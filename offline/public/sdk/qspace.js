!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).qspace=e()}(this,(function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return c(t,null==e?n.path:e)}},n.exports),n.exports}const n=Object.create(null),r=Object.create(null),i={id:"<rollup>",exports:{},parent:void 0,filename:null,loaded:!1,children:[],paths:[]},o=["",".js",".json"];function a(t){const e=(t=t.replace(/\\/g,"/")).split("/"),n=""===e[0];for(let t=1;t<e.length;t++)"."!==e[t]&&""!==e[t]||e.splice(t--,1);for(let t=1;t<e.length;t++)".."===e[t]&&t>0&&".."!==e[t-1]&&"."!==e[t-1]&&(e.splice(--t,2),t--);return t=e.join("/"),n&&"/"!==t[0]?t="/"+t:0===t.length&&(t="."),t}function s(){if(0===arguments.length)return".";let t;for(let e=0;e<arguments.length;++e){let n=arguments[e];n.length>0&&(void 0===t?t=n:t+="/"+n)}return void 0===t?".":t}function l(t){if(0===t.length)return".";let e=t.length-1;for(;e>0;){const n=t.charCodeAt(e);if((47===n||92===n)&&e!==t.length-1)break;e--}return e>0?t.substr(0,e):47===t.chartCodeAt(0)||92===t.chartCodeAt(0)?t.charAt(0):"."}function c(e,u){const h=function(t){let e=t[0];if("/"===e||"\\"===e)return!1;let n=t[1],r=t[2];return!(!("."!==e||n&&"/"!==n&&"\\"!==n)||!("."!==e||"."!==n||r&&"/"!==r&&"\\"!==r))&&(":"!==n||"/"!==r&&"\\"!==r)}(e);let p;for(e=a(e);;){p=h?a(u?u+"/node_modules/"+e:s("node_modules",e)):u?a(u+"/"+e):e;for(let e=0;e<o.length;e++){const a=p+o[e];let s=r[a];if(s)return s.exports;const u=n[a];if(u){r[a]=s={id:a,filename:a,path:l(a),exports:{},parent:i,loaded:!1,children:[],paths:[],require:function(t,e){return c(t,null==e?s.path:e)}};try{u.call(t,s,s.exports)}catch(t){throw delete r[a],t}return s.loaded=!0,s.exports}}if(!h)break;const d=a(u+"/..");if(d===u)break;u=d}return require(e)}c.cache=r;var u={__proto__:null,commonjsGlobal:t,createCommonjsModule:e,getCjsExportFromNamespace:function(t){return t&&t.default||t},commonjsRegister:function(t,e){n[t]=e},commonjsRequire:c};function h(){var t=!0,e=2;Object.defineProperties(this,{enabled:{get:function(){return t},set:function(e){t=e}},level:{get:function(){return e},set:function(t){e=t}}}),this.enabled=!1}u.commonjsRegister("/$$rollup_base$$/src/api/config.js",(function(t,e){t.exports={}})),h.prototype.echo=function(t,e){return this.enabled?((e=Array.prototype.slice.call(e)).unshift("sdk:"),e.unshift(console),Function.prototype.bind.apply(t,e)):function(){}},h.prototype.info=function(){return 1===this.level?this.echo(console.info,arguments):function(){}},h.prototype.debug=function(){return 1===this.level||2===this.level?this.echo(console.debug,arguments):function(){}},h.prototype.warn=function(){return 1===this.level||2===this.level||3===this.level?this.echo(console.warn,arguments):function(){}},h.prototype.error=function(){if(1===this.level||2===this.level||3===this.level||4===this.level)return this.echo(console.error,arguments)},h.prototype.time=function(){return this.echo(console.time,arguments)},h.prototype.timeEnd=function(){return this.echo(console.timeEnd,arguments)};var p=new h,d=e((function(e,n){e.exports=function(){var e=function(){var t=!0,e=1;Object.defineProperties(this,{enabled:{get:function(){return t},set:function(e){t=e}},level:{get:function(){return e},set:function(t){e=t}}})};e.prototype.echo=function(t,e,n){return this.enabled?(e=Array.prototype.slice.call(e),"table"!==n&&(e[0]="core: "+e[0]),e.unshift(console),Function.prototype.bind.apply(t,e)):function(){}},e.prototype.info=function(){return 1===this.level?this.echo(console.info,arguments):function(){}},e.prototype.debug=function(){return 1===this.level||2===this.level?this.echo(console.debug,arguments):function(){}},e.prototype.warn=function(){return 1===this.level||2===this.level||3===this.level?this.echo(console.warn,arguments):function(){}},e.prototype.error=function(){if(1===this.level||2===this.level||3===this.level||4===this.level)return this.echo(console.error,arguments)},e.prototype.time=function(){return this.echo(console.time,arguments,"time")},e.prototype.timeEnd=function(){return this.echo(console.timeEnd,arguments,"timeEnd")},e.prototype.trace=function(){return this.echo(console.trace,arguments,"trace")},e.prototype.table=function(){return this.echo(console.table,arguments,"table")};var n=new e,r=Object.create(null);r.type="browser default",Object.defineProperties(r,{input:{get:function(){return function(t,e){r[t]=e}}},output:{get:function(){return function(){n.table(r)()}}}}),r.input("window.Promise",!!window.Promise),r.input("Array.prototype.findIndex",!!Array.prototype.findIndex),r.input("window.navigator.vibrate",!!window.navigator.vibrate);var i=Object.create(null);i.type="vr session",Object.defineProperties(i,{input:{get:function(){return function(t,e){i[t]=e}}},output:{get:function(){return function(){n.table(i)()}}}});var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function a(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return s(null==e&&n.path)}},n.exports),n.exports}function s(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}a((function(t,e){!function(){function t(t){var e=this.constructor;return this.then((function(n){return e.resolve(t()).then((function(){return n}))}),(function(n){return e.resolve(t()).then((function(){return e.reject(n)}))}))}function e(t){return!(!t||void 0===t.length)}function n(){}function r(t){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function i(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,r._immediateFn((function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void s(e.promise,t)}a(e.promise,r)}else(1===t._state?a:s)(e.promise,t._value)}))):t._deferreds.push(e)}function a(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof r)return t._state=3,t._value=e,void l(t);if("function"==typeof n)return void c(function(t,e){return function(){t.apply(e,arguments)}}(n,e),t)}t._state=1,t._value=e,l(t)}catch(e){s(t,e)}}function s(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&r._immediateFn((function(){t._handled||r._unhandledRejectionFn(t._value)}));for(var e=0,n=t._deferreds.length;n>e;e++)i(t,t._deferreds[e]);t._deferreds=null}function c(t,e){var n=!1;try{t((function(t){n||(n=!0,a(e,t))}),(function(t){n||(n=!0,s(e,t))}))}catch(t){if(n)return;n=!0,s(e,t)}}var u=setTimeout;r.prototype.catch=function(t){return this.then(null,t)},r.prototype.then=function(t,e){var r=new this.constructor(n);return i(this,new function(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(t,e,r)),r},r.prototype.finally=t,r.all=function(t){return new r((function(n,r){function i(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var s=e.then;if("function"==typeof s)return void s.call(e,(function(e){i(t,e)}),r)}o[t]=e,0==--a&&n(o)}catch(t){r(t)}}if(!e(t))return r(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(t);if(0===o.length)return n([]);for(var a=o.length,s=0;o.length>s;s++)i(s,o[s])}))},r.resolve=function(t){return t&&"object"==typeof t&&t.constructor===r?t:new r((function(e){e(t)}))},r.reject=function(t){return new r((function(e,n){n(t)}))},r.race=function(t){return new r((function(n,i){if(!e(t))return i(new TypeError("Promise.race accepts an array"));for(var o=0,a=t.length;a>o;o++)r.resolve(t[o]).then(n,i)}))},r._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){u(t,0)},r._unhandledRejectionFn=function(t){void 0!==console&&console};var h=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==o)return o;throw Error("unable to locate global object")}();"Promise"in h?h.Promise.prototype.finally||(h.Promise.prototype.finally=t):h.Promise=r}()})),Object.defineProperty(Array.prototype,"findIndex",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<n;){var o=e[i];if(t.call(r,o,i,e))return i;i++}return-1}}),r["window.Promise"],r["Array.prototype.findIndex"];var l,c,u,h,p,d,f,m,v,g,y,_,E,T,x,b,M,A,S,O,w={DefaultSupport:r,VrSupport:i},L=a((function(t,e){
/**
	   * @license
	   * Copyright 2010-2021 Three.js Authors
	   * SPDX-License-Identifier: MIT
	   */
!function(t){var e=function(){};e.prototype.addEventListener=function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},e.prototype.hasEventListener=function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},e.prototype.removeEventListener=function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},e.prototype.dispatchEvent=function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t);t.target=null}}};for(var n=[],r=0;r<256;r++)n[r]=(r<16?"0":"")+r.toString(16);var i=1234567,o=Math.PI/180,a=180/Math.PI;function s(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(n[255&t]+n[t>>8&255]+n[t>>16&255]+n[t>>24&255]+"-"+n[255&e]+n[e>>8&255]+"-"+n[e>>16&15|64]+n[e>>24&255]+"-"+n[63&r|128]+n[r>>8&255]+"-"+n[r>>16&255]+n[r>>24&255]+n[255&i]+n[i>>8&255]+n[i>>16&255]+n[i>>24&255]).toUpperCase()}function l(t,e,n){return Math.max(e,Math.min(n,t))}function c(t,e){return(t%e+e)%e}function u(t,e,n){return(1-n)*t+n*e}function h(t){return 0==(t&t-1)&&0!==t}function p(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function d(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var f=Object.freeze({__proto__:null,DEG2RAD:o,RAD2DEG:a,generateUUID:s,clamp:l,euclideanModulo:c,mapLinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:u,damp:function(t,e,n,r){return u(t,e,1-Math.exp(-n*r))},pingpong:function(t,e){return void 0===e&&(e=1),e-Math.abs(c(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(i=t%2147483647),((i=16807*i%2147483647)-1)/2147483646},degToRad:function(t){return t*o},radToDeg:function(t){return t*a},isPowerOfTwo:h,ceilPowerOfTwo:p,floorPowerOfTwo:d,setQuaternionFromProperEuler:function(t,e,n,r,i){var o=Math.cos,a=Math.sin,s=o(n/2),l=a(n/2),c=o((e+r)/2),u=a((e+r)/2),h=o((e-r)/2),p=a((e-r)/2),d=o((r-e)/2),f=a((r-e)/2);switch(i){case"XYX":t.set(s*u,l*h,l*p,s*c);break;case"YZY":t.set(l*p,s*u,l*h,s*c);break;case"ZXZ":t.set(l*h,l*p,s*u,s*c);break;case"XZX":t.set(s*u,l*f,l*d,s*c);break;case"YXY":t.set(l*d,s*u,l*f,s*c);break;case"ZYZ":t.set(l*f,l*d,s*u,s*c)}}}),m=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},v={width:{configurable:!0},height:{configurable:!0}};v.width.get=function(){return this.x},v.width.set=function(t){this.x=t},v.height.get=function(){return this.y},v.height.set=function(t){this.y=t},m.prototype.set=function(t,e){return this.x=t,this.y=e,this},m.prototype.setScalar=function(t){return this.x=t,this.y=t,this},m.prototype.setX=function(t){return this.x=t,this},m.prototype.setY=function(t){return this.y=t,this},m.prototype.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},m.prototype.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},m.prototype.clone=function(){return new this.constructor(this.x,this.y)},m.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},m.prototype.add=function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this)},m.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},m.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},m.prototype.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},m.prototype.sub=function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this)},m.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this},m.prototype.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},m.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},m.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},m.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},m.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)},m.prototype.applyMatrix3=function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},m.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},m.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},m.prototype.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},m.prototype.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},m.prototype.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},m.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},m.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},m.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},m.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},m.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},m.prototype.dot=function(t){return this.x*t.x+this.y*t.y},m.prototype.cross=function(t){return this.x*t.y-this.y*t.x},m.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},m.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},m.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)},m.prototype.normalize=function(){return this.divideScalar(this.length()||1)},m.prototype.angle=function(){var t=Math.atan2(-this.y,-this.x)+Math.PI;return t},m.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},m.prototype.distanceToSquared=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},m.prototype.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},m.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},m.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},m.prototype.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},m.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},m.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},m.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},m.prototype.fromBufferAttribute=function(t,e,n){return this.x=t.getX(e),this.y=t.getY(e),this},m.prototype.rotateAround=function(t,e){var n=Math.cos(e),r=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*n-o*r+t.x,this.y=i*r+o*n+t.y,this},m.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this},Object.defineProperties(m.prototype,v),m.prototype.isVector2=!0;var g,y=function(){this.elements=[1,0,0,0,1,0,0,0,1]};y.prototype.set=function(t,e,n,r,i,o,a,s,l){var c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=n,c[7]=o,c[8]=l,this},y.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},y.prototype.copy=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},y.prototype.extractBasis=function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},y.prototype.setFromMatrix4=function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},y.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},y.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},y.prototype.multiplyMatrices=function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[3],s=n[6],l=n[1],c=n[4],u=n[7],h=n[2],p=n[5],d=n[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],_=r[7],E=r[2],T=r[5],x=r[8];return i[0]=o*f+a*g+s*E,i[3]=o*m+a*y+s*T,i[6]=o*v+a*_+s*x,i[1]=l*f+c*g+u*E,i[4]=l*m+c*y+u*T,i[7]=l*v+c*_+u*x,i[2]=h*f+p*g+d*E,i[5]=h*m+p*y+d*T,i[8]=h*v+p*_+d*x,this},y.prototype.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},y.prototype.determinant=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8];return e*o*c-e*a*l-n*i*c+n*a*s+r*i*l-r*o*s},y.prototype.invert=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=c*o-a*l,h=a*s-c*i,p=l*i-o*s,d=e*u+n*h+r*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);var f=1/d;return t[0]=u*f,t[1]=(r*l-c*n)*f,t[2]=(a*n-r*o)*f,t[3]=h*f,t[4]=(c*e-r*s)*f,t[5]=(r*i-a*e)*f,t[6]=p*f,t[7]=(n*s-l*e)*f,t[8]=(o*e-n*i)*f,this},y.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},y.prototype.getNormalMatrix=function(t){return this.setFromMatrix4(t).invert().transpose()},y.prototype.transposeIntoArray=function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},y.prototype.setUvTransform=function(t,e,n,r,i,o,a){var s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*o+l*a)+o+t,-r*l,r*s,-r*(-l*o+s*a)+a+e,0,0,1),this},y.prototype.scale=function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},y.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,i=r[0],o=r[3],a=r[6],s=r[1],l=r[4],c=r[7];return r[0]=e*i+n*s,r[3]=e*o+n*l,r[6]=e*a+n*c,r[1]=-n*i+e*s,r[4]=-n*o+e*l,r[7]=-n*a+e*c,this},y.prototype.translate=function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},y.prototype.equals=function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},y.prototype.fromArray=function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},y.prototype.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t},y.prototype.clone=function(){return(new this.constructor).fromArray(this.elements)},y.prototype.isMatrix3=!0;var _=function(){};_.getDataURL=function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;var e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===g&&(g=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),g.width=t.width,g.height=t.height;var n=g.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=g}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")};var E=0,T=function(t){function e(n,r,i,o,a,l,c,u,h,p){void 0===n&&(n=e.DEFAULT_IMAGE),void 0===r&&(r=e.DEFAULT_MAPPING),void 0===i&&(i=1001),void 0===o&&(o=1001),void 0===a&&(a=1006),void 0===l&&(l=1008),void 0===c&&(c=1023),void 0===u&&(u=1009),void 0===h&&(h=1),void 0===p&&(p=3e3),t.call(this),Object.defineProperty(this,"id",{value:E++}),this.uuid=s(),this.name="",this.image=n,this.mipmaps=[],this.mapping=r,this.wrapS=i,this.wrapT=o,this.magFilter=a,this.minFilter=l,this.anisotropy=h,this.format=c,this.internalFormat=null,this.type=u,this.offset=new m(0,0),this.repeat=new m(1,1),this.center=new m(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new y,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.version=0,this.onUpdate=null}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={needsUpdate:{configurable:!0}};return e.prototype.updateMatrix=function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},e.prototype.clone=function(){return(new this.constructor).copy(this)},e.prototype.copy=function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},e.prototype.toJSON=function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=s()),!e&&void 0===t.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var o=0,a=r.length;o<a;o++)r[o].isDataTexture?i.push(x(r[o].image)):i.push(x(r[o]))}else i=x(r);t.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},e.prototype.transformUv=function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t},n.needsUpdate.set=function(t){!0===t&&this.version++},Object.defineProperties(e.prototype,n),e}(e);function x(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?_.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:{}}T.DEFAULT_IMAGE=void 0,T.DEFAULT_MAPPING=300,T.prototype.isTexture=!0;var b=function(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=t,this.y=e,this.z=n,this.w=r},M={width:{configurable:!0},height:{configurable:!0}};M.width.get=function(){return this.z},M.width.set=function(t){this.z=t},M.height.get=function(){return this.w},M.height.set=function(t){this.w=t},b.prototype.set=function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},b.prototype.setScalar=function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},b.prototype.setX=function(t){return this.x=t,this},b.prototype.setY=function(t){return this.y=t,this},b.prototype.setZ=function(t){return this.z=t,this},b.prototype.setW=function(t){return this.w=t,this},b.prototype.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},b.prototype.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},b.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},b.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},b.prototype.add=function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},b.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},b.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},b.prototype.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},b.prototype.sub=function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},b.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},b.prototype.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},b.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},b.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},b.prototype.applyMatrix4=function(t){var e=this.x,n=this.y,r=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this},b.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)},b.prototype.setAxisAngleFromQuaternion=function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},b.prototype.setAxisAngleFromRotationMatrix=function(t){var e,n,r,i,o=t.elements,a=o[0],s=o[4],l=o[8],c=o[1],u=o[5],h=o[9],p=o[2],d=o[6],f=o[10];if(Math.abs(s-c)<.01&&Math.abs(l-p)<.01&&Math.abs(h-d)<.01){if(Math.abs(s+c)<.1&&Math.abs(l+p)<.1&&Math.abs(h+d)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var m=(a+1)/2,v=(u+1)/2,g=(f+1)/2,y=(s+c)/4,_=(l+p)/4,E=(h+d)/4;return m>v&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=_/n):v>g?v<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(v)),i=E/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=_/(i=Math.sqrt(g)),r=E/i),this.set(n,r,i,e),this}var T=Math.sqrt((d-h)*(d-h)+(l-p)*(l-p)+(c-s)*(c-s));return Math.abs(T)<.001&&(T=1),this.x=(d-h)/T,this.y=(l-p)/T,this.z=(c-s)/T,this.w=Math.acos((a+u+f-1)/2),this},b.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},b.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},b.prototype.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},b.prototype.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},b.prototype.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},b.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},b.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},b.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},b.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},b.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},b.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},b.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},b.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},b.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},b.prototype.normalize=function(){return this.divideScalar(this.length()||1)},b.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},b.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},b.prototype.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},b.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},b.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},b.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},b.prototype.fromBufferAttribute=function(t,e,n){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},b.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},Object.defineProperties(b.prototype,M),b.prototype.isVector4=!0;var A=function(t){function e(e,n,r){void 0===r&&(r={}),t.call(this),this.width=e,this.height=n,this.depth=1,this.scissor=new b(0,0,e,n),this.scissorTest=!1,this.viewport=new b(0,0,e,n),this.texture=new T(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={width:e,height:n,depth:1},this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:1006,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setTexture=function(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t},e.prototype.setSize=function(t,e,n){void 0===n&&(n=1),this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},e.prototype.clone=function(){return(new this.constructor).copy(this)},e.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=Object.assign({},this.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},e}(e);A.prototype.isWebGLRenderTarget=!0;var S=function(t){function e(e,n,r){t.call(this,e,n);var i=this.texture;this.texture=[];for(var o=0;o<r;o++)this.texture[o]=i.clone()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setSize=function(t,e,n){if(void 0===n&&(n=1),this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(var r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this},e.prototype.copy=function(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(var e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this},e}(A);S.prototype.isWebGLMultipleRenderTargets=!0;var O=function(t){function e(e,n,r){t.call(this,e,n,r),this.samples=4}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.samples=e.samples,this},e}(A);O.prototype.isWebGLMultisampleRenderTarget=!0;var w=function(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),this._x=t,this._y=e,this._z=n,this._w=r},L={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},w:{configurable:!0}};w.slerp=function(t,e,n,r){return n.slerpQuaternions(t,e,r)},w.slerpFlat=function(t,e,n,r,i,o,a){var s=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3],h=i[o+0],p=i[o+1],d=i[o+2],f=i[o+3];if(0===a)return t[e+0]=s,t[e+1]=l,t[e+2]=c,void(t[e+3]=u);if(1===a)return t[e+0]=h,t[e+1]=p,t[e+2]=d,void(t[e+3]=f);if(u!==f||s!==h||l!==p||c!==d){var m=1-a,v=s*h+l*p+c*d+u*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var _=Math.sqrt(y),E=Math.atan2(_,v*g);m=Math.sin(m*E)/_,a=Math.sin(a*E)/_}var T=a*g;if(s=s*m+h*T,l=l*m+p*T,c=c*m+d*T,u=u*m+f*T,m===1-a){var x=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=x,l*=x,c*=x,u*=x}}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=u},w.multiplyQuaternionsFlat=function(t,e,n,r,i,o){var a=n[r],s=n[r+1],l=n[r+2],c=n[r+3],u=i[o],h=i[o+1],p=i[o+2],d=i[o+3];return t[e]=a*d+c*u+s*p-l*h,t[e+1]=s*d+c*h+l*u-a*p,t[e+2]=l*d+c*p+a*h-s*u,t[e+3]=c*d-a*u-s*h-l*p,t},L.x.get=function(){return this._x},L.x.set=function(t){this._x=t,this._onChangeCallback()},L.y.get=function(){return this._y},L.y.set=function(t){this._y=t,this._onChangeCallback()},L.z.get=function(){return this._z},L.z.set=function(t){this._z=t,this._onChangeCallback()},L.w.get=function(){return this._w},L.w.set=function(t){this._w=t,this._onChangeCallback()},w.prototype.set=function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},w.prototype.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},w.prototype.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},w.prototype.setFromEuler=function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,i=t._z,o=t._order,a=Math.cos,s=Math.sin,l=a(n/2),c=a(r/2),u=a(i/2),h=s(n/2),p=s(r/2),d=s(i/2);switch(o){case"XYZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"YXZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"ZXY":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"ZYX":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"YZX":this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d;break;case"XZY":this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d}return!1!==e&&this._onChangeCallback(),this},w.prototype.setFromAxisAngle=function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},w.prototype.setFromRotationMatrix=function(t){var e=t.elements,n=e[0],r=e[4],i=e[8],o=e[1],a=e[5],s=e[9],l=e[2],c=e[6],u=e[10],h=n+a+u;if(h>0){var p=.5/Math.sqrt(h+1);this._w=.25/p,this._x=(c-s)*p,this._y=(i-l)*p,this._z=(o-r)*p}else if(n>a&&n>u){var d=2*Math.sqrt(1+n-a-u);this._w=(c-s)/d,this._x=.25*d,this._y=(r+o)/d,this._z=(i+l)/d}else if(a>u){var f=2*Math.sqrt(1+a-n-u);this._w=(i-l)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(s+c)/f}else{var m=2*Math.sqrt(1+u-n-a);this._w=(o-r)/m,this._x=(i+l)/m,this._y=(s+c)/m,this._z=.25*m}return this._onChangeCallback(),this},w.prototype.setFromUnitVectors=function(t,e){var n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},w.prototype.angleTo=function(t){return 2*Math.acos(Math.abs(l(this.dot(t),-1,1)))},w.prototype.rotateTowards=function(t,e){var n=this.angleTo(t);if(0===n)return this;var r=Math.min(1,e/n);return this.slerp(t,r),this},w.prototype.identity=function(){return this.set(0,0,0,1)},w.prototype.invert=function(){return this.conjugate()},w.prototype.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},w.prototype.dot=function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},w.prototype.lengthSq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},w.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},w.prototype.normalize=function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},w.prototype.multiply=function(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)},w.prototype.premultiply=function(t){return this.multiplyQuaternions(t,this)},w.prototype.multiplyQuaternions=function(t,e){var n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,l=e._z,c=e._w;return this._x=n*c+o*a+r*l-i*s,this._y=r*c+o*s+i*a-n*l,this._z=i*c+o*l+n*s-r*a,this._w=o*c-n*a-r*s-i*l,this._onChangeCallback(),this},w.prototype.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-e;return this._w=l*o+e*this._w,this._x=l*n+e*this._x,this._y=l*r+e*this._y,this._z=l*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),u=Math.atan2(c,a),h=Math.sin((1-e)*u)/c,p=Math.sin(e*u)/c;return this._w=o*h+this._w*p,this._x=n*h+this._x*p,this._y=r*h+this._y*p,this._z=i*h+this._z*p,this._onChangeCallback(),this},w.prototype.slerpQuaternions=function(t,e,n){this.copy(t).slerp(e,n)},w.prototype.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},w.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},w.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},w.prototype.fromBufferAttribute=function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},w.prototype._onChange=function(t){return this._onChangeCallback=t,this},w.prototype._onChangeCallback=function(){},Object.defineProperties(w.prototype,L),w.prototype.isQuaternion=!0;var D=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n};D.prototype.set=function(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this},D.prototype.setScalar=function(t){return this.x=t,this.y=t,this.z=t,this},D.prototype.setX=function(t){return this.x=t,this},D.prototype.setY=function(t){return this.y=t,this},D.prototype.setZ=function(t){return this.z=t,this},D.prototype.setComponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},D.prototype.getComponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},D.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z)},D.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},D.prototype.add=function(t,e){return void 0!==e?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},D.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},D.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},D.prototype.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},D.prototype.sub=function(t,e){return void 0!==e?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},D.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},D.prototype.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},D.prototype.multiply=function(t,e){return void 0!==e?this.multiplyVectors(t,e):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},D.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},D.prototype.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},D.prototype.applyEuler=function(t){return!t||t.isEuler,this.applyQuaternion(P.setFromEuler(t))},D.prototype.applyAxisAngle=function(t,e){return this.applyQuaternion(P.setFromAxisAngle(t,e))},D.prototype.applyMatrix3=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},D.prototype.applyNormalMatrix=function(t){return this.applyMatrix3(t).normalize()},D.prototype.applyMatrix4=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,o=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*o,this},D.prototype.applyQuaternion=function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,l=s*e+o*r-a*n,c=s*n+a*e-i*r,u=s*r+i*n-o*e,h=-i*e-o*n-a*r;return this.x=l*s+h*-i+c*-a-u*-o,this.y=c*s+h*-o+u*-i-l*-a,this.z=u*s+h*-a+l*-o-c*-i,this},D.prototype.project=function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},D.prototype.unproject=function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},D.prototype.transformDirection=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},D.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},D.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)},D.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},D.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},D.prototype.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},D.prototype.clampScalar=function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},D.prototype.clampLength=function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},D.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},D.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},D.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},D.prototype.roundToZero=function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},D.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},D.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},D.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},D.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},D.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},D.prototype.normalize=function(){return this.divideScalar(this.length()||1)},D.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},D.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},D.prototype.lerpVectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},D.prototype.cross=function(t,e){return void 0!==e?this.crossVectors(t,e):this.crossVectors(this,t)},D.prototype.crossVectors=function(t,e){var n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},D.prototype.projectOnVector=function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},D.prototype.projectOnPlane=function(t){return C.copy(this).projectOnVector(t),this.sub(C)},D.prototype.reflect=function(t){return this.sub(C.copy(t).multiplyScalar(2*this.dot(t)))},D.prototype.angleTo=function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(l(n,-1,1))},D.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},D.prototype.distanceToSquared=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},D.prototype.manhattanDistanceTo=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},D.prototype.setFromSpherical=function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},D.prototype.setFromSphericalCoords=function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},D.prototype.setFromCylindrical=function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},D.prototype.setFromCylindricalCoords=function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},D.prototype.setFromMatrixPosition=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},D.prototype.setFromMatrixScale=function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},D.prototype.setFromMatrixColumn=function(t,e){return this.fromArray(t.elements,4*e)},D.prototype.setFromMatrix3Column=function(t,e){return this.fromArray(t.elements,3*e)},D.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},D.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},D.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},D.prototype.fromBufferAttribute=function(t,e,n){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},D.prototype.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this},D.prototype.isVector3=!0;var C=new D,P=new w,N=function(t,e){void 0===t&&(t=new D(1/0,1/0,1/0)),void 0===e&&(e=new D(-1/0,-1/0,-1/0)),this.min=t,this.max=e};N.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},N.prototype.setFromArray=function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;s<l;s+=3){var c=t[s],u=t[s+1],h=t[s+2];c<e&&(e=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},N.prototype.setFromBufferAttribute=function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.count;s<l;s++){var c=t.getX(s),u=t.getY(s),h=t.getZ(s);c<e&&(e=c),u<n&&(n=u),h<r&&(r=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,n,r),this.max.set(i,o,a),this},N.prototype.setFromPoints=function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},N.prototype.setFromCenterAndSize=function(t,e){var n=I.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},N.prototype.setFromObject=function(t){return this.makeEmpty(),this.expandByObject(t)},N.prototype.clone=function(){return(new this.constructor).copy(this)},N.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},N.prototype.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},N.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},N.prototype.getCenter=function(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},N.prototype.getSize=function(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},N.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},N.prototype.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},N.prototype.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},N.prototype.expandByObject=function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),U.copy(e.boundingBox),U.applyMatrix4(t.matrixWorld),this.union(U));for(var n=t.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this},N.prototype.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},N.prototype.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},N.prototype.getParameter=function(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},N.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},N.prototype.intersectsSphere=function(t){return this.clampPoint(t.center,I),I.distanceToSquared(t.center)<=t.radius*t.radius},N.prototype.intersectsPlane=function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},N.prototype.intersectsTriangle=function(t){if(this.isEmpty())return!1;this.getCenter(W),V.subVectors(this.max,W),B.subVectors(t.a,W),F.subVectors(t.b,W),H.subVectors(t.c,W),k.subVectors(F,B),z.subVectors(H,F),G.subVectors(B,H);var e=[0,-k.z,k.y,0,-z.z,z.y,0,-G.z,G.y,k.z,0,-k.x,z.z,0,-z.x,G.z,0,-G.x,-k.y,k.x,0,-z.y,z.x,0,-G.y,G.x,0];return!!X(e,B,F,H,V)&&!!X(e=[1,0,0,0,1,0,0,0,1],B,F,H,V)&&(j.crossVectors(k,z),X(e=[j.x,j.y,j.z],B,F,H,V))},N.prototype.clampPoint=function(t,e){return e.copy(t).clamp(this.min,this.max)},N.prototype.distanceToPoint=function(t){return I.copy(t).clamp(this.min,this.max).sub(t).length()},N.prototype.getBoundingSphere=function(t){return this.getCenter(t.center),t.radius=.5*this.getSize(I).length(),t},N.prototype.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},N.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},N.prototype.applyMatrix4=function(t){return this.isEmpty()||(R[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),R[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),R[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),R[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),R[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),R[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),R[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),R[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(R)),this},N.prototype.translate=function(t){return this.min.add(t),this.max.add(t),this},N.prototype.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},N.prototype.isBox3=!0;var R=[new D,new D,new D,new D,new D,new D,new D,new D],I=new D,U=new N,B=new D,F=new D,H=new D,k=new D,z=new D,G=new D,W=new D,V=new D,j=new D,Y=new D;function X(t,e,n,r,i){for(var o=0,a=t.length-3;o<=a;o+=3){Y.fromArray(t,o);var s=i.x*Math.abs(Y.x)+i.y*Math.abs(Y.y)+i.z*Math.abs(Y.z),l=e.dot(Y),c=n.dot(Y),u=r.dot(Y);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}var Z=new N,q=new D,Q=new D,K=new D,J=function(t,e){void 0===t&&(t=new D),void 0===e&&(e=-1),this.center=t,this.radius=e};J.prototype.set=function(t,e){return this.center.copy(t),this.radius=e,this},J.prototype.setFromPoints=function(t,e){var n=this.center;void 0!==e?n.copy(e):Z.setFromPoints(t).getCenter(n);for(var r=0,i=0,o=t.length;i<o;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this},J.prototype.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},J.prototype.isEmpty=function(){return this.radius<0},J.prototype.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},J.prototype.containsPoint=function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},J.prototype.distanceToPoint=function(t){return t.distanceTo(this.center)-this.radius},J.prototype.intersectsSphere=function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},J.prototype.intersectsBox=function(t){return t.intersectsSphere(this)},J.prototype.intersectsPlane=function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},J.prototype.clampPoint=function(t,e){var n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},J.prototype.getBoundingBox=function(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},J.prototype.applyMatrix4=function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},J.prototype.translate=function(t){return this.center.add(t),this},J.prototype.expandByPoint=function(t){K.subVectors(t,this.center);var e=K.lengthSq();if(e>this.radius*this.radius){var n=Math.sqrt(e),r=.5*(n-this.radius);this.center.add(K.multiplyScalar(r/n)),this.radius+=r}return this},J.prototype.union=function(t){return Q.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(q.copy(t.center).add(Q)),this.expandByPoint(q.copy(t.center).sub(Q)),this},J.prototype.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius},J.prototype.clone=function(){return(new this.constructor).copy(this)};var $=new D,tt=new D,et=new D,nt=new D,rt=new D,it=new D,ot=new D,at=function(t,e){void 0===t&&(t=new D),void 0===e&&(e=new D(0,0,-1)),this.origin=t,this.direction=e};at.prototype.set=function(t,e){return this.origin.copy(t),this.direction.copy(e),this},at.prototype.copy=function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at.prototype.at=function(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)},at.prototype.lookAt=function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},at.prototype.recast=function(t){return this.origin.copy(this.at(t,$)),this},at.prototype.closestPointToPoint=function(t,e){e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},at.prototype.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},at.prototype.distanceSqToPoint=function(t){var e=$.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):($.copy(this.direction).multiplyScalar(e).add(this.origin),$.distanceToSquared(t))},at.prototype.distanceSqToSegment=function(t,e,n,r){tt.copy(t).add(e).multiplyScalar(.5),et.copy(e).sub(t).normalize(),nt.copy(this.origin).sub(tt);var i,o,a,s,l=.5*t.distanceTo(e),c=-this.direction.dot(et),u=nt.dot(this.direction),h=-nt.dot(et),p=nt.lengthSq(),d=Math.abs(1-c*c);if(d>0)if(o=c*u-h,s=l*d,(i=c*h-u)>=0)if(o>=-s)if(o<=s){var f=1/d;a=(i*=f)*(i+c*(o*=f)+2*u)+o*(c*i+o+2*h)+p}else o=l,a=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*h)+p;else o=-l,a=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*h)+p;else o<=-s?a=-(i=Math.max(0,-(-c*l+u)))*i+(o=i>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p:o<=s?(i=0,a=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+p):a=-(i=Math.max(0,-(c*l+u)))*i+(o=i>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p;else o=c>0?-l:l,a=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*h)+p;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(et).multiplyScalar(o).add(tt),a},at.prototype.intersectSphere=function(t,e){$.subVectors(t.center,this.origin);var n=$.dot(this.direction),r=$.dot($)-n*n,i=t.radius*t.radius;if(r>i)return null;var o=Math.sqrt(i-r),a=n-o,s=n+o;return a<0&&s<0?null:a<0?this.at(s,e):this.at(a,e)},at.prototype.intersectsSphere=function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},at.prototype.distanceToPlane=function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},at.prototype.intersectPlane=function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},at.prototype.intersectsPlane=function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},at.prototype.intersectBox=function(t,e){var n,r,i,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(n=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,o=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,o=(t.min.y-h.y)*c),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),u>=0?(a=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(a=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),n>s||a>r?null:((a>n||n!=n)&&(n=a),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))},at.prototype.intersectsBox=function(t){return null!==this.intersectBox(t,$)},at.prototype.intersectTriangle=function(t,e,n,r,i){rt.subVectors(e,t),it.subVectors(n,t),ot.crossVectors(rt,it);var o,a=this.direction.dot(ot);if(a>0){if(r)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}nt.subVectors(this.origin,t);var s=o*this.direction.dot(it.crossVectors(nt,it));if(s<0)return null;var l=o*this.direction.dot(rt.cross(nt));if(l<0)return null;if(s+l>a)return null;var c=-o*nt.dot(ot);return c<0?null:this.at(c/a,i)},at.prototype.applyMatrix4=function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},at.prototype.equals=function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},at.prototype.clone=function(){return(new this.constructor).copy(this)};var st=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};st.prototype.set=function(t,e,n,r,i,o,a,s,l,c,u,h,p,d,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=r,v[1]=i,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=u,v[14]=h,v[3]=p,v[7]=d,v[11]=f,v[15]=m,this},st.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},st.prototype.clone=function(){return(new st).fromArray(this.elements)},st.prototype.copy=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},st.prototype.copyPosition=function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},st.prototype.setFromMatrix3=function(t){var e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this},st.prototype.extractBasis=function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},st.prototype.makeBasis=function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},st.prototype.extractRotation=function(t){var e=this.elements,n=t.elements,r=1/lt.setFromMatrixColumn(t,0).length(),i=1/lt.setFromMatrixColumn(t,1).length(),o=1/lt.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},st.prototype.makeRotationFromEuler=function(t){!t||t.isEuler;var e=this.elements,n=t.x,r=t.y,i=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(r),l=Math.sin(r),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){var h=o*c,p=o*u,d=a*c,f=a*u;e[0]=s*c,e[4]=-s*u,e[8]=l,e[1]=p+d*l,e[5]=h-f*l,e[9]=-a*s,e[2]=f-h*l,e[6]=d+p*l,e[10]=o*s}else if("YXZ"===t.order){var m=s*c,v=s*u,g=l*c,y=l*u;e[0]=m+y*a,e[4]=g*a-v,e[8]=o*l,e[1]=o*u,e[5]=o*c,e[9]=-a,e[2]=v*a-g,e[6]=y+m*a,e[10]=o*s}else if("ZXY"===t.order){var _=s*c,E=s*u,T=l*c,x=l*u;e[0]=_-x*a,e[4]=-o*u,e[8]=T+E*a,e[1]=E+T*a,e[5]=o*c,e[9]=x-_*a,e[2]=-o*l,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){var b=o*c,M=o*u,A=a*c,S=a*u;e[0]=s*c,e[4]=A*l-M,e[8]=b*l+S,e[1]=s*u,e[5]=S*l+b,e[9]=M*l-A,e[2]=-l,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var O=o*s,w=o*l,L=a*s,D=a*l;e[0]=s*c,e[4]=D-O*u,e[8]=L*u+w,e[1]=u,e[5]=o*c,e[9]=-a*c,e[2]=-l*c,e[6]=w*u+L,e[10]=O-D*u}else if("XZY"===t.order){var C=o*s,P=o*l,N=a*s,R=a*l;e[0]=s*c,e[4]=-u,e[8]=l*c,e[1]=C*u+R,e[5]=o*c,e[9]=P*u-N,e[2]=N*u-P,e[6]=a*c,e[10]=R*u+C}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},st.prototype.makeRotationFromQuaternion=function(t){return this.compose(ut,t,ht)},st.prototype.lookAt=function(t,e,n){var r=this.elements;return ft.subVectors(t,e),0===ft.lengthSq()&&(ft.z=1),ft.normalize(),pt.crossVectors(n,ft),0===pt.lengthSq()&&(1===Math.abs(n.z)?ft.x+=1e-4:ft.z+=1e-4,ft.normalize(),pt.crossVectors(n,ft)),pt.normalize(),dt.crossVectors(ft,pt),r[0]=pt.x,r[4]=dt.x,r[8]=ft.x,r[1]=pt.y,r[5]=dt.y,r[9]=ft.y,r[2]=pt.z,r[6]=dt.z,r[10]=ft.z,this},st.prototype.multiply=function(t,e){return void 0!==e?this.multiplyMatrices(t,e):this.multiplyMatrices(this,t)},st.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},st.prototype.multiplyMatrices=function(t,e){var n=t.elements,r=e.elements,i=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],p=n[13],d=n[2],f=n[6],m=n[10],v=n[14],g=n[3],y=n[7],_=n[11],E=n[15],T=r[0],x=r[4],b=r[8],M=r[12],A=r[1],S=r[5],O=r[9],w=r[13],L=r[2],D=r[6],C=r[10],P=r[14],N=r[3],R=r[7],I=r[11],U=r[15];return i[0]=o*T+a*A+s*L+l*N,i[4]=o*x+a*S+s*D+l*R,i[8]=o*b+a*O+s*C+l*I,i[12]=o*M+a*w+s*P+l*U,i[1]=c*T+u*A+h*L+p*N,i[5]=c*x+u*S+h*D+p*R,i[9]=c*b+u*O+h*C+p*I,i[13]=c*M+u*w+h*P+p*U,i[2]=d*T+f*A+m*L+v*N,i[6]=d*x+f*S+m*D+v*R,i[10]=d*b+f*O+m*C+v*I,i[14]=d*M+f*w+m*P+v*U,i[3]=g*T+y*A+_*L+E*N,i[7]=g*x+y*S+_*D+E*R,i[11]=g*b+y*O+_*C+E*I,i[15]=g*M+y*w+_*P+E*U,this},st.prototype.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},st.prototype.determinant=function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],p=t[14];return t[3]*(+i*s*u-r*l*u-i*a*h+n*l*h+r*a*p-n*s*p)+t[7]*(+e*s*p-e*l*h+i*o*h-r*o*p+r*l*c-i*s*c)+t[11]*(+e*l*u-e*a*p-i*o*u+n*o*p+i*a*c-n*l*c)+t[15]*(-r*a*c-e*s*u+e*a*h+r*o*u-n*o*h+n*s*c)},st.prototype.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},st.prototype.setPosition=function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},st.prototype.invert=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],d=t[12],f=t[13],m=t[14],v=t[15],g=u*m*l-f*h*l+f*s*p-a*m*p-u*s*v+a*h*v,y=d*h*l-c*m*l-d*s*p+o*m*p+c*s*v-o*h*v,_=c*f*l-d*u*l+d*a*p-o*f*p-c*a*v+o*u*v,E=d*u*s-c*f*s-d*a*h+o*f*h+c*a*m-o*u*m,T=e*g+n*y+r*_+i*E;if(0===T)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var x=1/T;return t[0]=g*x,t[1]=(f*h*i-u*m*i-f*r*p+n*m*p+u*r*v-n*h*v)*x,t[2]=(a*m*i-f*s*i+f*r*l-n*m*l-a*r*v+n*s*v)*x,t[3]=(u*s*i-a*h*i-u*r*l+n*h*l+a*r*p-n*s*p)*x,t[4]=y*x,t[5]=(c*m*i-d*h*i+d*r*p-e*m*p-c*r*v+e*h*v)*x,t[6]=(d*s*i-o*m*i-d*r*l+e*m*l+o*r*v-e*s*v)*x,t[7]=(o*h*i-c*s*i+c*r*l-e*h*l-o*r*p+e*s*p)*x,t[8]=_*x,t[9]=(d*u*i-c*f*i-d*n*p+e*f*p+c*n*v-e*u*v)*x,t[10]=(o*f*i-d*a*i+d*n*l-e*f*l-o*n*v+e*a*v)*x,t[11]=(c*a*i-o*u*i-c*n*l+e*u*l+o*n*p-e*a*p)*x,t[12]=E*x,t[13]=(c*f*r-d*u*r+d*n*h-e*f*h-c*n*m+e*u*m)*x,t[14]=(d*a*r-o*f*r-d*n*s+e*f*s+o*n*m-e*a*m)*x,t[15]=(o*u*r-c*a*r+c*n*s-e*u*s-o*n*h+e*a*h)*x,this},st.prototype.scale=function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},st.prototype.getMaxScaleOnAxis=function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},st.prototype.makeTranslation=function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},st.prototype.makeRotationX=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},st.prototype.makeRotationY=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},st.prototype.makeRotationZ=function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},st.prototype.makeRotationAxis=function(t,e){var n=Math.cos(e),r=Math.sin(e),i=1-n,o=t.x,a=t.y,s=t.z,l=i*o,c=i*a;return this.set(l*o+n,l*a-r*s,l*s+r*a,0,l*a+r*s,c*a+n,c*s-r*o,0,l*s-r*a,c*s+r*o,i*s*s+n,0,0,0,0,1),this},st.prototype.makeScale=function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},st.prototype.makeShear=function(t,e,n,r,i,o){return this.set(1,n,i,0,t,1,o,0,e,r,1,0,0,0,0,1),this},st.prototype.compose=function(t,e,n){var r=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,l=i+i,c=o+o,u=a+a,h=i*l,p=i*c,d=i*u,f=o*c,m=o*u,v=a*u,g=s*l,y=s*c,_=s*u,E=n.x,T=n.y,x=n.z;return r[0]=(1-(f+v))*E,r[1]=(p+_)*E,r[2]=(d-y)*E,r[3]=0,r[4]=(p-_)*T,r[5]=(1-(h+v))*T,r[6]=(m+g)*T,r[7]=0,r[8]=(d+y)*x,r[9]=(m-g)*x,r[10]=(1-(h+f))*x,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},st.prototype.decompose=function(t,e,n){var r=this.elements,i=lt.set(r[0],r[1],r[2]).length(),o=lt.set(r[4],r[5],r[6]).length(),a=lt.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],ct.copy(this);var s=1/i,l=1/o,c=1/a;return ct.elements[0]*=s,ct.elements[1]*=s,ct.elements[2]*=s,ct.elements[4]*=l,ct.elements[5]*=l,ct.elements[6]*=l,ct.elements[8]*=c,ct.elements[9]*=c,ct.elements[10]*=c,e.setFromRotationMatrix(ct),n.x=i,n.y=o,n.z=a,this},st.prototype.makePerspective=function(t,e,n,r,i,o){var a=this.elements,s=2*i/(e-t),l=2*i/(n-r),c=(e+t)/(e-t),u=(n+r)/(n-r),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},st.prototype.makeOrthographic=function(t,e,n,r,i,o){var a=this.elements,s=1/(e-t),l=1/(n-r),c=1/(o-i),u=(e+t)*s,h=(n+r)*l,p=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},st.prototype.equals=function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},st.prototype.fromArray=function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},st.prototype.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},st.prototype.isMatrix4=!0;var lt=new D,ct=new st,ut=new D(0,0,0),ht=new D(1,1,1),pt=new D,dt=new D,ft=new D,mt=new st,vt=new w,gt=function t(e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=t.DefaultOrder),this._x=e,this._y=n,this._z=r,this._order=i},yt={x:{configurable:!0},y:{configurable:!0},z:{configurable:!0},order:{configurable:!0}};yt.x.get=function(){return this._x},yt.x.set=function(t){this._x=t,this._onChangeCallback()},yt.y.get=function(){return this._y},yt.y.set=function(t){this._y=t,this._onChangeCallback()},yt.z.get=function(){return this._z},yt.z.set=function(t){this._z=t,this._onChangeCallback()},yt.order.get=function(){return this._order},yt.order.set=function(t){this._order=t,this._onChangeCallback()},gt.prototype.set=function(t,e,n,r){return void 0===r&&(r=this._order),this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this},gt.prototype.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)},gt.prototype.copy=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},gt.prototype.setFromRotationMatrix=function(t,e,n){void 0===e&&(e=this._order),void 0===n&&(n=!0);var r=t.elements,i=r[0],o=r[4],a=r[8],s=r[1],c=r[5],u=r[9],h=r[2],p=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(l(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-l(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(s,c)):(this._y=Math.atan2(-h,i),this._z=0);break;case"ZXY":this._x=Math.asin(l(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-l(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(l(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-l(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-u,d),this._y=0)}return this._order=e,!0===n&&this._onChangeCallback(),this},gt.prototype.setFromQuaternion=function(t,e,n){return mt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(mt,e,n)},gt.prototype.setFromVector3=function(t,e){return void 0===e&&(e=this._order),this.set(t.x,t.y,t.z,e)},gt.prototype.reorder=function(t){return vt.setFromEuler(this),this.setFromQuaternion(vt,t)},gt.prototype.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},gt.prototype.fromArray=function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},gt.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},gt.prototype.toVector3=function(t){return t?t.set(this._x,this._y,this._z):new D(this._x,this._y,this._z)},gt.prototype._onChange=function(t){return this._onChangeCallback=t,this},gt.prototype._onChangeCallback=function(){},Object.defineProperties(gt.prototype,yt),gt.prototype.isEuler=!0,gt.DefaultOrder="XYZ",gt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var _t=function(){this.mask=1};_t.prototype.set=function(t){this.mask=1<<t|0},_t.prototype.enable=function(t){this.mask|=1<<t|0},_t.prototype.enableAll=function(){this.mask=-1},_t.prototype.toggle=function(t){this.mask^=1<<t|0},_t.prototype.disable=function(t){this.mask&=~(1<<t|0)},_t.prototype.disableAll=function(){this.mask=0},_t.prototype.test=function(t){return 0!=(this.mask&t.mask)};var Et=0,Tt=new D,xt=new w,bt=new st,Mt=new D,At=new D,St=new D,Ot=new w,wt=new D(1,0,0),Lt=new D(0,1,0),Dt=new D(0,0,1),Ct={type:"added"},Pt={type:"removed"},Nt=function(t){function e(){t.call(this),Object.defineProperty(this,"id",{value:Et++}),this.uuid=s(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=e.DefaultUp.clone();var n=new D,r=new gt,i=new w,o=new D(1,1,1);r._onChange((function(){i.setFromEuler(r,!1)})),i._onChange((function(){r.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new st},normalMatrix:{value:new y}}),this.matrix=new st,this.matrixWorld=new st,this.matrixAutoUpdate=e.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new _t,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onBeforeRender=function(){},e.prototype.onAfterRender=function(){},e.prototype.applyMatrix4=function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},e.prototype.applyQuaternion=function(t){return this.quaternion.premultiply(t),this},e.prototype.setRotationFromAxisAngle=function(t,e){this.quaternion.setFromAxisAngle(t,e)},e.prototype.setRotationFromEuler=function(t){this.quaternion.setFromEuler(t,!0)},e.prototype.setRotationFromMatrix=function(t){this.quaternion.setFromRotationMatrix(t)},e.prototype.setRotationFromQuaternion=function(t){this.quaternion.copy(t)},e.prototype.rotateOnAxis=function(t,e){return xt.setFromAxisAngle(t,e),this.quaternion.multiply(xt),this},e.prototype.rotateOnWorldAxis=function(t,e){return xt.setFromAxisAngle(t,e),this.quaternion.premultiply(xt),this},e.prototype.rotateX=function(t){return this.rotateOnAxis(wt,t)},e.prototype.rotateY=function(t){return this.rotateOnAxis(Lt,t)},e.prototype.rotateZ=function(t){return this.rotateOnAxis(Dt,t)},e.prototype.translateOnAxis=function(t,e){return Tt.copy(t).applyQuaternion(this.quaternion),this.position.add(Tt.multiplyScalar(e)),this},e.prototype.translateX=function(t){return this.translateOnAxis(wt,t)},e.prototype.translateY=function(t){return this.translateOnAxis(Lt,t)},e.prototype.translateZ=function(t){return this.translateOnAxis(Dt,t)},e.prototype.localToWorld=function(t){return t.applyMatrix4(this.matrixWorld)},e.prototype.worldToLocal=function(t){return t.applyMatrix4(bt.copy(this.matrixWorld).invert())},e.prototype.lookAt=function(t,e,n){t.isVector3?Mt.copy(t):Mt.set(t,e,n);var r=this.parent;this.updateWorldMatrix(!0,!1),At.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?bt.lookAt(At,Mt,this.up):bt.lookAt(Mt,At,this.up),this.quaternion.setFromRotationMatrix(bt),r&&(bt.extractRotation(r.matrixWorld),xt.setFromRotationMatrix(bt),this.quaternion.premultiply(xt.invert()))},e.prototype.add=function(t){var e=arguments;if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(e[n]);return this}return t===this||t&&t.isObject3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ct)),this},e.prototype.remove=function(t){var e=arguments;if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.remove(e[n]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(Pt)),this},e.prototype.removeFromParent=function(){var t=this.parent;return null!==t&&t.remove(this),this},e.prototype.clear=function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.parent=null,e.dispatchEvent(Pt)}return this.children.length=0,this},e.prototype.attach=function(t){return this.updateWorldMatrix(!0,!1),bt.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),bt.multiply(t.parent.matrixWorld)),t.applyMatrix4(bt),this.add(t),t.updateWorldMatrix(!1,!0),this},e.prototype.getObjectById=function(t){return this.getObjectByProperty("id",t)},e.prototype.getObjectByName=function(t){return this.getObjectByProperty("name",t)},e.prototype.getObjectByProperty=function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}},e.prototype.getWorldPosition=function(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},e.prototype.getWorldQuaternion=function(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(At,t,St),t},e.prototype.getWorldScale=function(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(At,Ot,t),t},e.prototype.getWorldDirection=function(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},e.prototype.raycast=function(){},e.prototype.traverse=function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},e.prototype.traverseVisible=function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},e.prototype.traverseAncestors=function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},e.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},e.prototype.updateMatrixWorld=function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},e.prototype.updateWorldMatrix=function(t,e){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var r=this.children,i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)},e.prototype.toJSON=function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var c=a[s];i(t.shapes,c)}else i(t.shapes,a)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var u=[],h=0,p=this.material.length;h<p;h++)u.push(i(t.materials,this.material[h]));r.material=u}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(var d=0;d<this.children.length;d++)r.children.push(this.children[d].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(var f=0;f<this.animations.length;f++){var m=this.animations[f];r.animations.push(i(t.animations,m))}}if(e){var v=b(t.geometries),g=b(t.materials),y=b(t.textures),_=b(t.images),E=b(t.shapes),T=b(t.skeletons),x=b(t.animations);v.length>0&&(n.geometries=v),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),_.length>0&&(n.images=_),E.length>0&&(n.shapes=E),T.length>0&&(n.skeletons=T),x.length>0&&(n.animations=x)}return n.object=r,n;function b(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}},e.prototype.clone=function(t){return(new this.constructor).copy(this,t)},e.prototype.copy=function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this},e}(e);Nt.DefaultUp=new D(0,1,0),Nt.DefaultMatrixAutoUpdate=!0,Nt.prototype.isObject3D=!0;var Rt=new D,It=new D,Ut=new D,Bt=new D,Ft=new D,Ht=new D,kt=new D,zt=new D,Gt=new D,Wt=new D,Vt=function(t,e,n){void 0===t&&(t=new D),void 0===e&&(e=new D),void 0===n&&(n=new D),this.a=t,this.b=e,this.c=n};Vt.getNormal=function(t,e,n,r){r.subVectors(n,e),Rt.subVectors(t,e),r.cross(Rt);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},Vt.getBarycoord=function(t,e,n,r,i){Rt.subVectors(r,e),It.subVectors(n,e),Ut.subVectors(t,e);var o=Rt.dot(Rt),a=Rt.dot(It),s=Rt.dot(Ut),l=It.dot(It),c=It.dot(Ut),u=o*l-a*a;if(0===u)return i.set(-2,-1,-1);var h=1/u,p=(l*s-a*c)*h,d=(o*c-a*s)*h;return i.set(1-p-d,d,p)},Vt.containsPoint=function(t,e,n,r){return this.getBarycoord(t,e,n,r,Bt),Bt.x>=0&&Bt.y>=0&&Bt.x+Bt.y<=1},Vt.getUV=function(t,e,n,r,i,o,a,s){return this.getBarycoord(t,e,n,r,Bt),s.set(0,0),s.addScaledVector(i,Bt.x),s.addScaledVector(o,Bt.y),s.addScaledVector(a,Bt.z),s},Vt.isFrontFacing=function(t,e,n,r){return Rt.subVectors(n,e),It.subVectors(t,e),Rt.cross(It).dot(r)<0},Vt.prototype.set=function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},Vt.prototype.setFromPointsAndIndices=function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},Vt.prototype.clone=function(){return(new this.constructor).copy(this)},Vt.prototype.copy=function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},Vt.prototype.getArea=function(){return Rt.subVectors(this.c,this.b),It.subVectors(this.a,this.b),.5*Rt.cross(It).length()},Vt.prototype.getMidpoint=function(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},Vt.prototype.getNormal=function(t){return Vt.getNormal(this.a,this.b,this.c,t)},Vt.prototype.getPlane=function(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)},Vt.prototype.getBarycoord=function(t,e){return Vt.getBarycoord(t,this.a,this.b,this.c,e)},Vt.prototype.getUV=function(t,e,n,r,i){return Vt.getUV(t,this.a,this.b,this.c,e,n,r,i)},Vt.prototype.containsPoint=function(t){return Vt.containsPoint(t,this.a,this.b,this.c)},Vt.prototype.isFrontFacing=function(t){return Vt.isFrontFacing(this.a,this.b,this.c,t)},Vt.prototype.intersectsBox=function(t){return t.intersectsTriangle(this)},Vt.prototype.closestPointToPoint=function(t,e){var n,r,i=this.a,o=this.b,a=this.c;Ft.subVectors(o,i),Ht.subVectors(a,i),zt.subVectors(t,i);var s=Ft.dot(zt),l=Ht.dot(zt);if(s<=0&&l<=0)return e.copy(i);Gt.subVectors(t,o);var c=Ft.dot(Gt),u=Ht.dot(Gt);if(c>=0&&u<=c)return e.copy(o);var h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return n=s/(s-c),e.copy(i).addScaledVector(Ft,n);Wt.subVectors(t,a);var p=Ft.dot(Wt),d=Ht.dot(Wt);if(d>=0&&p<=d)return e.copy(a);var f=p*l-s*d;if(f<=0&&l>=0&&d<=0)return r=l/(l-d),e.copy(i).addScaledVector(Ht,r);var m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return kt.subVectors(a,o),r=(u-c)/(u-c+(p-d)),e.copy(o).addScaledVector(kt,r);var v=1/(m+f+h);return n=f*v,r=h*v,e.copy(i).addScaledVector(Ft,n).addScaledVector(Ht,r)},Vt.prototype.equals=function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)};var jt=0,Yt=function(t){function e(){t.call(this),Object.defineProperty(this,"id",{value:jt++}),this.uuid=s(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={needsUpdate:{configurable:!0}};return e.prototype.onBuild=function(){},e.prototype.onBeforeCompile=function(){},e.prototype.customProgramCacheKey=function(){return this.onBeforeCompile.toString()},e.prototype.setValues=function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n)if("shading"!==e){var r=this[e];void 0!==r&&(r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n)}else this.flatShading=1===n}},e.prototype.toJSON=function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){var i=r(t.textures),o=r(t.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},e.prototype.clone=function(){return(new this.constructor).copy(this)},e.prototype.copy=function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(null!==e){var r=e.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},n.needsUpdate.set=function(t){!0===t&&this.version++},Object.defineProperties(e.prototype,n),e}(e);Yt.prototype.isMaterial=!0;var Xt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Zt={h:0,s:0,l:0},qt={h:0,s:0,l:0};function Qt(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function Kt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Jt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}var $t=function(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)};$t.prototype.set=function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},$t.prototype.setScalar=function(t){return this.r=t,this.g=t,this.b=t,this},$t.prototype.setHex=function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},$t.prototype.setRGB=function(t,e,n){return this.r=t,this.g=e,this.b=n,this},$t.prototype.setHSL=function(t,e,n){if(t=c(t,1),e=l(e,0,1),n=l(n,0,1),0===e)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=Qt(i,r,t+1/3),this.g=Qt(i,r,t),this.b=Qt(i,r,t-1/3)}return this},$t.prototype.setStyle=function(t){function e(t){void 0!==t&&parseFloat(t)}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var a=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return e(r[4]),this.setHSL(a,s,l)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){var c=n[1],u=c.length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},$t.prototype.setColorName=function(t){var e=Xt[t.toLowerCase()];return void 0!==e&&this.setHex(e),this},$t.prototype.clone=function(){return new this.constructor(this.r,this.g,this.b)},$t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},$t.prototype.copyGammaToLinear=function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},$t.prototype.copyLinearToGamma=function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},$t.prototype.convertGammaToLinear=function(t){return this.copyGammaToLinear(this,t),this},$t.prototype.convertLinearToGamma=function(t){return this.copyLinearToGamma(this,t),this},$t.prototype.copySRGBToLinear=function(t){return this.r=Kt(t.r),this.g=Kt(t.g),this.b=Kt(t.b),this},$t.prototype.copyLinearToSRGB=function(t){return this.r=Jt(t.r),this.g=Jt(t.g),this.b=Jt(t.b),this},$t.prototype.convertSRGBToLinear=function(){return this.copySRGBToLinear(this),this},$t.prototype.convertLinearToSRGB=function(){return this.copyLinearToSRGB(this),this},$t.prototype.getHex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},$t.prototype.getHexString=function(){return("000000"+this.getHex().toString(16)).slice(-6)},$t.prototype.getHSL=function(t){var e,n,r=this.r,i=this.g,o=this.b,a=Math.max(r,i,o),s=Math.min(r,i,o),l=(s+a)/2;if(s===a)e=0,n=0;else{var c=a-s;switch(n=l<=.5?c/(a+s):c/(2-a-s),a){case r:e=(i-o)/c+(i<o?6:0);break;case i:e=(o-r)/c+2;break;case o:e=(r-i)/c+4}e/=6}return t.h=e,t.s=n,t.l=l,t},$t.prototype.getStyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},$t.prototype.offsetHSL=function(t,e,n){return this.getHSL(Zt),Zt.h+=t,Zt.s+=e,Zt.l+=n,this.setHSL(Zt.h,Zt.s,Zt.l),this},$t.prototype.add=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},$t.prototype.addColors=function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},$t.prototype.addScalar=function(t){return this.r+=t,this.g+=t,this.b+=t,this},$t.prototype.sub=function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},$t.prototype.multiply=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},$t.prototype.multiplyScalar=function(t){return this.r*=t,this.g*=t,this.b*=t,this},$t.prototype.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},$t.prototype.lerpColors=function(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this},$t.prototype.lerpHSL=function(t,e){this.getHSL(Zt),t.getHSL(qt);var n=u(Zt.h,qt.h,e),r=u(Zt.s,qt.s,e),i=u(Zt.l,qt.l,e);return this.setHSL(n,r,i),this},$t.prototype.equals=function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},$t.prototype.fromArray=function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},$t.prototype.toArray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},$t.prototype.fromBufferAttribute=function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},$t.prototype.toJSON=function(){return this.getHex()},$t.NAMES=Xt,$t.prototype.isColor=!0,$t.prototype.r=1,$t.prototype.g=1,$t.prototype.b=1;var te=function(t){function e(e){t.call(this),this.type="MeshBasicMaterial",this.color=new $t(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this},e}(Yt);te.prototype.isMeshBasicMaterial=!0;var ee=new D,ne=new m,re=function(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0},ie={needsUpdate:{configurable:!0}};re.prototype.onUploadCallback=function(){},ie.needsUpdate.set=function(t){!0===t&&this.version++},re.prototype.setUsage=function(t){return this.usage=t,this},re.prototype.copy=function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},re.prototype.copyAt=function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[t+r]=e.array[n+r];return this},re.prototype.copyArray=function(t){return this.array.set(t),this},re.prototype.copyColorsArray=function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(o=new $t),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this},re.prototype.copyVector2sArray=function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(o=new m),e[n++]=o.x,e[n++]=o.y}return this},re.prototype.copyVector3sArray=function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(o=new D),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this},re.prototype.copyVector4sArray=function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var o=t[r];void 0===o&&(o=new b),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z,e[n++]=o.w}return this},re.prototype.applyMatrix3=function(t){if(2===this.itemSize)for(var e=0,n=this.count;e<n;e++)ne.fromBufferAttribute(this,e),ne.applyMatrix3(t),this.setXY(e,ne.x,ne.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)ee.fromBufferAttribute(this,r),ee.applyMatrix3(t),this.setXYZ(r,ee.x,ee.y,ee.z);return this},re.prototype.applyMatrix4=function(t){for(var e=0,n=this.count;e<n;e++)ee.x=this.getX(e),ee.y=this.getY(e),ee.z=this.getZ(e),ee.applyMatrix4(t),this.setXYZ(e,ee.x,ee.y,ee.z);return this},re.prototype.applyNormalMatrix=function(t){for(var e=0,n=this.count;e<n;e++)ee.x=this.getX(e),ee.y=this.getY(e),ee.z=this.getZ(e),ee.applyNormalMatrix(t),this.setXYZ(e,ee.x,ee.y,ee.z);return this},re.prototype.transformDirection=function(t){for(var e=0,n=this.count;e<n;e++)ee.x=this.getX(e),ee.y=this.getY(e),ee.z=this.getZ(e),ee.transformDirection(t),this.setXYZ(e,ee.x,ee.y,ee.z);return this},re.prototype.set=function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},re.prototype.getX=function(t){return this.array[t*this.itemSize]},re.prototype.setX=function(t,e){return this.array[t*this.itemSize]=e,this},re.prototype.getY=function(t){return this.array[t*this.itemSize+1]},re.prototype.setY=function(t,e){return this.array[t*this.itemSize+1]=e,this},re.prototype.getZ=function(t){return this.array[t*this.itemSize+2]},re.prototype.setZ=function(t,e){return this.array[t*this.itemSize+2]=e,this},re.prototype.getW=function(t){return this.array[t*this.itemSize+3]},re.prototype.setW=function(t,e){return this.array[t*this.itemSize+3]=e,this},re.prototype.setXY=function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},re.prototype.setXYZ=function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},re.prototype.setXYZW=function(t,e,n,r,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},re.prototype.onUpload=function(t){return this.onUploadCallback=t,this},re.prototype.clone=function(){return new this.constructor(this.array,this.itemSize).copy(this)},re.prototype.toJSON=function(){var t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t},Object.defineProperties(re.prototype,ie),re.prototype.isBufferAttribute=!0;var oe=function(t){function e(e,n,r){t.call(this,new Int8Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re),ae=function(t){function e(e,n,r){t.call(this,new Uint8Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re),se=function(t){function e(e,n,r){t.call(this,new Uint8ClampedArray(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re),le=function(t){function e(e,n,r){t.call(this,new Int16Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re),ce=function(t){function e(e,n,r){t.call(this,new Uint16Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re),ue=function(t){function e(e,n,r){t.call(this,new Int32Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re),he=function(t){function e(e,n,r){t.call(this,new Uint32Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re),pe=function(t){function e(e,n,r){t.call(this,new Uint16Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re);pe.prototype.isFloat16BufferAttribute=!0;var de=function(t){function e(e,n,r){t.call(this,new Float32Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re),fe=function(t){function e(e,n,r){t.call(this,new Float64Array(e),n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(re);function me(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}var ve={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ge(t,e){return new ve[t](e)}var ye=0,_e=new st,Ee=new Nt,Te=new D,xe=new N,be=new N,Me=new D,Ae=function(t){function e(){t.call(this),Object.defineProperty(this,"id",{value:ye++}),this.uuid=s(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getIndex=function(){return this.index},e.prototype.setIndex=function(t){return Array.isArray(t)?this.index=new(me(t)>65535?he:ce)(t,1):this.index=t,this},e.prototype.getAttribute=function(t){return this.attributes[t]},e.prototype.setAttribute=function(t,e){return this.attributes[t]=e,this},e.prototype.deleteAttribute=function(t){return delete this.attributes[t],this},e.prototype.hasAttribute=function(t){return void 0!==this.attributes[t]},e.prototype.addGroup=function(t,e,n){void 0===n&&(n=0),this.groups.push({start:t,count:e,materialIndex:n})},e.prototype.clearGroups=function(){this.groups=[]},e.prototype.setDrawRange=function(t,e){this.drawRange.start=t,this.drawRange.count=e},e.prototype.applyMatrix4=function(t){var e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new y).getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},e.prototype.applyQuaternion=function(t){return _e.makeRotationFromQuaternion(t),this.applyMatrix4(_e),this},e.prototype.rotateX=function(t){return _e.makeRotationX(t),this.applyMatrix4(_e),this},e.prototype.rotateY=function(t){return _e.makeRotationY(t),this.applyMatrix4(_e),this},e.prototype.rotateZ=function(t){return _e.makeRotationZ(t),this.applyMatrix4(_e),this},e.prototype.translate=function(t,e,n){return _e.makeTranslation(t,e,n),this.applyMatrix4(_e),this},e.prototype.scale=function(t,e,n){return _e.makeScale(t,e,n),this.applyMatrix4(_e),this},e.prototype.lookAt=function(t){return Ee.lookAt(t),Ee.updateMatrix(),this.applyMatrix4(Ee.matrix),this},e.prototype.center=function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Te).negate(),this.translate(Te.x,Te.y,Te.z),this},e.prototype.setFromPoints=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new de(e,3)),this},e.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new N);var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingBox.set(new D(-1/0,-1/0,-1/0),new D(1/0,1/0,1/0));else{if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var n=0,r=e.length;n<r;n++){var i=e[n];xe.setFromBufferAttribute(i),this.morphTargetsRelative?(Me.addVectors(this.boundingBox.min,xe.min),this.boundingBox.expandByPoint(Me),Me.addVectors(this.boundingBox.max,xe.max),this.boundingBox.expandByPoint(Me)):(this.boundingBox.expandByPoint(xe.min),this.boundingBox.expandByPoint(xe.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}},e.prototype.computeBoundingSphere=function(){null===this.boundingSphere&&(this.boundingSphere=new J);var t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingSphere.set(new D,1/0);else if(t){var n=this.boundingSphere.center;if(xe.setFromBufferAttribute(t),e)for(var r=0,i=e.length;r<i;r++){var o=e[r];be.setFromBufferAttribute(o),this.morphTargetsRelative?(Me.addVectors(xe.min,be.min),xe.expandByPoint(Me),Me.addVectors(xe.max,be.max),xe.expandByPoint(Me)):(xe.expandByPoint(be.min),xe.expandByPoint(be.max))}xe.getCenter(n);for(var a=0,s=0,l=t.count;s<l;s++)Me.fromBufferAttribute(t,s),a=Math.max(a,n.distanceToSquared(Me));if(e)for(var c=0,u=e.length;c<u;c++)for(var h=e[c],p=this.morphTargetsRelative,d=0,f=h.count;d<f;d++)Me.fromBufferAttribute(h,d),p&&(Te.fromBufferAttribute(t,d),Me.add(Te)),a=Math.max(a,n.distanceToSquared(Me));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)}},e.prototype.computeFaceNormals=function(){},e.prototype.computeTangents=function(){var t=this.index,e=this.attributes;if(null!==t&&void 0!==e.position&&void 0!==e.normal&&void 0!==e.uv){var n=t.array,r=e.position.array,i=e.normal.array,o=e.uv.array,a=r.length/3;void 0===e.tangent&&this.setAttribute("tangent",new re(new Float32Array(4*a),4));for(var s=e.tangent.array,l=[],c=[],u=0;u<a;u++)l[u]=new D,c[u]=new D;var h=new D,p=new D,d=new D,f=new m,v=new m,g=new m,y=new D,_=new D,E=this.groups;0===E.length&&(E=[{start:0,count:n.length}]);for(var T=0,x=E.length;T<x;++T)for(var b=E[T],M=b.start,A=M,S=M+b.count;A<S;A+=3)F(n[A+0],n[A+1],n[A+2]);for(var O=new D,w=new D,L=new D,C=new D,P=0,N=E.length;P<N;++P)for(var R=E[P],I=R.start,U=I,B=I+R.count;U<B;U+=3)H(n[U+0]),H(n[U+1]),H(n[U+2])}function F(t,e,n){h.fromArray(r,3*t),p.fromArray(r,3*e),d.fromArray(r,3*n),f.fromArray(o,2*t),v.fromArray(o,2*e),g.fromArray(o,2*n),p.sub(h),d.sub(h),v.sub(f),g.sub(f);var i=1/(v.x*g.y-g.x*v.y);isFinite(i)&&(y.copy(p).multiplyScalar(g.y).addScaledVector(d,-v.y).multiplyScalar(i),_.copy(d).multiplyScalar(v.x).addScaledVector(p,-g.x).multiplyScalar(i),l[t].add(y),l[e].add(y),l[n].add(y),c[t].add(_),c[e].add(_),c[n].add(_))}function H(t){L.fromArray(i,3*t),C.copy(L);var e=l[t];O.copy(e),O.sub(L.multiplyScalar(L.dot(e))).normalize(),w.crossVectors(C,e);var n=w.dot(c[t])<0?-1:1;s[4*t]=O.x,s[4*t+1]=O.y,s[4*t+2]=O.z,s[4*t+3]=n}},e.prototype.computeVertexNormals=function(){var t=this.index,e=this.getAttribute("position");if(void 0!==e){var n=this.getAttribute("normal");if(void 0===n)n=new re(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var o=new D,a=new D,s=new D,l=new D,c=new D,u=new D,h=new D,p=new D;if(t)for(var d=0,f=t.count;d<f;d+=3){var m=t.getX(d+0),v=t.getX(d+1),g=t.getX(d+2);o.fromBufferAttribute(e,m),a.fromBufferAttribute(e,v),s.fromBufferAttribute(e,g),h.subVectors(s,a),p.subVectors(o,a),h.cross(p),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,v),u.fromBufferAttribute(n,g),l.add(h),c.add(h),u.add(h),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z),n.setXYZ(g,u.x,u.y,u.z)}else for(var y=0,_=e.count;y<_;y+=3)o.fromBufferAttribute(e,y+0),a.fromBufferAttribute(e,y+1),s.fromBufferAttribute(e,y+2),h.subVectors(s,a),p.subVectors(o,a),h.cross(p),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}},e.prototype.merge=function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0);var n=this.attributes;for(var r in n)if(void 0!==t.attributes[r])for(var i=n[r].array,o=t.attributes[r],a=o.array,s=o.itemSize*e,l=Math.min(a.length,i.length-s),c=0,u=s;c<l;c++,u++)i[u]=a[c];return this}},e.prototype.normalizeNormals=function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)Me.fromBufferAttribute(t,e),Me.normalize(),t.setXYZ(e,Me.x,Me.y,Me.z)},e.prototype.toNonIndexed=function(){function t(t,e){for(var n=t.array,r=t.itemSize,i=t.normalized,o=new n.constructor(e.length*r),a=0,s=0,l=0,c=e.length;l<c;l++){a=t.isInterleavedBufferAttribute?e[l]*t.data.stride+t.offset:e[l]*r;for(var u=0;u<r;u++)o[s++]=n[a++]}return new re(o,r,i)}if(null===this.index)return this;var n=new e,r=this.index.array,i=this.attributes;for(var o in i){var a=t(i[o],r);n.setAttribute(o,a)}var s=this.morphAttributes;for(var l in s){for(var c=[],u=s[l],h=0,p=u.length;h<p;h++){var d=t(u[h],r);c.push(d)}n.morphAttributes[l]=c}n.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,m=0,v=f.length;m<v;m++){var g=f[m];n.addGroup(g.start,g.count,g.materialIndex)}return n},e.prototype.toJSON=function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;null!==r&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var o in i){var a=i[o];t.data.attributes[o]=a.toJSON(t.data)}var s={},l=!1;for(var c in this.morphAttributes){for(var u=this.morphAttributes[c],h=[],p=0,d=u.length;p<d;p++){var f=u[p];h.push(f.toJSON(t.data))}h.length>0&&(s[c]=h,l=!0)}l&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);var m=this.groups;m.length>0&&(t.data.groups=JSON.parse(JSON.stringify(m)));var v=this.boundingSphere;return null!==v&&(t.data.boundingSphere={center:v.center.toArray(),radius:v.radius}),t},e.prototype.clone=function(){return(new e).copy(this)},e.prototype.copy=function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var e={};this.name=t.name;var n=t.index;null!==n&&this.setIndex(n.clone(e));var r=t.attributes;for(var i in r){var o=r[i];this.setAttribute(i,o.clone(e))}var a=t.morphAttributes;for(var s in a){for(var l=[],c=a[s],u=0,h=c.length;u<h;u++)l.push(c[u].clone(e));this.morphAttributes[s]=l}this.morphTargetsRelative=t.morphTargetsRelative;for(var p=t.groups,d=0,f=p.length;d<f;d++){var m=p[d];this.addGroup(m.start,m.count,m.materialIndex)}var v=t.boundingBox;null!==v&&(this.boundingBox=v.clone());var g=t.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},e}(e);Ae.prototype.isBufferGeometry=!0;var Se=new st,Oe=new at,we=new J,Le=new D,De=new D,Ce=new D,Pe=new D,Ne=new D,Re=new D,Ie=new D,Ue=new D,Be=new D,Fe=new m,He=new m,ke=new m,ze=new D,Ge=new D,We=function(t){function e(e,n){void 0===e&&(e=new Ae),void 0===n&&(n=new te),t.call(this),this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},e.prototype.updateMorphTargets=function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=t.morphTargets;void 0!==s&&s.length}},e.prototype.raycast=function(t,e){var n,r=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),we.copy(r.boundingSphere),we.applyMatrix4(o),!1!==t.ray.intersectsSphere(we)&&(Se.copy(o).invert(),Oe.copy(t.ray).applyMatrix4(Se),null===r.boundingBox||!1!==Oe.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var a=r.index,s=r.attributes.position,l=r.morphAttributes.position,c=r.morphTargetsRelative,u=r.attributes.uv,h=r.attributes.uv2,p=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(i))for(var f=0,m=p.length;f<m;f++)for(var v=p[f],g=i[v.materialIndex],y=Math.max(v.start,d.start),_=Math.min(v.start+v.count,d.start+d.count);y<_;y+=3){var E=a.getX(y),T=a.getX(y+1),x=a.getX(y+2);(n=Ve(this,g,t,Oe,s,l,c,u,h,E,T,x))&&(n.faceIndex=Math.floor(y/3),n.face.materialIndex=v.materialIndex,e.push(n))}else for(var b=Math.max(0,d.start),M=Math.min(a.count,d.start+d.count);b<M;b+=3){var A=a.getX(b),S=a.getX(b+1),O=a.getX(b+2);(n=Ve(this,i,t,Oe,s,l,c,u,h,A,S,O))&&(n.faceIndex=Math.floor(b/3),e.push(n))}else if(void 0!==s)if(Array.isArray(i))for(var w=0,L=p.length;w<L;w++)for(var D=p[w],C=i[D.materialIndex],P=Math.max(D.start,d.start),N=Math.min(D.start+D.count,d.start+d.count);P<N;P+=3)(n=Ve(this,C,t,Oe,s,l,c,u,h,P,P+1,P+2))&&(n.faceIndex=Math.floor(P/3),n.face.materialIndex=D.materialIndex,e.push(n));else for(var R=Math.max(0,d.start),I=Math.min(s.count,d.start+d.count);R<I;R+=3)(n=Ve(this,i,t,Oe,s,l,c,u,h,R,R+1,R+2))&&(n.faceIndex=Math.floor(R/3),e.push(n))}else r.isGeometry},e}(Nt);function Ve(t,e,n,r,i,o,a,s,l,c,u,h){Le.fromBufferAttribute(i,c),De.fromBufferAttribute(i,u),Ce.fromBufferAttribute(i,h);var p=t.morphTargetInfluences;if(e.morphTargets&&o&&p){Ie.set(0,0,0),Ue.set(0,0,0),Be.set(0,0,0);for(var d=0,f=o.length;d<f;d++){var v=p[d],g=o[d];0!==v&&(Pe.fromBufferAttribute(g,c),Ne.fromBufferAttribute(g,u),Re.fromBufferAttribute(g,h),a?(Ie.addScaledVector(Pe,v),Ue.addScaledVector(Ne,v),Be.addScaledVector(Re,v)):(Ie.addScaledVector(Pe.sub(Le),v),Ue.addScaledVector(Ne.sub(De),v),Be.addScaledVector(Re.sub(Ce),v)))}Le.add(Ie),De.add(Ue),Ce.add(Be)}t.isSkinnedMesh&&(t.boneTransform(c,Le),t.boneTransform(u,De),t.boneTransform(h,Ce));var y=function(t,e,n,r,i,o,a,s){if(null===(1===e.side?r.intersectTriangle(a,o,i,!0,s):r.intersectTriangle(i,o,a,2!==e.side,s)))return null;Ge.copy(s),Ge.applyMatrix4(t.matrixWorld);var l=n.ray.origin.distanceTo(Ge);return l<n.near||l>n.far?null:{distance:l,point:Ge.clone(),object:t}}(t,e,n,r,Le,De,Ce,ze);if(y){s&&(Fe.fromBufferAttribute(s,c),He.fromBufferAttribute(s,u),ke.fromBufferAttribute(s,h),y.uv=Vt.getUV(ze,Le,De,Ce,Fe,He,ke,new m)),l&&(Fe.fromBufferAttribute(l,c),He.fromBufferAttribute(l,u),ke.fromBufferAttribute(l,h),y.uv2=Vt.getUV(ze,Le,De,Ce,Fe,He,ke,new m));var _={a:c,b:u,c:h,normal:new D,materialIndex:0};Vt.getNormal(Le,De,Ce,_.normal),y.face=_}return y}We.prototype.isMesh=!0;var je=function(t){function e(e,n,r,i,o,a){void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),void 0===o&&(o=1),void 0===a&&(a=1),t.call(this),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:o,depthSegments:a};var s=this;i=Math.floor(i),o=Math.floor(o),a=Math.floor(a);var l=[],c=[],u=[],h=[],p=0,d=0;function f(t,e,n,r,i,o,a,f,m,v,g){for(var y=o/m,_=a/v,E=o/2,T=a/2,x=f/2,b=m+1,M=v+1,A=0,S=0,O=new D,w=0;w<M;w++)for(var L=w*_-T,C=0;C<b;C++){var P=C*y-E;O[t]=P*r,O[e]=L*i,O[n]=x,c.push(O.x,O.y,O.z),O[t]=0,O[e]=0,O[n]=f>0?1:-1,u.push(O.x,O.y,O.z),h.push(C/m),h.push(1-w/v),A+=1}for(var N=0;N<v;N++)for(var R=0;R<m;R++){var I=p+R+b*N,U=p+R+b*(N+1),B=p+(R+1)+b*(N+1),F=p+(R+1)+b*N;l.push(I,U,F),l.push(U,B,F),S+=6}s.addGroup(d,S,g),d+=S,p+=A}f("z","y","x",-1,-1,r,n,e,a,o,0),f("z","y","x",1,-1,r,n,-e,a,o,1),f("x","z","y",1,1,e,r,n,i,a,2),f("x","z","y",1,-1,e,r,-n,i,a,3),f("x","y","z",1,-1,e,n,r,i,o,4),f("x","y","z",-1,-1,e,n,-r,i,o,5),this.setIndex(l),this.setAttribute("position",new de(c,3)),this.setAttribute("normal",new de(u,3)),this.setAttribute("uv",new de(h,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)},e}(Ae);function Ye(t){var e={};for(var n in t)for(var r in e[n]={},t[n]){var i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}return e}function Xe(t){for(var e={},n=0;n<t.length;n++){var r=Ye(t[n]);for(var i in r)e[i]=r[i]}return e}var Ze={clone:Ye,merge:Xe},qe=function(t){function e(e){t.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(e.attributes,this.setValues(e))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ye(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);for(var r in n.glslVersion=this.glslVersion,n.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?n.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?n.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?n.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?n.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?n.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?n.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?n.uniforms[r]={type:"m4",value:i.toArray()}:n.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader;var o={};for(var a in this.extensions)!0===this.extensions[a]&&(o[a]=!0);return Object.keys(o).length>0&&(n.extensions=o),n},e}(Yt);qe.prototype.isShaderMaterial=!0;var Qe=function(t){function e(){t.call(this),this.type="Camera",this.matrixWorldInverse=new st,this.projectionMatrix=new st,this.projectionMatrixInverse=new st}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e,n){return t.prototype.copy.call(this,e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},e.prototype.getWorldDirection=function(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},e.prototype.updateMatrixWorld=function(e){t.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},e.prototype.updateWorldMatrix=function(e,n){t.prototype.updateWorldMatrix.call(this,e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()},e.prototype.clone=function(){return(new this.constructor).copy(this)},e}(Nt);Qe.prototype.isCamera=!0;var Ke=function(t){function e(e,n,r,i){void 0===e&&(e=50),void 0===n&&(n=1),void 0===r&&(r=.1),void 0===i&&(i=2e3),t.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e,n){return t.prototype.copy.call(this,e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},e.prototype.setFocalLength=function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*a*Math.atan(e),this.updateProjectionMatrix()},e.prototype.getFocalLength=function(){var t=Math.tan(.5*o*this.fov);return.5*this.getFilmHeight()/t},e.prototype.getEffectiveFOV=function(){return 2*a*Math.atan(Math.tan(.5*o*this.fov)/this.zoom)},e.prototype.getFilmWidth=function(){return this.filmGauge*Math.min(this.aspect,1)},e.prototype.getFilmHeight=function(){return this.filmGauge/Math.max(this.aspect,1)},e.prototype.setViewOffset=function(t,e,n,r,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},e.prototype.clearViewOffset=function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},e.prototype.updateProjectionMatrix=function(){var t=this.near,e=t*Math.tan(.5*o*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var s=a.fullWidth,l=a.fullHeight;i+=a.offsetX*r/s,e-=a.offsetY*n/l,r*=a.width/s,n*=a.height/l}var c=this.filmOffset;0!==c&&(i+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,null!==this.view&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n},e}(Qe);Ke.prototype.isPerspectiveCamera=!0;var Je=function(t){function e(e,n,r){if(t.call(this),this.type="CubeCamera",!0===r.isWebGLCubeRenderTarget){this.renderTarget=r;var i=new Ke(90,1,e,n);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new D(1,0,0)),this.add(i);var o=new Ke(90,1,e,n);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new D(-1,0,0)),this.add(o);var a=new Ke(90,1,e,n);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new D(0,1,0)),this.add(a);var s=new Ke(90,1,e,n);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new D(0,-1,0)),this.add(s);var l=new Ke(90,1,e,n);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new D(0,0,1)),this.add(l);var c=new Ke(90,1,e,n);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new D(0,0,-1)),this.add(c)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=this.children,i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=t.xr.enabled,h=t.getRenderTarget();t.xr.enabled=!1;var p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,o),t.setRenderTarget(n,2),t.render(e,a),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,l),n.texture.generateMipmaps=p,t.setRenderTarget(n,5),t.render(e,c),t.setRenderTarget(h),t.xr.enabled=u},e}(Nt),$e=function(t){function e(e,n,r,i,o,a,s,l,c,u){e=void 0!==e?e:[],n=void 0!==n?n:301,s=void 0!==s?s:1022,t.call(this,e,n,r,i,o,a,s,l,c,u),this._needsFlipEnvMap=!0,this.flipY=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={images:{configurable:!0}};return n.images.get=function(){return this.image},n.images.set=function(t){this.image=t},Object.defineProperties(e.prototype,n),e}(T);$e.prototype.isCubeTexture=!0;var tn=function(t){function e(e,n,r){Number.isInteger(n)&&(n=r),t.call(this,e,e,n),n=n||{},this.texture=new $e(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.texture._needsFlipEnvMap=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=1023,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",o=new je(5,5,5),a=new qe({name:"CubemapFromEquirect",uniforms:Ye(n),vertexShader:r,fragmentShader:i,side:1,blending:0});a.uniforms.tEquirect.value=e;var s=new We(o,a),l=e.minFilter;return 1008===e.minFilter&&(e.minFilter=1006),new Je(1,10,this).update(t,s),e.minFilter=l,s.geometry.dispose(),s.material.dispose(),this},e.prototype.clear=function(t,e,n,r){for(var i=t.getRenderTarget(),o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,n,r);t.setRenderTarget(i)},e}(A);tn.prototype.isWebGLCubeRenderTarget=!0;var en=new D,nn=new D,rn=new y,on=function(t,e){void 0===t&&(t=new D(1,0,0)),void 0===e&&(e=0),this.normal=t,this.constant=e};on.prototype.set=function(t,e){return this.normal.copy(t),this.constant=e,this},on.prototype.setComponents=function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},on.prototype.setFromNormalAndCoplanarPoint=function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},on.prototype.setFromCoplanarPoints=function(t,e,n){var r=en.subVectors(n,e).cross(nn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this},on.prototype.copy=function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},on.prototype.normalize=function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},on.prototype.negate=function(){return this.constant*=-1,this.normal.negate(),this},on.prototype.distanceToPoint=function(t){return this.normal.dot(t)+this.constant},on.prototype.distanceToSphere=function(t){return this.distanceToPoint(t.center)-t.radius},on.prototype.projectPoint=function(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},on.prototype.intersectLine=function(t,e){var n=t.delta(en),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;var i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:e.copy(n).multiplyScalar(i).add(t.start)},on.prototype.intersectsLine=function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},on.prototype.intersectsBox=function(t){return t.intersectsPlane(this)},on.prototype.intersectsSphere=function(t){return t.intersectsPlane(this)},on.prototype.coplanarPoint=function(t){return t.copy(this.normal).multiplyScalar(-this.constant)},on.prototype.applyMatrix4=function(t,e){var n=e||rn.getNormalMatrix(t),r=this.coplanarPoint(en).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},on.prototype.translate=function(t){return this.constant-=t.dot(this.normal),this},on.prototype.equals=function(t){return t.normal.equals(this.normal)&&t.constant===this.constant},on.prototype.clone=function(){return(new this.constructor).copy(this)},on.prototype.isPlane=!0;var an=new J,sn=new D,ln=function(t,e,n,r,i,o){void 0===t&&(t=new on),void 0===e&&(e=new on),void 0===n&&(n=new on),void 0===r&&(r=new on),void 0===i&&(i=new on),void 0===o&&(o=new on),this.planes=[t,e,n,r,i,o]};function cn(){var t=null,e=!1,n=null,r=null;function i(e,o){n(e,o),r=t.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function un(t,e){var n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var n=r.get(e);n&&(t.deleteBuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isGLBufferAttribute){var o=r.get(e);(!o||o.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}else{e.isInterleavedBufferAttribute&&(e=e.data);var a=r.get(e);void 0===a?r.set(e,function(e,r){var i=e.array,o=e.usage,a=t.createBuffer();t.bindBuffer(r,a),t.bufferData(r,i,o),e.onUploadCallback();var s=t.FLOAT;return i instanceof Float32Array?s=t.FLOAT:i instanceof Float64Array||(i instanceof Uint16Array?e.isFloat16BufferAttribute?n&&(s=t.HALF_FLOAT):s=t.UNSIGNED_SHORT:i instanceof Int16Array?s=t.SHORT:i instanceof Uint32Array?s=t.UNSIGNED_INT:i instanceof Int32Array?s=t.INT:i instanceof Int8Array?s=t.BYTE:(i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&(s=t.UNSIGNED_BYTE)),{buffer:a,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}(e,i)):a.version<e.version&&(function(e,r,i){var o=r.array,a=r.updateRange;t.bindBuffer(i,e),-1===a.count?t.bufferSubData(i,0,o):(n?t.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):t.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(a.buffer,e,i),a.version=e.version)}}}}ln.prototype.set=function(t,e,n,r,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(o),this},ln.prototype.copy=function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},ln.prototype.setFromProjectionMatrix=function(t){var e=this.planes,n=t.elements,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],c=n[6],u=n[7],h=n[8],p=n[9],d=n[10],f=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return e[0].setComponents(a-r,u-s,f-h,y-m).normalize(),e[1].setComponents(a+r,u+s,f+h,y+m).normalize(),e[2].setComponents(a+i,u+l,f+p,y+v).normalize(),e[3].setComponents(a-i,u-l,f-p,y-v).normalize(),e[4].setComponents(a-o,u-c,f-d,y-g).normalize(),e[5].setComponents(a+o,u+c,f+d,y+g).normalize(),this},ln.prototype.intersectsObject=function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),an.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(an)},ln.prototype.intersectsSprite=function(t){return an.center.set(0,0,0),an.radius=.7071067811865476,an.applyMatrix4(t.matrixWorld),this.intersectsSphere(an)},ln.prototype.intersectsSphere=function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(n)<r)return!1;return!0},ln.prototype.intersectsBox=function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];if(sn.x=r.normal.x>0?t.max.x:t.min.x,sn.y=r.normal.y>0?t.max.y:t.min.y,sn.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(sn)<0)return!1}return!0},ln.prototype.containsPoint=function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0},ln.prototype.clone=function(){return(new this.constructor).copy(this)};var hn=function(t){function e(e,n,r,i){void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),t.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:i};for(var o=e/2,a=n/2,s=Math.floor(r),l=Math.floor(i),c=s+1,u=l+1,h=e/s,p=n/l,d=[],f=[],m=[],v=[],g=0;g<u;g++)for(var y=g*p-a,_=0;_<c;_++){var E=_*h-o;f.push(E,-y,0),m.push(0,0,1),v.push(_/s),v.push(1-g/l)}for(var T=0;T<l;T++)for(var x=0;x<s;x++){var b=x+c*T,M=x+c*(T+1),A=x+1+c*(T+1),S=x+1+c*T;d.push(b,M,S),d.push(M,A,S)}this.setIndex(d),this.setAttribute("position",new de(f,3)),this.setAttribute("normal",new de(m,3)),this.setAttribute("uv",new de(v,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.width,t.height,t.widthSegments,t.heightSegments)},e}(Ae),pn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotVH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSNMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition.xyz / vWorldPosition.w;\n\tvec3 v = normalize( cameraPosition - pos );\n\tfloat ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );\n\tvec3 transmission = transmissionFactor * getIBLVolumeRefraction(\n\t\tnormal, v, roughnessFactor, material.diffuseColor, totalSpecular,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec4 vWorldPosition;\n\tvec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {\n\t\tvec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length(vec3(modelMatrix[0].xyz));\n\t\tmodelScale.y = length(vec3(modelMatrix[1].xyz));\n\t\tmodelScale.z = length(vec3(modelMatrix[2].xyz));\n\t\treturn normalize(refractionVector) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness(float roughness, float ior) {\n\t\treturn roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);\n\t}\n\tvec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {\n\t\tfloat framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);\n\t\treturn texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;\n\t}\n\tvec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {\n\t\tif (attenuationDistance == 0.0) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;\n\t\t\tvec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec3 getIBLVolumeRefraction(vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);\n\t\tvec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);\n\t\treturn (1.0 - specularColor) * attenuatedColor * baseColor;\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform vec3 attenuationColor;\n\tuniform float attenuationDistance;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <transmission_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#ifdef USE_TRANSMISSION\n\tvarying vec4 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition;\n#endif\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},dn={common:{diffuse:{value:new $t(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new y},uv2Transform:{value:new y},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new m(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $t(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $t(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new y}},sprite:{diffuse:{value:new $t(16777215)},opacity:{value:1},center:{value:new m(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new y}}},fn={basic:{uniforms:Xe([dn.common,dn.specularmap,dn.envmap,dn.aomap,dn.lightmap,dn.fog]),vertexShader:pn.meshbasic_vert,fragmentShader:pn.meshbasic_frag},lambert:{uniforms:Xe([dn.common,dn.specularmap,dn.envmap,dn.aomap,dn.lightmap,dn.emissivemap,dn.fog,dn.lights,{emissive:{value:new $t(0)}}]),vertexShader:pn.meshlambert_vert,fragmentShader:pn.meshlambert_frag},phong:{uniforms:Xe([dn.common,dn.specularmap,dn.envmap,dn.aomap,dn.lightmap,dn.emissivemap,dn.bumpmap,dn.normalmap,dn.displacementmap,dn.fog,dn.lights,{emissive:{value:new $t(0)},specular:{value:new $t(1118481)},shininess:{value:30}}]),vertexShader:pn.meshphong_vert,fragmentShader:pn.meshphong_frag},standard:{uniforms:Xe([dn.common,dn.envmap,dn.aomap,dn.lightmap,dn.emissivemap,dn.bumpmap,dn.normalmap,dn.displacementmap,dn.roughnessmap,dn.metalnessmap,dn.fog,dn.lights,{emissive:{value:new $t(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:pn.meshphysical_vert,fragmentShader:pn.meshphysical_frag},toon:{uniforms:Xe([dn.common,dn.aomap,dn.lightmap,dn.emissivemap,dn.bumpmap,dn.normalmap,dn.displacementmap,dn.gradientmap,dn.fog,dn.lights,{emissive:{value:new $t(0)}}]),vertexShader:pn.meshtoon_vert,fragmentShader:pn.meshtoon_frag},matcap:{uniforms:Xe([dn.common,dn.bumpmap,dn.normalmap,dn.displacementmap,dn.fog,{matcap:{value:null}}]),vertexShader:pn.meshmatcap_vert,fragmentShader:pn.meshmatcap_frag},points:{uniforms:Xe([dn.points,dn.fog]),vertexShader:pn.points_vert,fragmentShader:pn.points_frag},dashed:{uniforms:Xe([dn.common,dn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:pn.linedashed_vert,fragmentShader:pn.linedashed_frag},depth:{uniforms:Xe([dn.common,dn.displacementmap]),vertexShader:pn.depth_vert,fragmentShader:pn.depth_frag},normal:{uniforms:Xe([dn.common,dn.bumpmap,dn.normalmap,dn.displacementmap,{opacity:{value:1}}]),vertexShader:pn.normal_vert,fragmentShader:pn.normal_frag},sprite:{uniforms:Xe([dn.sprite,dn.fog]),vertexShader:pn.sprite_vert,fragmentShader:pn.sprite_frag},background:{uniforms:{uvTransform:{value:new y},t2D:{value:null}},vertexShader:pn.background_vert,fragmentShader:pn.background_frag},cube:{uniforms:Xe([dn.envmap,{opacity:{value:1}}]),vertexShader:pn.cube_vert,fragmentShader:pn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:pn.equirect_vert,fragmentShader:pn.equirect_frag},distanceRGBA:{uniforms:Xe([dn.common,dn.displacementmap,{referencePosition:{value:new D},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:pn.distanceRGBA_vert,fragmentShader:pn.distanceRGBA_frag},shadow:{uniforms:Xe([dn.lights,dn.fog,{color:{value:new $t(0)},opacity:{value:1}}]),vertexShader:pn.shadow_vert,fragmentShader:pn.shadow_frag}};function mn(t,e,n,r,i){var o,a,s=new $t(0),l=0,c=null,u=0,h=null;function p(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return s},setClearColor:function(t,e){void 0===e&&(e=1),s.set(t),p(s,l=e)},getClearAlpha:function(){return l},setClearAlpha:function(t){p(s,l=t)},render:function(n,i){var d=!1,f=!0===i.isScene?i.background:null;f&&f.isTexture&&(f=e.get(f));var m=t.xr,v=m.getSession&&m.getSession();v&&"additive"===v.environmentBlendMode&&(f=null),null===f?p(s,l):f&&f.isColor&&(p(f,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&(f.isCubeTexture||306===f.mapping)?(void 0===a&&((a=new We(new je(1,1,1),new qe({name:"BackgroundCubeMaterial",uniforms:Ye(fn.cube.uniforms),vertexShader:fn.cube.vertexShader,fragmentShader:fn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a)),a.material.uniforms.envMap.value=f,a.material.uniforms.flipEnvMap.value=f.isCubeTexture&&f._needsFlipEnvMap?-1:1,c===f&&u===f.version&&h===t.toneMapping||(a.material.needsUpdate=!0,c=f,u=f.version,h=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):f&&f.isTexture&&(void 0===o&&((o=new We(new hn(2,2),new qe({name:"BackgroundMaterial",uniforms:Ye(fn.background.uniforms),vertexShader:fn.background.vertexShader,fragmentShader:fn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),o.material.uniforms.uvTransform.value.copy(f.matrix),c===f&&u===f.version&&h===t.toneMapping||(o.material.needsUpdate=!0,c=f,u=f.version,h=t.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function vn(t,e,n,r){var i=t.getParameter(t.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||null!==o,s={},l=p(null),c=l;function u(e){return r.isWebGL2?t.bindVertexArray(e):o.bindVertexArrayOES(e)}function h(e){return r.isWebGL2?t.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function p(t){for(var e=[],n=[],r=[],o=0;o<i;o++)e[o]=0,n[o]=0,r[o]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{},index:null}}function d(){for(var t=c.newAttributes,e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,i){var o=c.newAttributes,a=c.enabledAttributes,s=c.attributeDivisors;o[n]=1,0===a[n]&&(t.enableVertexAttribArray(n),a[n]=1),s[n]!==i&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function v(){for(var e=c.newAttributes,n=c.enabledAttributes,r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disableVertexAttribArray(r),n[r]=0)}function g(e,n,i,o,a,s){!0!==r.isWebGL2||i!==t.INT&&i!==t.UNSIGNED_INT?t.vertexAttribPointer(e,n,i,o,a,s):t.vertexAttribIPointer(e,n,i,a,s)}function y(){_(),c!==l&&u((c=l).object)}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,y,_){var E=!1;if(a){var T=function(e,n,i){var a=!0===i.wireframe,l=s[e.id];void 0===l&&(l={},s[e.id]=l);var c=l[n.id];void 0===c&&(c={},l[n.id]=c);var u=c[a];return void 0===u&&(u=p(r.isWebGL2?t.createVertexArray():o.createVertexArrayOES()),c[a]=u),u}(y,h,l);c!==T&&u((c=T).object),(E=function(t,e){var n=c.attributes,r=t.attributes,i=0;for(var o in r){var a=n[o],s=r[o];if(void 0===a)return!0;if(a.attribute!==s)return!0;if(a.data!==s.data)return!0;i++}return c.attributesNum!==i||c.index!==e}(y,_))&&function(t,e){var n={},r=t.attributes,i=0;for(var o in r){var a=r[o],s={};s.attribute=a,a.data&&(s.data=a.data),n[o]=s,i++}c.attributes=n,c.attributesNum=i,c.index=e}(y,_)}else{var x=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===x||(c.geometry=y.id,c.program=h.id,c.wireframe=x,E=!0)}!0===i.isInstancedMesh&&(E=!0),null!==_&&n.update(_,t.ELEMENT_ARRAY_BUFFER),E&&(function(i,o,a,s){if(!1!==r.isWebGL2||!i.isInstancedMesh&&!s.isInstancedBufferGeometry||null!==e.get("ANGLE_instanced_arrays")){d();var l=s.attributes,c=a.getAttributes(),u=o.defaultAttributeValues;for(var h in c){var p=c[h];if(p>=0){var y=l[h];if(void 0!==y){var _=y.normalized,E=y.itemSize,T=n.get(y);if(void 0===T)continue;var x=T.buffer,b=T.type,M=T.bytesPerElement;if(y.isInterleavedBufferAttribute){var A=y.data,S=A.stride,O=y.offset;A&&A.isInstancedInterleavedBuffer?(m(p,A.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=A.meshPerAttribute*A.count)):f(p),t.bindBuffer(t.ARRAY_BUFFER,x),g(p,E,b,_,S*M,O*M)}else y.isInstancedBufferAttribute?(m(p,y.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=y.meshPerAttribute*y.count)):f(p),t.bindBuffer(t.ARRAY_BUFFER,x),g(p,E,b,_,0,0)}else if("instanceMatrix"===h){var w=n.get(i.instanceMatrix);if(void 0===w)continue;var L=w.buffer,D=w.type;m(p+0,1),m(p+1,1),m(p+2,1),m(p+3,1),t.bindBuffer(t.ARRAY_BUFFER,L),t.vertexAttribPointer(p+0,4,D,!1,64,0),t.vertexAttribPointer(p+1,4,D,!1,64,16),t.vertexAttribPointer(p+2,4,D,!1,64,32),t.vertexAttribPointer(p+3,4,D,!1,64,48)}else if("instanceColor"===h){var C=n.get(i.instanceColor);if(void 0===C)continue;var P=C.buffer,N=C.type;m(p,1),t.bindBuffer(t.ARRAY_BUFFER,P),t.vertexAttribPointer(p,3,N,!1,12,0)}else if(void 0!==u){var R=u[h];if(void 0!==R)switch(R.length){case 2:t.vertexAttrib2fv(p,R);break;case 3:t.vertexAttrib3fv(p,R);break;case 4:t.vertexAttrib4fv(p,R);break;default:t.vertexAttrib1fv(p,R)}}}}v()}}(i,l,h,y),null!==_&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.get(_).buffer))},reset:y,resetDefaultState:_,dispose:function(){for(var t in y(),s){var e=s[t];for(var n in e){var r=e[n];for(var i in r)h(r[i].object),delete r[i];delete e[n]}delete s[t]}},releaseStatesOfGeometry:function(t){if(void 0!==s[t.id]){var e=s[t.id];for(var n in e){var r=e[n];for(var i in r)h(r[i].object),delete r[i];delete e[n]}delete s[t.id]}},releaseStatesOfProgram:function(t){for(var e in s){var n=s[e];if(void 0!==n[t.id]){var r=n[t.id];for(var i in r)h(r[i].object),delete r[i];delete n[t.id]}}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:v}}function gn(t,e,n,r){var i,o=r.isWebGL2;this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i,1)},this.renderInstances=function(r,a,s){if(0!==s){var l,c;if(o)l=t,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return;l[c](i,r,a,s),n.update(a,i,s)}}}function yn(t,e,n){var r;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,a=void 0!==n.precision?n.precision:"highp",s=i(a);s!==a&&(a=s);var l=o||e.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,u=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=t.getParameter(t.MAX_TEXTURE_SIZE),d=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),f=t.getParameter(t.MAX_VERTEX_ATTRIBS),m=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),v=t.getParameter(t.MAX_VARYING_VECTORS),g=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),y=h>0,_=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){var n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:m,maxVaryings:v,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:_,floatVertexTextures:y&&_,maxSamples:o?t.getParameter(t.MAX_SAMPLES):0}}function _n(t){var e=this,n=null,r=0,i=!1,o=!1,a=new on,s=new y,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(t,n,r,i){var o=null!==t?t.length:0,c=null;if(0!==o){if(c=l.value,!0!==i||null===c){var u=r+4*o,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var p=0,d=r;p!==o;++p,d+=4)a.copy(t[p]).applyMatrix4(h,s),a.normal.toArray(c,d),c[d+3]=a.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=o,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,o){var a=0!==t.length||e||0!==r||i;return i=e,n=u(t,o,0),r=t.length,a},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1,c()},this.setState=function(e,a,s){var h=e.clippingPlanes,p=e.clipIntersection,d=e.clipShadows,f=t.get(e);if(!i||null===h||0===h.length||o&&!d)o?u(null):c();else{var m=o?0:r,v=4*m,g=f.clippingState||null;l.value=g,g=u(h,a,v,s);for(var y=0;y!==v;++y)g[y]=n[y];f.clippingState=g,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=m}}}function En(t){var e=new WeakMap;function n(t,e){return 303===e?t.mapping=301:304===e&&(t.mapping=302),t}function r(t){var n=t.target;n.removeEventListener("dispose",r);var i=e.get(n);void 0!==i&&(e.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){var o=i.mapping;if(303===o||304===o){if(e.has(i))return n(e.get(i).texture,i.mapping);var a=i.image;if(a&&a.height>0){var s=t.getRenderTarget(),l=new tn(a.height/2);return l.fromEquirectangularTexture(t,i),e.set(i,l),t.setRenderTarget(s),i.addEventListener("dispose",r),n(l.texture,i.mapping)}return null}}return i},dispose:function(){e=new WeakMap}}}function Tn(t){var e={};function n(n){if(void 0!==e[n])return e[n];var r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return e[n]=r,r}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(t){var e=n(t);return e}}}function xn(t,e,n,r){var i={},o=new WeakMap;function a(t){var s=t.target;for(var l in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[l]);s.removeEventListener("dispose",a),delete i[s.id];var c=o.get(s);c&&(e.remove(c),o.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(t){var n=[],r=t.index,i=t.attributes.position,a=0;if(null!==r){var s=r.array;a=r.version;for(var l=0,c=s.length;l<c;l+=3){var u=s[l+0],h=s[l+1],p=s[l+2];n.push(u,h,h,p,p,u)}}else{var d=i.array;a=i.version;for(var f=0,m=d.length/3-1;f<m;f+=3){var v=f+0,g=f+1,y=f+2;n.push(v,g,g,y,y,v)}}var _=new(me(n)>65535?he:ce)(n,1);_.version=a;var E=o.get(t);E&&e.remove(E),o.set(t,_)}return{get:function(t,e){return!0===i[e.id]||(e.addEventListener("dispose",a),i[e.id]=!0,n.memory.geometries++),e},update:function(n){var r=n.attributes;for(var i in r)e.update(r[i],t.ARRAY_BUFFER);var o=n.morphAttributes;for(var a in o)for(var s=o[a],l=0,c=s.length;l<c;l++)e.update(s[l],t.ARRAY_BUFFER)},getWireframeAttribute:function(t){var e=o.get(t);if(e){var n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return o.get(t)}}}function bn(t,e,n,r){var i,o,a,s=r.isWebGL2;this.setMode=function(t){i=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,r){t.drawElements(i,r,o,e*a),n.update(r,i,1)},this.renderInstances=function(r,l,c){if(0!==c){var u,h;if(s)u=t,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(u=e.get("ANGLE_instanced_arrays")))return;u[h](i,l,o,r*a,c),n.update(l,i,c)}}}function Mn(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,r,i){switch(e.calls++,r){case t.TRIANGLES:e.triangles+=i*(n/3);break;case t.LINES:e.lines+=i*(n/2);break;case t.LINE_STRIP:e.lines+=i*(n-1);break;case t.LINE_LOOP:e.lines+=i*n;break;case t.POINTS:e.points+=i*n}}}}function An(t,e){return t[0]-e[0]}function Sn(t,e){return Math.abs(e[1])-Math.abs(t[1])}function On(t){for(var e={},n=new Float32Array(8),r=[],i=0;i<8;i++)r[i]=[i,0];return{update:function(i,o,a,s){var l=i.morphTargetInfluences,c=void 0===l?0:l.length,u=e[o.id];if(void 0===u||u.length!==c){u=[];for(var h=0;h<c;h++)u[h]=[h,0];e[o.id]=u}for(var p=0;p<c;p++){var d=u[p];d[0]=p,d[1]=l[p]}u.sort(Sn);for(var f=0;f<8;f++)f<c&&u[f][1]?(r[f][0]=u[f][0],r[f][1]=u[f][1]):(r[f][0]=Number.MAX_SAFE_INTEGER,r[f][1]=0);r.sort(An);for(var m=a.morphTargets&&o.morphAttributes.position,v=a.morphNormals&&o.morphAttributes.normal,g=0,y=0;y<8;y++){var _=r[y],E=_[0],T=_[1];E!==Number.MAX_SAFE_INTEGER&&T?(m&&o.getAttribute("morphTarget"+y)!==m[E]&&o.setAttribute("morphTarget"+y,m[E]),v&&o.getAttribute("morphNormal"+y)!==v[E]&&o.setAttribute("morphNormal"+y,v[E]),n[y]=T,g+=T):(m&&!0===o.hasAttribute("morphTarget"+y)&&o.deleteAttribute("morphTarget"+y),v&&!0===o.hasAttribute("morphNormal"+y)&&o.deleteAttribute("morphNormal"+y),n[y]=0)}var x=o.morphTargetsRelative?1:1-g;s.getUniforms().setValue(t,"morphTargetBaseInfluence",x),s.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function wn(t,e,n,r){var i=new WeakMap;function o(t){var e=t.target;e.removeEventListener("dispose",o),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(a){var s=r.render.frame,l=a.geometry,c=e.get(a,l);return i.get(c)!==s&&(e.update(c),i.set(c,s)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",o)&&a.addEventListener("dispose",o),n.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,t.ARRAY_BUFFER)),c},dispose:function(){i=new WeakMap}}}fn.physical={uniforms:Xe([fn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new m(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new $t(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new m},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new $t(0)}}]),vertexShader:pn.meshphysical_vert,fragmentShader:pn.meshphysical_frag};var Ln=function(t){function e(e,n,r,i){void 0===e&&(e=null),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),t.call(this,null),this.image={data:e,width:n,height:r,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(T);Ln.prototype.isDataTexture2DArray=!0;var Dn=function(t){function e(e,n,r,i){void 0===e&&(e=null),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),t.call(this,null),this.image={data:e,width:n,height:r,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(T);Dn.prototype.isDataTexture3D=!0;var Cn=new T,Pn=new Ln,Nn=new Dn,Rn=new $e,In=[],Un=[],Bn=new Float32Array(16),Fn=new Float32Array(9),Hn=new Float32Array(4);function kn(t,e,n){var r=t[0];if(r<=0||r>0)return t;var i=e*n,o=In[i];if(void 0===o&&(o=new Float32Array(i),In[i]=o),0!==e){r.toArray(o,0);for(var a=1,s=0;a!==e;++a)s+=n,t[a].toArray(o,s)}return o}function zn(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Gn(t,e){for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}function Wn(t,e){var n=Un[e];void 0===n&&(n=new Int32Array(e),Un[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function Vn(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function jn(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(zn(n,e))return;t.uniform2fv(this.addr,e),Gn(n,e)}}function Yn(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(zn(n,e))return;t.uniform3fv(this.addr,e),Gn(n,e)}}function Xn(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(zn(n,e))return;t.uniform4fv(this.addr,e),Gn(n,e)}}function Zn(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(zn(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Gn(n,e)}else{if(zn(n,r))return;Hn.set(r),t.uniformMatrix2fv(this.addr,!1,Hn),Gn(n,r)}}function qn(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(zn(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Gn(n,e)}else{if(zn(n,r))return;Fn.set(r),t.uniformMatrix3fv(this.addr,!1,Fn),Gn(n,r)}}function Qn(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(zn(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Gn(n,e)}else{if(zn(n,r))return;Bn.set(r),t.uniformMatrix4fv(this.addr,!1,Bn),Gn(n,r)}}function Kn(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Jn(t,e){var n=this.cache;zn(n,e)||(t.uniform2iv(this.addr,e),Gn(n,e))}function $n(t,e){var n=this.cache;zn(n,e)||(t.uniform3iv(this.addr,e),Gn(n,e))}function tr(t,e){var n=this.cache;zn(n,e)||(t.uniform4iv(this.addr,e),Gn(n,e))}function er(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function nr(t,e){var n=this.cache;zn(n,e)||(t.uniform2uiv(this.addr,e),Gn(n,e))}function rr(t,e){var n=this.cache;zn(n,e)||(t.uniform3uiv(this.addr,e),Gn(n,e))}function ir(t,e){var n=this.cache;zn(n,e)||(t.uniform4uiv(this.addr,e),Gn(n,e))}function or(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(e||Cn,i)}function ar(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||Nn,i)}function sr(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(e||Rn,i)}function lr(t,e,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||Pn,i)}function cr(t,e){t.uniform1fv(this.addr,e)}function ur(t,e){var n=kn(e,this.size,2);t.uniform2fv(this.addr,n)}function hr(t,e){var n=kn(e,this.size,3);t.uniform3fv(this.addr,n)}function pr(t,e){var n=kn(e,this.size,4);t.uniform4fv(this.addr,n)}function dr(t,e){var n=kn(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function fr(t,e){var n=kn(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function mr(t,e){var n=kn(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function vr(t,e){t.uniform1iv(this.addr,e)}function gr(t,e){t.uniform2iv(this.addr,e)}function yr(t,e){t.uniform3iv(this.addr,e)}function _r(t,e){t.uniform4iv(this.addr,e)}function Er(t,e){t.uniform1uiv(this.addr,e)}function Tr(t,e){t.uniform2uiv(this.addr,e)}function xr(t,e){t.uniform3uiv(this.addr,e)}function br(t,e){t.uniform4uiv(this.addr,e)}function Mr(t,e,n){var r=e.length,i=Wn(n,r);t.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTexture2D(e[o]||Cn,i[o])}function Ar(t,e,n){var r=e.length,i=Wn(n,r);t.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.safeSetTextureCube(e[o]||Rn,i[o])}function Sr(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return Vn;case 35664:return jn;case 35665:return Yn;case 35666:return Xn;case 35674:return Zn;case 35675:return qn;case 35676:return Qn;case 5124:case 35670:return Kn;case 35667:case 35671:return Jn;case 35668:case 35672:return $n;case 35669:case 35673:return tr;case 5125:return er;case 36294:return nr;case 36295:return rr;case 36296:return ir;case 35678:case 36198:case 36298:case 36306:case 35682:return or;case 35679:case 36299:case 36307:return ar;case 35680:case 36300:case 36308:case 36293:return sr;case 36289:case 36303:case 36311:case 36292:return lr}}(e.type)}function Or(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return cr;case 35664:return ur;case 35665:return hr;case 35666:return pr;case 35674:return dr;case 35675:return fr;case 35676:return mr;case 5124:case 35670:return vr;case 35667:case 35671:return gr;case 35668:case 35672:return yr;case 35669:case 35673:return _r;case 5125:return Er;case 36294:return Tr;case 36295:return xr;case 36296:return br;case 35678:case 36198:case 36298:case 36306:case 35682:return Mr;case 35680:case 36300:case 36308:case 36293:return Ar}}(e.type)}function wr(t){this.id=t,this.seq=[],this.map={}}Or.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),Gn(e,t)},wr.prototype.setValue=function(t,e,n){for(var r=this.seq,i=0,o=r.length;i!==o;++i){var a=r[i];a.setValue(t,e[a.id],n)}};var Lr=/(\w+)(\])?(\[|\.)?/g;function Dr(t,e){t.seq.push(e),t.map[e.id]=e}function Cr(t,e,n){var r=t.name,i=r.length;for(Lr.lastIndex=0;;){var o=Lr.exec(r),a=Lr.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===i){Dr(n,void 0===c?new Sr(s,t,e):new Or(s,t,e));break}var u=n.map[s];void 0===u&&Dr(n,u=new wr(s)),n=u}}function Pr(t,e){this.seq=[],this.map={};for(var n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<n;++r){var i=t.getActiveUniform(e,r);Cr(i,t.getUniformLocation(e,i.name),this)}}function Nr(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}Pr.prototype.setValue=function(t,e,n,r){var i=this.map[e];void 0!==i&&i.setValue(t,n,r)},Pr.prototype.setOptional=function(t,e,n){var r=e[n];void 0!==r&&this.setValue(t,n,r)},Pr.upload=function(t,e,n,r){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=n[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,r)}},Pr.seqWithValue=function(t,e){for(var n=[],r=0,i=t.length;r!==i;++r){var o=t[r];o.id in e&&n.push(o)}return n};var Rr=0;function Ir(t){switch(t){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return["Linear","( value )"]}}function Ur(t,e,n){var r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(t.getShaderSource(e))}function Br(t,e){var n=Ir(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Fr(t,e){var n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Hr(t){return""!==t}function kr(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function zr(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var Gr=/^[ \t]*#include +<([\w\d./]+)>/gm;function Wr(t){return t.replace(Gr,Vr)}function Vr(t,e){var n=pn[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return Wr(n)}var jr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Yr=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Xr(t){return t.replace(Yr,qr).replace(jr,Zr)}function Zr(t,e,n,r){return qr(0,e,n,r)}function qr(t,e,n,r){for(var i="",o=parseInt(e);o<parseInt(n);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function Qr(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Kr(t,e,n,r){var i,o,a,s,l,c=t.getContext(),u=n.defines,h=n.vertexShader,p=n.fragmentShader,d=function(t){var e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),f=function(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),m=function(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 307:e="ENVMAP_MODE_REFRACTION"}return e}(n),v=function(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),g=t.gammaFactor>0?t.gammaFactor:1,y=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission>0)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Hr).join("\n")}(n),_=function(t){var e=[];for(var n in t){var r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(u),E=c.createProgram(),T=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((i=[_].filter(Hr).join("\n")).length>0&&(i+="\n"),(o=[y,_].filter(Hr).join("\n")).length>0&&(o+="\n")):(i=[Qr(n),"#define SHADER_NAME "+n.shaderName,_,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+m:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Hr).join("\n"),o=[y,Qr(n),"#define SHADER_NAME "+n.shaderName,_,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.envMap?"#define "+m:"",n.envMap?"#define "+v:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?pn.tonemapping_pars_fragment:"",0!==n.toneMapping?Fr("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",pn.encodings_pars_fragment,n.map?Br("mapTexelToLinear",n.mapEncoding):"",n.matcap?Br("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Br("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Br("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Br("lightMapTexelToLinear",n.lightMapEncoding):"",(a="linearToOutputTexel",s=n.outputEncoding,l=Ir(s),"vec4 "+a+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Hr).join("\n")),h=zr(h=kr(h=Wr(h),n),n),p=zr(p=kr(p=Wr(p),n),n),h=Xr(h),p=Xr(p),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(T="#version 300 es\n",i=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,o=["#define varying in","300 es"===n.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+o);var x,b,M=T+i+h,A=T+o+p,S=Nr(c,c.VERTEX_SHADER,M),O=Nr(c,c.FRAGMENT_SHADER,A);if(c.attachShader(E,S),c.attachShader(E,O),void 0!==n.index0AttributeName?c.bindAttribLocation(E,0,n.index0AttributeName):!0===n.morphTargets&&c.bindAttribLocation(E,0,"position"),c.linkProgram(E),t.debug.checkShaderErrors){var w=c.getProgramInfoLog(E).trim(),L=c.getShaderInfoLog(S).trim(),D=c.getShaderInfoLog(O).trim(),C=!0,P=!0;!1===c.getProgramParameter(E,c.LINK_STATUS)?(C=!1,Ur(c,S,"vertex"),Ur(c,O,"fragment")):""!==w||""!==L&&""!==D||(P=!1),P&&(this.diagnostics={runnable:C,programLog:w,vertexShader:{log:L,prefix:i},fragmentShader:{log:D,prefix:o}})}return c.deleteShader(S),c.deleteShader(O),this.getUniforms=function(){return void 0===x&&(x=new Pr(c,E)),x},this.getAttributes=function(){return void 0===b&&(b=function(t,e){for(var n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var o=t.getActiveAttrib(e,i).name;n[o]=t.getAttribLocation(e,o)}return n}(c,E)),b},this.destroy=function(){r.releaseStatesOfProgram(this),c.deleteProgram(E),this.program=void 0},this.name=n.shaderName,this.id=Rr++,this.cacheKey=e,this.usedTimes=1,this.program=E,this.vertexShader=S,this.fragmentShader=O,this}function Jr(t,e,n,r,i,o){var a=[],s=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,u=r.maxVertexUniforms,h=r.vertexTextures,p=r.precision,d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function m(t){return t&&t.isTexture?t.encoding:t&&t.isWebGLRenderTarget?t.texture.encoding:3e3}return{getParameters:function(i,a,f,v,g){var y,_,E=v.fog,T=i.isMeshStandardMaterial?v.environment:null,x=e.get(i.envMap||T),b=d[i.type],M=g.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(c)return 1024;var n=u,r=Math.floor((n-20)/4),i=Math.min(r,e.length);return i<e.length?0:i}(g):0;if(null!==i.precision&&(p=r.getMaxPrecision(i.precision),i.precision),b){var A=fn[b];y=A.vertexShader,_=A.fragmentShader}else y=i.vertexShader,_=i.fragmentShader;var S=t.getRenderTarget();return{isWebGL2:s,shaderID:b,shaderName:i.type,vertexShader:y,fragmentShader:_,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:h,outputEncoding:null!==S?m(S.texture):t.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(306===x.mapping||307===x.mapping),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:0===i.normalMapType,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmission:!!i.transmission,transmissionMap:!!i.transmissionMap,thicknessMap:!!i.thicknessMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&g.geometry&&g.geometry.attributes.color&&4===g.geometry.attributes.color.itemSize,vertexUvs:!!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatMap||i.clearcoatRoughnessMap||i.clearcoatNormalMap||i.displacementMap||i.transmissionMap||i.thicknessMap),uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmission||i.transmissionMap||i.thicknessMap||!i.displacementMap),fog:!!E,useFog:i.fog,fogExp2:E&&E.isFogExp2,flatShading:!!i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===g.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:c,morphTargets:i.morphTargets,morphNormals:i.morphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:t.shadowMap.enabled&&f.length>0,shadowMapType:t.shadowMap.type,toneMapping:i.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:2===i.side,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);if(!1===e.isRawShaderMaterial){for(var i=0;i<f.length;i++)n.push(e[f[i]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){var e,n=d[t.type];if(n){var r=fn[n];e=Ze.clone(r.uniforms)}else e=t.uniforms;return e},acquireProgram:function(e,n){for(var r,o=0,s=a.length;o<s;o++){var l=a[o];if(l.cacheKey===n){++(r=l).usedTimes;break}}return void 0===r&&(r=new Kr(t,n,e,i),a.push(r)),r},releaseProgram:function(t){if(0==--t.usedTimes){var e=a.indexOf(t);a[e]=a[a.length-1],a.pop(),t.destroy()}},programs:a}}function $r(){var t=new WeakMap;return{get:function(e){var n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new WeakMap}}}function ti(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ei(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function ni(t){var e=[],n=0,r=[],i=[],o=[],a={id:-1};function s(r,i,o,s,l,c){var u=e[n],h=t.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||a,groupOrder:s,renderOrder:r.renderOrder,z:l,group:c},e[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||a,u.groupOrder=s,u.renderOrder=r.renderOrder,u.z=l,u.group=c),n++,u}return{opaque:r,transmissive:i,transparent:o,init:function(){n=0,r.length=0,i.length=0,o.length=0},push:function(t,e,n,a,l,c){var u=s(t,e,n,a,l,c);n.transmission>0?i.push(u):!0===n.transparent?o.push(u):r.push(u)},unshift:function(t,e,n,a,l,c){var u=s(t,e,n,a,l,c);n.transmission>0?i.unshift(u):!0===n.transparent?o.unshift(u):r.unshift(u)},finish:function(){for(var t=n,r=e.length;t<r;t++){var i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){r.length>1&&r.sort(t||ti),i.length>1&&i.sort(e||ei),o.length>1&&o.sort(e||ei)}}}function ri(t){var e=new WeakMap;return{get:function(n,r){var i;return!1===e.has(n)?(i=new ni(t),e.set(n,[i])):r>=e.get(n).length?(i=new ni(t),e.get(n).push(i)):i=e.get(n)[r],i},dispose:function(){e=new WeakMap}}}function ii(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new D,color:new $t};break;case"SpotLight":n={position:new D,direction:new D,color:new $t,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new D,color:new $t,distance:0,decay:0};break;case"HemisphereLight":n={direction:new D,skyColor:new $t,groundColor:new $t};break;case"RectAreaLight":n={color:new $t,position:new D,halfWidth:new D,halfHeight:new D}}return t[e.id]=n,n}}}var oi=0;function ai(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function si(t,e){for(var n,r=new ii,i=(n={},{get:function(t){if(void 0!==n[t.id])return n[t.id];var e;switch(t.type){case"DirectionalLight":case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new m};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new m,shadowCameraNear:1,shadowCameraFar:1e3}}return n[t.id]=e,e}}),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)o.probe.push(new D);var s=new D,l=new st,c=new st;return{setup:function(n){for(var a=0,s=0,l=0,c=0;c<9;c++)o.probe[c].set(0,0,0);var u=0,h=0,p=0,d=0,f=0,m=0,v=0,g=0;n.sort(ai);for(var y=0,_=n.length;y<_;y++){var E=n[y],T=E.color,x=E.intensity,b=E.distance,M=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)a+=T.r*x,s+=T.g*x,l+=T.b*x;else if(E.isLightProbe)for(var A=0;A<9;A++)o.probe[A].addScaledVector(E.sh.coefficients[A],x);else if(E.isDirectionalLight){var S=r.get(E);if(S.color.copy(E.color).multiplyScalar(E.intensity),E.castShadow){var O=E.shadow,w=i.get(E);w.shadowBias=O.bias,w.shadowNormalBias=O.normalBias,w.shadowRadius=O.radius,w.shadowMapSize=O.mapSize,o.directionalShadow[u]=w,o.directionalShadowMap[u]=M,o.directionalShadowMatrix[u]=E.shadow.matrix,m++}o.directional[u]=S,u++}else if(E.isSpotLight){var L=r.get(E);if(L.position.setFromMatrixPosition(E.matrixWorld),L.color.copy(T).multiplyScalar(x),L.distance=b,L.coneCos=Math.cos(E.angle),L.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),L.decay=E.decay,E.castShadow){var D=E.shadow,C=i.get(E);C.shadowBias=D.bias,C.shadowNormalBias=D.normalBias,C.shadowRadius=D.radius,C.shadowMapSize=D.mapSize,o.spotShadow[p]=C,o.spotShadowMap[p]=M,o.spotShadowMatrix[p]=E.shadow.matrix,g++}o.spot[p]=L,p++}else if(E.isRectAreaLight){var P=r.get(E);P.color.copy(T).multiplyScalar(x),P.halfWidth.set(.5*E.width,0,0),P.halfHeight.set(0,.5*E.height,0),o.rectArea[d]=P,d++}else if(E.isPointLight){var N=r.get(E);if(N.color.copy(E.color).multiplyScalar(E.intensity),N.distance=E.distance,N.decay=E.decay,E.castShadow){var R=E.shadow,I=i.get(E);I.shadowBias=R.bias,I.shadowNormalBias=R.normalBias,I.shadowRadius=R.radius,I.shadowMapSize=R.mapSize,I.shadowCameraNear=R.camera.near,I.shadowCameraFar=R.camera.far,o.pointShadow[h]=I,o.pointShadowMap[h]=M,o.pointShadowMatrix[h]=E.shadow.matrix,v++}o.point[h]=N,h++}else if(E.isHemisphereLight){var U=r.get(E);U.skyColor.copy(E.color).multiplyScalar(x),U.groundColor.copy(E.groundColor).multiplyScalar(x),o.hemi[f]=U,f++}}d>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(o.rectAreaLTC1=dn.LTC_FLOAT_1,o.rectAreaLTC2=dn.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")&&(o.rectAreaLTC1=dn.LTC_HALF_1,o.rectAreaLTC2=dn.LTC_HALF_2)),o.ambient[0]=a,o.ambient[1]=s,o.ambient[2]=l;var B=o.hash;B.directionalLength===u&&B.pointLength===h&&B.spotLength===p&&B.rectAreaLength===d&&B.hemiLength===f&&B.numDirectionalShadows===m&&B.numPointShadows===v&&B.numSpotShadows===g||(o.directional.length=u,o.spot.length=p,o.rectArea.length=d,o.point.length=h,o.hemi.length=f,o.directionalShadow.length=m,o.directionalShadowMap.length=m,o.pointShadow.length=v,o.pointShadowMap.length=v,o.spotShadow.length=g,o.spotShadowMap.length=g,o.directionalShadowMatrix.length=m,o.pointShadowMatrix.length=v,o.spotShadowMatrix.length=g,B.directionalLength=u,B.pointLength=h,B.spotLength=p,B.rectAreaLength=d,B.hemiLength=f,B.numDirectionalShadows=m,B.numPointShadows=v,B.numSpotShadows=g,o.version=oi++)},setupView:function(t,e){for(var n=0,r=0,i=0,a=0,u=0,h=e.matrixWorldInverse,p=0,d=t.length;p<d;p++){var f=t[p];if(f.isDirectionalLight){var m=o.directional[n];m.direction.setFromMatrixPosition(f.matrixWorld),s.setFromMatrixPosition(f.target.matrixWorld),m.direction.sub(s),m.direction.transformDirection(h),n++}else if(f.isSpotLight){var v=o.spot[i];v.position.setFromMatrixPosition(f.matrixWorld),v.position.applyMatrix4(h),v.direction.setFromMatrixPosition(f.matrixWorld),s.setFromMatrixPosition(f.target.matrixWorld),v.direction.sub(s),v.direction.transformDirection(h),i++}else if(f.isRectAreaLight){var g=o.rectArea[a];g.position.setFromMatrixPosition(f.matrixWorld),g.position.applyMatrix4(h),c.identity(),l.copy(f.matrixWorld),l.premultiply(h),c.extractRotation(l),g.halfWidth.set(.5*f.width,0,0),g.halfHeight.set(0,.5*f.height,0),g.halfWidth.applyMatrix4(c),g.halfHeight.applyMatrix4(c),a++}else if(f.isPointLight){var y=o.point[r];y.position.setFromMatrixPosition(f.matrixWorld),y.position.applyMatrix4(h),r++}else if(f.isHemisphereLight){var _=o.hemi[u];_.direction.setFromMatrixPosition(f.matrixWorld),_.direction.transformDirection(h),_.direction.normalize(),u++}}},state:o}}function li(t,e){var n=new si(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(t){n.setupView(r,t)},pushLight:function(t){r.push(t)},pushShadow:function(t){i.push(t)}}}function ci(t,e){var n=new WeakMap;return{get:function(r,i){var o;return void 0===i&&(i=0),!1===n.has(r)?(o=new li(t,e),n.set(r,[o])):i>=n.get(r).length?(o=new li(t,e),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}var ui=function(t){function e(e){t.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},e}(Yt);ui.prototype.isMeshDepthMaterial=!0;var hi=function(t){function e(e){t.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new D,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},e}(Yt);function pi(t,e,n){var r=new ln,i=new m,o=new m,a=new b,s=[],l=[],c={},u=n.maxTextureSize,h={0:1,1:0,2:2},p=new qe({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new m},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=p.clone();d.defines.HORIZONTAL_PASS=1;var f=new Ae;f.setAttribute("position",new re(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new We(f,p),g=this;function y(n,r){var i=e.update(v);p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(r,null,i,p,v,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(r,null,i,d,v,null)}function _(t){var e=t<<0,n=s[e];return void 0===n&&(n=new ui({depthPacking:3201,morphTargets:t}),s[e]=n),n}function E(t){var e=t<<0,n=l[e];return void 0===n&&(n=new hi({morphTargets:t}),l[e]=n),n}function T(e,n,r,i,o,a,s){var l=null,u=_,p=e.customDepthMaterial;if(!0===i.isPointLight&&(u=E,p=e.customDistanceMaterial),void 0===p){var d=!1;!0===r.morphTargets&&(d=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0),l=u(d)}else l=p;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var f=l.uuid,m=r.uuid,v=c[f];void 0===v&&(v={},c[f]=v);var g=v[m];void 0===g&&(g=l.clone(),v[m]=g),l=g}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=3===s?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:h[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=o,l.farDistance=a),l}function x(n,i,o,a,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var l=e.update(n),c=n.material;if(Array.isArray(c))for(var u=l.groups,h=0,p=u.length;h<p;h++){var d=u[h],f=c[d.materialIndex];if(f&&f.visible){var m=T(n,l,f,a,o.near,o.far,s);t.renderBufferDirect(o,null,l,m,n,d)}}else if(c.visible){var v=T(n,l,c,a,o.near,o.far,s);t.renderBufferDirect(o,null,l,v,n,null)}}for(var g=n.children,y=0,_=g.length;y<_;y++)x(g[y],i,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,s){if(!1!==g.enabled&&(!1!==g.autoUpdate||!1!==g.needsUpdate)&&0!==e.length){var l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var d=0,f=e.length;d<f;d++){var m=e[d],v=m.shadow;if(void 0!==v&&(!1!==v.autoUpdate||!1!==v.needsUpdate)){i.copy(v.mapSize);var _=v.getFrameExtents();if(i.multiply(_),o.copy(v.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/_.x),i.x=o.x*_.x,v.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/_.y),i.y=o.y*_.y,v.mapSize.y=o.y)),null===v.map&&!v.isPointLightShadow&&3===this.type){var E={minFilter:1006,magFilter:1006,format:1023};v.map=new A(i.x,i.y,E),v.map.texture.name=m.name+".shadowMap",v.mapPass=new A(i.x,i.y,E),v.camera.updateProjectionMatrix()}if(null===v.map){var T={minFilter:1003,magFilter:1003,format:1023};v.map=new A(i.x,i.y,T),v.map.texture.name=m.name+".shadowMap",v.camera.updateProjectionMatrix()}t.setRenderTarget(v.map),t.clear();for(var b=v.getViewportCount(),M=0;M<b;M++){var S=v.getViewport(M);a.set(o.x*S.x,o.y*S.y,o.x*S.z,o.y*S.w),p.viewport(a),v.updateMatrices(m,M),r=v.getFrustum(),x(n,s,v.camera,m,this.type)}v.isPointLightShadow||3!==this.type||y(v,s),v.needsUpdate=!1}}g.needsUpdate=!1,t.setRenderTarget(l,c,h)}}}function di(t,e,n){var r=n.isWebGL2,i=new function(){var e=!1,n=new b,r=null,i=new b(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,r,o,a,s){!0===s&&(e*=a,r*=a,o*=a),n.set(e,r,o,a),!1===i.equals(n)&&(t.clearColor(e,r,o,a),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},o=new function(){var e=!1,n=null,r=null,i=null;return{setTest:function(e){e?F(t.DEPTH_TEST):H(t.DEPTH_TEST)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);r=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},a=new function(){var e=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(n){e||(n?F(t.STENCIL_TEST):H(t.STENCIL_TEST))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,a){r===e&&i===n&&o===a||(t.stencilFunc(e,n,a),r=e,i=n,o=a)},setOp:function(e,n,r){a===e&&s===n&&l===r||(t.stencilOp(e,n,r),a=e,s=n,l=r)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,r=null,i=null,o=null,a=null,s=null,l=null,c=null}}},s={},l=null,c={},u=null,h=!1,p=null,d=null,f=null,m=null,v=null,g=null,y=null,_=!1,E=null,T=null,x=null,M=null,A=null,S=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),O=!1,w=0,L=t.getParameter(t.VERSION);-1!==L.indexOf("WebGL")?(w=parseFloat(/^WebGL (\d)/.exec(L)[1]),O=w>=1):-1!==L.indexOf("OpenGL ES")&&(w=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),O=w>=2);var D=null,C={},P=t.getParameter(t.SCISSOR_BOX),N=t.getParameter(t.VIEWPORT),R=(new b).fromArray(P),I=(new b).fromArray(N);function U(e,n,r){var i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var a=0;a<r;a++)t.texImage2D(n+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i);return o}var B={};function F(e){!0!==s[e]&&(t.enable(e),s[e]=!0)}function H(e){!1!==s[e]&&(t.disable(e),s[e]=!1)}B[t.TEXTURE_2D]=U(t.TEXTURE_2D,t.TEXTURE_2D,1),B[t.TEXTURE_CUBE_MAP]=U(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),i.setClear(0,0,0,1),o.setClear(1),a.setClear(0),F(t.DEPTH_TEST),o.setFunc(3),V(!1),j(1),F(t.CULL_FACE),W(0);var k={};if(k[100]=t.FUNC_ADD,k[101]=t.FUNC_SUBTRACT,k[102]=t.FUNC_REVERSE_SUBTRACT,r)k[103]=t.MIN,k[104]=t.MAX;else{var z=e.get("EXT_blend_minmax");null!==z&&(k[103]=z.MIN_EXT,k[104]=z.MAX_EXT)}var G={};function W(e,n,r,i,o,a,s,l){if(0!==e){if(!1===h&&(F(t.BLEND),h=!0),5===e)o=o||n,a=a||r,s=s||i,n===d&&o===v||(t.blendEquationSeparate(k[n],k[o]),d=n,v=o),r===f&&i===m&&a===g&&s===y||(t.blendFuncSeparate(G[r],G[i],G[a],G[s]),f=r,m=i,g=a,y=s),p=e,_=null;else if(e!==p||l!==_){if(100===d&&100===v||(t.blendEquation(t.FUNC_ADD),d=100,v=100),l)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR)}f=null,m=null,g=null,y=null,p=e,_=l}}else!0===h&&(H(t.BLEND),h=!1)}function V(e){E!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),E=e)}function j(e){0!==e?(F(t.CULL_FACE),e!==T&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):H(t.CULL_FACE),T=e}function Y(e,n,r){e?(F(t.POLYGON_OFFSET_FILL),M===n&&A===r||(t.polygonOffset(n,r),M=n,A=r)):H(t.POLYGON_OFFSET_FILL)}function X(e){void 0===e&&(e=t.TEXTURE0+S-1),D!==e&&(t.activeTexture(e),D=e)}return G[200]=t.ZERO,G[201]=t.ONE,G[202]=t.SRC_COLOR,G[204]=t.SRC_ALPHA,G[210]=t.SRC_ALPHA_SATURATE,G[208]=t.DST_COLOR,G[206]=t.DST_ALPHA,G[203]=t.ONE_MINUS_SRC_COLOR,G[205]=t.ONE_MINUS_SRC_ALPHA,G[209]=t.ONE_MINUS_DST_COLOR,G[207]=t.ONE_MINUS_DST_ALPHA,{buffers:{color:i,depth:o,stencil:a},enable:F,disable:H,bindFramebuffer:function(e,n){return null===n&&null!==l&&(n=l),c[e]!==n&&(t.bindFramebuffer(e,n),c[e]=n,r&&(e===t.DRAW_FRAMEBUFFER&&(c[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(c[t.DRAW_FRAMEBUFFER]=n)),!0)},bindXRFramebuffer:function(e){e!==l&&(t.bindFramebuffer(t.FRAMEBUFFER,e),l=e)},useProgram:function(e){return u!==e&&(t.useProgram(e),u=e,!0)},setBlending:W,setMaterial:function(e,n){2===e.side?H(t.CULL_FACE):F(t.CULL_FACE);var r=1===e.side;n&&(r=!r),V(r),1===e.blending&&!1===e.transparent?W(0):W(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),i.setMask(e.colorWrite);var s=e.stencilWrite;a.setTest(s),s&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Y(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?F(t.SAMPLE_ALPHA_TO_COVERAGE):H(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:V,setCullFace:j,setLineWidth:function(e){e!==x&&(O&&t.lineWidth(e),x=e)},setPolygonOffset:Y,setScissorTest:function(e){e?F(t.SCISSOR_TEST):H(t.SCISSOR_TEST)},activeTexture:X,bindTexture:function(e,n){null===D&&X();var r=C[D];void 0===r&&(r={type:void 0,texture:void 0},C[D]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||B[e]),r.type=e,r.texture=n)},unbindTexture:function(){var e=C[D];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){}},scissor:function(e){!1===R.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),R.copy(e))},viewport:function(e){!1===I.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),I.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===r&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),s={},D=null,C={},l=null,c={},u=null,h=!1,p=null,d=null,f=null,m=null,v=null,g=null,y=null,_=!1,E=null,T=null,x=null,M=null,A=null,R.set(0,0,t.canvas.width,t.canvas.height),I.set(0,0,t.canvas.width,t.canvas.height),i.reset(),o.reset(),a.reset()}}}function fi(t,e,n,r,i,o,a){var s,l=i.isWebGL2,c=(i.maxTextures,i.maxCubemapSize),u=i.maxTextureSize,p=i.maxSamples,f=new WeakMap,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function v(t,e){return m?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,n,r){var i=1;if((t.width>r||t.height>r)&&(i=r/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var o=e?d:Math.floor,a=o(i*t.width),l=o(i*t.height);void 0===s&&(s=v(a,l));var c=n?v(a,l):s;return c.width=a,c.height=l,c.getContext("2d").drawImage(t,0,0,a,l),c}return t}return t}function y(t){return h(t.width)&&h(t.height)}function _(t,e){return t.generateMipmaps&&e&&1003!==t.minFilter&&1006!==t.minFilter}function E(e,n,i,o,a){void 0===a&&(a=1),t.generateMipmap(e),r.get(n).__maxMipLevel=Math.log2(Math.max(i,o,a))}function T(n,r,i){if(!1===l)return r;if(null!==n&&void 0!==t[n])return t[n];var o=r;return r===t.RED&&(i===t.FLOAT&&(o=t.R32F),i===t.HALF_FLOAT&&(o=t.R16F),i===t.UNSIGNED_BYTE&&(o=t.R8)),r===t.RGB&&(i===t.FLOAT&&(o=t.RGB32F),i===t.HALF_FLOAT&&(o=t.RGB16F),i===t.UNSIGNED_BYTE&&(o=t.RGB8)),r===t.RGBA&&(i===t.FLOAT&&(o=t.RGBA32F),i===t.HALF_FLOAT&&(o=t.RGBA16F),i===t.UNSIGNED_BYTE&&(o=t.RGBA8)),o!==t.R16F&&o!==t.R32F&&o!==t.RGBA16F&&o!==t.RGBA32F||e.get("EXT_color_buffer_float"),o}function x(e){return 1003===e||1004===e||1005===e?t.NEAREST:t.LINEAR}function b(e){var n=e.target;n.removeEventListener("dispose",b),function(e){var n=r.get(e);void 0!==n.__webglInit&&(t.deleteTexture(n.__webglTexture),r.remove(e))}(n),n.isVideoTexture&&f.delete(n),a.memory.textures--}function M(e){var n=e.target;n.removeEventListener("dispose",M),function(e){var n=e.texture,i=r.get(e),o=r.get(n);if(e){if(void 0!==o.__webglTexture&&(t.deleteTexture(o.__webglTexture),a.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)t.deleteFramebuffer(i.__webglFramebuffer[s]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[s]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(var l=0,c=n.length;l<c;l++){var u=r.get(n[l]);u.__webglTexture&&(t.deleteTexture(u.__webglTexture),a.memory.textures--),r.remove(n[l])}r.remove(n),r.remove(e)}}(n)}var A=0;function S(e,i){var o=r.get(e);if(e.isVideoTexture&&function(t){var e=a.render.frame;f.get(t)!==e&&(f.set(t,e),t.update())}(e),e.version>0&&o.__version!==e.version){var s=e.image;if(void 0===s);else if(!1!==s.complete)return void P(o,e,i)}n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_2D,o.__webglTexture)}function O(e,i){var a=r.get(e);e.version>0&&a.__version!==e.version?function(e,r,i){if(6===r.image.length){C(e,r),n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);for(var a=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,u=[],h=0;h<6;h++)u[h]=a||s?s?r.image[h].image:r.image[h]:g(r.image[h],!1,!0,c);var p,d=u[0],f=y(d)||l,m=o.convert(r.format),v=o.convert(r.type),x=T(r.internalFormat,m,v);if(D(t.TEXTURE_CUBE_MAP,r,f),a){for(var b=0;b<6;b++){p=u[b].mipmaps;for(var M=0;M<p.length;M++){var A=p[M];1023!==r.format&&1022!==r.format?null!==m&&n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+b,M,x,A.width,A.height,0,A.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+b,M,x,A.width,A.height,0,m,v,A.data)}}e.__maxMipLevel=p.length-1}else{p=r.mipmaps;for(var S=0;S<6;S++)if(s){n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,x,u[S].width,u[S].height,0,m,v,u[S].data);for(var O=0;O<p.length;O++){var w=p[O].image[S].image;n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+S,O+1,x,w.width,w.height,0,m,v,w.data)}}else{n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+S,0,x,m,v,u[S]);for(var L=0;L<p.length;L++){var P=p[L];n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+S,L+1,x,m,v,P.image[S])}}e.__maxMipLevel=p.length}_(r,f)&&E(t.TEXTURE_CUBE_MAP,r,d.width,d.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}}(a,e,i):(n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture))}var w={};w[1e3]=t.REPEAT,w[1001]=t.CLAMP_TO_EDGE,w[1002]=t.MIRRORED_REPEAT;var L={};function D(n,o,a){if(a?(t.texParameteri(n,t.TEXTURE_WRAP_S,w[o.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,w[o.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,w[o.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,L[o.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,L[o.minFilter])):(t.texParameteri(n,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(n,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),1001!==o.wrapS||o.wrapT,t.texParameteri(n,t.TEXTURE_MAG_FILTER,x(o.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,x(o.minFilter)),1003!==o.minFilter&&o.minFilter),!0===e.has("EXT_texture_filter_anisotropic")){var s=e.get("EXT_texture_filter_anisotropic");if(1015===o.type&&!1===e.has("OES_texture_float_linear"))return;if(!1===l&&1016===o.type&&!1===e.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(t.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function C(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",b),e.__webglTexture=t.createTexture(),a.memory.textures++)}function P(e,r,i){var a=t.TEXTURE_2D;r.isDataTexture2DArray&&(a=t.TEXTURE_2D_ARRAY),r.isDataTexture3D&&(a=t.TEXTURE_3D),C(e,r),n.activeTexture(t.TEXTURE0+i),n.bindTexture(a,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE);var s,c=function(t){return!l&&(1001!==t.wrapS||1001!==t.wrapT||1003!==t.minFilter&&1006!==t.minFilter)}(r)&&!1===y(r.image),h=g(r.image,c,!1,u),p=y(h)||l,d=o.convert(r.format),f=o.convert(r.type),m=T(r.internalFormat,d,f);D(a,r,p);var v=r.mipmaps;if(r.isDepthTexture)m=t.DEPTH_COMPONENT,l?m=1015===r.type?t.DEPTH_COMPONENT32F:1014===r.type?t.DEPTH_COMPONENT24:1020===r.type?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:r.type,1026===r.format&&m===t.DEPTH_COMPONENT&&1012!==r.type&&1014!==r.type&&(r.type=1012,f=o.convert(r.type)),1027===r.format&&m===t.DEPTH_COMPONENT&&(m=t.DEPTH_STENCIL,1020!==r.type&&(r.type=1020,f=o.convert(r.type))),n.texImage2D(t.TEXTURE_2D,0,m,h.width,h.height,0,d,f,null);else if(r.isDataTexture)if(v.length>0&&p){for(var x=0,b=v.length;x<b;x++)s=v[x],n.texImage2D(t.TEXTURE_2D,x,m,s.width,s.height,0,d,f,s.data);r.generateMipmaps=!1,e.__maxMipLevel=v.length-1}else n.texImage2D(t.TEXTURE_2D,0,m,h.width,h.height,0,d,f,h.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(var M=0,A=v.length;M<A;M++)s=v[M],1023!==r.format&&1022!==r.format?null!==d&&n.compressedTexImage2D(t.TEXTURE_2D,M,m,s.width,s.height,0,s.data):n.texImage2D(t.TEXTURE_2D,M,m,s.width,s.height,0,d,f,s.data);e.__maxMipLevel=v.length-1}else if(r.isDataTexture2DArray)n.texImage3D(t.TEXTURE_2D_ARRAY,0,m,h.width,h.height,h.depth,0,d,f,h.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(t.TEXTURE_3D,0,m,h.width,h.height,h.depth,0,d,f,h.data),e.__maxMipLevel=0;else if(v.length>0&&p){for(var S=0,O=v.length;S<O;S++)s=v[S],n.texImage2D(t.TEXTURE_2D,S,m,d,f,s);r.generateMipmaps=!1,e.__maxMipLevel=v.length-1}else n.texImage2D(t.TEXTURE_2D,0,m,d,f,h),e.__maxMipLevel=0;_(r,p)&&E(a,r,h.width,h.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function N(e,i,a,s,l){var c=o.convert(a.format),u=o.convert(a.type),h=T(a.internalFormat,c,u);l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?n.texImage3D(l,0,h,i.width,i.height,i.depth,0,c,u,null):n.texImage2D(l,0,h,i.width,i.height,0,c,u,null),n.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,s,l,r.get(a).__webglTexture,0),n.bindFramebuffer(t.FRAMEBUFFER,null)}function R(e,n,r){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer){var i=t.DEPTH_COMPONENT16;if(r){var a=n.depthTexture;a&&a.isDepthTexture&&(1015===a.type?i=t.DEPTH_COMPONENT32F:1014===a.type&&(i=t.DEPTH_COMPONENT24));var s=U(n);t.renderbufferStorageMultisample(t.RENDERBUFFER,s,i,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,i,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){var l=U(n);t.renderbufferStorageMultisample(t.RENDERBUFFER,l,t.DEPTH24_STENCIL8,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{var c=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,u=o.convert(c.format),h=o.convert(c.type),p=T(c.internalFormat,u,h);if(r){var d=U(n);t.renderbufferStorageMultisample(t.RENDERBUFFER,d,p,n.width,n.height)}else t.renderbufferStorage(t.RENDERBUFFER,p,n.width,n.height)}t.bindRenderbuffer(t.RENDERBUFFER,null)}function I(e){var i=r.get(e),o=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),S(i.depthTexture,0);var o=r.get(i.depthTexture).__webglTexture;if(1026===i.depthTexture.format)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(1027!==i.depthTexture.format)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}(i.__webglFramebuffer,e)}else if(o){i.__webglDepthbuffer=[];for(var a=0;a<6;a++)n.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer[a]),i.__webglDepthbuffer[a]=t.createRenderbuffer(),R(i.__webglDepthbuffer[a],e,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),R(i.__webglDepthbuffer,e,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}function U(t){return l&&t.isWebGLMultisampleRenderTarget?Math.min(p,t.samples):0}L[1003]=t.NEAREST,L[1004]=t.NEAREST_MIPMAP_NEAREST,L[1005]=t.NEAREST_MIPMAP_LINEAR,L[1006]=t.LINEAR,L[1007]=t.LINEAR_MIPMAP_NEAREST,L[1008]=t.LINEAR_MIPMAP_LINEAR;var B=!1,F=!1;this.allocateTextureUnit=function(){var t=A;return A+=1,t},this.resetTextureUnits=function(){A=0},this.setTexture2D=S,this.setTexture2DArray=function(e,i){var o=r.get(e);e.version>0&&o.__version!==e.version?P(o,e,i):(n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_2D_ARRAY,o.__webglTexture))},this.setTexture3D=function(e,i){var o=r.get(e);e.version>0&&o.__version!==e.version?P(o,e,i):(n.activeTexture(t.TEXTURE0+i),n.bindTexture(t.TEXTURE_3D,o.__webglTexture))},this.setTextureCube=O,this.setupRenderTarget=function(e){var s=e.texture,c=r.get(e),u=r.get(s);e.addEventListener("dispose",M),!0!==e.isWebGLMultipleRenderTargets&&(u.__webglTexture=t.createTexture(),u.__version=s.version,a.memory.textures++);var h=!0===e.isWebGLCubeRenderTarget,p=!0===e.isWebGLMultipleRenderTargets,d=!0===e.isWebGLMultisampleRenderTarget,f=s.isDataTexture3D||s.isDataTexture2DArray,m=y(e)||l;if(!l||1022!==s.format||1015!==s.type&&1016!==s.type||(s.format=1023),h){c.__webglFramebuffer=[];for(var v=0;v<6;v++)c.__webglFramebuffer[v]=t.createFramebuffer()}else if(c.__webglFramebuffer=t.createFramebuffer(),p){if(i.drawBuffers)for(var g=e.texture,x=0,b=g.length;x<b;x++){var A=r.get(g[x]);void 0===A.__webglTexture&&(A.__webglTexture=t.createTexture(),a.memory.textures++)}}else if(d&&l){c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,c.__webglColorRenderbuffer);var S=o.convert(s.format),O=o.convert(s.type),w=T(s.internalFormat,S,O),L=U(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,L,w,e.width,e.height),n.bindFramebuffer(t.FRAMEBUFFER,c.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,c.__webglColorRenderbuffer),t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),R(c.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}if(h){n.bindTexture(t.TEXTURE_CUBE_MAP,u.__webglTexture),D(t.TEXTURE_CUBE_MAP,s,m);for(var C=0;C<6;C++)N(c.__webglFramebuffer[C],e,s,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+C);_(s,m)&&E(t.TEXTURE_CUBE_MAP,s,e.width,e.height),n.bindTexture(t.TEXTURE_CUBE_MAP,null)}else if(p){for(var P=e.texture,B=0,F=P.length;B<F;B++){var H=P[B],k=r.get(H);n.bindTexture(t.TEXTURE_2D,k.__webglTexture),D(t.TEXTURE_2D,H,m),N(c.__webglFramebuffer,e,H,t.COLOR_ATTACHMENT0+B,t.TEXTURE_2D),_(H,m)&&E(t.TEXTURE_2D,H,e.width,e.height)}n.bindTexture(t.TEXTURE_2D,null)}else{var z=t.TEXTURE_2D;f&&l&&(z=s.isDataTexture3D?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(z,u.__webglTexture),D(z,s,m),N(c.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0,z),_(s,m)&&E(z,s,e.width,e.height,e.depth),n.bindTexture(z,null)}e.depthBuffer&&I(e)},this.updateRenderTargetMipmap=function(e){for(var i=y(e)||l,o=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,s=o.length;a<s;a++){var c=o[a];if(_(c,i)){var u=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,h=r.get(c).__webglTexture;n.bindTexture(u,h),E(u,c,e.width,e.height),n.bindTexture(u,null)}}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget&&l){var i=e.width,o=e.height,a=t.COLOR_BUFFER_BIT;e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(a|=t.STENCIL_BUFFER_BIT);var s=r.get(e);n.bindFramebuffer(t.READ_FRAMEBUFFER,s.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,s.__webglFramebuffer),t.blitFramebuffer(0,0,i,o,0,0,i,o,a,t.NEAREST),n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,s.__webglMultisampledFramebuffer)}},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===B&&(B=!0),t=t.texture),S(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===F&&(F=!0),t=t.texture),O(t,e)}}function mi(t,e,n){var r=n.isWebGL2;return{convert:function(n){var i;if(1009===n)return t.UNSIGNED_BYTE;if(1017===n)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return t.UNSIGNED_SHORT_5_5_5_1;if(1019===n)return t.UNSIGNED_SHORT_5_6_5;if(1010===n)return t.BYTE;if(1011===n)return t.SHORT;if(1012===n)return t.UNSIGNED_SHORT;if(1013===n)return t.INT;if(1014===n)return t.UNSIGNED_INT;if(1015===n)return t.FLOAT;if(1016===n)return r?t.HALF_FLOAT:null!==(i=e.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(1021===n)return t.ALPHA;if(1022===n)return t.RGB;if(1023===n)return t.RGBA;if(1024===n)return t.LUMINANCE;if(1025===n)return t.LUMINANCE_ALPHA;if(1026===n)return t.DEPTH_COMPONENT;if(1027===n)return t.DEPTH_STENCIL;if(1028===n)return t.RED;if(1029===n)return t.RED_INTEGER;if(1030===n)return t.RG;if(1031===n)return t.RG_INTEGER;if(1032===n)return t.RGB_INTEGER;if(1033===n)return t.RGBA_INTEGER;if(33776===n||33777===n||33778===n||33779===n){if(null===(i=e.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===n)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===n)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===n)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===n)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(null===(i=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===n)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return null!==(i=e.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===n||37496===n)&&null!==(i=e.get("WEBGL_compressed_texture_etc"))){if(37492===n)return i.COMPRESSED_RGB8_ETC2;if(37496===n)return i.COMPRESSED_RGBA8_ETC2_EAC}return 37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n||37840===n||37841===n||37842===n||37843===n||37844===n||37845===n||37846===n||37847===n||37848===n||37849===n||37850===n||37851===n||37852===n||37853===n?null!==(i=e.get("WEBGL_compressed_texture_astc"))?n:null:36492===n?null!==(i=e.get("EXT_texture_compression_bptc"))?n:null:1020===n?r?t.UNSIGNED_INT_24_8:null!==(i=e.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}hi.prototype.isMeshDistanceMaterial=!0;var vi=function(t){function e(e){void 0===e&&(e=[]),t.call(this),this.cameras=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ke);vi.prototype.isArrayCamera=!0;var gi=function(t){function e(){t.call(this),this.type="Group"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Nt);gi.prototype.isGroup=!0;var yi={type:"move"},_i=function(){this._targetRay=null,this._grip=null,this._hand=null};_i.prototype.getHandSpace=function(){return null===this._hand&&(this._hand=new gi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},_i.prototype.getTargetRaySpace=function(){return null===this._targetRay&&(this._targetRay=new gi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new D,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new D),this._targetRay},_i.prototype.getGripSpace=function(){return null===this._grip&&(this._grip=new gi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new D,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new D),this._grip},_i.prototype.dispatchEvent=function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},_i.prototype.disconnect=function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},_i.prototype.update=function(t,e,n){var r=null,i=null,o=null,a=this._targetRay,s=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==a&&null!==(r=e.getPose(t.targetRaySpace,n))&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(yi)),l&&t.hand){for(var c of(o=!0,t.hand.values())){var u=e.getJointPose(c,n);if(void 0===l.joints[c.jointName]){var h=new gi;h.matrixAutoUpdate=!1,h.visible=!1,l.joints[c.jointName]=h,l.add(h)}var p=l.joints[c.jointName];null!==u&&(p.matrix.fromArray(u.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=u.radius),p.visible=null!==u}var d=l.joints["index-finger-tip"],f=l.joints["thumb-tip"],m=d.position.distanceTo(f.position);l.inputState.pinching&&m>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&m<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==s&&t.gripSpace&&null!==(i=e.getPose(t.gripSpace,n))&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1);return null!==a&&(a.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==o),this};var Ei=function(t){function e(e,n){t.call(this);var r=this,i=e.state,o=null,a=1,s=null,l="local-floor",c=null,u=null,h=null,p=null,d=[],f=new Map,m=new Ke;m.layers.enable(1),m.viewport=new b;var v=new Ke;v.layers.enable(2),v.viewport=new b;var g=[m,v],y=new vi;y.layers.enable(1),y.layers.enable(2);var _=null,E=null;function T(t){var e=f.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function x(){f.forEach((function(t,e){t.disconnect(e)})),f.clear(),_=null,E=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),L.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function M(t){for(var e=o.inputSources,n=0;n<d.length;n++)f.set(e[n],d[n]);for(var r=0;r<t.removed.length;r++){var i=t.removed[r],a=f.get(i);a&&(a.dispatchEvent({type:"disconnected",data:i}),f.delete(i))}for(var s=0;s<t.added.length;s++){var l=t.added[s],c=f.get(l);c&&c.dispatchEvent({type:"connected",data:l})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){var e=d[t];return void 0===e&&(e=new _i,d[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){var e=d[t];return void 0===e&&(e=new _i,d[t]=e),e.getGripSpace()},this.getHand=function(t){var e=d[t];return void 0===e&&(e=new _i,d[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){a=t,r.isPresenting},this.setReferenceSpaceType=function(t){l=t,r.isPresenting},this.getReferenceSpace=function(){return s},this.getSession=function(){return o},this.setSession=async function(t){if(null!==(o=t)){o.addEventListener("select",T),o.addEventListener("selectstart",T),o.addEventListener("selectend",T),o.addEventListener("squeeze",T),o.addEventListener("squeezestart",T),o.addEventListener("squeezeend",T),o.addEventListener("end",x),o.addEventListener("inputsourceschange",M);var e=n.getContextAttributes();if(!0!==e.xrCompatible&&await n.makeXRCompatible(),void 0===o.renderState.layers){var i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:a},c=new XRWebGLLayer(o,n,i);o.updateRenderState({baseLayer:c})}else{var d=0;e.depth&&(d=e.stencil?n.DEPTH_STENCIL:n.DEPTH_COMPONENT);var f={colorFormat:e.alpha?n.RGBA:n.RGB,depthFormat:d,scaleFactor:a};u=new XRWebGLBinding(o,n),p=u.createProjectionLayer(f),h=n.createFramebuffer(),o.updateRenderState({layers:[p]})}s=await o.requestReferenceSpace(l),L.setContext(o),L.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}};var A=new D,S=new D;function O(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null!==o){y.near=v.near=m.near=t.near,y.far=v.far=m.far=t.far,_===y.near&&E===y.far||(o.updateRenderState({depthNear:y.near,depthFar:y.far}),_=y.near,E=y.far);var e=t.parent,n=y.cameras;O(y,e);for(var r=0;r<n.length;r++)O(n[r],e);y.matrixWorld.decompose(y.position,y.quaternion,y.scale),t.position.copy(y.position),t.quaternion.copy(y.quaternion),t.scale.copy(y.scale),t.matrix.copy(y.matrix),t.matrixWorld.copy(y.matrixWorld);for(var i=t.children,a=0,s=i.length;a<s;a++)i[a].updateMatrixWorld(!0);2===n.length?function(t,e,n){A.setFromMatrixPosition(e.matrixWorld),S.setFromMatrixPosition(n.matrixWorld);var r=A.distanceTo(S),i=e.projectionMatrix.elements,o=n.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],p=a*u,d=a*h,f=r/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();var v=a+f,g=s+f,y=p-m,_=d+(r-m),E=l*s/g*v,T=c*s/g*v;t.projectionMatrix.makePerspective(y,_,E,T,v,g)}(y,m,v):y.projectionMatrix.copy(m.projectionMatrix)}},this.getCamera=function(){return y};var w=null,L=new cn;L.setAnimationLoop((function(t,e){if(null!==(c=e.getViewerPose(s))){var r=c.views,a=o.renderState.baseLayer;void 0===o.renderState.layers&&i.bindXRFramebuffer(a.framebuffer);var l=!1;r.length!==y.cameras.length&&(y.cameras.length=0,l=!0);for(var f=0;f<r.length;f++){var m=r[f],v=null;if(void 0===o.renderState.layers)v=a.getViewport(m);else{var _=u.getViewSubImage(p,m);i.bindXRFramebuffer(h),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,_.colorTexture,0),void 0!==_.depthStencilTexture&&n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,_.depthStencilTexture,0),v=_.viewport}var E=g[f];E.matrix.fromArray(m.transform.matrix),E.projectionMatrix.fromArray(m.projectionMatrix),E.viewport.set(v.x,v.y,v.width,v.height),0===f&&y.matrix.copy(E.matrix),!0===l&&y.cameras.push(E)}}for(var T=o.inputSources,x=0;x<d.length;x++){var b=d[x],M=T[x];b.update(M,e,s)}w&&w(t,e)})),this.setAnimationLoop=function(t){w=t},this.dispose=function(){}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(e);function Ti(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);var r,i,o=t.get(n).envMap;if(o){e.envMap.value=o,e.flipEnvMap.value=o.isCubeTexture&&o._needsFlipEnvMap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio;var a=t.get(o).__maxMipLevel;void 0!==a&&(e.maxMipLevel.value=a)}n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),n.aoMap?i=n.aoMap:n.lightMap&&(i=n.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias),t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,i,o,a){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r),r.isMeshPhysicalMaterial?function(t,e,r){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()),t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),e.transmission>0&&(t.transmissionSamplerMap.value=r.texture,t.transmissionSamplerSize.value.set(r.width,r.height)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor)}(t,r,a):n(t,r)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){var i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,r,i,o):r.isSpriteMaterial?function(t,e){var n;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?n=e.map:e.alphaMap&&(n=e.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function xi(t){void 0===t&&(t={});var e,n=void 0!==t.canvas?t.canvas:((e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).style.display="block",e),r=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,o=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,l=void 0===t.premultipliedAlpha||t.premultipliedAlpha,c=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,u=void 0!==t.powerPreference?t.powerPreference:"default",h=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,p=null,d=null,f=[],m=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;var v=this,g=!1,y=0,_=0,E=null,T=-1,x=null,M=new b,S=new b,w=null,L=n.width,C=n.height,P=1,N=null,R=null,I=new b(0,0,L,C),U=new b(0,0,L,C),B=!1,F=[],H=new ln,k=!1,z=!1,G=null,W=new st,V=new D,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Y(){return null===E?P:1}var X,Z,q,Q,K,J,$,tt,et,nt,rt,it,ot,at,lt,ct,ut,ht,pt,dt,ft,mt,vt=r;function gt(t,e){for(var r=0;r<t.length;r++){var i=t[r],o=n.getContext(i,e);if(null!==o)return o}return null}try{var yt={alpha:i,depth:o,stencil:a,antialias:s,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if(n.addEventListener("webglcontextlost",xt,!1),n.addEventListener("webglcontextrestored",bt,!1),null===vt){var _t=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&_t.shift(),null===(vt=gt(_t,yt)))throw gt(_t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===vt.getShaderPrecisionFormat&&(vt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw t}function Et(){X=new Tn(vt),Z=new yn(vt,X,t),X.init(Z),ft=new mi(vt,X,Z),q=new di(vt,X,Z),F[0]=vt.BACK,Q=new Mn(vt),K=new $r,J=new fi(vt,X,q,K,Z,ft,Q),$=new En(v),tt=new un(vt,Z),mt=new vn(vt,X,tt,Z),et=new xn(vt,tt,Q,mt),nt=new wn(vt,et,tt,Q),ht=new On(vt),lt=new _n(K),rt=new Jr(v,$,X,Z,mt,lt),it=new Ti(K),ot=new ri(K),at=new ci(X,Z),ut=new mn(v,$,q,nt,l),ct=new pi(v,nt,Z),pt=new gn(vt,X,Q,Z),dt=new bn(vt,X,Q,Z),Q.programs=rt.programs,v.capabilities=Z,v.extensions=X,v.properties=K,v.renderLists=ot,v.shadowMap=ct,v.state=q,v.info=Q}Et();var Tt=new Ei(v,vt);function xt(t){t.preventDefault(),g=!0}function bt(){g=!1;var t=Q.autoReset,e=ct.enabled,n=ct.autoUpdate,r=ct.needsUpdate,i=ct.type;Et(),Q.autoReset=t,ct.enabled=e,ct.autoUpdate=n,ct.needsUpdate=r,ct.type=i}function Mt(t){var e=t.target;e.removeEventListener("dispose",Mt),function(t){(function(t){var e=K.get(t).programs;void 0!==e&&e.forEach((function(t){rt.releaseProgram(t)}))})(t),K.remove(t)}(e)}this.xr=Tt,this.getContext=function(){return vt},this.getContextAttributes=function(){return vt.getContextAttributes()},this.forceContextLoss=function(){var t=X.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=X.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(t){void 0!==t&&(P=t,this.setSize(L,C,!1))},this.getSize=function(t){return t.set(L,C)},this.setSize=function(t,e,r){Tt.isPresenting||(L=t,C=e,n.width=Math.floor(t*P),n.height=Math.floor(e*P),!1!==r&&(n.style.width=t+"px",n.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(L*P,C*P).floor()},this.setDrawingBufferSize=function(t,e,r){L=t,C=e,P=r,n.width=Math.floor(t*r),n.height=Math.floor(e*r),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(M)},this.getViewport=function(t){return t.copy(I)},this.setViewport=function(t,e,n,r){t.isVector4?I.set(t.x,t.y,t.z,t.w):I.set(t,e,n,r),q.viewport(M.copy(I).multiplyScalar(P).floor())},this.getScissor=function(t){return t.copy(U)},this.setScissor=function(t,e,n,r){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,n,r),q.scissor(S.copy(U).multiplyScalar(P).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(t){q.setScissorTest(B=t)},this.setOpaqueSort=function(t){N=t},this.setTransparentSort=function(t){R=t},this.getClearColor=function(t){return t.copy(ut.getClearColor())},this.setClearColor=function(){ut.setClearColor.apply(ut,arguments)},this.getClearAlpha=function(){return ut.getClearAlpha()},this.setClearAlpha=function(){ut.setClearAlpha.apply(ut,arguments)},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=vt.COLOR_BUFFER_BIT),(void 0===e||e)&&(r|=vt.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=vt.STENCIL_BUFFER_BIT),vt.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",xt,!1),n.removeEventListener("webglcontextrestored",bt,!1),ot.dispose(),at.dispose(),K.dispose(),$.dispose(),nt.dispose(),mt.dispose(),Tt.dispose(),Tt.removeEventListener("sessionstart",St),Tt.removeEventListener("sessionend",Ot),G&&(G.dispose(),G=null),wt.stop()},this.renderBufferImmediate=function(t,e){mt.initAttributes();var n=K.get(t);t.hasPositions&&!n.position&&(n.position=vt.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=vt.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=vt.createBuffer()),t.hasColors&&!n.color&&(n.color=vt.createBuffer());var r=e.getAttributes();t.hasPositions&&(vt.bindBuffer(vt.ARRAY_BUFFER,n.position),vt.bufferData(vt.ARRAY_BUFFER,t.positionArray,vt.DYNAMIC_DRAW),mt.enableAttribute(r.position),vt.vertexAttribPointer(r.position,3,vt.FLOAT,!1,0,0)),t.hasNormals&&(vt.bindBuffer(vt.ARRAY_BUFFER,n.normal),vt.bufferData(vt.ARRAY_BUFFER,t.normalArray,vt.DYNAMIC_DRAW),mt.enableAttribute(r.normal),vt.vertexAttribPointer(r.normal,3,vt.FLOAT,!1,0,0)),t.hasUvs&&(vt.bindBuffer(vt.ARRAY_BUFFER,n.uv),vt.bufferData(vt.ARRAY_BUFFER,t.uvArray,vt.DYNAMIC_DRAW),mt.enableAttribute(r.uv),vt.vertexAttribPointer(r.uv,2,vt.FLOAT,!1,0,0)),t.hasColors&&(vt.bindBuffer(vt.ARRAY_BUFFER,n.color),vt.bufferData(vt.ARRAY_BUFFER,t.colorArray,vt.DYNAMIC_DRAW),mt.enableAttribute(r.color),vt.vertexAttribPointer(r.color,3,vt.FLOAT,!1,0,0)),mt.disableUnusedAttributes(),vt.drawArrays(vt.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,r,i,o){null===e&&(e=j);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=Nt(t,e,r,i);q.setMaterial(r,a);var l=n.index,c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;var u,h=1;!0===r.wireframe&&(l=et.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&ht.update(i,n,r,s),mt.setup(i,r,s,n,l);var p=pt;null!==l&&(u=tt.get(l),(p=dt).setIndex(u));var d=null!==l?l.count:c.count,f=n.drawRange.start*h,m=n.drawRange.count*h,v=null!==o?o.start*h:0,g=null!==o?o.count*h:1/0,y=Math.max(f,v),_=Math.min(d,f+m,v+g)-1,E=Math.max(0,_-y+1);if(0!==E){if(i.isMesh)!0===r.wireframe?(q.setLineWidth(r.wireframeLinewidth*Y()),p.setMode(vt.LINES)):p.setMode(vt.TRIANGLES);else if(i.isLine){var T=r.linewidth;void 0===T&&(T=1),q.setLineWidth(T*Y()),i.isLineSegments?p.setMode(vt.LINES):i.isLineLoop?p.setMode(vt.LINE_LOOP):p.setMode(vt.LINE_STRIP)}else i.isPoints?p.setMode(vt.POINTS):i.isSprite&&p.setMode(vt.TRIANGLES);if(i.isInstancedMesh)p.renderInstances(y,E,i.count);else if(n.isInstancedBufferGeometry){var x=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(y,E,x)}else p.render(y,E)}},this.compile=function(t,e){(d=at.get(t)).init(),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(),t.traverse((function(e){var n=e.material;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++)Ct(n[r],t,e);else Ct(n,t,e)}))};var At=null;function St(){wt.stop()}function Ot(){wt.start()}var wt=new cn;function Lt(t,e,n){for(var r=!0===e.isScene?e.overrideMaterial:null,i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,l=a.geometry,c=null===r?a.material:r,u=a.group;if(n.isArrayCamera)for(var h=n.cameras,p=0,f=h.length;p<f;p++){var m=h[p];s.layers.test(m.layers)&&(q.viewport(M.copy(m.viewport)),d.setupLightsView(m),Dt(s,e,m,l,c,u))}else Dt(s,e,n,l,c,u)}}function Dt(t,e,n,r,i,o){if(t.onBeforeRender(v,e,n,r,i,o),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var a=Nt(n,e,i,t);q.setMaterial(i),mt.reset(),function(t,e){t.render((function(t){v.renderBufferImmediate(t,e)}))}(t,a)}else!0===i.transparent&&2===i.side?(i.side=1,i.needsUpdate=!0,v.renderBufferDirect(n,e,r,i,t,o),i.side=0,i.needsUpdate=!0,v.renderBufferDirect(n,e,r,i,t,o),i.side=2):v.renderBufferDirect(n,e,r,i,t,o);t.onAfterRender(v,e,n,r,i,o)}function Ct(t,e,n){!0!==e.isScene&&(e=j);var r=K.get(t),i=d.state.lights,o=d.state.shadowsArray,a=i.state.version,s=rt.getParameters(t,i.state,o,e,n),l=rt.getProgramCacheKey(s),c=r.programs;r.environment=t.isMeshStandardMaterial?e.environment:null,r.fog=e.fog,r.envMap=$.get(t.envMap||r.environment),void 0===c&&(t.addEventListener("dispose",Mt),c=new Map,r.programs=c);var u=c.get(l);if(void 0!==u){if(r.currentProgram===u&&r.lightsStateVersion===a)return Pt(t,s),u}else s.uniforms=rt.getUniforms(t),t.onBuild(s,v),t.onBeforeCompile(s,v),u=rt.acquireProgram(s,l),c.set(l,u),r.uniforms=s.uniforms;var h=r.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(h.clippingPlanes=lt.uniform),Pt(t,s),r.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),r.lightsStateVersion=a,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);var p=u.getUniforms(),f=Pr.seqWithValue(p.seq,h);return r.currentProgram=u,r.uniformsList=f,u}function Pt(t,e){var n=K.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas}function Nt(t,e,n,r){!0!==e.isScene&&(e=j),J.resetTextureUnits();var i=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===E?v.outputEncoding:E.texture.encoding,s=$.get(n.envMap||o),l=!0===n.vertexColors&&r.geometry&&r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,c=K.get(n),u=d.state.lights;if(!0===k&&(!0===z||t!==x)){var h=t===x&&n.id===T;lt.setState(n,t,h)}var p=!1;n.version===c.__version?c.needsLights&&c.lightsStateVersion!==u.state.version||c.outputEncoding!==a||r.isInstancedMesh&&!1===c.instancing?p=!0:r.isInstancedMesh||!0!==c.instancing?r.isSkinnedMesh&&!1===c.skinning?p=!0:r.isSkinnedMesh||!0!==c.skinning?c.envMap!==s||n.fog&&c.fog!==i?p=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===lt.numPlanes&&c.numIntersection===lt.numIntersection?c.vertexAlphas!==l&&(p=!0):p=!0:p=!0:p=!0:(p=!0,c.__version=n.version);var f=c.currentProgram;!0===p&&(f=Ct(n,e,r));var m,g,y=!1,_=!1,b=!1,M=f.getUniforms(),A=c.uniforms;if(q.useProgram(f.program)&&(y=!0,_=!0,b=!0),n.id!==T&&(T=n.id,_=!0),y||x!==t){if(M.setValue(vt,"projectionMatrix",t.projectionMatrix),Z.logarithmicDepthBuffer&&M.setValue(vt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),x!==t&&(x=t,_=!0,b=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var S=M.map.cameraPosition;void 0!==S&&S.setValue(vt,V.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&M.setValue(vt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&M.setValue(vt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){M.setOptional(vt,r,"bindMatrix"),M.setOptional(vt,r,"bindMatrixInverse");var O=r.skeleton;O&&(Z.floatVertexTextures?(null===O.boneTexture&&O.computeBoneTexture(),M.setValue(vt,"boneTexture",O.boneTexture,J),M.setValue(vt,"boneTextureSize",O.boneTextureSize)):M.setOptional(vt,O,"boneMatrices"))}return(_||c.receiveShadow!==r.receiveShadow)&&(c.receiveShadow=r.receiveShadow,M.setValue(vt,"receiveShadow",r.receiveShadow)),_&&(M.setValue(vt,"toneMappingExposure",v.toneMappingExposure),c.needsLights&&(g=b,(m=A).ambientLightColor.needsUpdate=g,m.lightProbe.needsUpdate=g,m.directionalLights.needsUpdate=g,m.directionalLightShadows.needsUpdate=g,m.pointLights.needsUpdate=g,m.pointLightShadows.needsUpdate=g,m.spotLights.needsUpdate=g,m.spotLightShadows.needsUpdate=g,m.rectAreaLights.needsUpdate=g,m.hemisphereLights.needsUpdate=g),i&&n.fog&&it.refreshFogUniforms(A,i),it.refreshMaterialUniforms(A,n,P,C,G),Pr.upload(vt,c.uniformsList,A,J)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Pr.upload(vt,c.uniformsList,A,J),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&M.setValue(vt,"center",r.center),M.setValue(vt,"modelViewMatrix",r.modelViewMatrix),M.setValue(vt,"normalMatrix",r.normalMatrix),M.setValue(vt,"modelMatrix",r.matrixWorld),f}wt.setAnimationLoop((function(t){At&&At(t)})),"undefined"!=typeof window&&wt.setContext(window),this.setAnimationLoop=function(t){At=t,Tt.setAnimationLoop(t),null===t?wt.stop():wt.start()},Tt.addEventListener("sessionstart",St),Tt.addEventListener("sessionend",Ot),this.render=function(t,e){if((void 0===e||!0===e.isCamera)&&!0!==g){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===Tt.enabled&&!0===Tt.isPresenting&&(!0===Tt.cameraAutoUpdate&&Tt.updateCamera(e),e=Tt.getCamera()),!0===t.isScene&&t.onBeforeRender(v,t,e,E),(d=at.get(t,m.length)).init(),m.push(d),W.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),H.setFromProjectionMatrix(W),z=this.localClippingEnabled,k=lt.init(this.clippingPlanes,z,e),(p=ot.get(t,f.length)).init(),f.push(p),function t(e,n,r,i){if(!1!==e.visible){if(e.layers.test(n.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(n);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||H.intersectsSprite(e)){i&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W);var o=nt.update(e),a=e.material;a.visible&&p.push(e,o,a,r,V.z,null)}}else if(e.isImmediateRenderObject)i&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W),p.push(e,null,e.material,r,V.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Q.render.frame&&(e.skeleton.update(),e.skeleton.frame=Q.render.frame),!e.frustumCulled||H.intersectsObject(e))){i&&V.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W);var s=nt.update(e),l=e.material;if(Array.isArray(l))for(var c=s.groups,u=0,h=c.length;u<h;u++){var f=c[u],m=l[f.materialIndex];m&&m.visible&&p.push(e,s,m,r,V.z,f)}else l.visible&&p.push(e,s,l,r,V.z,null)}for(var v=e.children,g=0,y=v.length;g<y;g++)t(v[g],n,r,i)}}(t,e,0,v.sortObjects),p.finish(),!0===v.sortObjects&&p.sort(N,R),!0===k&&lt.beginShadows();var n=d.state.shadowsArray;ct.render(n,t,e),d.setupLights(),d.setupLightsView(e),!0===k&&lt.endShadows(),!0===this.info.autoReset&&this.info.reset(),ut.render(p,t);var r=p.opaque,i=p.transmissive,o=p.transparent;r.length>0&&Lt(r,t,e),i.length>0&&function(t,e,n,r){if(null===G){var i=!0===s&&!0===Z.isWebGL2;G=new(i?O:A)(1024,1024,{generateMipmaps:!0,type:null!==ft.convert(1016)?1016:1009,minFilter:1008,magFilter:1003,wrapS:1001,wrapT:1001})}var o=v.getRenderTarget();v.setRenderTarget(G),v.clear();var a=v.toneMapping;v.toneMapping=0,Lt(t,n,r),v.toneMapping=a,J.updateMultisampleRenderTarget(G),J.updateRenderTargetMipmap(G),v.setRenderTarget(o),Lt(e,n,r)}(r,i,t,e),o.length>0&&Lt(o,t,e),null!==E&&(J.updateMultisampleRenderTarget(E),J.updateRenderTargetMipmap(E)),!0===t.isScene&&t.onAfterRender(v,t,e),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1),mt.resetDefaultState(),T=-1,x=null,m.pop(),d=m.length>0?m[m.length-1]:null,f.pop(),p=f.length>0?f[f.length-1]:null}},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return E},this.setRenderTarget=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),E=t,y=e,_=n,t&&void 0===K.get(t).__webglFramebuffer&&J.setupRenderTarget(t);var r=null,i=!1,o=!1;if(t){var a=t.texture;(a.isDataTexture3D||a.isDataTexture2DArray)&&(o=!0);var s=K.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=s[e],i=!0):r=t.isWebGLMultisampleRenderTarget?K.get(t).__webglMultisampledFramebuffer:s,M.copy(t.viewport),S.copy(t.scissor),w=t.scissorTest}else M.copy(I).multiplyScalar(P).floor(),S.copy(U).multiplyScalar(P).floor(),w=B;if(q.bindFramebuffer(vt.FRAMEBUFFER,r)&&Z.drawBuffers){var l=!1;if(t)if(t.isWebGLMultipleRenderTargets){var c=t.texture;if(F.length!==c.length||F[0]!==vt.COLOR_ATTACHMENT0){for(var u=0,h=c.length;u<h;u++)F[u]=vt.COLOR_ATTACHMENT0+u;F.length=c.length,l=!0}}else 1===F.length&&F[0]===vt.COLOR_ATTACHMENT0||(F[0]=vt.COLOR_ATTACHMENT0,F.length=1,l=!0);else 1===F.length&&F[0]===vt.BACK||(F[0]=vt.BACK,F.length=1,l=!0);l&&(Z.isWebGL2?vt.drawBuffers(F):X.get("WEBGL_draw_buffers").drawBuffersWEBGL(F))}if(q.viewport(M),q.scissor(S),q.setScissorTest(w),i){var p=K.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_CUBE_MAP_POSITIVE_X+e,p.__webglTexture,n)}else if(o){var d=K.get(t.texture),f=e||0;vt.framebufferTextureLayer(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,d.__webglTexture,n||0,f)}},this.readRenderTargetPixels=function(t,e,n,r,i,o,a){if(t&&t.isWebGLRenderTarget){var s=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){q.bindFramebuffer(vt.FRAMEBUFFER,s);try{var l=t.texture,c=l.format,u=l.type;if(1023!==c&&ft.convert(c)!==vt.getParameter(vt.IMPLEMENTATION_COLOR_READ_FORMAT))return;var h=1016===u&&(X.has("EXT_color_buffer_half_float")||Z.isWebGL2&&X.has("EXT_color_buffer_float"));if(!(1009===u||ft.convert(u)===vt.getParameter(vt.IMPLEMENTATION_COLOR_READ_TYPE)||1015===u&&(Z.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float"))||h))return;vt.checkFramebufferStatus(vt.FRAMEBUFFER)===vt.FRAMEBUFFER_COMPLETE&&e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&vt.readPixels(e,n,r,i,ft.convert(c),ft.convert(u),o)}finally{var p=null!==E?K.get(E).__webglFramebuffer:null;q.bindFramebuffer(vt.FRAMEBUFFER,p)}}}},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(e.image.width*r),o=Math.floor(e.image.height*r),a=ft.convert(e.format);Z.isWebGL2&&(a===vt.RGB&&(a=vt.RGB8),a===vt.RGBA&&(a=vt.RGBA8)),J.setTexture2D(e,0),vt.copyTexImage2D(vt.TEXTURE_2D,n,a,t.x,t.y,i,o,0),q.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r){void 0===r&&(r=0);var i=e.image.width,o=e.image.height,a=ft.convert(n.format),s=ft.convert(n.type);J.setTexture2D(n,0),vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,n.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,n.unpackAlignment),e.isDataTexture?vt.texSubImage2D(vt.TEXTURE_2D,r,t.x,t.y,i,o,a,s,e.image.data):e.isCompressedTexture?vt.compressedTexSubImage2D(vt.TEXTURE_2D,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):vt.texSubImage2D(vt.TEXTURE_2D,r,t.x,t.y,a,s,e.image),0===r&&n.generateMipmaps&&vt.generateMipmap(vt.TEXTURE_2D),q.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,r,i){if(void 0===i&&(i=0),!v.isWebGL1Renderer){var o,a=t.max.x-t.min.x+1,s=t.max.y-t.min.y+1,l=t.max.z-t.min.z+1,c=ft.convert(r.format),u=ft.convert(r.type);if(r.isDataTexture3D)J.setTexture3D(r,0),o=vt.TEXTURE_3D;else{if(!r.isDataTexture2DArray)return;J.setTexture2DArray(r,0),o=vt.TEXTURE_2D_ARRAY}vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,r.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,r.unpackAlignment);var h=vt.getParameter(vt.UNPACK_ROW_LENGTH),p=vt.getParameter(vt.UNPACK_IMAGE_HEIGHT),d=vt.getParameter(vt.UNPACK_SKIP_PIXELS),f=vt.getParameter(vt.UNPACK_SKIP_ROWS),m=vt.getParameter(vt.UNPACK_SKIP_IMAGES),g=n.isCompressedTexture?n.mipmaps[0]:n.image;vt.pixelStorei(vt.UNPACK_ROW_LENGTH,g.width),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,g.height),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,t.min.x),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,t.min.y),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,t.min.z),n.isDataTexture||n.isDataTexture3D?vt.texSubImage3D(o,i,e.x,e.y,e.z,a,s,l,c,u,g.data):n.isCompressedTexture?vt.compressedTexSubImage3D(o,i,e.x,e.y,e.z,a,s,l,c,g.data):vt.texSubImage3D(o,i,e.x,e.y,e.z,a,s,l,c,u,g),vt.pixelStorei(vt.UNPACK_ROW_LENGTH,h),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,p),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,d),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,f),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,m),0===i&&r.generateMipmaps&&vt.generateMipmap(o),q.unbindTexture()}},this.initTexture=function(t){J.setTexture2D(t,0),q.unbindTexture()},this.resetState=function(){y=0,_=0,E=null,q.reset(),mt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(xi);bi.prototype.isWebGL1Renderer=!0;var Mi=function(t,e){void 0===e&&(e=25e-5),this.name="",this.color=new $t(t),this.density=e};Mi.prototype.clone=function(){return new Mi(this.color,this.density)},Mi.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Mi.prototype.isFogExp2=!0;var Ai=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1e3),this.name="",this.color=new $t(t),this.near=e,this.far=n};Ai.prototype.clone=function(){return new Ai(this.color,this.near,this.far)},Ai.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Ai.prototype.isFog=!0;var Si=function(t){function e(){t.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e,n){return t.prototype.copy.call(this,e,n),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return null!==this.fog&&(n.object.fog=this.fog.toJSON()),n},e}(Nt);Si.prototype.isScene=!0;var Oi=function(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=s()},wi={needsUpdate:{configurable:!0}};Oi.prototype.onUploadCallback=function(){},wi.needsUpdate.set=function(t){!0===t&&this.version++},Oi.prototype.setUsage=function(t){return this.usage=t,this},Oi.prototype.copy=function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},Oi.prototype.copyAt=function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},Oi.prototype.set=function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},Oi.prototype.clone=function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=s()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n},Oi.prototype.onUpload=function(t){return this.onUploadCallback=t,this},Oi.prototype.toJSON=function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=s()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}},Object.defineProperties(Oi.prototype,wi),Oi.prototype.isInterleavedBuffer=!0;var Li=new D,Di=function(t,e,n,r){void 0===r&&(r=!1),this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r},Ci={count:{configurable:!0},array:{configurable:!0},needsUpdate:{configurable:!0}};Ci.count.get=function(){return this.data.count},Ci.array.get=function(){return this.data.array},Ci.needsUpdate.set=function(t){this.data.needsUpdate=t},Di.prototype.applyMatrix4=function(t){for(var e=0,n=this.data.count;e<n;e++)Li.x=this.getX(e),Li.y=this.getY(e),Li.z=this.getZ(e),Li.applyMatrix4(t),this.setXYZ(e,Li.x,Li.y,Li.z);return this},Di.prototype.applyNormalMatrix=function(t){for(var e=0,n=this.count;e<n;e++)Li.x=this.getX(e),Li.y=this.getY(e),Li.z=this.getZ(e),Li.applyNormalMatrix(t),this.setXYZ(e,Li.x,Li.y,Li.z);return this},Di.prototype.transformDirection=function(t){for(var e=0,n=this.count;e<n;e++)Li.x=this.getX(e),Li.y=this.getY(e),Li.z=this.getZ(e),Li.transformDirection(t),this.setXYZ(e,Li.x,Li.y,Li.z);return this},Di.prototype.setX=function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},Di.prototype.setY=function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},Di.prototype.setZ=function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},Di.prototype.setW=function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},Di.prototype.getX=function(t){return this.data.array[t*this.data.stride+this.offset]},Di.prototype.getY=function(t){return this.data.array[t*this.data.stride+this.offset+1]},Di.prototype.getZ=function(t){return this.data.array[t*this.data.stride+this.offset+2]},Di.prototype.getW=function(t){return this.data.array[t*this.data.stride+this.offset+3]},Di.prototype.setXY=function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},Di.prototype.setXYZ=function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},Di.prototype.setXYZW=function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},Di.prototype.clone=function(t){if(void 0===t){for(var e=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)e.push(this.data.array[r+i]);return new re(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Di(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},Di.prototype.toJSON=function(t){if(void 0===t){for(var e=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)e.push(this.data.array[r+i]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}},Object.defineProperties(Di.prototype,Ci),Di.prototype.isInterleavedBufferAttribute=!0;var Pi,Ni=function(t){function e(e){t.call(this),this.type="SpriteMaterial",this.color=new $t(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},e}(Yt);Ni.prototype.isSpriteMaterial=!0;var Ri=new D,Ii=new D,Ui=new D,Bi=new m,Fi=new m,Hi=new st,ki=new D,zi=new D,Gi=new D,Wi=new m,Vi=new m,ji=new m,Yi=function(t){function e(e){if(t.call(this),this.type="Sprite",void 0===Pi){Pi=new Ae;var n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new Oi(n,5);Pi.setIndex([0,1,2,0,2,3]),Pi.setAttribute("position",new Di(r,3,0,!1)),Pi.setAttribute("uv",new Di(r,2,3,!1))}this.geometry=Pi,this.material=void 0!==e?e:new Ni,this.center=new m(.5,.5)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.raycast=function(t,e){t.camera,Ii.setFromMatrixScale(this.matrixWorld),Hi.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Ui.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ii.multiplyScalar(-Ui.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var o=this.center;Xi(ki.set(-.5,-.5,0),Ui,o,Ii,n,r),Xi(zi.set(.5,-.5,0),Ui,o,Ii,n,r),Xi(Gi.set(.5,.5,0),Ui,o,Ii,n,r),Wi.set(0,0),Vi.set(1,0),ji.set(1,1);var a=t.ray.intersectTriangle(ki,zi,Gi,!1,Ri);if(null!==a||(Xi(zi.set(-.5,.5,0),Ui,o,Ii,n,r),Vi.set(0,1),null!==(a=t.ray.intersectTriangle(ki,Gi,zi,!1,Ri)))){var s=t.ray.origin.distanceTo(Ri);s<t.near||s>t.far||e.push({distance:s,point:Ri.clone(),uv:Vt.getUV(Ri,ki,zi,Gi,Wi,Vi,ji,new m),face:null,object:this})}},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this},e}(Nt);function Xi(t,e,n,r,i,o){Bi.subVectors(t,n).addScalar(.5).multiply(r),void 0!==i?(Fi.x=o*Bi.x-i*Bi.y,Fi.y=i*Bi.x+o*Bi.y):Fi.copy(Bi),t.copy(e),t.x+=Fi.x,t.y+=Fi.y,t.applyMatrix4(Hi)}Yi.prototype.isSprite=!0;var Zi=new D,qi=new D,Qi=function(t){function e(){t.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){t.prototype.copy.call(this,e,!1);for(var n=e.levels,r=0,i=n.length;r<i;r++){var o=n[r];this.addLevel(o.object.clone(),o.distance)}return this.autoUpdate=e.autoUpdate,this},e.prototype.addLevel=function(t,e){void 0===e&&(e=0),e=Math.abs(e);var n,r=this.levels;for(n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,object:t}),this.add(t),this},e.prototype.getCurrentLevel=function(){return this._currentLevel},e.prototype.getObjectForDistance=function(t){var e=this.levels;if(e.length>0){var n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},e.prototype.raycast=function(t,e){if(this.levels.length>0){Zi.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(Zi);this.getObjectForDistance(n).raycast(t,e)}},e.prototype.update=function(t){var e=this.levels;if(e.length>1){Zi.setFromMatrixPosition(t.matrixWorld),qi.setFromMatrixPosition(this.matrixWorld);var n,r,i=Zi.distanceTo(qi)/t.zoom;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(n.object.autoUpdate=!1),n.object.levels=[];for(var r=this.levels,i=0,o=r.length;i<o;i++){var a=r[i];n.object.levels.push({object:a.object.uuid,distance:a.distance})}return n},e}(Nt),Ki=new D,Ji=new b,$i=new b,to=new D,eo=new st,no=function(t){function e(e,n){t.call(this,e,n),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new st,this.bindMatrixInverse=new st}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},e.prototype.bind=function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()},e.prototype.pose=function(){this.skeleton.pose()},e.prototype.normalizeSkinWeights=function(){for(var t=new b,e=this.geometry.attributes.skinWeight,n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);var i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},e.prototype.updateMatrixWorld=function(e){t.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()},e.prototype.boneTransform=function(t,e){var n=this.skeleton,r=this.geometry;Ji.fromBufferAttribute(r.attributes.skinIndex,t),$i.fromBufferAttribute(r.attributes.skinWeight,t),Ki.fromBufferAttribute(r.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var i=0;i<4;i++){var o=$i.getComponent(i);if(0!==o){var a=Ji.getComponent(i);eo.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),e.addScaledVector(to.copy(Ki).applyMatrix4(eo),o)}}return e.applyMatrix4(this.bindMatrixInverse)},e}(We);no.prototype.isSkinnedMesh=!0;var ro=function(t){function e(){t.call(this),this.type="Bone"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Nt);ro.prototype.isBone=!0;var io=function(t){function e(e,n,r,i,o,a,s,l,c,u,h,p){void 0===e&&(e=null),void 0===n&&(n=1),void 0===r&&(r=1),void 0===c&&(c=1003),void 0===u&&(u=1003),t.call(this,null,a,s,l,c,u,i,o,h,p),this.image={data:e,width:n,height:r},this.magFilter=c,this.minFilter=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(T);io.prototype.isDataTexture=!0;var oo=new st,ao=new st,so=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]),this.uuid=s(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()};so.prototype.init=function(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new st)}},so.prototype.calculateInverses=function(){this.boneInverses.length=0;for(var t=0,e=this.bones.length;t<e;t++){var n=new st;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}},so.prototype.pose=function(){for(var t=0,e=this.bones.length;t<e;t++){var n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(var r=0,i=this.bones.length;r<i;r++){var o=this.bones[r];o&&(o.parent&&o.parent.isBone?(o.matrix.copy(o.parent.matrixWorld).invert(),o.matrix.multiply(o.matrixWorld)):o.matrix.copy(o.matrixWorld),o.matrix.decompose(o.position,o.quaternion,o.scale))}},so.prototype.update=function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,o=t.length;i<o;i++){var a=t[i]?t[i].matrixWorld:ao;oo.multiplyMatrices(a,e[i]),oo.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)},so.prototype.clone=function(){return new so(this.bones,this.boneInverses)},so.prototype.computeBoneTexture=function(){var t=Math.sqrt(4*this.bones.length);t=p(t),t=Math.max(t,4);var e=new Float32Array(t*t*4);e.set(this.boneMatrices);var n=new io(e,t,t,1023,1015);return this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this},so.prototype.getBoneByName=function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}},so.prototype.dispose=function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},so.prototype.fromJSON=function(t,e){this.uuid=t.uuid;for(var n=0,r=t.bones.length;n<r;n++){var i=e[t.bones[n]];void 0===i&&(i=new ro),this.bones.push(i),this.boneInverses.push((new st).fromArray(t.boneInverses[n]))}return this.init(),this},so.prototype.toJSON=function(){var t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;for(var e=this.bones,n=this.boneInverses,r=0,i=e.length;r<i;r++){var o=e[r];t.bones.push(o.uuid);var a=n[r];t.boneInverses.push(a.toArray())}return t};var lo=new st,co=new st,uo=[],ho=new We,po=function(t){function e(e,n,r){t.call(this,e,n),this.instanceMatrix=new re(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this},e.prototype.getColorAt=function(t,e){e.fromArray(this.instanceColor.array,3*t)},e.prototype.getMatrixAt=function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},e.prototype.raycast=function(t,e){var n=this.matrixWorld,r=this.count;if(ho.geometry=this.geometry,ho.material=this.material,void 0!==ho.material)for(var i=0;i<r;i++){this.getMatrixAt(i,lo),co.multiplyMatrices(n,lo),ho.matrixWorld=co,ho.raycast(t,uo);for(var o=0,a=uo.length;o<a;o++){var s=uo[o];s.instanceId=i,s.object=this,e.push(s)}uo.length=0}},e.prototype.setColorAt=function(t,e){null===this.instanceColor&&(this.instanceColor=new re(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},e.prototype.setMatrixAt=function(t,e){e.toArray(this.instanceMatrix.array,16*t)},e.prototype.updateMorphTargets=function(){},e.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},e}(We);po.prototype.isInstancedMesh=!0;var fo=function(t){function e(e){t.call(this),this.type="LineBasicMaterial",this.color=new $t(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this},e}(Yt);fo.prototype.isLineBasicMaterial=!0;var mo=new D,vo=new D,go=new st,yo=new at,_o=new J,Eo=function(t){function e(e,n){void 0===e&&(e=new Ae),void 0===n&&(n=new fo),t.call(this),this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},e.prototype.computeLineDistances=function(){var t=this.geometry;if(t.isBufferGeometry){if(null===t.index){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)mo.fromBufferAttribute(e,r-1),vo.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=mo.distanceTo(vo);t.setAttribute("lineDistance",new de(n,1))}}else t.isGeometry;return this},e.prototype.raycast=function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),_o.copy(n.boundingSphere),_o.applyMatrix4(r),_o.radius+=i,!1!==t.ray.intersectsSphere(_o)){go.copy(r).invert(),yo.copy(t.ray).applyMatrix4(go);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,l=new D,c=new D,u=new D,h=new D,p=this.isLineSegments?2:1;if(n.isBufferGeometry){var d=n.index,f=n.attributes.position;if(null!==d)for(var m=Math.max(0,o.start),v=Math.min(d.count,o.start+o.count)-1;m<v;m+=p){var g=d.getX(m),y=d.getX(m+1);if(l.fromBufferAttribute(f,g),c.fromBufferAttribute(f,y),!(yo.distanceSqToSegment(l,c,h,u)>s)){h.applyMatrix4(this.matrixWorld);var _=t.ray.origin.distanceTo(h);_<t.near||_>t.far||e.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else for(var E=Math.max(0,o.start),T=Math.min(f.count,o.start+o.count)-1;E<T;E+=p)if(l.fromBufferAttribute(f,E),c.fromBufferAttribute(f,E+1),!(yo.distanceSqToSegment(l,c,h,u)>s)){h.applyMatrix4(this.matrixWorld);var x=t.ray.origin.distanceTo(h);x<t.near||x>t.far||e.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:E,face:null,faceIndex:null,object:this})}}else n.isGeometry}},e.prototype.updateMorphTargets=function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=t.morphTargets;void 0!==s&&s.length}},e}(Nt);Eo.prototype.isLine=!0;var To=new D,xo=new D,bo=function(t){function e(e,n){t.call(this,e,n),this.type="LineSegments"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeLineDistances=function(){var t=this.geometry;if(t.isBufferGeometry){if(null===t.index){for(var e=t.attributes.position,n=[],r=0,i=e.count;r<i;r+=2)To.fromBufferAttribute(e,r),xo.fromBufferAttribute(e,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+To.distanceTo(xo);t.setAttribute("lineDistance",new de(n,1))}}else t.isGeometry;return this},e}(Eo);bo.prototype.isLineSegments=!0;var Mo=function(t){function e(e,n){t.call(this,e,n),this.type="LineLoop"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Eo);Mo.prototype.isLineLoop=!0;var Ao=function(t){function e(e){t.call(this),this.type="PointsMaterial",this.color=new $t(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},e}(Yt);Ao.prototype.isPointsMaterial=!0;var So=new st,Oo=new at,wo=new J,Lo=new D,Do=function(t){function e(e,n){void 0===e&&(e=new Ae),void 0===n&&(n=new Ao),t.call(this),this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},e.prototype.raycast=function(t,e){var n=this.geometry,r=this.matrixWorld,i=t.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),wo.copy(n.boundingSphere),wo.applyMatrix4(r),wo.radius+=i,!1!==t.ray.intersectsSphere(wo)){So.copy(r).invert(),Oo.copy(t.ray).applyMatrix4(So);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a;if(n.isBufferGeometry){var l=n.index,c=n.attributes.position;if(null!==l)for(var u=Math.max(0,o.start),h=Math.min(l.count,o.start+o.count);u<h;u++){var p=l.getX(u);Lo.fromBufferAttribute(c,p),Co(Lo,p,s,r,t,e,this)}else for(var d=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);d<f;d++)Lo.fromBufferAttribute(c,d),Co(Lo,d,s,r,t,e,this)}}},e.prototype.updateMorphTargets=function(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,o=r.length;i<o;i++){var a=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{var s=t.morphTargets;void 0!==s&&s.length}},e}(Nt);function Co(t,e,n,r,i,o,a){var s=Oo.distanceSqToPoint(t);if(s<n){var l=new D;Oo.closestPointToPoint(t,l),l.applyMatrix4(r);var c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(s),point:l,index:e,face:null,object:a})}}Do.prototype.isPoints=!0;var Po=function(t){function e(e,n,r,i,o,a,s,l,c){t.call(this,e,n,r,i,o,a,s,l,c),this.format=void 0!==s?s:1022,this.minFilter=void 0!==a?a:1006,this.magFilter=void 0!==o?o:1006,this.generateMipmaps=!1;var u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new this.constructor(this.image).copy(this)},e.prototype.update=function(){var t=this.image;0=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)},e}(T);Po.prototype.isVideoTexture=!0;var No=function(t){function e(e,n,r,i,o,a,s,l,c,u,h,p){t.call(this,null,a,s,l,c,u,i,o,h,p),this.image={width:n,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(T);No.prototype.isCompressedTexture=!0;var Ro=function(t){function e(e,n,r,i,o,a,s,l,c){t.call(this,e,n,r,i,o,a,s,l,c),this.needsUpdate=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(T);Ro.prototype.isCanvasTexture=!0;var Io=function(t){function e(e,n,r,i,o,a,s,l,c,u){if(1026!==(u=void 0!==u?u:1026)&&1027!==u)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&1026===u&&(r=1012),void 0===r&&1027===u&&(r=1020),t.call(this,null,i,o,a,s,l,u,r,c),this.image={width:e,height:n},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==l?l:1003,this.flipY=!1,this.generateMipmaps=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(T);Io.prototype.isDepthTexture=!0;var Uo=function(t){function e(e,n,r,i){void 0===e&&(e=1),void 0===n&&(n=8),void 0===r&&(r=0),void 0===i&&(i=2*Math.PI),t.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:r,thetaLength:i},n=Math.max(3,n);var o=[],a=[],s=[],l=[],c=new D,u=new m;a.push(0,0,0),s.push(0,0,1),l.push(.5,.5);for(var h=0,p=3;h<=n;h++,p+=3){var d=r+h/n*i;c.x=e*Math.cos(d),c.y=e*Math.sin(d),a.push(c.x,c.y,c.z),s.push(0,0,1),u.x=(a[p]/e+1)/2,u.y=(a[p+1]/e+1)/2,l.push(u.x,u.y)}for(var f=1;f<=n;f++)o.push(f,f+1,0);this.setIndex(o),this.setAttribute("position",new de(a,3)),this.setAttribute("normal",new de(s,3)),this.setAttribute("uv",new de(l,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.segments,t.thetaStart,t.thetaLength)},e}(Ae),Bo=function(t){function e(e,n,r,i,o,a,s,l){void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=8),void 0===o&&(o=1),void 0===a&&(a=!1),void 0===s&&(s=0),void 0===l&&(l=2*Math.PI),t.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:r,radialSegments:i,heightSegments:o,openEnded:a,thetaStart:s,thetaLength:l};var c=this;i=Math.floor(i),o=Math.floor(o);var u=[],h=[],p=[],d=[],f=0,v=[],g=r/2,y=0;function _(t){for(var r=f,o=new m,a=new D,v=0,_=!0===t?e:n,E=!0===t?1:-1,T=1;T<=i;T++)h.push(0,g*E,0),p.push(0,E,0),d.push(.5,.5),f++;for(var x=f,b=0;b<=i;b++){var M=b/i*l+s,A=Math.cos(M),S=Math.sin(M);a.x=_*S,a.y=g*E,a.z=_*A,h.push(a.x,a.y,a.z),p.push(0,E,0),o.x=.5*A+.5,o.y=.5*S*E+.5,d.push(o.x,o.y),f++}for(var O=0;O<i;O++){var w=r+O,L=x+O;!0===t?u.push(L,L+1,w):u.push(L+1,L,w),v+=3}c.addGroup(y,v,!0===t?1:2),y+=v}!function(){for(var t=new D,a=new D,m=0,_=(n-e)/r,E=0;E<=o;E++){for(var T=[],x=E/o,b=x*(n-e)+e,M=0;M<=i;M++){var A=M/i,S=A*l+s,O=Math.sin(S),w=Math.cos(S);a.x=b*O,a.y=-x*r+g,a.z=b*w,h.push(a.x,a.y,a.z),t.set(O,_,w).normalize(),p.push(t.x,t.y,t.z),d.push(A,1-x),T.push(f++)}v.push(T)}for(var L=0;L<i;L++)for(var C=0;C<o;C++){var P=v[C][L],N=v[C+1][L],R=v[C+1][L+1],I=v[C][L+1];u.push(P,N,I),u.push(N,R,I),m+=6}c.addGroup(y,m,0),y+=m}(),!1===a&&(e>0&&_(!0),n>0&&_(!1)),this.setIndex(u),this.setAttribute("position",new de(h,3)),this.setAttribute("normal",new de(p,3)),this.setAttribute("uv",new de(d,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)},e}(Ae),Fo=function(t){function e(e,n,r,i,o,a,s){void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=8),void 0===i&&(i=1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===s&&(s=2*Math.PI),t.call(this,0,e,n,r,i,o,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)},e}(Bo),Ho=function(t){function e(e,n,r,i){void 0===r&&(r=1),void 0===i&&(i=0),t.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:r,detail:i};var o=[],a=[];function s(t,e,n,r){for(var i=r+1,o=[],a=0;a<=i;a++){o[a]=[];for(var s=t.clone().lerp(n,a/i),c=e.clone().lerp(n,a/i),u=i-a,h=0;h<=u;h++)o[a][h]=0===h&&a===i?s:s.clone().lerp(c,h/u)}for(var p=0;p<i;p++)for(var d=0;d<2*(i-p)-1;d++){var f=Math.floor(d/2);d%2==0?(l(o[p][f+1]),l(o[p+1][f]),l(o[p][f])):(l(o[p][f+1]),l(o[p+1][f+1]),l(o[p+1][f]))}}function l(t){o.push(t.x,t.y,t.z)}function c(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function u(t,e,n,r){r<0&&1===t.x&&(a[e]=t.x-1),0===n.x&&0===n.z&&(a[e]=r/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){for(var e=new D,r=new D,i=new D,o=0;o<n.length;o+=3)c(n[o+0],e),c(n[o+1],r),c(n[o+2],i),s(e,r,i,t)}(i),function(t){for(var e=new D,n=0;n<o.length;n+=3)e.x=o[n+0],e.y=o[n+1],e.z=o[n+2],e.normalize().multiplyScalar(t),o[n+0]=e.x,o[n+1]=e.y,o[n+2]=e.z}(r),function(){for(var t=new D,e=0;e<o.length;e+=3){t.x=o[e+0],t.y=o[e+1],t.z=o[e+2];var n=h(t)/2/Math.PI+.5,r=(i=t,Math.atan2(-i.y,Math.sqrt(i.x*i.x+i.z*i.z))/Math.PI+.5);a.push(n,1-r)}var i;(function(){for(var t=new D,e=new D,n=new D,r=new D,i=new m,s=new m,l=new m,c=0,p=0;c<o.length;c+=9,p+=6){t.set(o[c+0],o[c+1],o[c+2]),e.set(o[c+3],o[c+4],o[c+5]),n.set(o[c+6],o[c+7],o[c+8]),i.set(a[p+0],a[p+1]),s.set(a[p+2],a[p+3]),l.set(a[p+4],a[p+5]),r.copy(t).add(e).add(n).divideScalar(3);var d=h(r);u(i,p+0,t,d),u(s,p+2,e,d),u(l,p+4,n,d)}})(),function(){for(var t=0;t<a.length;t+=6){var e=a[t+0],n=a[t+2],r=a[t+4],i=Math.max(e,n,r),o=Math.min(e,n,r);i>.9&&o<.1&&(e<.2&&(a[t+0]+=1),n<.2&&(a[t+2]+=1),r<.2&&(a[t+4]+=1))}}()}(),this.setAttribute("position",new de(o,3)),this.setAttribute("normal",new de(o.slice(),3)),this.setAttribute("uv",new de(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.vertices,t.indices,t.radius,t.details)},e}(Ae),ko=function(t){function e(e,n){void 0===e&&(e=1),void 0===n&&(n=0);var r=(1+Math.sqrt(5))/2,i=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i];t.call(this,o,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.detail)},e}(Ho),zo=new D,Go=new D,Wo=new D,Vo=new Vt,jo=function(t){function e(e,n){if(t.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:n},n=void 0!==n?n:1,!0!==e.isGeometry){for(var r=Math.pow(10,4),i=Math.cos(o*n),a=e.getIndex(),s=e.getAttribute("position"),l=a?a.count:s.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),p={},d=[],f=0;f<l;f+=3){a?(c[0]=a.getX(f),c[1]=a.getX(f+1),c[2]=a.getX(f+2)):(c[0]=f,c[1]=f+1,c[2]=f+2);var m=Vo.a,v=Vo.b,g=Vo.c;if(m.fromBufferAttribute(s,c[0]),v.fromBufferAttribute(s,c[1]),g.fromBufferAttribute(s,c[2]),Vo.getNormal(Wo),h[0]=Math.round(m.x*r)+","+Math.round(m.y*r)+","+Math.round(m.z*r),h[1]=Math.round(v.x*r)+","+Math.round(v.y*r)+","+Math.round(v.z*r),h[2]=Math.round(g.x*r)+","+Math.round(g.y*r)+","+Math.round(g.z*r),h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(var y=0;y<3;y++){var _=(y+1)%3,E=h[y],T=h[_],x=Vo[u[y]],b=Vo[u[_]],M=E+"_"+T,A=T+"_"+E;A in p&&p[A]?(Wo.dot(p[A].normal)<=i&&(d.push(x.x,x.y,x.z),d.push(b.x,b.y,b.z)),p[A]=null):M in p||(p[M]={index0:c[y],index1:c[_],normal:Wo.clone()})}}for(var S in p)if(p[S]){var O=p[S],w=O.index0,L=O.index1;zo.fromBufferAttribute(s,w),Go.fromBufferAttribute(s,L),d.push(zo.x,zo.y,zo.z),d.push(Go.x,Go.y,Go.z)}this.setAttribute("position",new de(d,3))}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ae),Yo=function(){this.type="Curve",this.arcLengthDivisions=200};Yo.prototype.getPoint=function(){return null},Yo.prototype.getPointAt=function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},Yo.prototype.getPoints=function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},Yo.prototype.getSpacedPoints=function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},Yo.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},Yo.prototype.getLengths=function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n=[],r=this.getPoint(0),i=0;n.push(0);for(var o=1;o<=t;o++)i+=(e=this.getPoint(o/t)).distanceTo(r),n.push(i),r=e;return this.cacheArcLengths=n,n},Yo.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},Yo.prototype.getUtoTmapping=function(t,e){var n,r=this.getLengths(),i=0,o=r.length;n=e||t*r[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=r[i=Math.floor(s+(l-s)/2)]-n)<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(r[i=l]===n)return i/(o-1);var c=r[i];return(i+(n-c)/(r[i+1]-c))/(o-1)},Yo.prototype.getTangent=function(t,e){var n=t-1e-4,r=t+1e-4;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),o=this.getPoint(r),a=e||(i.isVector2?new m:new D);return a.copy(o).sub(i).normalize(),a},Yo.prototype.getTangentAt=function(t,e){var n=this.getUtoTmapping(t);return this.getTangent(n,e)},Yo.prototype.computeFrenetFrames=function(t,e){for(var n=new D,r=[],i=[],o=[],a=new D,s=new st,c=0;c<=t;c++){var u=c/t;r[c]=this.getTangentAt(u,new D),r[c].normalize()}i[0]=new D,o[0]=new D;var h=Number.MAX_VALUE,p=Math.abs(r[0].x),d=Math.abs(r[0].y),f=Math.abs(r[0].z);p<=h&&(h=p,n.set(1,0,0)),d<=h&&(h=d,n.set(0,1,0)),f<=h&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),o[0].crossVectors(r[0],i[0]);for(var m=1;m<=t;m++){if(i[m]=i[m-1].clone(),o[m]=o[m-1].clone(),a.crossVectors(r[m-1],r[m]),a.length()>Number.EPSILON){a.normalize();var v=Math.acos(l(r[m-1].dot(r[m]),-1,1));i[m].applyMatrix4(s.makeRotationAxis(a,v))}o[m].crossVectors(r[m],i[m])}if(!0===e){var g=Math.acos(l(i[0].dot(i[t]),-1,1));g/=t,r[0].dot(a.crossVectors(i[0],i[t]))>0&&(g=-g);for(var y=1;y<=t;y++)i[y].applyMatrix4(s.makeRotationAxis(r[y],g*y)),o[y].crossVectors(r[y],i[y])}return{tangents:r,normals:i,binormals:o}},Yo.prototype.clone=function(){return(new this.constructor).copy(this)},Yo.prototype.copy=function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},Yo.prototype.toJSON=function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},Yo.prototype.fromJSON=function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this};var Xo=function(t){function e(e,n,r,i,o,a,s,l){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=1),void 0===o&&(o=0),void 0===a&&(a=2*Math.PI),void 0===s&&(s=!1),void 0===l&&(l=0),t.call(this),this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=r,this.yRadius=i,this.aStartAngle=o,this.aEndAngle=a,this.aClockwise=s,this.aRotation=l}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){for(var n=e||new m,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var a=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,p=l-this.aY;s=h*c-p*u+this.aX,l=h*u+p*c+this.aY}return n.set(s,l)},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},e.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},e}(Yo);Xo.prototype.isEllipseCurve=!0;var Zo=function(t){function e(e,n,r,i,o,a){t.call(this,e,n,r,r,i,o,a),this.type="ArcCurve"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Xo);function qo(){var t=0,e=0,n=0,r=0;function i(i,o,a,s){t=i,e=a,n=-3*i+3*o-2*a-s,r=2*i-2*o+a+s}return{initCatmullRom:function(t,e,n,r,o){i(e,n,o*(n-t),o*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,o,a,s){var l=(e-t)/o-(n-t)/(o+a)+(n-e)/a,c=(n-e)/a-(r-e)/(a+s)+(r-n)/s;i(e,n,l*=a,c*=a)},calc:function(i){var o=i*i;return t+e*i+n*o+r*(o*i)}}}Zo.prototype.isArcCurve=!0;var Qo=new D,Ko=new qo,Jo=new qo,$o=new qo,ta=function(t){function e(e,n,r,i){void 0===e&&(e=[]),void 0===n&&(n=!1),void 0===r&&(r="centripetal"),void 0===i&&(i=.5),t.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=r,this.tension=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){void 0===e&&(e=new D);var n,r,i=e,o=this.points,a=o.length,s=(a-(this.closed?0:1))*t,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a)+1)*a:0===c&&l===a-1&&(l=a-2,c=1),this.closed||l>0?n=o[(l-1)%a]:(Qo.subVectors(o[0],o[1]).add(o[0]),n=Qo);var u=o[l%a],h=o[(l+1)%a];if(this.closed||l+2<a?r=o[(l+2)%a]:(Qo.subVectors(o[a-1],o[a-2]).add(o[a-1]),r=Qo),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(n.distanceToSquared(u),p),f=Math.pow(u.distanceToSquared(h),p),m=Math.pow(h.distanceToSquared(r),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),Ko.initNonuniformCatmullRom(n.x,u.x,h.x,r.x,d,f,m),Jo.initNonuniformCatmullRom(n.y,u.y,h.y,r.y,d,f,m),$o.initNonuniformCatmullRom(n.z,u.z,h.z,r.z,d,f,m)}else"catmullrom"===this.curveType&&(Ko.initCatmullRom(n.x,u.x,h.x,r.x,this.tension),Jo.initCatmullRom(n.y,u.y,h.y,r.y,this.tension),$o.initCatmullRom(n.z,u.z,h.z,r.z,this.tension));return i.set(Ko.calc(c),Jo.calc(c),$o.calc(c)),i},e.prototype.copy=function(e){t.prototype.copy.call(this,e),this.points=[];for(var n=0,r=e.points.length;n<r;n++){var i=e.points[n];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);e.points=[];for(var n=0,r=this.points.length;n<r;n++){var i=this.points[n];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.points=[];for(var n=0,r=e.points.length;n<r;n++){var i=e.points[n];this.points.push((new D).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},e}(Yo);function ea(t,e,n,r,i){var o=.5*(r-e),a=.5*(i-n),s=t*t;return(2*n-2*r+o+a)*(t*s)+(-3*n+3*r-2*o-a)*s+o*t+n}function na(t,e,n,r){return function(t,e){var n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function ra(t,e,n,r,i){return function(t,e){var n=1-t;return n*n*n*e}(t,e)+function(t,e){var n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}ta.prototype.isCatmullRomCurve3=!0;var ia=function(t){function e(e,n,r,i){void 0===e&&(e=new m),void 0===n&&(n=new m),void 0===r&&(r=new m),void 0===i&&(i=new m),t.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=r,this.v3=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){void 0===e&&(e=new m);var n=e,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(ra(t,r.x,i.x,o.x,a.x),ra(t,r.y,i.y,o.y,a.y)),n},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},e.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},e}(Yo);ia.prototype.isCubicBezierCurve=!0;var oa=function(t){function e(e,n,r,i){void 0===e&&(e=new D),void 0===n&&(n=new D),void 0===r&&(r=new D),void 0===i&&(i=new D),t.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=r,this.v3=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){void 0===e&&(e=new D);var n=e,r=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(ra(t,r.x,i.x,o.x,a.x),ra(t,r.y,i.y,o.y,a.y),ra(t,r.z,i.z,o.z,a.z)),n},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},e.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},e}(Yo);oa.prototype.isCubicBezierCurve3=!0;var aa=function(t){function e(e,n){void 0===e&&(e=new m),void 0===n&&(n=new m),t.call(this),this.type="LineCurve",this.v1=e,this.v2=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){void 0===e&&(e=new m);var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},e.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},e.prototype.getTangent=function(t,e){var n=e||new m;return n.copy(this.v2).sub(this.v1).normalize(),n},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},e.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},e}(Yo);aa.prototype.isLineCurve=!0;var sa=function(t){function e(e,n){void 0===e&&(e=new D),void 0===n&&(n=new D),t.call(this),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){void 0===e&&(e=new D);var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},e.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},e.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},e}(Yo),la=function(t){function e(e,n,r){void 0===e&&(e=new m),void 0===n&&(n=new m),void 0===r&&(r=new m),t.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){void 0===e&&(e=new m);var n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(na(t,r.x,i.x,o.x),na(t,r.y,i.y,o.y)),n},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},e.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},e}(Yo);la.prototype.isQuadraticBezierCurve=!0;var ca=function(t){function e(e,n,r){void 0===e&&(e=new D),void 0===n&&(n=new D),void 0===r&&(r=new D),t.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){void 0===e&&(e=new D);var n=e,r=this.v0,i=this.v1,o=this.v2;return n.set(na(t,r.x,i.x,o.x),na(t,r.y,i.y,o.y),na(t,r.z,i.z,o.z)),n},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},e.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},e}(Yo);ca.prototype.isQuadraticBezierCurve3=!0;var ua=function(t){function e(e){void 0===e&&(e=[]),t.call(this),this.type="SplineCurve",this.points=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPoint=function(t,e){void 0===e&&(e=new m);var n=e,r=this.points,i=(r.length-1)*t,o=Math.floor(i),a=i-o,s=r[0===o?o:o-1],l=r[o],c=r[o>r.length-2?r.length-1:o+1],u=r[o>r.length-3?r.length-1:o+2];return n.set(ea(a,s.x,l.x,c.x,u.x),ea(a,s.y,l.y,c.y,u.y)),n},e.prototype.copy=function(e){t.prototype.copy.call(this,e),this.points=[];for(var n=0,r=e.points.length;n<r;n++){var i=e.points[n];this.points.push(i.clone())}return this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);e.points=[];for(var n=0,r=this.points.length;n<r;n++){var i=this.points[n];e.points.push(i.toArray())}return e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.points=[];for(var n=0,r=e.points.length;n<r;n++){var i=e.points[n];this.points.push((new m).fromArray(i))}return this},e}(Yo);ua.prototype.isSplineCurve=!0;var ha=Object.freeze({__proto__:null,ArcCurve:Zo,CatmullRomCurve3:ta,CubicBezierCurve:ia,CubicBezierCurve3:oa,EllipseCurve:Xo,LineCurve:aa,LineCurve3:sa,QuadraticBezierCurve:la,QuadraticBezierCurve3:ca,SplineCurve:ua}),pa=function(t,e,n){void 0===n&&(n=2);var r,i,o,a,s,l,c,u=e&&e.length,h=u?e[0]*n:t.length,p=da(t,0,h,n,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,n,r){var i,o,a,s,l,c=[];for(i=0,o=e.length;i<o;i++)a=e[i]*r,s=i<o-1?e[i+1]*r:t.length,(l=da(t,a,s,r,!1))===l.next&&(l.steiner=!0),c.push(Ma(l));for(c.sort(Ea),i=0;i<c.length;i++)Ta(c[i],n),n=fa(n,n.next);return n}(t,e,p,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var f=n;f<h;f+=n)(s=t[f])<r&&(r=s),(l=t[f+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-r,a-i))?1/c:0}return ma(p,d,n,r,i,c),d};function da(t,e,n,r,i){var o,a;if(i===function(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Ra(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Ra(o,t[o],t[o+1],a);return a&&wa(a,a.next)&&(Ia(a),a=a.next),a}function fa(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!wa(r,r.next)&&0!==Oa(r.prev,r,r.next))r=r.next;else{if(Ia(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function ma(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=ba(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,l,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,o);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?ga(t,r,i,o):va(t))e.push(s.i/n),e.push(t.i/n),e.push(l.i/n),Ia(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?ma(t=ya(fa(t),e,n),e,n,r,i,o,2):2===a&&_a(t,e,n,r,i,o):ma(fa(t),e,n,r,i,o,1);break}}}function va(t){var e=t.prev,n=t,r=t.next;if(Oa(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Aa(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Oa(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function ga(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Oa(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=ba(s,l,e,n,r),p=ba(c,u,e,n,r),d=t.prevZ,f=t.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&Aa(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Oa(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&Aa(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Oa(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&Aa(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Oa(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&Aa(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Oa(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function ya(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!wa(i,o)&&La(i,r,r.next,o)&&Pa(i,o)&&Pa(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Ia(r),Ia(r.next),r=t=o),r=r.next}while(r!==t);return fa(r)}function _a(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Sa(a,s)){var l=Na(a,s);return a=fa(a,a.next),l=fa(l,l.next),ma(a,e,n,r,i,o),void ma(l,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function Ea(t,e){return t.x-e.x}function Ta(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var l,c=n,u=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&Aa(o<h?i:a,o,u,h,o<h?a:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),Pa(r,t)&&(l<p||l===p&&(r.x>n.x||r.x===n.x&&xa(n,r)))&&(n=r,p=l)),r=r.next}while(r!==c);return n}(t,e)){var n=Na(e,t);fa(e,e.next),fa(n,n.next)}}function xa(t,e){return Oa(t.prev,t,e.prev)<0&&Oa(e.next,t,t.next)<0}function ba(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ma(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Aa(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Sa(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&La(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Pa(t,e)&&Pa(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Oa(t.prev,t,e.prev)||Oa(t,e.prev,e))||wa(t,e)&&Oa(t.prev,t,t.next)>0&&Oa(e.prev,e,e.next)>0)}function Oa(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function wa(t,e){return t.x===e.x&&t.y===e.y}function La(t,e,n,r){var i=Ca(Oa(t,e,n)),o=Ca(Oa(t,e,r)),a=Ca(Oa(n,r,t)),s=Ca(Oa(n,r,e));return i!==o&&a!==s||!(0!==i||!Da(t,n,e))||!(0!==o||!Da(t,r,e))||!(0!==a||!Da(n,t,r))||!(0!==s||!Da(n,e,r))}function Da(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ca(t){return t>0?1:t<0?-1:0}function Pa(t,e){return Oa(t.prev,t,t.next)<0?Oa(t,e,t.next)>=0&&Oa(t,t.prev,e)>=0:Oa(t,e,t.prev)<0||Oa(t,t.next,e)<0}function Na(t,e){var n=new Ua(t.i,t.x,t.y),r=new Ua(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Ra(t,e,n,r){var i=new Ua(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ia(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ua(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Ba=function(){};function Fa(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Ha(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}Ba.area=function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},Ba.isClockWise=function(t){return Ba.area(t)<0},Ba.triangulateShape=function(t,e){var n=[],r=[],i=[];Fa(t),Ha(n,t);var o=t.length;e.forEach(Fa);for(var a=0;a<e.length;a++)r.push(o),o+=e[a].length,Ha(n,e[a]);for(var s=pa(n,r),l=0;l<s.length;l+=3)i.push(s.slice(l,l+3));return i};var ka=function(t){function e(e,n){t.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];for(var r=this,i=[],o=[],a=0,s=e.length;a<s;a++)l(e[a]);function l(t){var e=[],a=void 0!==n.curveSegments?n.curveSegments:12,s=void 0!==n.steps?n.steps:1,l=void 0!==n.depth?n.depth:100,c=void 0===n.bevelEnabled||n.bevelEnabled,u=void 0!==n.bevelThickness?n.bevelThickness:6,h=void 0!==n.bevelSize?n.bevelSize:u-2,p=void 0!==n.bevelOffset?n.bevelOffset:0,d=void 0!==n.bevelSegments?n.bevelSegments:3,f=n.extrudePath,v=void 0!==n.UVGenerator?n.UVGenerator:za;void 0!==n.amount&&(l=n.amount);var g,y,_,E,T,x=!1;f&&(g=f.getSpacedPoints(s),x=!0,c=!1,y=f.computeFrenetFrames(s,!1),_=new D,E=new D,T=new D),c||(d=0,u=0,h=0,p=0);var b=t.extractPoints(a),M=b.shape,A=b.holes;if(!Ba.isClockWise(M)){M=M.reverse();for(var S=0,O=A.length;S<O;S++){var w=A[S];Ba.isClockWise(w)&&(A[S]=w.reverse())}}for(var L=Ba.triangulateShape(M,A),C=M,P=0,N=A.length;P<N;P++){var R=A[P];M=M.concat(R)}function I(t,e,n){return e.clone().multiplyScalar(n).add(t)}var U=M.length,B=L.length;function F(t,e,n){var r,i,o,a=t.x-e.x,s=t.y-e.y,l=n.x-t.x,c=n.y-t.y,u=a*a+s*s,h=a*c-s*l;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(u),d=Math.sqrt(l*l+c*c),f=e.x-s/p,v=e.y+a/p,g=((n.x-c/d-f)*c-(n.y+l/d-v)*l)/(a*c-s*l),y=(r=f+a*g-t.x)*r+(i=v+s*g-t.y)*i;if(y<=2)return new m(r,i);o=Math.sqrt(y/2)}else{var _=!1;a>Number.EPSILON?l>Number.EPSILON&&(_=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(_=!0):Math.sign(s)===Math.sign(c)&&(_=!0),_?(r=-s,i=a,o=Math.sqrt(u)):(r=a,i=s,o=Math.sqrt(u/2))}return new m(r/o,i/o)}for(var H=[],k=0,z=C.length,G=z-1,W=k+1;k<z;k++,G++,W++)G===z&&(G=0),W===z&&(W=0),H[k]=F(C[k],C[G],C[W]);for(var V,j=[],Y=H.concat(),X=0,Z=A.length;X<Z;X++){var q=A[X];V=[];for(var Q=0,K=q.length,J=K-1,$=Q+1;Q<K;Q++,J++,$++)J===K&&(J=0),$===K&&($=0),V[Q]=F(q[Q],q[J],q[$]);j.push(V),Y=Y.concat(V)}for(var tt=0;tt<d;tt++){for(var et=tt/d,nt=u*Math.cos(et*Math.PI/2),rt=h*Math.sin(et*Math.PI/2)+p,it=0,ot=C.length;it<ot;it++){var at=I(C[it],H[it],rt);Nt(at.x,at.y,-nt)}for(var st=0,lt=A.length;st<lt;st++){var ct=A[st];V=j[st];for(var ut=0,ht=ct.length;ut<ht;ut++){var pt=I(ct[ut],V[ut],rt);Nt(pt.x,pt.y,-nt)}}}for(var dt=h+p,ft=0;ft<U;ft++){var mt=c?I(M[ft],Y[ft],dt):M[ft];x?(E.copy(y.normals[0]).multiplyScalar(mt.x),_.copy(y.binormals[0]).multiplyScalar(mt.y),T.copy(g[0]).add(E).add(_),Nt(T.x,T.y,T.z)):Nt(mt.x,mt.y,0)}for(var vt=1;vt<=s;vt++)for(var gt=0;gt<U;gt++){var yt=c?I(M[gt],Y[gt],dt):M[gt];x?(E.copy(y.normals[vt]).multiplyScalar(yt.x),_.copy(y.binormals[vt]).multiplyScalar(yt.y),T.copy(g[vt]).add(E).add(_),Nt(T.x,T.y,T.z)):Nt(yt.x,yt.y,l/s*vt)}for(var _t=d-1;_t>=0;_t--){for(var Et=_t/d,Tt=u*Math.cos(Et*Math.PI/2),xt=h*Math.sin(Et*Math.PI/2)+p,bt=0,Mt=C.length;bt<Mt;bt++){var At=I(C[bt],H[bt],xt);Nt(At.x,At.y,l+Tt)}for(var St=0,Ot=A.length;St<Ot;St++){var wt=A[St];V=j[St];for(var Lt=0,Dt=wt.length;Lt<Dt;Lt++){var Ct=I(wt[Lt],V[Lt],xt);x?Nt(Ct.x,Ct.y+g[s-1].y,g[s-1].x+Tt):Nt(Ct.x,Ct.y,l+Tt)}}}function Pt(t,e){for(var n=t.length;--n>=0;){var r=n,i=n-1;i<0&&(i=t.length-1);for(var o=0,a=s+2*d;o<a;o++){var l=U*o,c=U*(o+1);It(e+r+l,e+i+l,e+i+c,e+r+c)}}}function Nt(t,n,r){e.push(t),e.push(n),e.push(r)}function Rt(t,e,n){Ut(t),Ut(e),Ut(n);var o=i.length/3,a=v.generateTopUV(r,i,o-3,o-2,o-1);Bt(a[0]),Bt(a[1]),Bt(a[2])}function It(t,e,n,o){Ut(t),Ut(e),Ut(o),Ut(e),Ut(n),Ut(o);var a=i.length/3,s=v.generateSideWallUV(r,i,a-6,a-3,a-2,a-1);Bt(s[0]),Bt(s[1]),Bt(s[3]),Bt(s[1]),Bt(s[2]),Bt(s[3])}function Ut(t){i.push(e[3*t+0]),i.push(e[3*t+1]),i.push(e[3*t+2])}function Bt(t){o.push(t.x),o.push(t.y)}!function(){var t=i.length/3;if(c){for(var e=0,n=U*e,o=0;o<B;o++){var a=L[o];Rt(a[2]+n,a[1]+n,a[0]+n)}n=U*(e=s+2*d);for(var l=0;l<B;l++){var u=L[l];Rt(u[0]+n,u[1]+n,u[2]+n)}}else{for(var h=0;h<B;h++){var p=L[h];Rt(p[2],p[1],p[0])}for(var f=0;f<B;f++){var m=L[f];Rt(m[0]+U*s,m[1]+U*s,m[2]+U*s)}}r.addGroup(t,i.length/3-t,0)}(),function(){var t=i.length/3,e=0;Pt(C,e),e+=C.length;for(var n=0,o=A.length;n<o;n++){var a=A[n];Pt(a,e),e+=a.length}r.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new de(i,3)),this.setAttribute("uv",new de(o,2)),this.computeVertexNormals()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(var r=0,i=t.length;r<i;r++){var o=t[r];n.shapes.push(o.uuid)}else n.shapes.push(t.uuid);return void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)},e.fromJSON=function(t,n){for(var r=[],i=0,o=t.shapes.length;i<o;i++){var a=n[t.shapes[i]];r.push(a)}var s=t.options.extrudePath;return void 0!==s&&(t.options.extrudePath=(new ha[s.type]).fromJSON(s)),new e(r,t.options)},e}(Ae),za={generateTopUV:function(t,e,n,r,i){var o=e[3*n],a=e[3*n+1],s=e[3*r],l=e[3*r+1],c=e[3*i],u=e[3*i+1];return[new m(o,a),new m(s,l),new m(c,u)]},generateSideWallUV:function(t,e,n,r,i,o){var a=e[3*n],s=e[3*n+1],l=e[3*n+2],c=e[3*r],u=e[3*r+1],h=e[3*r+2],p=e[3*i],d=e[3*i+1],f=e[3*i+2],v=e[3*o],g=e[3*o+1],y=e[3*o+2];return Math.abs(s-u)<Math.abs(a-c)?[new m(a,1-l),new m(c,1-h),new m(p,1-f),new m(v,1-y)]:[new m(s,1-l),new m(u,1-h),new m(d,1-f),new m(g,1-y)]}},Ga=function(t){function e(e,n){void 0===e&&(e=1),void 0===n&&(n=0);var r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];t.call(this,i,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.detail)},e}(Ho),Wa=function(t){function e(e,n,r,i){void 0===n&&(n=12),void 0===r&&(r=0),void 0===i&&(i=2*Math.PI),t.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:r,phiLength:i},n=Math.floor(n),i=l(i,0,2*Math.PI);for(var o=[],a=[],s=[],c=1/n,u=new D,h=new m,p=0;p<=n;p++)for(var d=r+p*c*i,f=Math.sin(d),v=Math.cos(d),g=0;g<=e.length-1;g++)u.x=e[g].x*f,u.y=e[g].y,u.z=e[g].x*v,a.push(u.x,u.y,u.z),h.x=p/n,h.y=g/(e.length-1),s.push(h.x,h.y);for(var y=0;y<n;y++)for(var _=0;_<e.length-1;_++){var E=_+y*e.length,T=E,x=E+e.length,b=E+e.length+1,M=E+1;o.push(T,x,M),o.push(x,b,M)}if(this.setIndex(o),this.setAttribute("position",new de(a,3)),this.setAttribute("uv",new de(s,2)),this.computeVertexNormals(),i===2*Math.PI)for(var A=this.attributes.normal.array,S=new D,O=new D,w=new D,L=n*e.length*3,C=0,P=0;C<e.length;C++,P+=3)S.x=A[P+0],S.y=A[P+1],S.z=A[P+2],O.x=A[L+P+0],O.y=A[L+P+1],O.z=A[L+P+2],w.addVectors(S,O).normalize(),A[P+0]=A[L+P+0]=w.x,A[P+1]=A[L+P+1]=w.y,A[P+2]=A[L+P+2]=w.z}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.points,t.segments,t.phiStart,t.phiLength)},e}(Ae),Va=function(t){function e(e,n){void 0===e&&(e=1),void 0===n&&(n=0),t.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.detail)},e}(Ho),ja=function(t){function e(e,n,r){t.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:n,stacks:r};var i=[],o=[],a=[],s=[],l=1e-5,c=new D,u=new D,h=new D,p=new D,d=new D;e.length;for(var f=n+1,m=0;m<=r;m++)for(var v=m/r,g=0;g<=n;g++){var y=g/n;e(y,v,u),o.push(u.x,u.y,u.z),y-l>=0?(e(y-l,v,h),p.subVectors(u,h)):(e(y+l,v,h),p.subVectors(h,u)),v-l>=0?(e(y,v-l,h),d.subVectors(u,h)):(e(y,v+l,h),d.subVectors(h,u)),c.crossVectors(p,d).normalize(),a.push(c.x,c.y,c.z),s.push(y,v)}for(var _=0;_<r;_++)for(var E=0;E<n;E++){var T=_*f+E,x=_*f+E+1,b=(_+1)*f+E+1,M=(_+1)*f+E;i.push(T,x,M),i.push(x,b,M)}this.setIndex(i),this.setAttribute("position",new de(o,3)),this.setAttribute("normal",new de(a,3)),this.setAttribute("uv",new de(s,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ae),Ya=function(t){function e(e,n,r,i,o,a){void 0===e&&(e=.5),void 0===n&&(n=1),void 0===r&&(r=8),void 0===i&&(i=1),void 0===o&&(o=0),void 0===a&&(a=2*Math.PI),t.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:a},r=Math.max(3,r);for(var s=[],l=[],c=[],u=[],h=e,p=(n-e)/(i=Math.max(1,i)),d=new D,f=new m,v=0;v<=i;v++){for(var g=0;g<=r;g++){var y=o+g/r*a;d.x=h*Math.cos(y),d.y=h*Math.sin(y),l.push(d.x,d.y,d.z),c.push(0,0,1),f.x=(d.x/n+1)/2,f.y=(d.y/n+1)/2,u.push(f.x,f.y)}h+=p}for(var _=0;_<i;_++)for(var E=_*(r+1),T=0;T<r;T++){var x=T+E,b=x,M=x+r+1,A=x+r+2,S=x+1;s.push(b,M,S),s.push(M,A,S)}this.setIndex(s),this.setAttribute("position",new de(l,3)),this.setAttribute("normal",new de(c,3)),this.setAttribute("uv",new de(u,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)},e}(Ae),Xa=function(t){function e(e,n){void 0===n&&(n=12),t.call(this),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};var r=[],i=[],o=[],a=[],s=0,l=0;if(!1===Array.isArray(e))u(e);else for(var c=0;c<e.length;c++)u(e[c]),this.addGroup(s,l,c),s+=l,l=0;function u(t){var e=i.length/3,s=t.extractPoints(n),c=s.shape,u=s.holes;!1===Ba.isClockWise(c)&&(c=c.reverse());for(var h=0,p=u.length;h<p;h++){var d=u[h];!0===Ba.isClockWise(d)&&(u[h]=d.reverse())}for(var f=Ba.triangulateShape(c,u),m=0,v=u.length;m<v;m++){var g=u[m];c=c.concat(g)}for(var y=0,_=c.length;y<_;y++){var E=c[y];i.push(E.x,E.y,0),o.push(0,0,1),a.push(E.x,E.y)}for(var T=0,x=f.length;T<x;T++){var b=f[T],M=b[0]+e,A=b[1]+e,S=b[2]+e;r.push(M,A,S),l+=3}}this.setIndex(r),this.setAttribute("position",new de(i,3)),this.setAttribute("normal",new de(o,3)),this.setAttribute("uv",new de(a,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++){var i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,e)},e.fromJSON=function(t,n){for(var r=[],i=0,o=t.shapes.length;i<o;i++){var a=n[t.shapes[i]];r.push(a)}return new e(r,t.curveSegments)},e}(Ae),Za=function(t){function e(e,n,r,i,o,a,s){void 0===e&&(e=1),void 0===n&&(n=8),void 0===r&&(r=6),void 0===i&&(i=0),void 0===o&&(o=2*Math.PI),void 0===a&&(a=0),void 0===s&&(s=Math.PI),t.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:r,phiStart:i,phiLength:o,thetaStart:a,thetaLength:s},n=Math.max(3,Math.floor(n)),r=Math.max(2,Math.floor(r));for(var l=Math.min(a+s,Math.PI),c=0,u=[],h=new D,p=new D,d=[],f=[],m=[],v=[],g=0;g<=r;g++){var y=[],_=g/r,E=0;0==g&&0==a?E=.5/n:g==r&&l==Math.PI&&(E=-.5/n);for(var T=0;T<=n;T++){var x=T/n;h.x=-e*Math.cos(i+x*o)*Math.sin(a+_*s),h.y=e*Math.cos(a+_*s),h.z=e*Math.sin(i+x*o)*Math.sin(a+_*s),f.push(h.x,h.y,h.z),p.copy(h).normalize(),m.push(p.x,p.y,p.z),v.push(x+E,1-_),y.push(c++)}u.push(y)}for(var b=0;b<r;b++)for(var M=0;M<n;M++){var A=u[b][M+1],S=u[b][M],O=u[b+1][M],w=u[b+1][M+1];(0!==b||a>0)&&d.push(A,S,w),(b!==r-1||l<Math.PI)&&d.push(S,O,w)}this.setIndex(d),this.setAttribute("position",new de(f,3)),this.setAttribute("normal",new de(m,3)),this.setAttribute("uv",new de(v,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)},e}(Ae),qa=function(t){function e(e,n){void 0===e&&(e=1),void 0===n&&(n=0),t.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.detail)},e}(Ho),Qa=function(t){function e(e,n){void 0===n&&(n={});var r=n.font;if(!r||!r.isFont)return new Ae;var i=r.generateShapes(e,n.size);n.depth=void 0!==n.height?n.height:50,void 0===n.bevelThickness&&(n.bevelThickness=10),void 0===n.bevelSize&&(n.bevelSize=8),void 0===n.bevelEnabled&&(n.bevelEnabled=!1),t.call(this,i,n),this.type="TextGeometry"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ka),Ka=function(t){function e(e,n,r,i,o){void 0===e&&(e=1),void 0===n&&(n=.4),void 0===r&&(r=8),void 0===i&&(i=6),void 0===o&&(o=2*Math.PI),t.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:r,tubularSegments:i,arc:o},r=Math.floor(r),i=Math.floor(i);for(var a=[],s=[],l=[],c=[],u=new D,h=new D,p=new D,d=0;d<=r;d++)for(var f=0;f<=i;f++){var m=f/i*o,v=d/r*Math.PI*2;h.x=(e+n*Math.cos(v))*Math.cos(m),h.y=(e+n*Math.cos(v))*Math.sin(m),h.z=n*Math.sin(v),s.push(h.x,h.y,h.z),u.x=e*Math.cos(m),u.y=e*Math.sin(m),p.subVectors(h,u).normalize(),l.push(p.x,p.y,p.z),c.push(f/i),c.push(d/r)}for(var g=1;g<=r;g++)for(var y=1;y<=i;y++){var _=(i+1)*g+y-1,E=(i+1)*(g-1)+y-1,T=(i+1)*(g-1)+y,x=(i+1)*g+y;a.push(_,E,x),a.push(E,T,x)}this.setIndex(a),this.setAttribute("position",new de(s,3)),this.setAttribute("normal",new de(l,3)),this.setAttribute("uv",new de(c,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)},e}(Ae),Ja=function(t){function e(e,n,r,i,o,a){void 0===e&&(e=1),void 0===n&&(n=.4),void 0===r&&(r=64),void 0===i&&(i=8),void 0===o&&(o=2),void 0===a&&(a=3),t.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:r,radialSegments:i,p:o,q:a},r=Math.floor(r),i=Math.floor(i);for(var s=[],l=[],c=[],u=[],h=new D,p=new D,d=new D,f=new D,m=new D,v=new D,g=new D,y=0;y<=r;++y){var _=y/r*o*Math.PI*2;C(_,o,a,e,d),C(_+.01,o,a,e,f),v.subVectors(f,d),g.addVectors(f,d),m.crossVectors(v,g),g.crossVectors(m,v),m.normalize(),g.normalize();for(var E=0;E<=i;++E){var T=E/i*Math.PI*2,x=-n*Math.cos(T),b=n*Math.sin(T);h.x=d.x+(x*g.x+b*m.x),h.y=d.y+(x*g.y+b*m.y),h.z=d.z+(x*g.z+b*m.z),l.push(h.x,h.y,h.z),p.subVectors(h,d).normalize(),c.push(p.x,p.y,p.z),u.push(y/r),u.push(E/i)}}for(var M=1;M<=r;M++)for(var A=1;A<=i;A++){var S=(i+1)*(M-1)+(A-1),O=(i+1)*M+(A-1),w=(i+1)*M+A,L=(i+1)*(M-1)+A;s.push(S,O,L),s.push(O,w,L)}function C(t,e,n,r,i){var o=Math.cos(t),a=Math.sin(t),s=n/e*t,l=Math.cos(s);i.x=r*(2+l)*.5*o,i.y=r*(2+l)*a*.5,i.z=r*Math.sin(s)*.5}this.setIndex(s),this.setAttribute("position",new de(l,3)),this.setAttribute("normal",new de(c,3)),this.setAttribute("uv",new de(u,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.fromJSON=function(t){return new e(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)},e}(Ae),$a=function(t){function e(e,n,r,i,o){void 0===n&&(n=64),void 0===r&&(r=1),void 0===i&&(i=8),void 0===o&&(o=!1),t.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:r,radialSegments:i,closed:o};var a=e.computeFrenetFrames(n,o);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var s=new D,l=new D,c=new m,u=new D,h=[],p=[],d=[],f=[];function v(t){u=e.getPointAt(t/n,u);for(var o=a.normals[t],c=a.binormals[t],d=0;d<=i;d++){var f=d/i*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);l.x=v*o.x+m*c.x,l.y=v*o.y+m*c.y,l.z=v*o.z+m*c.z,l.normalize(),p.push(l.x,l.y,l.z),s.x=u.x+r*l.x,s.y=u.y+r*l.y,s.z=u.z+r*l.z,h.push(s.x,s.y,s.z)}}!function(){for(var t=0;t<n;t++)v(t);v(!1===o?n:0),function(){for(var t=0;t<=n;t++)for(var e=0;e<=i;e++)c.x=t/n,c.y=e/i,d.push(c.x,c.y)}(),function(){for(var t=1;t<=n;t++)for(var e=1;e<=i;e++){var r=(i+1)*(t-1)+(e-1),o=(i+1)*t+(e-1),a=(i+1)*t+e,s=(i+1)*(t-1)+e;f.push(r,o,s),f.push(o,a,s)}}()}(),this.setIndex(f),this.setAttribute("position",new de(h,3)),this.setAttribute("normal",new de(p,3)),this.setAttribute("uv",new de(d,2))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},e.fromJSON=function(t){return new e((new ha[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)},e}(Ae),ts=function(t){function e(e){if(t.call(this),this.type="WireframeGeometry",!0!==e.isGeometry){var n=[],r=[0,0],i={},o=new D;if(null!==e.index){var a=e.attributes.position,s=e.index,l=e.groups;0===l.length&&(l=[{start:0,count:s.count,materialIndex:0}]);for(var c=0,u=l.length;c<u;++c)for(var h=l[c],p=h.start,d=p,f=p+h.count;d<f;d+=3)for(var m=0;m<3;m++){var v=s.getX(d+m),g=s.getX(d+(m+1)%3);r[0]=Math.min(v,g),r[1]=Math.max(v,g);var y=r[0]+","+r[1];void 0===i[y]&&(i[y]={index1:r[0],index2:r[1]})}for(var _ in i){var E=i[_];o.fromBufferAttribute(a,E.index1),n.push(o.x,o.y,o.z),o.fromBufferAttribute(a,E.index2),n.push(o.x,o.y,o.z)}}else for(var T=e.attributes.position,x=0,b=T.count/3;x<b;x++)for(var M=0;M<3;M++){var A=3*x+M;o.fromBufferAttribute(T,A),n.push(o.x,o.y,o.z);var S=3*x+(M+1)%3;o.fromBufferAttribute(T,S),n.push(o.x,o.y,o.z)}this.setAttribute("position",new de(n,3))}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ae),es=Object.freeze({__proto__:null,BoxGeometry:je,BoxBufferGeometry:je,CircleGeometry:Uo,CircleBufferGeometry:Uo,ConeGeometry:Fo,ConeBufferGeometry:Fo,CylinderGeometry:Bo,CylinderBufferGeometry:Bo,DodecahedronGeometry:ko,DodecahedronBufferGeometry:ko,EdgesGeometry:jo,ExtrudeGeometry:ka,ExtrudeBufferGeometry:ka,IcosahedronGeometry:Ga,IcosahedronBufferGeometry:Ga,LatheGeometry:Wa,LatheBufferGeometry:Wa,OctahedronGeometry:Va,OctahedronBufferGeometry:Va,ParametricGeometry:ja,ParametricBufferGeometry:ja,PlaneGeometry:hn,PlaneBufferGeometry:hn,PolyhedronGeometry:Ho,PolyhedronBufferGeometry:Ho,RingGeometry:Ya,RingBufferGeometry:Ya,ShapeGeometry:Xa,ShapeBufferGeometry:Xa,SphereGeometry:Za,SphereBufferGeometry:Za,TetrahedronGeometry:qa,TetrahedronBufferGeometry:qa,TextGeometry:Qa,TextBufferGeometry:Qa,TorusGeometry:Ka,TorusBufferGeometry:Ka,TorusKnotGeometry:Ja,TorusKnotBufferGeometry:Ja,TubeGeometry:$a,TubeBufferGeometry:$a,WireframeGeometry:ts}),ns=function(t){function e(e){t.call(this),this.type="ShadowMaterial",this.color=new $t(0),this.transparent=!0,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this},e}(Yt);ns.prototype.isShadowMaterial=!0;var rs=function(t){function e(e){t.call(this,e),this.type="RawShaderMaterial"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(qe);rs.prototype.isRawShaderMaterial=!0;var is=function(t){function e(e){t.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new $t(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new m(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this},e}(Yt);is.prototype.isMeshStandardMaterial=!0;var os=function(t){function e(e){t.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new m(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=l(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new $t(1,1,1),this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new $t).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this},e}(is);os.prototype.isMeshPhysicalMaterial=!0;var as=function(t){function e(e){t.call(this),this.type="MeshPhongMaterial",this.color=new $t(16777215),this.specular=new $t(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new m(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this},e}(Yt);as.prototype.isMeshPhongMaterial=!0;var ss=function(t){function e(e){t.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new $t(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new m(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},e}(Yt);ss.prototype.isMeshToonMaterial=!0;var ls=function(t){function e(e){t.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new m(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this},e}(Yt);ls.prototype.isMeshNormalMaterial=!0;var cs=function(t){function e(e){t.call(this),this.type="MeshLambertMaterial",this.color=new $t(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new $t(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},e}(Yt);cs.prototype.isMeshLambertMaterial=!0;var us=function(t){function e(e){t.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new $t(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new m(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this},e}(Yt);us.prototype.isMeshMatcapMaterial=!0;var hs=function(t){function e(e){t.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this},e}(fo);hs.prototype.isLineDashedMaterial=!0;var ps=Object.freeze({__proto__:null,ShadowMaterial:ns,SpriteMaterial:Ni,RawShaderMaterial:rs,ShaderMaterial:qe,PointsMaterial:Ao,MeshPhysicalMaterial:os,MeshStandardMaterial:is,MeshPhongMaterial:as,MeshToonMaterial:ss,MeshNormalMaterial:ls,MeshLambertMaterial:cs,MeshDepthMaterial:ui,MeshDistanceMaterial:hi,MeshBasicMaterial:te,MeshMatcapMaterial:us,LineDashedMaterial:hs,LineBasicMaterial:fo,Material:Yt}),ds={arraySlice:function(t,e,n){return ds.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,n=new Array(e),r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),o=0,a=0;a!==r;++o)for(var s=n[o]*e,l=0;l!==e;++l)i[a++]=t[s+l];return i},flattenJSON:function(t,e,n,r){for(var i=1,o=t[0];void 0!==o&&void 0===o[r];)o=t[i++];if(void 0!==o){var a=o[r];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[r])&&(e.push(o.time),n.push.apply(n,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[r])&&(e.push(o.time),a.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[r])&&(e.push(o.time),n.push(a)),o=t[i++]}while(void 0!==o)}},subclip:function(t,e,n,r,i){void 0===i&&(i=30);var o=t.clone();o.name=e;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],c=l.getValueSize(),u=[],h=[],p=0;p<l.times.length;++p){var d=l.times[p]*i;if(!(d<n||d>=r)){u.push(l.times[p]);for(var f=0;f<c;++f)h.push(l.values[p*c+f])}}0!==u.length&&(l.times=ds.convertArray(u,l.times.constructor),l.values=ds.convertArray(h,l.values.constructor),a.push(l))}o.tracks=a;for(var m=1/0,v=0;v<o.tracks.length;++v)m>o.tracks[v].times[0]&&(m=o.tracks[v].times[0]);for(var g=0;g<o.tracks.length;++g)o.tracks[g].shift(-1*m);return o.resetDuration(),o},makeClipAdditive:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=t),void 0===r&&(r=30),r<=0&&(r=30);for(var i=n.tracks.length,o=e/r,a=function(e){var r=n.tracks[e],i=r.ValueTypeName;if("bool"!==i&&"string"!==i){var a=t.tracks.find((function(t){return t.name===r.name&&t.ValueTypeName===i}));if(void 0!==a){var s=0,l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);var c=0,u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);var h=r.times.length-1,p=void 0;if(o<=r.times[0]){var d=s,f=l-s;p=ds.arraySlice(r.values,d,f)}else if(o>=r.times[h]){var m=h*l+s,v=m+l-s;p=ds.arraySlice(r.values,m,v)}else{var g=r.createInterpolant(),y=s,_=l-s;g.evaluate(o),p=ds.arraySlice(g.resultBuffer,y,_)}"quaternion"===i&&(new w).fromArray(p).normalize().conjugate().toArray(p);for(var E=a.times.length,T=0;T<E;++T){var x=T*u+c;if("quaternion"===i)w.multiplyQuaternionsFlat(a.values,x,p,0,a.values,x);else for(var b=u-2*c,M=0;M<b;++M)a.values[x+M]-=p[M]}}}},s=0;s<i;++s)a(s);return t.blendMode=2501,t}},fs=function(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}};fs.prototype.evaluate=function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],i=e[n-1];t:{e:{var o;n:{r:if(!(t<r)){for(var a=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,i)}if(n===a)break;if(i=r,t<(r=e[++n]))break e}o=e.length;break n}if(t>=i)break t;var s=e[1];t<s&&(n=2,i=s);for(var l=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===l)break;if(r=i,t>=(i=e[--n-1]))break e}o=n,n=0}for(;n<o;){var c=n+o>>>1;t<e[c]?o=c:n=c+1}if(r=e[n],void 0===(i=e[n-1]))return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,i,t)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,t,r)},fs.prototype.getSettings_=function(){return this.settings||this.DefaultSettings_},fs.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r,o=0;o!==r;++o)e[o]=n[i+o];return e},fs.prototype.interpolate_=function(){throw new Error("call to abstract method")},fs.prototype.intervalChanged_=function(){},fs.prototype.beforeStart_=fs.prototype.copySampleValue_,fs.prototype.afterEnd_=fs.prototype.copySampleValue_;var ms=function(t){function e(e,n,r,i){t.call(this,e,n,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.intervalChanged_=function(t,e,n){var r=this.parameterPositions,i=t-2,o=t+1,a=r[i],s=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=t,a=2*e-n;break;case 2402:a=e+r[i=r.length-2]-r[i+1];break;default:i=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:o=t,s=2*n-e;break;case 2402:o=1,s=n+r[1]-r[0];break;default:o=t-1,s=e}var l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(s-n),this._offsetPrev=i*c,this._offsetNext=o*c},e.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(n-e)/(r-e),f=d*d,m=f*d,v=-h*m+2*h*f-h*d,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,_=p*m-p*f,E=0;E!==a;++E)i[E]=v*o[c+E]+g*o[l+E]+y*o[s+E]+_*o[u+E];return i},e}(fs),vs=function(t){function e(e,n,r,i){t.call(this,e,n,r,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=(n-e)/(r-e),u=1-c,h=0;h!==a;++h)i[h]=o[l+h]*u+o[s+h]*c;return i},e}(fs),gs=function(t){function e(e,n,r,i){t.call(this,e,n,r,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interpolate_=function(t){return this.copySampleValue_(t-1)},e}(fs),ys=function(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=ds.convertArray(e,this.TimeBufferType),this.values=ds.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)};ys.toJSON=function(t){var e,n=t.constructor;if(n.toJSON!==this.toJSON)e=n.toJSON(t);else{e={name:t.name,times:ds.convertArray(t.times,Array),values:ds.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(e.interpolation=r)}return e.type=t.ValueTypeName,e},ys.prototype.InterpolantFactoryMethodDiscrete=function(t){return new gs(this.times,this.values,this.getValueSize(),t)},ys.prototype.InterpolantFactoryMethodLinear=function(t){return new vs(this.times,this.values,this.getValueSize(),t)},ys.prototype.InterpolantFactoryMethodSmooth=function(t){return new ms(this.times,this.values,this.getValueSize(),t)},ys.prototype.setInterpolation=function(t){var e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=e,this},ys.prototype.getInterpolation=function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},ys.prototype.getValueSize=function(){return this.values.length/this.times.length},ys.prototype.shift=function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},ys.prototype.scale=function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},ys.prototype.trim=function(t,e){for(var n=this.times,r=n.length,i=0,o=r-1;i!==r&&n[i]<t;)++i;for(;-1!==o&&n[o]>e;)--o;if(++o,0!==i||o!==r){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=ds.arraySlice(n,i,o),this.values=ds.arraySlice(this.values,i*a,o*a)}return this},ys.prototype.validate=function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(t=!1);var n=this.times,r=this.values,i=n.length;0===i&&(t=!1);for(var o=null,a=0;a!==i;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){t=!1;break}if(null!==o&&o>s){t=!1;break}o=s}if(void 0!==r&&ds.isTypedArray(r))for(var l=0,c=r.length;l!==c;++l){var u=r[l];if(isNaN(u)){t=!1;break}}return t},ys.prototype.optimize=function(){for(var t=ds.arraySlice(this.times),e=ds.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),i=t.length-1,o=1,a=1;a<i;++a){var s=!1,l=t[a];if(l!==t[a+1]&&(1!==a||l!==t[0]))if(r)s=!0;else for(var c=a*n,u=c-n,h=c+n,p=0;p!==n;++p){var d=e[c+p];if(d!==e[u+p]||d!==e[h+p]){s=!0;break}}if(s){if(a!==o){t[o]=t[a];for(var f=a*n,m=o*n,v=0;v!==n;++v)e[m+v]=e[f+v]}++o}}if(i>0){t[o]=t[i];for(var g=i*n,y=o*n,_=0;_!==n;++_)e[y+_]=e[g+_];++o}return o!==t.length?(this.times=ds.arraySlice(t,0,o),this.values=ds.arraySlice(e,0,o*n)):(this.times=t,this.values=e),this},ys.prototype.clone=function(){var t=ds.arraySlice(this.times,0),e=ds.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n},ys.prototype.TimeBufferType=Float32Array,ys.prototype.ValueBufferType=Float32Array,ys.prototype.DefaultInterpolation=2301;var _s=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ys);_s.prototype.ValueTypeName="bool",_s.prototype.ValueBufferType=Array,_s.prototype.DefaultInterpolation=2300,_s.prototype.InterpolantFactoryMethodLinear=void 0,_s.prototype.InterpolantFactoryMethodSmooth=void 0;var Es=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ys);Es.prototype.ValueTypeName="color";var Ts=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ys);Ts.prototype.ValueTypeName="number";var xs=function(t){function e(e,n,r,i){t.call(this,e,n,r,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=(n-e)/(r-e),l=t*a,c=l+a;l!==c;l+=4)w.slerpFlat(i,0,o,l-a,o,l,s);return i},e}(fs),bs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.InterpolantFactoryMethodLinear=function(t){return new xs(this.times,this.values,this.getValueSize(),t)},e}(ys);bs.prototype.ValueTypeName="quaternion",bs.prototype.DefaultInterpolation=2301,bs.prototype.InterpolantFactoryMethodSmooth=void 0;var Ms=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ys);Ms.prototype.ValueTypeName="string",Ms.prototype.ValueBufferType=Array,Ms.prototype.DefaultInterpolation=2300,Ms.prototype.InterpolantFactoryMethodLinear=void 0,Ms.prototype.InterpolantFactoryMethodSmooth=void 0;var As=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ys);As.prototype.ValueTypeName="vector";var Ss=function(t,e,n,r){void 0===e&&(e=-1),void 0===r&&(r=2500),this.name=t,this.tracks=n,this.duration=e,this.blendMode=r,this.uuid=s(),this.duration<0&&this.resetDuration()};function Os(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ts;case"vector":case"vector2":case"vector3":case"vector4":return As;case"color":return Es;case"quaternion":return bs;case"bool":case"boolean":return _s;case"string":return Ms}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var n=[],r=[];ds.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Ss.parse=function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,o=n.length;i!==o;++i)e.push(Os(n[i]).scale(r));var a=new this(t.name,t.duration,e,t.blendMode);return a.uuid=t.uuid,a},Ss.toJSON=function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},i=0,o=n.length;i!==o;++i)e.push(ys.toJSON(n[i]));return r},Ss.CreateFromMorphTargetSequence=function(t,e,n,r){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],l=[];s.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);var c=ds.getKeyframeOrder(s);s=ds.sortedArray(s,1,c),l=ds.sortedArray(l,1,c),r||0!==s[0]||(s.push(i),l.push(l[0])),o.push(new Ts(".morphTargetInfluences["+e[a].name+"]",s,l).scale(1/n))}return new this(t,-1,o)},Ss.findByName=function(t,e){var n=t;if(!Array.isArray(t)){var r=t;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null},Ss.CreateClipsFromMorphTargetSequences=function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],l=s.name.match(i);if(l&&l.length>1){var c=l[1],u=r[c];u||(r[c]=u=[]),u.push(s)}}var h=[];for(var p in r)h.push(this.CreateFromMorphTargetSequence(p,r[p],e,n));return h},Ss.parseAnimation=function(t,e){if(!t)return null;for(var n=function(t,e,n,r,i){if(0!==n.length){var o=[],a=[];ds.flattenJSON(n,o,a,r),0!==o.length&&i.push(new t(e,o,a))}},r=[],i=t.name||"default",o=t.fps||30,a=t.blendMode,s=t.length||-1,l=t.hierarchy||[],c=0;c<l.length;c++){var u=l[c].keys;if(u&&0!==u.length)if(u[0].morphTargets){var h={},p=void 0;for(p=0;p<u.length;p++)if(u[p].morphTargets)for(var d=0;d<u[p].morphTargets.length;d++)h[u[p].morphTargets[d]]=-1;for(var f in h){for(var m=[],v=[],g=0;g!==u[p].morphTargets.length;++g){var y=u[p];m.push(y.time),v.push(y.morphTarget===f?1:0)}r.push(new Ts(".morphTargetInfluence["+f+"]",m,v))}s=h.length*(o||1)}else{var _=".bones["+e[c].name+"]";n(As,_+".position",u,"pos",r),n(bs,_+".quaternion",u,"rot",r),n(As,_+".scale",u,"scl",r)}}return 0===r.length?null:new this(i,s,r,a)},Ss.prototype.resetDuration=function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this},Ss.prototype.trim=function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},Ss.prototype.validate=function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},Ss.prototype.optimize=function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},Ss.prototype.clone=function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)},Ss.prototype.toJSON=function(){return this.constructor.toJSON(this)};var ws={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Ls=function(t,e,n){var r=this,i=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===i&&void 0!==r.onStart&&r.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==r.onProgress&&r.onProgress(t,o,a),o===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){var e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(var e=0,n=l.length;e<n;e+=2){var r=l[e],i=l[e+1];if(r.global&&(r.lastIndex=0),r.test(t))return i}return null}},Ds=new Ls,Cs=function(t){this.manager=void 0!==t?t:Ds,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}};Cs.prototype.load=function(){},Cs.prototype.loadAsync=function(t,e){var n=this;return new Promise((function(r,i){n.load(t,r,e,i)}))},Cs.prototype.parse=function(){},Cs.prototype.setCrossOrigin=function(t){return this.crossOrigin=t,this},Cs.prototype.setWithCredentials=function(t){return this.withCredentials=t,this},Cs.prototype.setPath=function(t){return this.path=t,this},Cs.prototype.setResourcePath=function(t){return this.resourcePath=t,this},Cs.prototype.setRequestHeader=function(t){return this.requestHeader=t,this};var Ps={},Ns=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=ws.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0===Ps[t]){var a,s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var l=s[1],c=!!s[2],u=s[3];u=decodeURIComponent(u),c&&(u=atob(u));try{var h,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":for(var d=new Uint8Array(u.length),f=0;f<u.length;f++)d[f]=u.charCodeAt(f);h="blob"===p?new Blob([d.buffer],{type:l}):d.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(u,l);break;case"json":h=JSON.parse(u);break;default:h=u}setTimeout((function(){e&&e(h),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{for(var v in Ps[t]=[],Ps[t].push({onLoad:e,onProgress:n,onError:r}),(a=new XMLHttpRequest).open("GET",t,!0),a.addEventListener("load",(function(e){var n=this.response,r=Ps[t];if(delete Ps[t],200===this.status||0===this.status){this.status,ws.add(t,n);for(var o=0,a=r.length;o<a;o++){var s=r[o];s.onLoad&&s.onLoad(n)}i.manager.itemEnd(t)}else{for(var l=0,c=r.length;l<c;l++){var u=r[l];u.onError&&u.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),a.addEventListener("progress",(function(e){for(var n=Ps[t],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(e)}}),!1),a.addEventListener("error",(function(e){var n=Ps[t];delete Ps[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),a.addEventListener("abort",(function(e){var n=Ps[t];delete Ps[t];for(var r=0,o=n.length;r<o;r++){var a=n[r];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)a.setRequestHeader(v,this.requestHeader[v]);a.send(null)}return i.manager.itemStart(t),a}Ps[t].push({onLoad:e,onProgress:n,onError:r})},e.prototype.setResponseType=function(t){return this.responseType=t,this},e.prototype.setMimeType=function(t){return this.mimeType=t,this},e}(Cs),Rs=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=this,o=new Ns(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r&&r(e),i.manager.itemError(t)}}),n,r)},e.prototype.parse=function(t){for(var e=[],n=0;n<t.length;n++){var r=Ss.parse(t[n]);e.push(r)}return e},e}(Cs),Is=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=this,o=[],a=new No,s=new Ns(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);var l=0;function c(c){s.load(t[c],(function(t){var n=i.parse(t,!0);o[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(a.minFilter=1006),a.image=o,a.format=n.format,a.needsUpdate=!0,e&&e(a))}),n,r)}if(Array.isArray(t))for(var u=0,h=t.length;u<h;++u)c(u);else s.load(t,(function(t){var n=i.parse(t,!0);if(n.isCubemap){for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){o[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)o[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),o[s].format=n.format,o[s].width=n.width,o[s].height=n.height}a.image=o}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=1006),a.format=n.format,a.needsUpdate=!0,e&&e(a)}),n,r);return a},e}(Cs),Us=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=ws.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),ws.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a},e}(Cs),Bs=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=new $e,o=new Us(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(n){o.load(t[n],(function(t){i.images[n]=t,6==++a&&(i.needsUpdate=!0,e&&e(i))}),void 0,r)}for(var l=0;l<t.length;++l)s(l);return i},e}(Cs),Fs=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=this,o=new io,a=new Ns(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(t,(function(t){var n=i.parse(t);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:1001,o.wrapT=void 0!==n.wrapT?n.wrapT:1001,o.magFilter=void 0!==n.magFilter?n.magFilter:1006,o.minFilter=void 0!==n.minFilter?n.minFilter:1006,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=1008),1===n.mipmapCount&&(o.minFilter=1006),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,e&&e(o,n))}),n,r),o},e}(Cs),Hs=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=new T,o=new Us(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(n){i.image=n;var r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?1022:1023,i.needsUpdate=!0,void 0!==e&&e(i)}),n,r),i},e}(Cs),ks=function(t){function e(){t.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.add=function(t){this.curves.push(t)},e.prototype.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new aa(e,t))},e.prototype.getPoint=function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=e){var i=n[r]-e,o=this.curves[r],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}r++}return null},e.prototype.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},e.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},e.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},e.prototype.getSpacedPoints=function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},e.prototype.getPoints=function(t){void 0===t&&(t=12);for(var e,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],a=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];e&&e.equals(c)||(n.push(c),e=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},e.prototype.copy=function(e){t.prototype.copy.call(this,e),this.curves=[];for(var n=0,r=e.curves.length;n<r;n++){var i=e.curves[n];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var n=0,r=this.curves.length;n<r;n++){var i=this.curves[n];e.curves.push(i.toJSON())}return e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var n=0,r=e.curves.length;n<r;n++){var i=e.curves[n];this.curves.push((new ha[i.type]).fromJSON(i))}return this},e}(Yo),zs=function(t){function e(e){t.call(this),this.type="Path",this.currentPoint=new m,e&&this.setFromPoints(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setFromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},e.prototype.moveTo=function(t,e){return this.currentPoint.set(t,e),this},e.prototype.lineTo=function(t,e){var n=new aa(this.currentPoint.clone(),new m(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},e.prototype.quadraticCurveTo=function(t,e,n,r){var i=new la(this.currentPoint.clone(),new m(t,e),new m(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},e.prototype.bezierCurveTo=function(t,e,n,r,i,o){var a=new ia(this.currentPoint.clone(),new m(t,e),new m(n,r),new m(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},e.prototype.splineThru=function(t){var e=[this.currentPoint.clone()].concat(t),n=new ua(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this},e.prototype.arc=function(t,e,n,r,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,n,r,i,o),this},e.prototype.absarc=function(t,e,n,r,i,o){return this.absellipse(t,e,n,n,r,i,o),this},e.prototype.ellipse=function(t,e,n,r,i,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,r,i,o,a,s),this},e.prototype.absellipse=function(t,e,n,r,i,o,a,s){var l=new Xo(t,e,n,r,i,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);return this.currentPoint.copy(u),this},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},e.prototype.fromJSON=function(e){return t.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this},e}(ks),Gs=function(t){function e(e){t.call(this,e),this.uuid=s(),this.type="Shape",this.holes=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPointsHoles=function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},e.prototype.extractPoints=function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},e.prototype.copy=function(e){t.prototype.copy.call(this,e),this.holes=[];for(var n=0,r=e.holes.length;n<r;n++){var i=e.holes[n];this.holes.push(i.clone())}return this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var n=0,r=this.holes.length;n<r;n++){var i=this.holes[n];e.holes.push(i.toJSON())}return e},e.prototype.fromJSON=function(e){t.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var n=0,r=e.holes.length;n<r;n++){var i=e.holes[n];this.holes.push((new t).fromJSON(i))}return this},e}(zs),Ws=function(t){function e(e,n){void 0===n&&(n=1),t.call(this),this.type="Light",this.color=new $t(e),this.intensity=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,void 0!==this.groundColor&&(n.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(n.object.distance=this.distance),void 0!==this.angle&&(n.object.angle=this.angle),void 0!==this.decay&&(n.object.decay=this.decay),void 0!==this.penumbra&&(n.object.penumbra=this.penumbra),void 0!==this.shadow&&(n.object.shadow=this.shadow.toJSON()),n},e}(Nt);Ws.prototype.isLight=!0;var Vs=function(t){function e(e,n,r){t.call(this,e,r),this.type="HemisphereLight",this.position.copy(Nt.DefaultUp),this.updateMatrix(),this.groundColor=new $t(n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this},e}(Ws);Vs.prototype.isHemisphereLight=!0;var js=new st,Ys=new D,Xs=new D,Zs=function(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new m(512,512),this.map=null,this.mapPass=null,this.matrix=new st,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ln,this._frameExtents=new m(1,1),this._viewportCount=1,this._viewports=[new b(0,0,1,1)]};Zs.prototype.getViewportCount=function(){return this._viewportCount},Zs.prototype.getFrustum=function(){return this._frustum},Zs.prototype.updateMatrices=function(t){var e=this.camera,n=this.matrix;Ys.setFromMatrixPosition(t.matrixWorld),e.position.copy(Ys),Xs.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Xs),e.updateMatrixWorld(),js.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(js),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},Zs.prototype.getViewport=function(t){return this._viewports[t]},Zs.prototype.getFrameExtents=function(){return this._frameExtents},Zs.prototype.dispose=function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()},Zs.prototype.copy=function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},Zs.prototype.clone=function(){return(new this.constructor).copy(this)},Zs.prototype.toJSON=function(){var t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t};var qs=function(t){function e(){t.call(this,new Ke(50,1,.5,500)),this.focus=1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateMatrices=function(e){var n=this.camera,r=2*a*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=e.distance||n.far;r===n.fov&&i===n.aspect&&o===n.far||(n.fov=r,n.aspect=i,n.far=o,n.updateProjectionMatrix()),t.prototype.updateMatrices.call(this,e)},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.focus=e.focus,this},e}(Zs);qs.prototype.isSpotLightShadow=!0;var Qs=function(t){function e(e,n,r,i,o,a){void 0===r&&(r=0),void 0===i&&(i=Math.PI/3),void 0===o&&(o=0),void 0===a&&(a=1),t.call(this,e,n),this.type="SpotLight",this.position.copy(Nt.DefaultUp),this.updateMatrix(),this.target=new Nt,this.distance=r,this.angle=i,this.penumbra=o,this.decay=a,this.shadow=new qs}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={power:{configurable:!0}};return n.power.get=function(){return this.intensity*Math.PI},n.power.set=function(t){this.intensity=t/Math.PI},e.prototype.dispose=function(){this.shadow.dispose()},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},Object.defineProperties(e.prototype,n),e}(Ws);Qs.prototype.isSpotLight=!0;var Ks=new st,Js=new D,$s=new D,tl=function(t){function e(){t.call(this,new Ke(90,1,.5,500)),this._frameExtents=new m(4,2),this._viewportCount=6,this._viewports=[new b(2,1,1,1),new b(0,1,1,1),new b(3,1,1,1),new b(1,1,1,1),new b(3,0,1,1),new b(1,0,1,1)],this._cubeDirections=[new D(1,0,0),new D(-1,0,0),new D(0,0,1),new D(0,0,-1),new D(0,1,0),new D(0,-1,0)],this._cubeUps=[new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,0,1),new D(0,0,-1)]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateMatrices=function(t,e){void 0===e&&(e=0);var n=this.camera,r=this.matrix,i=t.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Js.setFromMatrixPosition(t.matrixWorld),n.position.copy(Js),$s.copy(n.position),$s.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt($s),n.updateMatrixWorld(),r.makeTranslation(-Js.x,-Js.y,-Js.z),Ks.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ks)},e}(Zs);tl.prototype.isPointLightShadow=!0;var el=function(t){function e(e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=1),t.call(this,e,n),this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new tl}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={power:{configurable:!0}};return n.power.get=function(){return 4*this.intensity*Math.PI},n.power.set=function(t){this.intensity=t/(4*Math.PI)},e.prototype.dispose=function(){this.shadow.dispose()},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this},Object.defineProperties(e.prototype,n),e}(Ws);el.prototype.isPointLight=!0;var nl=function(t){function e(e,n,r,i,o,a){void 0===e&&(e=-1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=-1),void 0===o&&(o=.1),void 0===a&&(a=2e3),t.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=i,this.near=o,this.far=a,this.updateProjectionMatrix()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e,n){return t.prototype.copy.call(this,e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},e.prototype.setViewOffset=function(t,e,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},e.prototype.clearViewOffset=function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},e.prototype.updateProjectionMatrix=function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,o=n+t,a=r+e,s=r-e;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(i+=l*this.view.offsetX)+l*this.view.width,s=(a-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,null!==this.view&&(n.object.view=Object.assign({},this.view)),n},e}(Qe);nl.prototype.isOrthographicCamera=!0;var rl=function(t){function e(){t.call(this,new nl(-5,5,5,-5,.5,500))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Zs);rl.prototype.isDirectionalLightShadow=!0;var il=function(t){function e(e,n){t.call(this,e,n),this.type="DirectionalLight",this.position.copy(Nt.DefaultUp),this.updateMatrix(),this.target=new Nt,this.shadow=new rl}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){this.shadow.dispose()},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},e}(Ws);il.prototype.isDirectionalLight=!0;var ol=function(t){function e(e,n){t.call(this,e,n),this.type="AmbientLight"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ws);ol.prototype.isAmbientLight=!0;var al=function(t){function e(e,n,r,i){void 0===r&&(r=10),void 0===i&&(i=10),t.call(this,e,n),this.type="RectAreaLight",this.width=r,this.height=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.width=this.width,n.object.height=this.height,n},e}(Ws);al.prototype.isRectAreaLight=!0;var sl=function(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new D)};sl.prototype.set=function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},sl.prototype.zero=function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},sl.prototype.getAt=function(t,e){var n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*r),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],n*r*1.092548),e.addScaledVector(o[5],r*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],n*i*1.092548),e.addScaledVector(o[8],.546274*(n*n-r*r)),e},sl.prototype.getIrradianceAt=function(t,e){var n=t.x,r=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*r),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*n),e.addScaledVector(o[4],.858086*n*r),e.addScaledVector(o[5],.858086*r*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*n*i),e.addScaledVector(o[8],.429043*(n*n-r*r)),e},sl.prototype.add=function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},sl.prototype.addScaledSH=function(t,e){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this},sl.prototype.scale=function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},sl.prototype.lerp=function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},sl.prototype.equals=function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},sl.prototype.copy=function(t){return this.set(t.coefficients)},sl.prototype.clone=function(){return(new this.constructor).copy(this)},sl.prototype.fromArray=function(t,e){void 0===e&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(t,e+3*r);return this},sl.prototype.toArray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(t,e+3*r);return t},sl.getBasisAt=function(t,e){var n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)},sl.prototype.isSphericalHarmonics3=!0;var ll=function(t){function e(e,n){void 0===e&&(e=new sl),void 0===n&&(n=1),t.call(this,void 0,n),this.sh=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.sh.copy(e.sh),this},e.prototype.fromJSON=function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.object.sh=this.sh.toArray(),n},e}(Ws);ll.prototype.isLightProbe=!0;var cl=function(t){function e(e){t.call(this,e),this.textures={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=this,o=new Ns(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r&&r(e),i.manager.itemError(t)}}),n,r)},e.prototype.parse=function(t){var e=this.textures;function n(t){return e[t],e[t]}var r=new ps[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new $t).setHex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.thickness&&(r.thickness=t.thickness),void 0!==t.attenuationDistance&&(r.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.shadowSide&&(r.shadowSide=t.shadowSide),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.alphaToCoverage&&(r.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(r.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var i in t.uniforms){var o=t.uniforms[i];switch(r.uniforms[i]={},o.type){case"t":r.uniforms[i].value=n(o.value);break;case"c":r.uniforms[i].value=(new $t).setHex(o.value);break;case"v2":r.uniforms[i].value=(new m).fromArray(o.value);break;case"v3":r.uniforms[i].value=(new D).fromArray(o.value);break;case"v4":r.uniforms[i].value=(new b).fromArray(o.value);break;case"m3":r.uniforms[i].value=(new y).fromArray(o.value);break;case"m4":r.uniforms[i].value=(new st).fromArray(o.value);break;default:r.uniforms[i].value=o.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var a in t.extensions)r.extensions[a]=t.extensions[a];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new m).fromArray(s)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new m).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(r.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(r.thicknessMap=n(t.thicknessMap)),r},e.prototype.setTextures=function(t){return this.textures=t,this},e}(Cs),ul=function(){};ul.decodeText=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}},ul.extractUrlBase=function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)};var hl=function(t){function e(){t.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},e.prototype.clone=function(){return(new this.constructor).copy(this)},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e},e}(Ae);hl.prototype.isInstancedBufferGeometry=!0;var pl=function(t){function e(e,n,r,i){void 0===i&&(i=1),"number"==typeof r&&(i=r,r=!1),t.call(this,e,n,r),this.meshPerAttribute=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e},e}(re);pl.prototype.isInstancedBufferAttribute=!0;var dl=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=this,o=new Ns(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(n){try{e(i.parse(JSON.parse(n)))}catch(e){r&&r(e),i.manager.itemError(t)}}),n,r)},e.prototype.parse=function(t){var e={},n={};function r(t,r){if(void 0!==e[r])return e[r];var i=t.interleavedBuffers[r],o=function(t,e){if(void 0!==n[e])return n[e];var r=t.arrayBuffers[e],i=new Uint32Array(r).buffer;return n[e]=i,i}(t,i.buffer),a=ge(i.type,o),s=new Oi(a,i.stride);return s.uuid=i.uuid,e[r]=s,s}var i=t.isInstancedBufferGeometry?new hl:new Ae,o=t.data.index;if(void 0!==o){var a=ge(o.type,o.array);i.setIndex(new re(a,1))}var s=t.data.attributes;for(var l in s){var c=s[l],u=void 0;if(c.isInterleavedBufferAttribute){var h=r(t.data,c.data);u=new Di(h,c.itemSize,c.offset,c.normalized)}else{var p=ge(c.type,c.array);u=new(c.isInstancedBufferAttribute?pl:re)(p,c.itemSize,c.normalized)}void 0!==c.name&&(u.name=c.name),void 0!==c.usage&&u.setUsage(c.usage),void 0!==c.updateRange&&(u.updateRange.offset=c.updateRange.offset,u.updateRange.count=c.updateRange.count),i.setAttribute(l,u)}var d=t.data.morphAttributes;if(d)for(var f in d){for(var m=d[f],v=[],g=0,y=m.length;g<y;g++){var _=m[g],E=void 0;if(_.isInterleavedBufferAttribute){var T=r(t.data,_.data);E=new Di(T,_.itemSize,_.offset,_.normalized)}else{var x=ge(_.type,_.array);E=new re(x,_.itemSize,_.normalized)}void 0!==_.name&&(E.name=_.name),v.push(E)}i.morphAttributes[f]=v}t.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);var b=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==b)for(var M=0,A=b.length;M!==A;++M){var S=b[M];i.addGroup(S.start,S.count,S.materialIndex)}var O=t.data.boundingSphere;if(void 0!==O){var w=new D;void 0!==O.center&&w.fromArray(O.center),i.boundingSphere=new J(w,O.radius)}return t.name&&(i.name=t.name),t.userData&&(i.userData=t.userData),i},e}(Cs),fl=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=this,o=""===this.path?ul.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;var a=new Ns(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(t){var n=null;try{n=JSON.parse(t)}catch(t){return void(void 0!==r&&r(t))}var o=n.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()&&i.parse(n,e)}),n,r)},e.prototype.loadAsync=async function(t,e){var n=""===this.path?ul.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;var r=new Ns(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);var i=await r.loadAsync(t,e),o=JSON.parse(i),a=o.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(o)},e.prototype.parse=function(t,e){var n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,r),o=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),a=this.parseTextures(t.textures,o),s=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,i,s,a,n),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){var u=!1;for(var h in o)if(o[h]instanceof HTMLImageElement){u=!0;break}!1===u&&e(l)}return l},e.prototype.parseAsync=async function(t){var e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),i=await this.parseImagesAsync(t.images),o=this.parseTextures(t.textures,i),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,r,a,o,e),l=this.parseSkeletons(t.skeletons,s);return this.bindSkeletons(s,l),s},e.prototype.parseShapes=function(t){var e={};if(void 0!==t)for(var n=0,r=t.length;n<r;n++){var i=(new Gs).fromJSON(t[n]);e[i.uuid]=i}return e},e.prototype.parseSkeletons=function(t,e){var n={},r={};if(e.traverse((function(t){t.isBone&&(r[t.uuid]=t)})),void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=(new so).fromJSON(t[i],r);n[a.uuid]=a}return n},e.prototype.parseGeometries=function(t,e){var n={};if(void 0!==t)for(var r=new dl,i=0,o=t.length;i<o;i++){var a=void 0,s=t[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(s);break;case"Geometry":break;default:s.type in es&&(a=es[s.type].fromJSON(s,e))}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),n[s.uuid]=a}return n},e.prototype.parseMaterials=function(t,e){var n={},r={};if(void 0!==t){var i=new cl;i.setTextures(e);for(var o=0,a=t.length;o<a;o++){var s=t[o];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===n[u.uuid]&&(n[u.uuid]=i.parse(u)),l.push(n[u.uuid])}r[s.uuid]=l}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},e.prototype.parseAnimations=function(t){var e={};if(void 0!==t)for(var n=0;n<t.length;n++){var r=t[n],i=Ss.parse(r);e[i.uuid]=i}return e},e.prototype.parseImages=function(t,e){var n,r=this,i={};function o(t){if("string"==typeof t){var e=t;return function(t){return r.manager.itemStart(t),n.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcePath+e)}return t.data?{data:ge(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){var a=new Ls(e);(n=new Us(a)).setCrossOrigin(this.crossOrigin);for(var s=0,l=t.length;s<l;s++){var c=t[s],u=c.url;if(Array.isArray(u)){i[c.uuid]=[];for(var h=0,p=u.length;h<p;h++){var d=o(u[h]);null!==d&&(d instanceof HTMLImageElement?i[c.uuid].push(d):i[c.uuid].push(new io(d.data,d.width,d.height)))}}else{var f=o(c.url);null!==f&&(i[c.uuid]=f)}}}return i},e.prototype.parseImagesAsync=async function(t){var e,n=this,r={};async function i(t){if("string"==typeof t){var r=t,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r)?r:n.resourcePath+r;return await e.loadAsync(i)}return t.data?{data:ge(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){(e=new Us(this.manager)).setCrossOrigin(this.crossOrigin);for(var o=0,a=t.length;o<a;o++){var s=t[o],l=s.url;if(Array.isArray(l)){r[s.uuid]=[];for(var c=0,u=l.length;c<u;c++){var h=l[c],p=await i(h);null!==p&&(p instanceof HTMLImageElement?r[s.uuid].push(p):r[s.uuid].push(new io(p.data,p.width,p.height)))}}else{var d=await i(s.url);null!==d&&(r[s.uuid]=d)}}}return r},e.prototype.parseTextures=function(t,e){function n(t,e){return"number"==typeof t?t:e[t]}var r={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a=t[i];a.image,e[a.image];var s=void 0,l=e[a.image];Array.isArray(l)?(s=new $e(l),6===l.length&&(s.needsUpdate=!0)):(s=l&&l.data?new io(l.data,l.width,l.height):new T(l),l&&(s.needsUpdate=!0)),s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=n(a.mapping,ml)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=n(a.wrap[0],vl),s.wrapT=n(a.wrap[1],vl)),void 0!==a.format&&(s.format=a.format),void 0!==a.type&&(s.type=a.type),void 0!==a.encoding&&(s.encoding=a.encoding),void 0!==a.minFilter&&(s.minFilter=n(a.minFilter,gl)),void 0!==a.magFilter&&(s.magFilter=n(a.magFilter,gl)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(s.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(s.unpackAlignment=a.unpackAlignment),r[a.uuid]=s}return r},e.prototype.parseObject=function(t,e,n,r,i){var o,a,s;function l(t){return e[t],e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],r=0,i=t.length;r<i;r++){var o=t[r];n[o],e.push(n[o])}return e}return n[t],n[t]}}function u(t){return r[t],r[t]}switch(t.type){case"Scene":o=new Si,void 0!==t.background&&(Number.isInteger(t.background)?o.background=new $t(t.background):o.background=u(t.background)),void 0!==t.environment&&(o.environment=u(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?o.fog=new Ai(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(o.fog=new Mi(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":o=new Ke(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(o.focus=t.focus),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.filmGauge&&(o.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(o.filmOffset=t.filmOffset),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new nl(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"AmbientLight":o=new ol(t.color,t.intensity);break;case"DirectionalLight":o=new il(t.color,t.intensity);break;case"PointLight":o=new el(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new al(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new Qs(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new Vs(t.color,t.groundColor,t.intensity);break;case"LightProbe":o=(new ll).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),s=c(t.material),o=new no(a,s),void 0!==t.bindMode&&(o.bindMode=t.bindMode),void 0!==t.bindMatrix&&o.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(o.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),s=c(t.material),o=new We(a,s);break;case"InstancedMesh":a=l(t.geometry),s=c(t.material);var h=t.count,p=t.instanceMatrix,d=t.instanceColor;(o=new po(a,s,h)).instanceMatrix=new re(new Float32Array(p.array),16),void 0!==d&&(o.instanceColor=new re(new Float32Array(d.array),d.itemSize));break;case"LOD":o=new Qi;break;case"Line":o=new Eo(l(t.geometry),c(t.material));break;case"LineLoop":o=new Mo(l(t.geometry),c(t.material));break;case"LineSegments":o=new bo(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":o=new Do(l(t.geometry),c(t.material));break;case"Sprite":o=new Yi(c(t.material));break;case"Group":o=new gi;break;case"Bone":o=new ro;break;default:o=new Nt}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(o.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(o.matrixAutoUpdate=t.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.quaternion&&o.quaternion.fromArray(t.quaternion),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(o.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(o.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(o.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&o.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(o.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.frustumCulled&&(o.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(o.renderOrder=t.renderOrder),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.layers&&(o.layers.mask=t.layers),void 0!==t.children)for(var f=t.children,m=0;m<f.length;m++)o.add(this.parseObject(f[m],e,n,r,i));if(void 0!==t.animations)for(var v=t.animations,g=0;g<v.length;g++){var y=v[g];o.animations.push(i[y])}if("LOD"===t.type){void 0!==t.autoUpdate&&(o.autoUpdate=t.autoUpdate);for(var _=t.levels,E=0;E<_.length;E++){var T=_[E],x=o.getObjectByProperty("uuid",T.object);void 0!==x&&o.addLevel(x,T.distance)}}return o},e.prototype.bindSkeletons=function(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){var n=e[t.skeleton];void 0===n||t.bind(n,t.bindMatrix)}}))},e.prototype.setTexturePath=function(t){return this.setResourcePath(t)},e}(Cs),ml={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},vl={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},gl={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008},yl=function(t){function e(e){t.call(this,e),this.options={premultiplyAlpha:"none"}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setOptions=function(t){return this.options=t,this},e.prototype.load=function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=ws.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;var a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){ws.add(t,n),e&&e(n),i.manager.itemEnd(t)})).catch((function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)},e}(Cs);yl.prototype.isImageBitmapLoader=!0;var _l=function(){this.type="ShapePath",this.color=new $t,this.subPaths=[],this.currentPath=null};_l.prototype.moveTo=function(t,e){return this.currentPath=new zs,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},_l.prototype.lineTo=function(t,e){return this.currentPath.lineTo(t,e),this},_l.prototype.quadraticCurveTo=function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},_l.prototype.bezierCurveTo=function(t,e,n,r,i,o){return this.currentPath.bezierCurveTo(t,e,n,r,i,o),this},_l.prototype.splineThru=function(t){return this.currentPath.splineThru(t),this},_l.prototype.toShapes=function(t,e){function n(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],o=new Gs;o.curves=i.curves,e.push(o)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,o=0;o<n;i=o++){var a=e[i],s=e[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=e[o],l=-l,s=e[i],c=-c),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var u=c*(t.x-a.x)-l*(t.y-a.y);if(0===u)return!0;if(u<0)continue;r=!r}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return r}var i,o,a,s=Ba.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===e)return n(l);var c=[];if(1===l.length)return o=l[0],(a=new Gs).curves=o.curves,c.push(a),c;var u=!s(l[0].getPoints());u=t?!u:u;var h,p,d=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=l.length;g<y;g++)i=s(h=(o=l[g]).getPoints()),(i=t?!i:i)?(!u&&f[v]&&v++,f[v]={s:new Gs,p:h},f[v].s.curves=o.curves,u&&v++,m[v]=[]):m[v].push({h:o,p:h[0]});if(!f[0])return n(l);if(f.length>1){for(var _=!1,E=[],T=0,x=f.length;T<x;T++)d[T]=[];for(var b=0,M=f.length;b<M;b++)for(var A=m[b],S=0;S<A.length;S++){for(var O=A[S],w=!0,L=0;L<f.length;L++)r(O.p,f[L].p)&&(b!==L&&E.push({froms:b,tos:L,hole:S}),w?(w=!1,d[L].push(O)):_=!0);w&&d[b].push(O)}E.length>0&&(_||(m=d))}for(var D=0,C=f.length;D<C;D++){a=f[D].s,c.push(a);for(var P=0,N=(p=m[D]).length;P<N;P++)a.holes.push(p[P].h)}return c};var El=function(t){this.type="Font",this.data=t};function Tl(t,e,n,r,i){var o=i.glyphs[t]||i.glyphs["?"];if(o){var a,s,l,c,u,h,p,d,f=new _l;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),v=0,g=m.length;v<g;)switch(m[v++]){case"m":a=m[v++]*e+n,s=m[v++]*e+r,f.moveTo(a,s);break;case"l":a=m[v++]*e+n,s=m[v++]*e+r,f.lineTo(a,s);break;case"q":l=m[v++]*e+n,c=m[v++]*e+r,u=m[v++]*e+n,h=m[v++]*e+r,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[v++]*e+n,c=m[v++]*e+r,u=m[v++]*e+n,h=m[v++]*e+r,p=m[v++]*e+n,d=m[v++]*e+r,f.bezierCurveTo(u,h,p,d,l,c)}return{offsetX:o.ha*e,path:f}}}El.prototype.generateShapes=function(t,e){void 0===e&&(e=100);for(var n=[],r=function(t,e,n){for(var r=Array.from(t),i=e/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[],s=0,l=0,c=0;c<r.length;c++){var u=r[c];if("\n"===u)s=0,l-=o;else{var h=Tl(u,i,s,l,n);s+=h.offsetX,a.push(h.path)}}return a}(t,e,this.data),i=0,o=r.length;i<o;i++)Array.prototype.push.apply(n,r[i].toShapes());return n},El.prototype.isFont=!0;var xl,bl=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=this,o=new Ns(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,(function(t){var n;try{n=JSON.parse(t)}catch(e){n=JSON.parse(t.substring(65,t.length-2))}var r=i.parse(n);e&&e(r)}),n,r)},e.prototype.parse=function(t){return new El(t)},e}(Cs),Ml={getContext:function(){return void 0===xl&&(xl=new(window.AudioContext||window.webkitAudioContext)),xl},setContext:function(t){xl=t}},Al=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(t,e,n,r){var i=this,o=new Ns(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{var o=n.slice(0);Ml.getContext().decodeAudioData(o,(function(t){e(t)}))}catch(e){r&&r(e),i.manager.itemError(t)}}),n,r)},e}(Cs),Sl=function(t){function e(e,n,r){void 0===r&&(r=1),t.call(this,void 0,r);var i=(new $t).set(e),o=(new $t).set(n),a=new D(i.r,i.g,i.b),s=new D(o.r,o.g,o.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(s).multiplyScalar(l),this.sh.coefficients[1].copy(a).sub(s).multiplyScalar(c)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ll);Sl.prototype.isHemisphereLightProbe=!0;var Ol=function(t){function e(e,n){void 0===n&&(n=1),t.call(this,void 0,n);var r=(new $t).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ll);Ol.prototype.isAmbientLightProbe=!0;var wl=new st,Ll=new st,Dl=function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ke,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ke,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}};Dl.prototype.update=function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var n,r,i=t.projectionMatrix.clone(),a=e.eyeSep/2,s=a*e.near/e.focus,l=e.near*Math.tan(o*e.fov*.5)/e.zoom;Ll.elements[12]=-a,wl.elements[12]=a,n=-l*e.aspect+s,r=l*e.aspect+s,i.elements[0]=2*e.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-l*e.aspect-s,r=l*e.aspect-s,i.elements[0]=2*e.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Ll),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(wl)};var Cl=function(t){void 0===t&&(t=!0),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1};function Pl(){return("undefined"==typeof performance?Date:performance).now()}Cl.prototype.start=function(){this.startTime=Pl(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},Cl.prototype.stop=function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},Cl.prototype.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},Cl.prototype.getDelta=function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=Pl();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t};var Nl=new D,Rl=new w,Il=new D,Ul=new D,Bl=function(t){function e(){t.call(this),this.type="AudioListener",this.context=Ml.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Cl}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getInput=function(){return this.gain},e.prototype.removeFilter=function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},e.prototype.getFilter=function(){return this.filter},e.prototype.setFilter=function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},e.prototype.getMasterVolume=function(){return this.gain.gain.value},e.prototype.setMasterVolume=function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},e.prototype.updateMatrixWorld=function(e){t.prototype.updateMatrixWorld.call(this,e);var n=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Nl,Rl,Il),Ul.set(0,0,-1).applyQuaternion(Rl),n.positionX){var i=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Nl.x,i),n.positionY.linearRampToValueAtTime(Nl.y,i),n.positionZ.linearRampToValueAtTime(Nl.z,i),n.forwardX.linearRampToValueAtTime(Ul.x,i),n.forwardY.linearRampToValueAtTime(Ul.y,i),n.forwardZ.linearRampToValueAtTime(Ul.z,i),n.upX.linearRampToValueAtTime(r.x,i),n.upY.linearRampToValueAtTime(r.y,i),n.upZ.linearRampToValueAtTime(r.z,i)}else n.setPosition(Nl.x,Nl.y,Nl.z),n.setOrientation(Ul.x,Ul.y,Ul.z,r.x,r.y,r.z)},e}(Nt),Fl=function(t){function e(e){t.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getOutput=function(){return this.gain},e.prototype.setNodeSource=function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},e.prototype.setMediaElementSource=function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},e.prototype.setMediaStreamSource=function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},e.prototype.setBuffer=function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},e.prototype.play=function(t){if(void 0===t&&(t=0),!0!==this.isPlaying&&!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}},e.prototype.pause=function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this},e.prototype.stop=function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this},e.prototype.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this},e.prototype.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this},e.prototype.getFilters=function(){return this.filters},e.prototype.setFilters=function(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this},e.prototype.setDetune=function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},e.prototype.getDetune=function(){return this.detune},e.prototype.getFilter=function(){return this.getFilters()[0]},e.prototype.setFilter=function(t){return this.setFilters(t?[t]:[])},e.prototype.setPlaybackRate=function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},e.prototype.getPlaybackRate=function(){return this.playbackRate},e.prototype.onEnded=function(){this.isPlaying=!1},e.prototype.getLoop=function(){return!1!==this.hasPlaybackControl&&this.loop},e.prototype.setLoop=function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this},e.prototype.setLoopStart=function(t){return this.loopStart=t,this},e.prototype.setLoopEnd=function(t){return this.loopEnd=t,this},e.prototype.getVolume=function(){return this.gain.gain.value},e.prototype.setVolume=function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},e}(Nt),Hl=new D,kl=new w,zl=new D,Gl=new D,Wl=function(t){function e(e){t.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getOutput=function(){return this.panner},e.prototype.getRefDistance=function(){return this.panner.refDistance},e.prototype.setRefDistance=function(t){return this.panner.refDistance=t,this},e.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},e.prototype.setRolloffFactor=function(t){return this.panner.rolloffFactor=t,this},e.prototype.getDistanceModel=function(){return this.panner.distanceModel},e.prototype.setDistanceModel=function(t){return this.panner.distanceModel=t,this},e.prototype.getMaxDistance=function(){return this.panner.maxDistance},e.prototype.setMaxDistance=function(t){return this.panner.maxDistance=t,this},e.prototype.setDirectionalCone=function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},e.prototype.updateMatrixWorld=function(e){if(t.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Hl,kl,zl),Gl.set(0,0,1).applyQuaternion(kl);var n=this.panner;if(n.positionX){var r=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Hl.x,r),n.positionY.linearRampToValueAtTime(Hl.y,r),n.positionZ.linearRampToValueAtTime(Hl.z,r),n.orientationX.linearRampToValueAtTime(Gl.x,r),n.orientationY.linearRampToValueAtTime(Gl.y,r),n.orientationZ.linearRampToValueAtTime(Gl.z,r)}else n.setPosition(Hl.x,Hl.y,Hl.z),n.setOrientation(Gl.x,Gl.y,Gl.z)}},e}(Fl),Vl=function(t,e){void 0===e&&(e=2048),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)};Vl.prototype.getFrequencyData=function(){return this.analyser.getByteFrequencyData(this.data),this.data},Vl.prototype.getAverageFrequency=function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length};var jl=function(t,e,n){var r,i,o;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0};jl.prototype.accumulate=function(t,e){var n=this.buffer,r=this.valueSize,i=t*r+r,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==r;++a)n[i+a]=n[a];o=e}else{var s=e/(o+=e);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=o},jl.prototype.accumulateAdditive=function(t){var e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},jl.prototype.apply=function(t){var e=this.valueSize,n=this.buffer,r=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=e*this._origIndex;this._mixBufferRegion(n,r,s,1-i,e)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(var l=e,c=e+e;l!==c;++l)if(n[l]!==n[l+e]){a.setValue(n,r);break}},jl.prototype.saveOriginalState=function(){var t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(var i=n,o=r;i!==o;++i)e[i]=e[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},jl.prototype.restoreOriginalState=function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},jl.prototype._setAdditiveIdentityNumeric=function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize,n=t;n<e;n++)this.buffer[n]=0},jl.prototype._setAdditiveIdentityQuaternion=function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},jl.prototype._setAdditiveIdentityOther=function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]},jl.prototype._select=function(t,e,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)t[e+o]=t[n+o]},jl.prototype._slerp=function(t,e,n,r){w.slerpFlat(t,e,t,e,t,n,r)},jl.prototype._slerpAdditive=function(t,e,n,r,i){var o=this._workIndex*i;w.multiplyQuaternionsFlat(t,o,t,e,t,n),w.slerpFlat(t,e,t,e,t,o,r)},jl.prototype._lerp=function(t,e,n,r,i){for(var o=1-r,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[n+a]*r}},jl.prototype._lerpAdditive=function(t,e,n,r,i){for(var o=0;o!==i;++o){var a=e+o;t[a]=t[a]+t[n+o]*r}};var Yl=new RegExp("[\\[\\]\\.:\\/]","g"),Xl="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Zl=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),ql=/(WCOD+)?/.source.replace("WCOD",Xl),Ql=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Kl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Jl=new RegExp("^"+Zl+ql+Ql+Kl+"$"),$l=["material","materials","bones"],tc=function(t,e,n){var r=n||ec.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)};tc.prototype.getValue=function(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},tc.prototype.setValue=function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(t,e)},tc.prototype.bind=function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},tc.prototype.unbind=function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()};var ec=function t(e,n,r){this.path=n,this.parsedPath=r||t.parseTrackName(n),this.node=t.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound};ec.create=function(t,e,n){return t&&t.isAnimationObjectGroup?new ec.Composite(t,e,n):new ec(t,e,n)},ec.sanitizeNodeName=function(t){return t.replace(/\s/g,"_").replace(Yl,"")},ec.parseTrackName=function(t){var e=Jl.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==$l.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},ec.findNode=function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){var r=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i.name===e||i.uuid===e)return i;var o=r(i.children);if(o)return o}return null},i=r(t.children);if(i)return i}return null},ec.prototype._getValue_unavailable=function(){},ec.prototype._setValue_unavailable=function(){},ec.prototype._getValue_direct=function(t,e){t[e]=this.node[this.propertyName]},ec.prototype._getValue_array=function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]},ec.prototype._getValue_arrayElement=function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},ec.prototype._getValue_toArray=function(t,e){this.resolvedProperty.toArray(t,e)},ec.prototype._setValue_direct=function(t,e){this.targetObject[this.propertyName]=t[e]},ec.prototype._setValue_direct_setNeedsUpdate=function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},ec.prototype._setValue_direct_setMatrixWorldNeedsUpdate=function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0},ec.prototype._setValue_array=function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]},ec.prototype._setValue_array_setNeedsUpdate=function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.needsUpdate=!0},ec.prototype._setValue_array_setMatrixWorldNeedsUpdate=function(t,e){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0},ec.prototype._setValue_arrayElement=function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},ec.prototype._setValue_arrayElement_setNeedsUpdate=function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},ec.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate=function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0},ec.prototype._setValue_fromArray=function(t,e){this.resolvedProperty.fromArray(t,e)},ec.prototype._setValue_fromArray_setNeedsUpdate=function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},ec.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate=function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0},ec.prototype._getValue_unbound=function(t,e){this.bind(),this.getValue(t,e)},ec.prototype._setValue_unbound=function(t,e){this.bind(),this.setValue(t,e)},ec.prototype.bind=function(){var t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,i=e.propertyIndex;if(t||(t=ec.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(n){var o=e.objectIndex;switch(n){case"materials":if(!t.material)return;if(!t.material.materials)return;t=t.material.materials;break;case"bones":if(!t.skeleton)return;t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[n])return;t=t[n]}if(void 0!==o){if(void 0===t[o])return;t=t[o]}}var s=t[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!t.geometry)return;if(!t.geometry.isBufferGeometry)return;if(!t.geometry.morphAttributes)return;void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else e.nodeName}},ec.prototype.unbind=function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound},ec.Composite=tc,ec.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ec.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ec.prototype.GetterByBindingType=[ec.prototype._getValue_direct,ec.prototype._getValue_array,ec.prototype._getValue_arrayElement,ec.prototype._getValue_toArray],ec.prototype.SetterByBindingTypeAndVersioning=[[ec.prototype._setValue_direct,ec.prototype._setValue_direct_setNeedsUpdate,ec.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ec.prototype._setValue_array,ec.prototype._setValue_array_setNeedsUpdate,ec.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ec.prototype._setValue_arrayElement,ec.prototype._setValue_arrayElement_setNeedsUpdate,ec.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ec.prototype._setValue_fromArray,ec.prototype._setValue_fromArray_setNeedsUpdate,ec.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var nc=function(){var t=arguments;this.uuid=s(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var n=0,r=arguments.length;n!==r;++n)e[t[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}};nc.prototype.add=function(){for(var t=arguments,e=this._objects,n=this._indicesByUUID,r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length,s=e.length,l=this.nCachedObjects_,c=0,u=arguments.length;c!==u;++c){var h=t[c],p=h.uuid,d=n[p];if(void 0===d){d=s++,n[p]=d,e.push(h);for(var f=0,m=a;f!==m;++f)o[f].push(new ec(h,r[f],i[f]))}else if(d<l){e[d];var v=--l,g=e[v];n[g.uuid]=d,e[d]=g,n[p]=v,e[v]=h;for(var y=0,_=a;y!==_;++y){var E=o[y],T=E[v],x=E[d];E[d]=T,void 0===x&&(x=new ec(h,r[y],i[y])),E[v]=x}}else e[d]}this.nCachedObjects_=l},nc.prototype.remove=function(){for(var t=arguments,e=this._objects,n=this._indicesByUUID,r=this._bindings,i=r.length,o=this.nCachedObjects_,a=0,s=arguments.length;a!==s;++a){var l=t[a],c=l.uuid,u=n[c];if(void 0!==u&&u>=o){var h=o++,p=e[h];n[p.uuid]=u,e[u]=p,n[c]=h,e[h]=l;for(var d=0,f=i;d!==f;++d){var m=r[d],v=m[h],g=m[u];m[u]=v,m[h]=g}}}this.nCachedObjects_=o},nc.prototype.uncache=function(){for(var t=arguments,e=this._objects,n=this._indicesByUUID,r=this._bindings,i=r.length,o=this.nCachedObjects_,a=e.length,s=0,l=arguments.length;s!==l;++s){var c=t[s],u=c.uuid,h=n[u];if(void 0!==h)if(delete n[u],h<o){var p=--o,d=e[p],f=--a,m=e[f];n[d.uuid]=h,e[h]=d,n[m.uuid]=p,e[p]=m,e.pop();for(var v=0,g=i;v!==g;++v){var y=r[v],_=y[p],E=y[f];y[h]=_,y[p]=E,y.pop()}}else{var T=--a,x=e[T];T>0&&(n[x.uuid]=h),e[h]=x,e.pop();for(var b=0,M=i;b!==M;++b){var A=r[b];A[h]=A[T],A.pop()}}}this.nCachedObjects_=o},nc.prototype.subscribe_=function(t,e){var n=this._bindingsIndicesByPath,r=n[t],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);r=i.length,n[t]=r,o.push(t),a.push(e),i.push(u);for(var h=c,p=s.length;h!==p;++h){var d=s[h];u[h]=new ec(d,t,e)}return u},nc.prototype.unsubscribe_=function(t){var e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=n,o[n]=s,o.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}},nc.prototype.isAnimationObjectGroup=!0;var rc=function(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=e.blendMode),this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=r;for(var i=e.tracks,o=i.length,a=new Array(o),s={endingStart:2400,endingEnd:2400},l=0;l!==o;++l){var c=i[l].createInterpolant(null);a[l]=c,c.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0};rc.prototype.play=function(){return this._mixer._activateAction(this),this},rc.prototype.stop=function(){return this._mixer._deactivateAction(this),this.reset()},rc.prototype.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},rc.prototype.isRunning=function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},rc.prototype.isScheduled=function(){return this._mixer._isActiveAction(this)},rc.prototype.startAt=function(t){return this._startTime=t,this},rc.prototype.setLoop=function(t,e){return this.loop=t,this.repetitions=e,this},rc.prototype.setEffectiveWeight=function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},rc.prototype.getEffectiveWeight=function(){return this._effectiveWeight},rc.prototype.fadeIn=function(t){return this._scheduleFading(t,0,1)},rc.prototype.fadeOut=function(t){return this._scheduleFading(t,1,0)},rc.prototype.crossFadeFrom=function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var r=this._clip.duration,i=t._clip.duration,o=i/r,a=r/i;t.warp(1,o,e),this.warp(a,1,e)}return this},rc.prototype.crossFadeTo=function(t,e,n){return t.crossFadeFrom(this,e,n)},rc.prototype.stopFading=function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},rc.prototype.setEffectiveTimeScale=function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},rc.prototype.getEffectiveTimeScale=function(){return this._effectiveTimeScale},rc.prototype.setDuration=function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},rc.prototype.syncWith=function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},rc.prototype.halt=function(t){return this.warp(this._effectiveTimeScale,0,t)},rc.prototype.warp=function(t,e,n){var r=this._mixer,i=r.time,o=this.timeScale,a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,l=a.sampleValues;return s[0]=i,s[1]=i+n,l[0]=t/o,l[1]=e/o,this},rc.prototype.stopWarping=function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},rc.prototype.getMixer=function(){return this._mixer},rc.prototype.getClip=function(){return this._clip},rc.prototype.getRoot=function(){return this._localRoot||this._mixer._root},rc.prototype._update=function(t,e,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*n;if(o<0||0===n)return;this._startTime=null,e=n*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0){var l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case 2501:for(var u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(s);break;case 2500:default:for(var p=0,d=l.length;p!==d;++p)l[p].evaluate(a),c[p].accumulate(r,s)}}}else this._updateWeight(t)},rc.prototype._updateWeight=function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=e,e},rc.prototype._updateTimeScale=function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},rc.prototype._updateTime=function(t){var e=this._clip.duration,n=this.loop,r=this.time+t,i=this._loopCount,o=2202===n;if(0===t)return-1===i?r:o&&1==(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=e||r<0){var a=Math.floor(r/e);r-=e*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&1==(1&i))return e-r}return r},rc.prototype._setEndings=function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},rc.prototype._scheduleFading=function(t,e,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=n,this};var ic=function(t){function e(e){t.call(this),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._bindAction=function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,i=r.length,o=t._propertyBindings,a=t._interpolants,s=n.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==i;++u){var h=r[u],p=h.name,d=c[p];if(void 0!==d)o[u]=d;else{if(void 0!==(d=o[u])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=e&&e._propertyBindings[u].binding.parsedPath;++(d=new jl(ec.create(n,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),o[u]=d}a[u].resultBuffer=d.buffer}},e.prototype._activateAction=function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},e.prototype._deactivateAction=function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},e.prototype._initMemoryManager=function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},e.prototype._isActiveAction=function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},e.prototype._addInactiveAction=function(t,e,n){var r=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=r.length,r.push(t),o.actionByRoot[n]=t},e.prototype._removeInactiveAction=function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)},e.prototype._removeInactiveBindingsForAction=function(t){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.referenceCount&&this._removeInactiveBinding(i)}},e.prototype._lendAction=function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},e.prototype._takeBackAction=function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},e.prototype._addInactiveBinding=function(t,e,n){var r=this._bindingsByRootAndName,i=this._bindings,o=r[e];void 0===o&&(o={},r[e]=o),o[n]=t,t._cacheIndex=i.length,i.push(t)},e.prototype._removeInactiveBinding=function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[r],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete a[i],0===Object.keys(a).length&&delete o[r]},e.prototype._lendBinding=function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},e.prototype._takeBackBinding=function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,i=e[r];t._cacheIndex=r,e[r]=t,i._cacheIndex=n,e[n]=i},e.prototype._lendControlInterpolant=function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return void 0===n&&((n=new vs(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=n),n},e.prototype._takeBackControlInterpolant=function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,i=e[r];t.__cacheIndex=r,e[r]=t,i.__cacheIndex=n,e[n]=i},e.prototype.clipAction=function(t,e,n){var r=e||this._root,i=r.uuid,o="string"==typeof t?Ss.findByName(r,t):t,a=null!==o?o.uuid:t,s=this._actionsByClip[a],l=null;if(void 0===n&&(n=null!==o?o.blendMode:2500),void 0!==s){var c=s.actionByRoot[i];if(void 0!==c&&c.blendMode===n)return c;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;var u=new rc(this,o,e,n);return this._bindAction(u,l),this._addInactiveAction(u,a,i),u},e.prototype.existingAction=function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?Ss.findByName(n,t):t,o=i?i.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[r]||null},e.prototype.stopAllAction=function(){for(var t=this._actions,e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},e.prototype.update=function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,r=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==n;++a)e[a]._update(r,t,i,o);for(var s=this._bindings,l=this._nActiveBindings,c=0;c!==l;++c)s[c].apply(o);return this},e.prototype.setTime=function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},e.prototype.getRoot=function(){return this._root},e.prototype.uncacheClip=function(t){var e=this._actions,n=t.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete r[n]}},e.prototype.uncacheRoot=function(t){var e=t.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},e.prototype.uncacheAction=function(t,e){var n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))},e}(e);ic.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var oc=function(t){"string"==typeof t&&(t=arguments[1]),this.value=t};oc.prototype.clone=function(){return new oc(void 0===this.value.clone?this.value:this.value.clone())};var ac=function(t){function e(e,n,r){void 0===r&&(r=1),t.call(this,e,n),this.meshPerAttribute=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},e.prototype.clone=function(e){var n=t.prototype.clone.call(this,e);return n.meshPerAttribute=this.meshPerAttribute,n},e.prototype.toJSON=function(e){var n=t.prototype.toJSON.call(this,e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n},e}(Oi);ac.prototype.isInstancedInterleavedBuffer=!0;var sc=function(t,e,n,r,i){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0},lc={needsUpdate:{configurable:!0}};lc.needsUpdate.set=function(t){!0===t&&this.version++},sc.prototype.setBuffer=function(t){return this.buffer=t,this},sc.prototype.setType=function(t,e){return this.type=t,this.elementSize=e,this},sc.prototype.setItemSize=function(t){return this.itemSize=t,this},sc.prototype.setCount=function(t){return this.count=t,this},Object.defineProperties(sc.prototype,lc),sc.prototype.isGLBufferAttribute=!0;var cc=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=1/0),this.ray=new at(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new _t,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}};function uc(t,e){return t.distance-e.distance}function hc(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r)for(var i=t.children,o=0,a=i.length;o<a;o++)hc(i[o],e,n,!0)}cc.prototype.set=function(t,e){this.ray.set(t,e)},cc.prototype.setFromCamera=function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera&&(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e)},cc.prototype.intersectObject=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=[]),hc(t,this,n,e),n.sort(uc),n},cc.prototype.intersectObjects=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=[]);for(var r=0,i=t.length;r<i;r++)hc(t[r],this,n,e);return n.sort(uc),n};var pc=function(t,e,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),this.radius=t,this.phi=e,this.theta=n,this};pc.prototype.set=function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},pc.prototype.copy=function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},pc.prototype.makeSafe=function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},pc.prototype.setFromVector3=function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},pc.prototype.setFromCartesianCoords=function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(l(e/this.radius,-1,1))),this},pc.prototype.clone=function(){return(new this.constructor).copy(this)};var dc=function(t,e,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),this.radius=t,this.theta=e,this.y=n,this};dc.prototype.set=function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},dc.prototype.copy=function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},dc.prototype.setFromVector3=function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},dc.prototype.setFromCartesianCoords=function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this},dc.prototype.clone=function(){return(new this.constructor).copy(this)};var fc=new m,mc=function(t,e){void 0===t&&(t=new m(1/0,1/0)),void 0===e&&(e=new m(-1/0,-1/0)),this.min=t,this.max=e};mc.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},mc.prototype.setFromPoints=function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},mc.prototype.setFromCenterAndSize=function(t,e){var n=fc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},mc.prototype.clone=function(){return(new this.constructor).copy(this)},mc.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},mc.prototype.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},mc.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},mc.prototype.getCenter=function(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},mc.prototype.getSize=function(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},mc.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},mc.prototype.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},mc.prototype.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},mc.prototype.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},mc.prototype.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},mc.prototype.getParameter=function(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},mc.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},mc.prototype.clampPoint=function(t,e){return e.copy(t).clamp(this.min,this.max)},mc.prototype.distanceToPoint=function(t){return fc.copy(t).clamp(this.min,this.max).sub(t).length()},mc.prototype.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this},mc.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},mc.prototype.translate=function(t){return this.min.add(t),this.max.add(t),this},mc.prototype.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},mc.prototype.isBox2=!0;var vc=new D,gc=new D,yc=function(t,e){void 0===t&&(t=new D),void 0===e&&(e=new D),this.start=t,this.end=e};yc.prototype.set=function(t,e){return this.start.copy(t),this.end.copy(e),this},yc.prototype.copy=function(t){return this.start.copy(t.start),this.end.copy(t.end),this},yc.prototype.getCenter=function(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)},yc.prototype.delta=function(t){return t.subVectors(this.end,this.start)},yc.prototype.distanceSq=function(){return this.start.distanceToSquared(this.end)},yc.prototype.distance=function(){return this.start.distanceTo(this.end)},yc.prototype.at=function(t,e){return this.delta(e).multiplyScalar(t).add(this.start)},yc.prototype.closestPointToPointParameter=function(t,e){vc.subVectors(t,this.start),gc.subVectors(this.end,this.start);var n=gc.dot(gc),r=gc.dot(vc)/n;return e&&(r=l(r,0,1)),r},yc.prototype.closestPointToPoint=function(t,e,n){var r=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(r).add(this.start)},yc.prototype.applyMatrix4=function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},yc.prototype.equals=function(t){return t.start.equals(this.start)&&t.end.equals(this.end)},yc.prototype.clone=function(){return(new this.constructor).copy(this)};var _c=function(t){function e(e){t.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Nt);_c.prototype.isImmediateRenderObject=!0;var Ec=new D,Tc=function(t){function e(e,n){t.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;for(var r=new Ae,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],o=0,a=1;o<32;o++,a++){var s=o/32*Math.PI*2,l=a/32*Math.PI*2;i.push(Math.cos(s),Math.sin(s),1,Math.cos(l),Math.sin(l),1)}r.setAttribute("position",new de(i,3));var c=new fo({fog:!1,toneMapped:!1});this.cone=new bo(r,c),this.add(this.cone),this.update()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},e.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Ec.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ec),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},e}(Nt),xc=new D,bc=new st,Mc=new st,Ac=function(t){function e(e){for(var n=function t(e){var n=[];e&&e.isBone&&n.push(e);for(var r=0;r<e.children.length;r++)n.push.apply(n,t(e.children[r]));return n}(e),r=new Ae,i=[],o=[],a=new $t(0,0,1),s=new $t(0,1,0),l=0;l<n.length;l++){var c=n[l];c.parent&&c.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),o.push(a.r,a.g,a.b),o.push(s.r,s.g,s.b))}r.setAttribute("position",new de(i,3)),r.setAttribute("color",new de(o,3));var u=new fo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});t.call(this,r,u),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateMatrixWorld=function(e){var n=this.bones,r=this.geometry,i=r.getAttribute("position");Mc.copy(this.root.matrixWorld).invert();for(var o=0,a=0;o<n.length;o++){var s=n[o];s.parent&&s.parent.isBone&&(bc.multiplyMatrices(Mc,s.matrixWorld),xc.setFromMatrixPosition(bc),i.setXYZ(a,xc.x,xc.y,xc.z),bc.multiplyMatrices(Mc,s.parent.matrixWorld),xc.setFromMatrixPosition(bc),i.setXYZ(a+1,xc.x,xc.y,xc.z),a+=2)}r.getAttribute("position").needsUpdate=!0,t.prototype.updateMatrixWorld.call(this,e)},e}(bo),Sc=function(t){function e(e,n,r){var i=new Za(n,4,2),o=new te({wireframe:!0,fog:!1,toneMapped:!1});t.call(this,i,o),this.light=e,this.light.updateMatrixWorld(),this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},e.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},e}(We),Oc=new D,wc=new $t,Lc=new $t,Dc=function(t){function e(e,n,r){t.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new Va(n);i.rotateY(.5*Math.PI),this.material=new te({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);var o=i.getAttribute("position"),a=new Float32Array(3*o.count);i.setAttribute("color",new re(a,3)),this.add(new We(i,this.material)),this.update()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},e.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");wc.copy(this.light.color),Lc.copy(this.light.groundColor);for(var n=0,r=e.count;n<r;n++){var i=n<r/2?wc:Lc;e.setXYZ(n,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(Oc.setFromMatrixPosition(this.light.matrixWorld).negate())},e}(Nt),Cc=function(t){function e(e,n,r,i){void 0===e&&(e=10),void 0===n&&(n=10),void 0===r&&(r=4473924),void 0===i&&(i=8947848),r=new $t(r),i=new $t(i);for(var o=n/2,a=e/n,s=e/2,l=[],c=[],u=0,h=0,p=-s;u<=n;u++,p+=a){l.push(-s,0,p,s,0,p),l.push(p,0,-s,p,0,s);var d=u===o?r:i;d.toArray(c,h),h+=3,d.toArray(c,h),h+=3,d.toArray(c,h),h+=3,d.toArray(c,h),h+=3}var f=new Ae;f.setAttribute("position",new de(l,3)),f.setAttribute("color",new de(c,3));var m=new fo({vertexColors:!0,toneMapped:!1});t.call(this,f,m),this.type="GridHelper"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(bo),Pc=function(t){function e(e,n,r,i,o,a){void 0===e&&(e=10),void 0===n&&(n=16),void 0===r&&(r=8),void 0===i&&(i=64),void 0===o&&(o=4473924),void 0===a&&(a=8947848),o=new $t(o),a=new $t(a);for(var s=[],l=[],c=0;c<=n;c++){var u=c/n*(2*Math.PI),h=Math.sin(u)*e,p=Math.cos(u)*e;s.push(0,0,0),s.push(h,0,p);var d=1&c?o:a;l.push(d.r,d.g,d.b),l.push(d.r,d.g,d.b)}for(var f=0;f<=r;f++)for(var m=1&f?o:a,v=e-e/r*f,g=0;g<i;g++){var y=g/i*(2*Math.PI),_=Math.sin(y)*v,E=Math.cos(y)*v;s.push(_,0,E),l.push(m.r,m.g,m.b),y=(g+1)/i*(2*Math.PI),_=Math.sin(y)*v,E=Math.cos(y)*v,s.push(_,0,E),l.push(m.r,m.g,m.b)}var T=new Ae;T.setAttribute("position",new de(s,3)),T.setAttribute("color",new de(l,3));var x=new fo({vertexColors:!0,toneMapped:!1});t.call(this,T,x),this.type="PolarGridHelper"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(bo),Nc=new D,Rc=new D,Ic=new D,Uc=function(t){function e(e,n,r){t.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===n&&(n=1);var i=new Ae;i.setAttribute("position",new de([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));var o=new fo({fog:!1,toneMapped:!1});this.lightPlane=new Eo(i,o),this.add(this.lightPlane),(i=new Ae).setAttribute("position",new de([0,0,0,0,0,1],3)),this.targetLine=new Eo(i,o),this.add(this.targetLine),this.update()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},e.prototype.update=function(){Nc.setFromMatrixPosition(this.light.matrixWorld),Rc.setFromMatrixPosition(this.light.target.matrixWorld),Ic.subVectors(Rc,Nc),this.lightPlane.lookAt(Rc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Rc),this.targetLine.scale.z=Ic.length()},e}(Nt),Bc=new D,Fc=new Qe,Hc=function(t){function e(e){var n=new Ae,r=new fo({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],o=[],a={},s=new $t(16755200),l=new $t(16711680),c=new $t(43775),u=new $t(16777215),h=new $t(3355443);function p(t,e,n){d(t,n),d(e,n)}function d(t,e){i.push(0,0,0),o.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(i.length/3-1)}p("n1","n2",s),p("n2","n4",s),p("n4","n3",s),p("n3","n1",s),p("f1","f2",s),p("f2","f4",s),p("f4","f3",s),p("f3","f1",s),p("n1","f1",s),p("n2","f2",s),p("n3","f3",s),p("n4","f4",s),p("p","n1",l),p("p","n2",l),p("p","n3",l),p("p","n4",l),p("u1","u2",c),p("u2","u3",c),p("u3","u1",c),p("c","t",u),p("p","c",h),p("cn1","cn2",h),p("cn3","cn4",h),p("cf1","cf2",h),p("cf3","cf4",h),n.setAttribute("position",new de(i,3)),n.setAttribute("color",new de(o,3)),t.call(this,n,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(){var t=this.geometry,e=this.pointMap;Fc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),kc("c",e,t,Fc,0,0,-1),kc("t",e,t,Fc,0,0,1),kc("n1",e,t,Fc,-1,-1,-1),kc("n2",e,t,Fc,1,-1,-1),kc("n3",e,t,Fc,-1,1,-1),kc("n4",e,t,Fc,1,1,-1),kc("f1",e,t,Fc,-1,-1,1),kc("f2",e,t,Fc,1,-1,1),kc("f3",e,t,Fc,-1,1,1),kc("f4",e,t,Fc,1,1,1),kc("u1",e,t,Fc,.7,1.1,-1),kc("u2",e,t,Fc,-.7,1.1,-1),kc("u3",e,t,Fc,0,2,-1),kc("cf1",e,t,Fc,-1,0,1),kc("cf2",e,t,Fc,1,0,1),kc("cf3",e,t,Fc,0,-1,1),kc("cf4",e,t,Fc,0,1,1),kc("cn1",e,t,Fc,-1,0,-1),kc("cn2",e,t,Fc,1,0,-1),kc("cn3",e,t,Fc,0,-1,-1),kc("cn4",e,t,Fc,0,1,-1),t.getAttribute("position").needsUpdate=!0},e.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},e}(bo);function kc(t,e,n,r,i,o,a){Bc.set(i,o,a).unproject(r);var s=e[t];if(void 0!==s)for(var l=n.getAttribute("position"),c=0,u=s.length;c<u;c++)l.setXYZ(s[c],Bc.x,Bc.y,Bc.z)}var zc,Gc,Wc=new N,Vc=function(t){function e(e,n){void 0===n&&(n=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),o=new Ae;o.setIndex(new re(r,1)),o.setAttribute("position",new re(i,3)),t.call(this,o,new fo({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.update=function(t){if(void 0!==this.object&&Wc.setFromObject(this.object),!Wc.isEmpty()){var e=Wc.min,n=Wc.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},e.prototype.setFromObject=function(t){return this.object=t,this.update(),this},e.prototype.copy=function(e){return t.prototype.copy.call(this,e),this.object=e.object,this},e}(bo),jc=function(t){function e(e,n){void 0===n&&(n=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Ae;i.setIndex(new re(r,1)),i.setAttribute("position",new de([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),t.call(this,i,new fo({color:n,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateMatrixWorld=function(e){var n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),t.prototype.updateMatrixWorld.call(this,e))},e}(bo),Yc=function(t){function e(e,n,r){void 0===n&&(n=1),void 0===r&&(r=16776960);var i=r,o=new Ae;o.setAttribute("position",new de([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),t.call(this,o,new fo({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=n;var a=new Ae;a.setAttribute("position",new de([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new We(a,new te({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateMatrixWorld=function(e){var n=-this.plane.constant;Math.abs(n)<1e-8&&(n=1e-8),this.scale.set(.5*this.size,.5*this.size,n),this.children[0].material.side=n<0?1:0,this.lookAt(this.plane.normal),t.prototype.updateMatrixWorld.call(this,e)},e}(Eo),Xc=new D,Zc=function(t){function e(e,n,r,i,o,a){void 0===e&&(e=new D(0,0,1)),void 0===n&&(n=new D(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===o&&(o=.2*r),void 0===a&&(a=.2*o),t.call(this),this.type="ArrowHelper",void 0===zc&&((zc=new Ae).setAttribute("position",new de([0,0,0,0,1,0],3)),(Gc=new Bo(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(n),this.line=new Eo(zc,new fo({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new We(Gc,new te({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,o,a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Xc.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Xc,e)}},e.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},e.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},e.prototype.copy=function(e){return t.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},e}(Nt),qc=function(t){function e(e){void 0===e&&(e=1);var n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Ae;r.setAttribute("position",new de(n,3)),r.setAttribute("color",new de([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new fo({vertexColors:!0,toneMapped:!1});t.call(this,r,i),this.type="AxesHelper"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setColors=function(t,e,n){var r=new $t,i=this.geometry.attributes.color.array;return r.set(t),r.toArray(i,0),r.toArray(i,3),r.set(e),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this},e.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},e}(bo),Qc=new Float32Array(1),Kc=new Int32Array(Qc.buffer),Jc=function(){};Jc.toHalfFloat=function(t){Qc[0]=t;var e=Kc[0],n=e>>16&32768,r=e>>12&2047,i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&e):i<113?n|=((r|=2048)>>114-i)+(r>>113-i&1):(n|=i-112<<10|r>>1,n+=1&r)};var $c=Math.pow(2,8),tu=[.125,.215,.35,.446,.526,.582],eu=5+tu.length,nu={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},ru=new te({side:1,depthWrite:!1,depthTest:!1}),iu=new We(new je,ru),ou=new nl,au=yu(),su=au._lodPlanes,lu=au._sizeLods,cu=au._sigmas,uu=new $t,hu=null,pu=(1+Math.sqrt(5))/2,du=1/pu,fu=[new D(1,1,1),new D(-1,1,1),new D(1,1,-1),new D(-1,1,-1),new D(0,pu,du),new D(0,pu,-du),new D(du,0,pu),new D(-du,0,pu),new D(pu,du,0),new D(-pu,du,0)];function mu(t){var e=Math.max(t.r,t.g,t.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);return t.multiplyScalar(Math.pow(2,-n)),(n+128)/255}var vu=function(t){var e,n,r;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=(e=20,n=new Float32Array(e),r=new D(0,1,0),new rs({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r},inputEncoding:{value:nu[3e3]},outputEncoding:{value:nu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)};function gu(t){return void 0!==t&&1009===t.type&&(3e3===t.encoding||3001===t.encoding||3007===t.encoding)}function yu(){for(var t=[],e=[],n=[],r=8,i=0;i<eu;i++){var o=Math.pow(2,r);e.push(o);var a=1/o;i>4?a=tu[i-8+4-1]:0==i&&(a=0),n.push(a);for(var s=1/(o-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=new Float32Array(108),p=new Float32Array(72),d=new Float32Array(36),f=0;f<6;f++){var m=f%3*2/3-1,v=f>2?0:-1,g=[m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0];h.set(g,18*f),p.set(u,12*f);var y=[f,f,f,f,f,f];d.set(y,6*f)}var _=new Ae;_.setAttribute("position",new re(h,3)),_.setAttribute("uv",new re(p,2)),_.setAttribute("faceIndex",new re(d,1)),t.push(_),r>4&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function _u(t){var e=new A(3*$c,3*$c,t);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Eu(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function Tu(){var t=new m(1,1);return new rs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:nu[3e3]},outputEncoding:{value:nu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function xu(){return new rs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:nu[3e3]},outputEncoding:{value:nu[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}vu.prototype.fromScene=function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=.1),void 0===r&&(r=100),hu=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i},vu.prototype.fromEquirectangular=function(t){return this._fromTexture(t)},vu.prototype.fromCubemap=function(t){return this._fromTexture(t)},vu.prototype.compileCubemapShader=function(){null===this._cubemapShader&&(this._cubemapShader=xu(),this._compileMaterial(this._cubemapShader))},vu.prototype.compileEquirectangularShader=function(){null===this._equirectShader&&(this._equirectShader=Tu(),this._compileMaterial(this._equirectShader))},vu.prototype.dispose=function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var t=0;t<su.length;t++)su[t].dispose()},vu.prototype._cleanup=function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(hu),t.scissorTest=!1,Eu(t,0,0,t.width,t.height)},vu.prototype._fromTexture=function(t){hu=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},vu.prototype._allocateTargets=function(t){var e={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:gu(t)?t.encoding:3002,depthBuffer:!1},n=_u(e);return n.depthBuffer=!t,this._pingPongRenderTarget=_u(e),n},vu.prototype._compileMaterial=function(t){var e=new We(su[0],t);this._renderer.compile(e,ou)},vu.prototype._sceneToCubeUV=function(t,e,n,r){var i=new Ke(90,1,e,n),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,c=s.outputEncoding,u=s.toneMapping;s.getClearColor(uu),s.toneMapping=0,s.outputEncoding=3e3,s.autoClear=!1;var h=!1,p=t.background;if(p){if(p.isColor){ru.color.copy(p).convertSRGBToLinear(),t.background=null;var d=mu(ru.color);ru.opacity=d,h=!0}}else{ru.color.copy(uu).convertSRGBToLinear();var f=mu(ru.color);ru.opacity=f,h=!0}for(var m=0;m<6;m++){var v=m%3;0==v?(i.up.set(0,o[m],0),i.lookAt(a[m],0,0)):1==v?(i.up.set(0,0,o[m]),i.lookAt(0,a[m],0)):(i.up.set(0,o[m],0),i.lookAt(0,0,a[m])),Eu(r,v*$c,m>2?$c:0,$c,$c),s.setRenderTarget(r),h&&s.render(iu,i),s.render(t,i)}s.toneMapping=u,s.outputEncoding=c,s.autoClear=l},vu.prototype._textureToCubeUV=function(t,e){var n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=xu()):null==this._equirectShader&&(this._equirectShader=Tu());var r=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new We(su[0],r),o=r.uniforms;o.envMap.value=t,t.isCubeTexture||o.texelSize.value.set(1/t.image.width,1/t.image.height),o.inputEncoding.value=nu[t.encoding],o.outputEncoding.value=nu[e.texture.encoding],Eu(e,0,0,3*$c,2*$c),n.setRenderTarget(e),n.render(i,ou)},vu.prototype._applyPMREM=function(t){var e=this._renderer,n=e.autoClear;e.autoClear=!1;for(var r=1;r<eu;r++){var i=Math.sqrt(cu[r]*cu[r]-cu[r-1]*cu[r-1]),o=fu[(r-1)%fu.length];this._blur(t,r-1,r,i,o)}e.autoClear=n},vu.prototype._blur=function(t,e,n,r,i){var o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",i),this._halfBlur(o,t,n,n,r,"longitudinal",i)},vu.prototype._halfBlur=function(t,e,n,r,i,o,a){for(var s=this._renderer,l=this._blurMaterial,c=new We(su[r],l),u=l.uniforms,h=lu[n]-1,p=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,d=i/p,f=isFinite(i)?1+Math.floor(3*d):20,m=[],v=0,g=0;g<20;++g){var y=g/d,_=Math.exp(-y*y/2);m.push(_),0==g?v+=_:g<f&&(v+=2*_)}for(var E=0;E<m.length;E++)m[E]=m[E]/v;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a),u.dTheta.value=p,u.mipInt.value=8-n,u.inputEncoding.value=nu[t.texture.encoding],u.outputEncoding.value=nu[t.texture.encoding];var T=lu[r];Eu(e,3*Math.max(0,$c-2*T),(0===r?0:2*$c)+2*T*(r>4?r-8+4:0),3*T,2*T),s.setRenderTarget(e),s.render(c,ou)},Yo.create=function(t,e){return t.prototype=Object.create(Yo.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},zs.prototype.fromPoints=function(t){return this.setFromPoints(t)},Cc.prototype.setColors=function(){},Ac.prototype.update=function(){},Cs.prototype.extractUrlBase=function(t){return ul.extractUrlBase(t)},Cs.Handlers={add:function(){},get:function(){}},mc.prototype.center=function(t){return this.getCenter(t)},mc.prototype.empty=function(){return this.isEmpty()},mc.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},mc.prototype.size=function(t){return this.getSize(t)},N.prototype.center=function(t){return this.getCenter(t)},N.prototype.empty=function(){return this.isEmpty()},N.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},N.prototype.isIntersectionSphere=function(t){return this.intersectsSphere(t)},N.prototype.size=function(t){return this.getSize(t)},J.prototype.empty=function(){return this.isEmpty()},ln.prototype.setFromMatrix=function(t){return this.setFromProjectionMatrix(t)},yc.prototype.center=function(t){return this.getCenter(t)},y.prototype.flattenToArrayOffset=function(t,e){return this.toArray(t,e)},y.prototype.multiplyVector3=function(t){return t.applyMatrix3(this)},y.prototype.multiplyVector3Array=function(){},y.prototype.applyToBufferAttribute=function(t){return t.applyMatrix3(this)},y.prototype.applyToVector3Array=function(){},y.prototype.getInverse=function(t){return this.copy(t).invert()},st.prototype.extractPosition=function(t){return this.copyPosition(t)},st.prototype.flattenToArrayOffset=function(t,e){return this.toArray(t,e)},st.prototype.getPosition=function(){return(new D).setFromMatrixColumn(this,3)},st.prototype.setRotationFromQuaternion=function(t){return this.makeRotationFromQuaternion(t)},st.prototype.multiplyToArray=function(){},st.prototype.multiplyVector3=function(t){return t.applyMatrix4(this)},st.prototype.multiplyVector4=function(t){return t.applyMatrix4(this)},st.prototype.multiplyVector3Array=function(){},st.prototype.rotateAxis=function(t){t.transformDirection(this)},st.prototype.crossVector=function(t){return t.applyMatrix4(this)},st.prototype.translate=function(){},st.prototype.rotateX=function(){},st.prototype.rotateY=function(){},st.prototype.rotateZ=function(){},st.prototype.rotateByAxis=function(){},st.prototype.applyToBufferAttribute=function(t){return t.applyMatrix4(this)},st.prototype.applyToVector3Array=function(){},st.prototype.makeFrustum=function(t,e,n,r,i,o){return this.makePerspective(t,e,r,n,i,o)},st.prototype.getInverse=function(t){return this.copy(t).invert()},on.prototype.isIntersectionLine=function(t){return this.intersectsLine(t)},w.prototype.multiplyVector3=function(t){return t.applyQuaternion(this)},w.prototype.inverse=function(){return this.invert()},at.prototype.isIntersectionBox=function(t){return this.intersectsBox(t)},at.prototype.isIntersectionPlane=function(t){return this.intersectsPlane(t)},at.prototype.isIntersectionSphere=function(t){return this.intersectsSphere(t)},Vt.prototype.area=function(){return this.getArea()},Vt.prototype.barycoordFromPoint=function(t,e){return this.getBarycoord(t,e)},Vt.prototype.midpoint=function(t){return this.getMidpoint(t)},Vt.prototypenormal=function(t){return this.getNormal(t)},Vt.prototype.plane=function(t){return this.getPlane(t)},Vt.barycoordFromPoint=function(t,e,n,r,i){return Vt.getBarycoord(t,e,n,r,i)},Vt.normal=function(t,e,n,r){return Vt.getNormal(t,e,n,r)},Gs.prototype.extractAllPoints=function(t){return this.extractPoints(t)},Gs.prototype.extrude=function(t){return new ka(this,t)},Gs.prototype.makeGeometry=function(t){return new Xa(this,t)},m.prototype.fromAttribute=function(t,e,n){return this.fromBufferAttribute(t,e,n)},m.prototype.distanceToManhattan=function(t){return this.manhattanDistanceTo(t)},m.prototype.lengthManhattan=function(){return this.manhattanLength()},D.prototype.setEulerFromRotationMatrix=function(){},D.prototype.setEulerFromQuaternion=function(){},D.prototype.getPositionFromMatrix=function(t){return this.setFromMatrixPosition(t)},D.prototype.getScaleFromMatrix=function(t){return this.setFromMatrixScale(t)},D.prototype.getColumnFromMatrix=function(t,e){return this.setFromMatrixColumn(e,t)},D.prototype.applyProjection=function(t){return this.applyMatrix4(t)},D.prototype.fromAttribute=function(t,e,n){return this.fromBufferAttribute(t,e,n)},D.prototype.distanceToManhattan=function(t){return this.manhattanDistanceTo(t)},D.prototype.lengthManhattan=function(){return this.manhattanLength()},b.prototype.fromAttribute=function(t,e,n){return this.fromBufferAttribute(t,e,n)},b.prototype.lengthManhattan=function(){return this.manhattanLength()},Nt.prototype.getChildByName=function(t){return this.getObjectByName(t)},Nt.prototype.renderDepth=function(){},Nt.prototype.translate=function(t,e){return this.translateOnAxis(e,t)},Nt.prototype.getWorldRotation=function(){},Nt.prototype.applyMatrix=function(t){return this.applyMatrix4(t)},Object.defineProperties(Nt.prototype,{eulerOrder:{get:function(){return this.rotation.order},set:function(t){this.rotation.order=t}},useQuaternion:{get:function(){},set:function(){}}}),We.prototype.setDrawMode=function(){},Object.defineProperties(We.prototype,{drawMode:{get:function(){return 0},set:function(){}}}),no.prototype.initBones=function(){},Ke.prototype.setLens=function(t,e){void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Ws.prototype,{onlyShadow:{set:function(){}},shadowCameraFov:{set:function(t){this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){}},shadowBias:{set:function(t){this.shadow.bias=t}},shadowDarkness:{set:function(){}},shadowMapWidth:{set:function(t){this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){this.shadow.mapSize.height=t}}}),Object.defineProperties(re.prototype,{length:{get:function(){return this.array.length}},dynamic:{get:function(){return 35048===this.usage},set:function(){this.setUsage(35048)}}}),re.prototype.setDynamic=function(t){return this.setUsage(!0===t?35048:35044),this},re.prototype.copyIndicesArray=function(){},re.prototype.setArray=function(){},Ae.prototype.addIndex=function(t){this.setIndex(t)},Ae.prototype.addAttribute=function(t,e){return e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(this.setIndex(e),this):this.setAttribute(t,e):this.setAttribute(t,new re(arguments[1],arguments[2]))},Ae.prototype.addDrawCall=function(t,e,n){this.addGroup(t,e)},Ae.prototype.clearDrawCalls=function(){this.clearGroups()},Ae.prototype.computeOffsets=function(){},Ae.prototype.removeAttribute=function(t){return this.deleteAttribute(t)},Ae.prototype.applyMatrix=function(t){return this.applyMatrix4(t)},Object.defineProperties(Ae.prototype,{drawcalls:{get:function(){return this.groups}},offsets:{get:function(){return this.groups}}}),Oi.prototype.setDynamic=function(t){return this.setUsage(!0===t?35048:35044),this},Oi.prototype.setArray=function(){},ka.prototype.getArrays=function(){},ka.prototype.addShapeList=function(){},ka.prototype.addShape=function(){},Si.prototype.dispose=function(){},oc.prototype.onUpdate=function(){return this},Object.defineProperties(Yt.prototype,{wrapAround:{get:function(){},set:function(){}},overdraw:{get:function(){},set:function(){}},wrapRGB:{get:function(){return new $t}},shading:{get:function(){},set:function(t){this.flatShading=1===t}},stencilMask:{get:function(){return this.stencilFuncMask},set:function(t){this.stencilFuncMask=t}}}),Object.defineProperties(qe.prototype,{derivatives:{get:function(){return this.extensions.derivatives},set:function(t){this.extensions.derivatives=t}}}),xi.prototype.clearTarget=function(t,e,n,r){this.setRenderTarget(t),this.clear(e,n,r)},xi.prototype.animate=function(t){this.setAnimationLoop(t)},xi.prototype.getCurrentRenderTarget=function(){return this.getRenderTarget()},xi.prototype.getMaxAnisotropy=function(){return this.capabilities.getMaxAnisotropy()},xi.prototype.getPrecision=function(){return this.capabilities.precision},xi.prototype.resetGLState=function(){return this.state.reset()},xi.prototype.supportsFloatTextures=function(){return this.extensions.get("OES_texture_float")},xi.prototype.supportsHalfFloatTextures=function(){return this.extensions.get("OES_texture_half_float")},xi.prototype.supportsStandardDerivatives=function(){return this.extensions.get("OES_standard_derivatives")},xi.prototype.supportsCompressedTextureS3TC=function(){return this.extensions.get("WEBGL_compressed_texture_s3tc")},xi.prototype.supportsCompressedTexturePVRTC=function(){return this.extensions.get("WEBGL_compressed_texture_pvrtc")},xi.prototype.supportsBlendMinMax=function(){return this.extensions.get("EXT_blend_minmax")},xi.prototype.supportsVertexTextures=function(){return this.capabilities.vertexTextures},xi.prototype.supportsInstancedArrays=function(){return this.extensions.get("ANGLE_instanced_arrays")},xi.prototype.enableScissorTest=function(t){this.setScissorTest(t)},xi.prototype.initMaterial=function(){},xi.prototype.addPrePlugin=function(){},xi.prototype.addPostPlugin=function(){},xi.prototype.updateShadowMap=function(){},xi.prototype.setFaceCulling=function(){},xi.prototype.allocTextureUnit=function(){},xi.prototype.setTexture=function(){},xi.prototype.setTexture2D=function(){},xi.prototype.setTextureCube=function(){},xi.prototype.getActiveMipMapLevel=function(){return this.getActiveMipmapLevel()},Object.defineProperties(xi.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){this.shadowMap.type=t}},shadowMapCullFace:{get:function(){},set:function(){}},context:{get:function(){return this.getContext()}},vr:{get:function(){return this.xr}},gammaInput:{get:function(){return!1},set:function(){}},gammaOutput:{get:function(){return!1},set:function(t){this.outputEncoding=!0===t?3001:3e3}},toneMappingWhitePoint:{get:function(){return 1},set:function(){}}}),Object.defineProperties(pi.prototype,{cullFace:{get:function(){},set:function(){}},renderReverseSided:{get:function(){},set:function(){}},renderSingleSided:{get:function(){},set:function(){}}}),Object.defineProperties(A.prototype,{wrapS:{get:function(){return this.texture.wrapS},set:function(t){this.texture.wrapS=t}},wrapT:{get:function(){return this.texture.wrapT},set:function(t){this.texture.wrapT=t}},magFilter:{get:function(){return this.texture.magFilter},set:function(t){this.texture.magFilter=t}},minFilter:{get:function(){return this.texture.minFilter},set:function(t){this.texture.minFilter=t}},anisotropy:{get:function(){return this.texture.anisotropy},set:function(t){this.texture.anisotropy=t}},offset:{get:function(){return this.texture.offset},set:function(t){this.texture.offset=t}},repeat:{get:function(){return this.texture.repeat},set:function(t){this.texture.repeat=t}},format:{get:function(){return this.texture.format},set:function(t){this.texture.format=t}},type:{get:function(){return this.texture.type},set:function(t){this.texture.type=t}},generateMipmaps:{get:function(){return this.texture.generateMipmaps},set:function(t){this.texture.generateMipmaps=t}}}),Fl.prototype.load=function(t){var e=this;return(new Al).load(t,(function(t){e.setBuffer(t)})),this},Vl.prototype.getData=function(){return this.getFrequencyData()},Je.prototype.updateCubeMap=function(t,e){return this.update(t,e)},Je.prototype.clear=function(t,e,n,r){return this.renderTarget.clear(t,e,n,r)},_.crossOrigin=void 0,_.loadTexture=function(t,e,n,r){var i=new Hs;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},_.loadTextureCube=function(t,e,n,r){var i=new Bs;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,n,void 0,r);return e&&(o.mapping=e),o},_.loadCompressedTexture=function(){},_.loadCompressedTextureCube=function(){},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"130"}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__="130")),t.ACESFilmicToneMapping=4,t.AddEquation=100,t.AddOperation=2,t.AdditiveAnimationBlendMode=2501,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=ol,t.AmbientLightProbe=Ol,t.AnimationClip=Ss,t.AnimationLoader=Rs,t.AnimationMixer=ic,t.AnimationObjectGroup=nc,t.AnimationUtils=ds,t.ArcCurve=Zo,t.ArrayCamera=vi,t.ArrowHelper=Zc,t.Audio=Fl,t.AudioAnalyser=Vl,t.AudioContext=Ml,t.AudioListener=Bl,t.AudioLoader=Al,t.AxesHelper=qc,t.AxisHelper=function(t){return new qc(t)},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BinaryTextureLoader=function(t){return new Fs(t)},t.Bone=ro,t.BooleanKeyframeTrack=_s,t.BoundingBoxHelper=function(t,e){return new Vc(t,e)},t.Box2=mc,t.Box3=N,t.Box3Helper=jc,t.BoxBufferGeometry=je,t.BoxGeometry=je,t.BoxHelper=Vc,t.BufferAttribute=re,t.BufferGeometry=Ae,t.BufferGeometryLoader=dl,t.ByteType=1010,t.Cache=ws,t.Camera=Qe,t.CameraHelper=Hc,t.CanvasRenderer=function(){},t.CanvasTexture=Ro,t.CatmullRomCurve3=ta,t.CineonToneMapping=3,t.CircleBufferGeometry=Uo,t.CircleGeometry=Uo,t.ClampToEdgeWrapping=1001,t.Clock=Cl,t.Color=$t,t.ColorKeyframeTrack=Es,t.CompressedTexture=No,t.CompressedTextureLoader=Is,t.ConeBufferGeometry=Fo,t.ConeGeometry=Fo,t.CubeCamera=Je,t.CubeReflectionMapping=301,t.CubeRefractionMapping=302,t.CubeTexture=$e,t.CubeTextureLoader=Bs,t.CubeUVReflectionMapping=306,t.CubeUVRefractionMapping=307,t.CubicBezierCurve=ia,t.CubicBezierCurve3=oa,t.CubicInterpolant=ms,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=Yo,t.CurvePath=ks,t.CustomBlending=5,t.CustomToneMapping=5,t.CylinderBufferGeometry=Bo,t.CylinderGeometry=Bo,t.Cylindrical=dc,t.DataTexture=io,t.DataTexture2DArray=Ln,t.DataTexture3D=Dn,t.DataTextureLoader=Fs,t.DataUtils=Jc,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=Ds,t.DepthFormat=1026,t.DepthStencilFormat=1027,t.DepthTexture=Io,t.DirectionalLight=il,t.DirectionalLightHelper=Uc,t.DiscreteInterpolant=gs,t.DodecahedronBufferGeometry=ko,t.DodecahedronGeometry=ko,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicBufferAttribute=function(t,e){return new re(t,e).setUsage(35048)},t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=jo,t.EdgesHelper=function(t,e){return new bo(new jo(t.geometry),new fo({color:void 0!==e?e:16777215}))},t.EllipseCurve=Xo,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=303,t.EquirectangularRefractionMapping=304,t.Euler=gt,t.EventDispatcher=e,t.ExtrudeBufferGeometry=ka,t.ExtrudeGeometry=ka,t.FaceColors=1,t.FileLoader=Ns,t.FlatShading=1,t.Float16BufferAttribute=pe,t.Float32Attribute=function(t,e){return new de(t,e)},t.Float32BufferAttribute=de,t.Float64Attribute=function(t,e){return new fe(t,e)},t.Float64BufferAttribute=fe,t.FloatType=1015,t.Fog=Ai,t.FogExp2=Mi,t.Font=El,t.FontLoader=bl,t.FrontSide=0,t.Frustum=ln,t.GLBufferAttribute=sc,t.GLSL1="100",t.GLSL3="300 es",t.GammaEncoding=3007,t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=Cc,t.Group=gi,t.HalfFloatType=1016,t.HemisphereLight=Vs,t.HemisphereLightHelper=Dc,t.HemisphereLightProbe=Sl,t.IcosahedronBufferGeometry=Ga,t.IcosahedronGeometry=Ga,t.ImageBitmapLoader=yl,t.ImageLoader=Us,t.ImageUtils=_,t.ImmediateRenderObject=_c,t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=pl,t.InstancedBufferGeometry=hl,t.InstancedInterleavedBuffer=ac,t.InstancedMesh=po,t.Int16Attribute=function(t,e){return new le(t,e)},t.Int16BufferAttribute=le,t.Int32Attribute=function(t,e){return new ue(t,e)},t.Int32BufferAttribute=ue,t.Int8Attribute=function(t,e){return new oe(t,e)},t.Int8BufferAttribute=oe,t.IntType=1013,t.InterleavedBuffer=Oi,t.InterleavedBufferAttribute=Di,t.Interpolant=fs,t.InterpolateDiscrete=2300,t.InterpolateLinear=2301,t.InterpolateSmooth=2302,t.InvertStencilOp=5386,t.JSONLoader=function(){},t.KeepStencilOp=7680,t.KeyframeTrack=ys,t.LOD=Qi,t.LatheBufferGeometry=Wa,t.LatheGeometry=Wa,t.Layers=_t,t.LensFlare=function(){},t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=Ws,t.LightProbe=ll,t.Line=Eo,t.Line3=yc,t.LineBasicMaterial=fo,t.LineCurve=aa,t.LineCurve3=sa,t.LineDashedMaterial=hs,t.LineLoop=Mo,t.LinePieces=1,t.LineSegments=bo,t.LineStrip=0,t.LinearEncoding=3e3,t.LinearFilter=1006,t.LinearInterpolant=vs,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=1008,t.LinearMipmapNearestFilter=1007,t.LinearToneMapping=1,t.Loader=Cs,t.LoaderUtils=ul,t.LoadingManager=Ls,t.LogLuvEncoding=3003,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=Yt,t.MaterialLoader=cl,t.Math=f,t.MathUtils=f,t.Matrix3=y,t.Matrix4=st,t.MaxEquation=104,t.Mesh=We,t.MeshBasicMaterial=te,t.MeshDepthMaterial=ui,t.MeshDistanceMaterial=hi,t.MeshFaceMaterial=function(t){return t},t.MeshLambertMaterial=cs,t.MeshMatcapMaterial=us,t.MeshNormalMaterial=ls,t.MeshPhongMaterial=as,t.MeshPhysicalMaterial=os,t.MeshStandardMaterial=is,t.MeshToonMaterial=ss,t.MinEquation=103,t.MirroredRepeatWrapping=1002,t.MixOperation=1,t.MultiMaterial=function(t){return void 0===t&&(t=[]),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=1003,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=1005,t.NearestMipmapNearestFilter=1004,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColors=0,t.NoToneMapping=0,t.NormalAnimationBlendMode=2500,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=Ts,t.Object3D=Nt,t.ObjectLoader=fl,t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=Va,t.OctahedronGeometry=Va,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=nl,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=vu,t.ParametricBufferGeometry=ja,t.ParametricGeometry=ja,t.Particle=function(t){return new Yi(t)},t.ParticleBasicMaterial=function(t){return new Ao(t)},t.ParticleSystem=function(t,e){return new Do(t,e)},t.ParticleSystemMaterial=function(t){return new Ao(t)},t.Path=zs,t.PerspectiveCamera=Ke,t.Plane=on,t.PlaneBufferGeometry=hn,t.PlaneGeometry=hn,t.PlaneHelper=Yc,t.PointCloud=function(t,e){return new Do(t,e)},t.PointCloudMaterial=function(t){return new Ao(t)},t.PointLight=el,t.PointLightHelper=Sc,t.Points=Do,t.PointsMaterial=Ao,t.PolarGridHelper=Pc,t.PolyhedronBufferGeometry=Ho,t.PolyhedronGeometry=Ho,t.PositionalAudio=Wl,t.PropertyBinding=ec,t.PropertyMixer=jl,t.QuadraticBezierCurve=la,t.QuadraticBezierCurve3=ca,t.Quaternion=w,t.QuaternionKeyframeTrack=bs,t.QuaternionLinearInterpolant=xs,t.REVISION="130",t.RGBADepthPacking=3201,t.RGBAFormat=1023,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=37819,t.RGBA_ASTC_10x5_Format=37816,t.RGBA_ASTC_10x6_Format=37817,t.RGBA_ASTC_10x8_Format=37818,t.RGBA_ASTC_12x10_Format=37820,t.RGBA_ASTC_12x12_Format=37821,t.RGBA_ASTC_4x4_Format=37808,t.RGBA_ASTC_5x4_Format=37809,t.RGBA_ASTC_5x5_Format=37810,t.RGBA_ASTC_6x5_Format=37811,t.RGBA_ASTC_6x6_Format=37812,t.RGBA_ASTC_8x5_Format=37813,t.RGBA_ASTC_8x6_Format=37814,t.RGBA_ASTC_8x8_Format=37815,t.RGBA_BPTC_Format=36492,t.RGBA_ETC2_EAC_Format=37496,t.RGBA_PVRTC_2BPPV1_Format=35843,t.RGBA_PVRTC_4BPPV1_Format=35842,t.RGBA_S3TC_DXT1_Format=33777,t.RGBA_S3TC_DXT3_Format=33778,t.RGBA_S3TC_DXT5_Format=33779,t.RGBDEncoding=3006,t.RGBEEncoding=3002,t.RGBEFormat=1023,t.RGBFormat=1022,t.RGBIntegerFormat=1032,t.RGBM16Encoding=3005,t.RGBM7Encoding=3004,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=37492,t.RGB_PVRTC_2BPPV1_Format=35841,t.RGB_PVRTC_4BPPV1_Format=35840,t.RGB_S3TC_DXT1_Format=33776,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=rs,t.Ray=at,t.Raycaster=cc,t.RectAreaLight=al,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RepeatWrapping=1e3,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=Ya,t.RingGeometry=Ya,t.SRGB8_ALPHA8_ASTC_10x10_Format=37851,t.SRGB8_ALPHA8_ASTC_10x5_Format=37848,t.SRGB8_ALPHA8_ASTC_10x6_Format=37849,t.SRGB8_ALPHA8_ASTC_10x8_Format=37850,t.SRGB8_ALPHA8_ASTC_12x10_Format=37852,t.SRGB8_ALPHA8_ASTC_12x12_Format=37853,t.SRGB8_ALPHA8_ASTC_4x4_Format=37840,t.SRGB8_ALPHA8_ASTC_5x4_Format=37841,t.SRGB8_ALPHA8_ASTC_5x5_Format=37842,t.SRGB8_ALPHA8_ASTC_6x5_Format=37843,t.SRGB8_ALPHA8_ASTC_6x6_Format=37844,t.SRGB8_ALPHA8_ASTC_8x5_Format=37845,t.SRGB8_ALPHA8_ASTC_8x6_Format=37846,t.SRGB8_ALPHA8_ASTC_8x8_Format=37847,t.Scene=Si,t.SceneUtils={createMultiMaterialObject:function(){},detach:function(){},attach:function(){}},t.ShaderChunk=pn,t.ShaderLib=fn,t.ShaderMaterial=qe,t.ShadowMaterial=ns,t.Shape=Gs,t.ShapeBufferGeometry=Xa,t.ShapeGeometry=Xa,t.ShapePath=_l,t.ShapeUtils=Ba,t.ShortType=1011,t.Skeleton=so,t.SkeletonHelper=Ac,t.SkinnedMesh=no,t.SmoothShading=2,t.Sphere=J,t.SphereBufferGeometry=Za,t.SphereGeometry=Za,t.Spherical=pc,t.SphericalHarmonics3=sl,t.SplineCurve=ua,t.SpotLight=Qs,t.SpotLightHelper=Tc,t.Sprite=Yi,t.SpriteMaterial=Ni,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=35044,t.StaticReadUsage=35045,t.StereoCamera=Dl,t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=Ms,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=qa,t.TetrahedronGeometry=qa,t.TextBufferGeometry=Qa,t.TextGeometry=Qa,t.Texture=T,t.TextureLoader=Hs,t.TorusBufferGeometry=Ka,t.TorusGeometry=Ka,t.TorusKnotBufferGeometry=Ja,t.TorusKnotGeometry=Ja,t.Triangle=Vt,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=$a,t.TubeGeometry=$a,t.UVMapping=300,t.Uint16Attribute=function(t,e){return new ce(t,e)},t.Uint16BufferAttribute=ce,t.Uint32Attribute=function(t,e){return new he(t,e)},t.Uint32BufferAttribute=he,t.Uint8Attribute=function(t,e){return new ae(t,e)},t.Uint8BufferAttribute=ae,t.Uint8ClampedAttribute=function(t,e){return new se(t,e)},t.Uint8ClampedBufferAttribute=se,t.Uniform=oc,t.UniformsLib=dn,t.UniformsUtils=Ze,t.UnsignedByteType=1009,t.UnsignedInt248Type=1020,t.UnsignedIntType=1014,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShort565Type=1019,t.UnsignedShortType=1012,t.VSMShadowMap=3,t.Vector2=m,t.Vector3=D,t.Vector4=b,t.VectorKeyframeTrack=As,t.Vertex=function(t,e,n){return new D(t,e,n)},t.VertexColors=2,t.VideoTexture=Po,t.WebGL1Renderer=bi,t.WebGLCubeRenderTarget=tn,t.WebGLMultipleRenderTargets=S,t.WebGLMultisampleRenderTarget=O,t.WebGLRenderTarget=A,t.WebGLRenderTargetCube=function(t,e,n){return new tn(t,n)},t.WebGLRenderer=xi,t.WebGLUtils=mi,t.WireframeGeometry=ts,t.WireframeHelper=function(t,e){return new bo(new ts(t.geometry),new fo({color:void 0!==e?e:16777215}))},t.WrapAroundEnding=2402,t.XHRLoader=function(t){return new Ns(t)},t.ZeroCurvatureEnding=2400,t.ZeroFactor=200,t.ZeroSlopeEnding=2401,t.ZeroStencilOp=0,t.sRGBEncoding=3001,Object.defineProperty(t,"__esModule",{value:!0})}(e)}));(O=L).LineSegmentsGeometry=function(){O.InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new O.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new O.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))},O.LineSegmentsGeometry.prototype=Object.assign(Object.create(O.InstancedBufferGeometry.prototype),{constructor:O.LineSegmentsGeometry,isLineSegmentsGeometry:!0,applyMatrix4:function(t){var e=this.attributes.instanceStart,n=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),n.applyMatrix4(t),e.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new O.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new O.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceEnd",new O.InterleavedBufferAttribute(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var n=new O.InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new O.InterleavedBufferAttribute(n,3,0)),this.setAttribute("instanceColorEnd",new O.InterleavedBufferAttribute(n,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new O.WireframeGeometry(t.geometry)),this},fromLineSegments:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},computeBoundingBox:(S=new O.Box3,function(){null===this.boundingBox&&(this.boundingBox=new O.Box3);var t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),S.setFromBufferAttribute(e),this.boundingBox.union(S))}),computeBoundingSphere:(A=new O.Vector3,function(){null===this.boundingSphere&&(this.boundingSphere=new O.Sphere),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){var n=this.boundingSphere.center;this.boundingBox.getCenter(n);for(var r=0,i=0,o=t.count;i<o;i++)A.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(A)),A.fromBufferAttribute(e,i),r=Math.max(r,n.distanceToSquared(A));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)}}),toJSON:function(){},applyMatrix:function(t){return this.applyMatrix4(t)}}),function(){var t=L;t.LineGeometry=function(){t.LineSegmentsGeometry.call(this),this.type="LineGeometry"},t.LineGeometry.prototype=Object.assign(Object.create(t.LineSegmentsGeometry.prototype),{constructor:t.LineGeometry,isLineGeometry:!0,setPositions:function(e){for(var n=e.length-3,r=new Float32Array(2*n),i=0;i<n;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return t.LineSegmentsGeometry.prototype.setPositions.call(this,r),this},setColors:function(e){for(var n=e.length-3,r=new Float32Array(2*n),i=0;i<n;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return t.LineSegmentsGeometry.prototype.setColors.call(this,r),this},fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.attributes.position.array),this},copy:function(){return this}})}(),function(){var t=L;t.UniformsLib.line={linewidth:{value:1},resolution:{value:new t.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1},opacity:{value:1}},t.ShaderLib.line={uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.fog,t.UniformsLib.line]),vertexShader:"\n\t\t\t#include <common>\n\t\t\t#include <color_pars_vertex>\n\t\t\t#include <fog_pars_vertex>\n\t\t\t#include <logdepthbuf_pars_vertex>\n\t\t\t#include <clipping_planes_pars_vertex>\n\t\n\t\t\tuniform float linewidth;\n\t\t\tuniform vec2 resolution;\n\t\n\t\t\tattribute vec3 instanceStart;\n\t\t\tattribute vec3 instanceEnd;\n\t\n\t\t\tattribute vec3 instanceColorStart;\n\t\t\tattribute vec3 instanceColorEnd;\n\t\n\t\t\tvarying vec2 vUv;\n\t\n\t\t\t#ifdef USE_DASH\n\t\n\t\t\t\tuniform float dashScale;\n\t\t\t\tattribute float instanceDistanceStart;\n\t\t\t\tattribute float instanceDistanceEnd;\n\t\t\t\tvarying float vLineDistance;\n\t\n\t\t\t#endif\n\t\n\t\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\t\n\t\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\t\n\t\t\t\t// conservative estimate of the near plane\n\t\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\t\n\t\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\t\n\t\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\t\n\t\t\t}\n\t\n\t\t\tvoid main() {\n\t\n\t\t\t\t#ifdef USE_COLOR\n\t\n\t\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\t\n\t\t\t\t#endif\n\t\n\t\t\t\t#ifdef USE_DASH\n\t\n\t\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\t\n\t\t\t\t#endif\n\t\n\t\t\t\tfloat aspect = resolution.x / resolution.y;\n\t\n\t\t\t\tvUv = uv;\n\t\n\t\t\t\t// camera space\n\t\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\t\n\t\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\t\n\t\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\t\n\t\t\t\tif ( perspective ) {\n\t\n\t\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\t\n\t\t\t\t\t\ttrimSegment( start, end );\n\t\n\t\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\t\n\t\t\t\t\t\ttrimSegment( end, start );\n\t\n\t\t\t\t\t}\n\t\n\t\t\t\t}\n\t\n\t\t\t\t// clip space\n\t\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\t\tvec4 clipEnd = projectionMatrix * end;\n\t\n\t\t\t\t// ndc space\n\t\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\t\n\t\t\t\t// direction\n\t\t\t\tvec2 dir = ndcEnd - ndcStart;\n\t\n\t\t\t\t// account for clip-space aspect ratio\n\t\t\t\tdir.x *= aspect;\n\t\t\t\tdir = normalize( dir );\n\t\n\t\t\t\t// perpendicular to dir\n\t\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\t\n\t\t\t\t// undo aspect ratio adjustment\n\t\t\t\tdir.x /= aspect;\n\t\t\t\toffset.x /= aspect;\n\t\n\t\t\t\t// sign flip\n\t\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\t\n\t\t\t\t// endcaps\n\t\t\t\tif ( position.y < 0.0 ) {\n\t\n\t\t\t\t\toffset += - dir;\n\t\n\t\t\t\t} else if ( position.y > 1.0 ) {\n\t\n\t\t\t\t\toffset += dir;\n\t\n\t\t\t\t}\n\t\n\t\t\t\t// adjust for linewidth\n\t\t\t\toffset *= linewidth;\n\t\n\t\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\t\toffset /= resolution.y;\n\t\n\t\t\t\t// select end\n\t\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\t\n\t\t\t\t// back to clip space\n\t\t\t\toffset *= clip.w;\n\t\n\t\t\t\tclip.xy += offset;\n\t\n\t\t\t\tgl_Position = clip;\n\t\n\t\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\t\n\t\t\t\t#include <logdepthbuf_vertex>\n\t\t\t\t#include <clipping_planes_vertex>\n\t\t\t\t#include <fog_vertex>\n\t\n\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\tuniform vec3 diffuse;\n\t\t\tuniform float opacity;\n\t\n\t\t\t#ifdef USE_DASH\n\t\n\t\t\t\tuniform float dashSize;\n\t\t\t\tuniform float gapSize;\n\t\n\t\t\t#endif\n\t\n\t\t\tvarying float vLineDistance;\n\t\n\t\t\t#include <common>\n\t\t\t#include <color_pars_fragment>\n\t\t\t#include <fog_pars_fragment>\n\t\t\t#include <logdepthbuf_pars_fragment>\n\t\t\t#include <clipping_planes_pars_fragment>\n\t\n\t\t\tvarying vec2 vUv;\n\t\n\t\t\tvoid main() {\n\t\n\t\t\t\t#include <clipping_planes_fragment>\n\t\n\t\t\t\t#ifdef USE_DASH\n\t\n\t\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\t\n\t\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\t\n\t\t\t\t#endif\n\t\n\t\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\t\n\t\t\t\t\tfloat a = vUv.x;\n\t\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\t\tfloat len2 = a * a + b * b;\n\t\n\t\t\t\t\tif ( len2 > 1.0 ) discard;\n\t\n\t\t\t\t}\n\t\n\t\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\n\t\t\t\t#include <logdepthbuf_fragment>\n\t\t\t\t#include <color_fragment>\n\t\n\t\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\t\n\t\t\t\t#include <tonemapping_fragment>\n\t\t\t\t#include <encodings_fragment>\n\t\t\t\t#include <fog_fragment>\n\t\t\t\t#include <premultiplied_alpha_fragment>\n\t\n\t\t\t}\n\t\t\t"},t.LineMaterial=function(e){t.ShaderMaterial.call(this,{type:"LineMaterial",uniforms:t.UniformsUtils.clone(t.ShaderLib.line.uniforms),vertexShader:t.ShaderLib.line.vertexShader,fragmentShader:t.ShaderLib.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(e)},t.LineMaterial.prototype=Object.create(t.ShaderMaterial.prototype),t.LineMaterial.prototype.constructor=t.LineMaterial,t.LineMaterial.prototype.isLineMaterial=!0}(),function(){var t,e,n=L;n.LineSegments2=function(t,e){n.Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==t?t:new n.LineSegmentsGeometry,this.material=void 0!==e?e:new n.LineMaterial({color:16777215*Math.random()})},n.LineSegments2.prototype=Object.assign(Object.create(n.Mesh.prototype),{constructor:n.LineSegments2,isLineSegments2:!0,computeLineDistances:(t=new n.Vector3,e=new n.Vector3,function(){for(var r=this.geometry,i=r.attributes.instanceStart,o=r.attributes.instanceEnd,a=new Float32Array(2*i.data.count),s=0,l=0,c=i.data.count;s<c;s++,l+=2)t.fromBufferAttribute(i,s),e.fromBufferAttribute(o,s),a[l]=0===l?0:a[l-1],a[l+1]=a[l]+t.distanceTo(e);var u=new n.InstancedInterleavedBuffer(a,2,1);return r.setAttribute("instanceDistanceStart",new n.InterleavedBufferAttribute(u,1,0)),r.setAttribute("instanceDistanceEnd",new n.InterleavedBufferAttribute(u,1,1)),this}),raycast:function(){var t=new n.Vector4,e=new n.Vector4,r=new n.Vector4,i=new n.Vector3,o=new n.Matrix4,a=new n.Line3,s=new n.Vector3;return function(l,c){l.camera;var u=l.ray,h=l.camera,p=h.projectionMatrix,d=this.geometry,f=this.material,m=f.resolution,v=f.linewidth,g=d.attributes.instanceStart,y=d.attributes.instanceEnd;u.at(1,r),r.w=1,r.applyMatrix4(h.matrixWorldInverse),r.applyMatrix4(p),r.multiplyScalar(1/r.w),r.x*=m.x/2,r.y*=m.y/2,r.z=0,i.copy(r);var _=this.matrixWorld;o.multiplyMatrices(h.matrixWorldInverse,_);for(var E=0,T=g.count;E<T;E++){t.fromBufferAttribute(g,E),e.fromBufferAttribute(y,E),t.w=1,e.w=1,t.applyMatrix4(o),e.applyMatrix4(o),t.applyMatrix4(p),e.applyMatrix4(p),t.multiplyScalar(1/t.w),e.multiplyScalar(1/e.w);var x=t.z<-1&&e.z<-1,b=t.z>1&&e.z>1;if(!x&&!b){t.x*=m.x/2,t.y*=m.y/2,e.x*=m.x/2,e.y*=m.y/2,a.start.copy(t),a.start.z=0,a.end.copy(e),a.end.z=0;var M=a.closestPointToPointParameter(i,!0);a.at(M,s);var A=n.MathUtils.lerp(t.z,e.z,M),S=A>=-1&&A<=1,O=i.distanceTo(s)<.5*v;if(S&&O){a.start.fromBufferAttribute(g,E),a.end.fromBufferAttribute(y,E),a.start.applyMatrix4(_),a.end.applyMatrix4(_);var w=new n.Vector3,L=new n.Vector3;u.distanceSqToSegment(a.start,a.end,L,w),c.push({point:L,pointOnLine:w,distance:u.origin.distanceTo(L),object:this,face:null,faceIndex:E,uv:null,uv2:null})}}}}}()})}(),function(){var t=L;t.Line2=function(e,n){t.LineSegments2.call(this),this.type="Line2",this.geometry=void 0!==e?e:new t.LineGeometry,this.material=void 0!==n?n:new t.LineMaterial({color:16777215*Math.random()})},t.Line2.prototype=Object.assign(Object.create(t.LineSegments2.prototype),{constructor:t.Line2,isLine2:!0})}(),L.OBJExporter=function(){},L.OBJExporter.prototype={constructor:L.OBJExporter,parse:function(t){var e,n,r,i,o,a="",s=0,l=0,c=0,u=new L.Vector3,h=new L.Vector3,p=new L.Vector2,d=[];return t.traverse((function(t){t instanceof L.Mesh&&function(t){var r=0,f=0,m=0,v=t.geometry,g=new L.Matrix3;if(v instanceof L.Geometry&&(v=(new L.BufferGeometry).setFromObject(t)),v instanceof L.BufferGeometry){var y=v.getAttribute("position"),_=v.getAttribute("normal"),E=v.getAttribute("uv"),T=v.getIndex();if(a+="o "+t.name+"\n",t.material&&t.material.name&&(a+="usemtl "+t.material.name+"\n"),void 0!==y)for(e=0,i=y.count;e<i;e++,r++)u.x=y.getX(e),u.y=y.getY(e),u.z=y.getZ(e),u.applyMatrix4(t.matrixWorld),a+="v "+u.x+" "+u.y+" "+u.z+"\n";if(void 0!==E)for(e=0,i=E.count;e<i;e++,m++)p.x=E.getX(e),p.y=E.getY(e),a+="vt "+p.x+" "+p.y+"\n";if(void 0!==_)for(g.getNormalMatrix(t.matrixWorld),e=0,i=_.count;e<i;e++,f++)h.x=_.getX(e),h.y=_.getY(e),h.z=_.getZ(e),h.applyMatrix3(g).normalize(),a+="vn "+h.x+" "+h.y+" "+h.z+"\n";if(null!==T)for(e=0,i=T.count;e<i;e+=3){for(o=0;o<3;o++)n=T.getX(e+o)+1,d[o]=s+n+(_||E?"/"+(E?l+n:"")+(_?"/"+(c+n):""):"");a+="f "+d.join(" ")+"\n"}else for(e=0,i=y.count;e<i;e+=3){for(o=0;o<3;o++)n=e+o+1,d[o]=s+n+(_||E?"/"+(E?l+n:"")+(_?"/"+(c+n):""):"");a+="f "+d.join(" ")+"\n"}}s+=r,l+=m,c+=f}(t),t instanceof L.Line&&function(t){var o=0,l=t.geometry,c=t.type;if(l instanceof L.Geometry&&(l=(new L.BufferGeometry).setFromObject(t)),l instanceof L.BufferGeometry){var h=l.getAttribute("position");if(a+="o "+t.name+"\n",void 0!==h)for(e=0,i=h.count;e<i;e++,o++)u.x=h.getX(e),u.y=h.getY(e),u.z=h.getZ(e),u.applyMatrix4(t.matrixWorld),a+="v "+u.x+" "+u.y+" "+u.z+"\n";if("Line"===c){for(a+="l ",n=1,i=h.count;n<=i;n++)a+=s+n+" ";a+="\n"}if("LineSegments"===c)for(r=1+(n=1),i=h.count;n<i;r=(n+=2)+1)a+="l "+(s+n)+" "+(s+r)+"\n"}s+=o}(t)})),a}},L.SVGLoader=function(t){L.Loader.call(this,t),this.defaultDPI=90,this.defaultUnit="px"},L.SVGLoader.prototype=Object.assign(Object.create(L.Loader.prototype),{constructor:L.SVGLoader,load:function(t,e,n,r){var i=this,o=new L.FileLoader(i.manager);o.setPath(i.path),o.load(t,(function(n){try{e(i.parse(n))}catch(e){r&&r(e),i.manager.itemError(t)}}),n,r)},parse:function(t){var e=this;function n(t,e,n,i,o,a,s,l){i=i*Math.PI/180,e=Math.abs(e),n=Math.abs(n);var c=(s.x-l.x)/2,u=(s.y-l.y)/2,h=Math.cos(i)*c+Math.sin(i)*u,p=-Math.sin(i)*c+Math.cos(i)*u,d=e*e,f=n*n,m=h*h,v=p*p,g=m/d+v/f;if(g>1){var y=Math.sqrt(g);d=(e*=y)*e,f=(n*=y)*n}var _=d*v+f*m,E=(d*f-_)/_,T=Math.sqrt(Math.max(0,E));o===a&&(T=-T);var x=T*e*p/n,b=-T*n*h/e,M=Math.cos(i)*x-Math.sin(i)*b+(s.x+l.x)/2,A=Math.sin(i)*x+Math.cos(i)*b+(s.y+l.y)/2,S=r(1,0,(h-x)/e,(p-b)/n),O=r((h-x)/e,(p-b)/n,(-h-x)/e,(-p-b)/n)%(2*Math.PI);t.currentPath.absellipse(M,A,e,n,S,S+O,0===a,i)}function r(t,e,n,r){var i=t*n+e*r,o=Math.sqrt(t*t+e*e)*Math.sqrt(n*n+r*r),a=Math.acos(Math.max(-1,Math.min(1,i/o)));return t*r-e*n<0&&(a=-a),a}function i(t,e){e=Object.assign({},e);var n={};if(t.hasAttribute("class"))for(var r=t.getAttribute("class").split(/\s/).filter(Boolean).map((function(t){return t.trim()})),i=0;i<r.length;i++)n=Object.assign(n,d["."+r[i]]);function o(r,i,o){void 0===o&&(o=function(t){return t}),t.hasAttribute(r)&&(e[i]=o(t.getAttribute(r))),n[r]&&(e[i]=o(n[r])),t.style&&""!==t.style[r]&&(e[i]=o(t.style[r]))}function a(t){return Math.max(0,Math.min(1,c(t)))}function s(t){return Math.max(0,c(t))}return t.hasAttribute("id")&&(n=Object.assign(n,d["#"+t.getAttribute("id")])),o("fill","fill"),o("fill-opacity","fillOpacity",a),o("opacity","opacity",a),o("stroke","stroke"),o("stroke-opacity","strokeOpacity",a),o("stroke-width","strokeWidth",s),o("stroke-linejoin","strokeLineJoin"),o("stroke-linecap","strokeLineCap"),o("stroke-miterlimit","strokeMiterLimit",s),o("visibility","visibility"),e}function o(t,e){return t-(e-t)}function a(t){for(var e=t.split(/[\s,]+|(?=\s?[+\-])/),n=0;n<e.length;n++){var r=e[n];if(r.indexOf(".")!==r.lastIndexOf("."))for(var i=r.split("."),o=2;o<i.length;o++)e.splice(n+o-1,0,"0."+i[o]);e[n]=c(r)}return e}var s=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function c(t){var n="px";if("string"==typeof t||t instanceof String)for(var r=0,i=s.length;r<i;r++){var o=s[r];if(t.endsWith(o)){n=o,t=t.substring(0,t.length-o.length);break}}var a=void 0;return"px"===n&&"px"!==e.defaultUnit?a=l.in[e.defaultUnit]/e.defaultDPI:(a=l[n][e.defaultUnit])<0&&(a=l[n].in*e.defaultDPI),a*parseFloat(t)}function u(t){var e=t.elements;return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function h(t){var e=t.elements;return Math.sqrt(e[3]*e[3]+e[4]*e[4])}var p=[],d={},f=[],m=new L.Matrix3,v=new L.Matrix3,g=new L.Matrix3,y=new L.Matrix3,_=new L.Vector2,E=new L.Vector3,T=new L.Matrix3,x=(new DOMParser).parseFromString(t,"image/svg+xml");return function t(e,r){if(1===e.nodeType){var s=function(t){if(!t.hasAttribute("transform"))return null;var e=function(t){for(var e=new L.Matrix3,n=m,r=t.getAttribute("transform").split(")"),i=r.length-1;i>=0;i--){var o=r[i].trim();if(""!==o){var s=o.indexOf("("),l=o.length;if(s>0&&s<l){var c=o.substr(0,s),u=a(o.substr(s+1,l-s-1));switch(n.identity(),c){case"translate":if(u.length>=1){var h=u[0],p=h;u.length>=2&&(p=u[1]),n.translate(h,p)}break;case"rotate":if(u.length>=1){var d,f=0,_=0;d=-u[0]*Math.PI/180,u.length>=3&&(f=u[1],_=u[2]),v.identity().translate(-f,-_),g.identity().rotate(d),y.multiplyMatrices(g,v),v.identity().translate(f,_),n.multiplyMatrices(v,y)}break;case"scale":if(u.length>=1){var E=u[0],T=E;u.length>=2&&(T=u[1]),n.scale(E,T)}break;case"skewX":1===u.length&&n.set(1,Math.tan(u[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===u.length&&n.set(1,0,0,Math.tan(u[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===u.length&&n.set(u[0],u[2],u[4],u[1],u[3],u[5],0,0,1)}}e.premultiply(n)}}return e}(t);return f.length>0&&e.premultiply(f[f.length-1]),T.copy(e),f.push(e),e}(e),l=null;switch(e.nodeName){case"svg":break;case"style":!function(t){if(t.sheet&&t.sheet.cssRules&&t.sheet.cssRules.length)for(var e=0;e<t.sheet.cssRules.length;e++){var n=t.sheet.cssRules[e];if(1===n.type)for(var r=n.selectorText.split(/,/gm).filter(Boolean).map((function(t){return t.trim()})),i=0;i<r.length;i++)d[r[i]]=Object.assign(d[r[i]]||{},n.style)}}(e);break;case"g":r=i(e,r);break;case"path":r=i(e,r),e.hasAttribute("d")&&(l=function(t){for(var e=new L.ShapePath,r=new L.Vector2,i=new L.Vector2,s=new L.Vector2,l=!0,c=!1,u=t.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),h=0,p=u.length;h<p;h++){var d=u[h],f=d.charAt(0),m=d.substr(1).trim();switch(!0===l&&(c=!0,l=!1),f){case"M":for(var v=a(m),g=0,y=v.length;g<y;g+=2)r.x=v[g+0],r.y=v[g+1],i.x=r.x,i.y=r.y,0===g?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y),0===g&&!0===c&&s.copy(r);break;case"H":for(v=a(m),g=0,y=v.length;g<y;g++)r.x=v[g],i.x=r.x,i.y=r.y,e.lineTo(r.x,r.y),0===g&&!0===c&&s.copy(r);break;case"V":for(v=a(m),g=0,y=v.length;g<y;g++)r.y=v[g],i.x=r.x,i.y=r.y,e.lineTo(r.x,r.y),0===g&&!0===c&&s.copy(r);break;case"L":for(v=a(m),g=0,y=v.length;g<y;g+=2)r.x=v[g+0],r.y=v[g+1],i.x=r.x,i.y=r.y,e.lineTo(r.x,r.y),0===g&&!0===c&&s.copy(r);break;case"C":for(v=a(m),g=0,y=v.length;g<y;g+=6)e.bezierCurveTo(v[g+0],v[g+1],v[g+2],v[g+3],v[g+4],v[g+5]),i.x=v[g+2],i.y=v[g+3],r.x=v[g+4],r.y=v[g+5],0===g&&!0===c&&s.copy(r);break;case"S":for(v=a(m),g=0,y=v.length;g<y;g+=4)e.bezierCurveTo(o(r.x,i.x),o(r.y,i.y),v[g+0],v[g+1],v[g+2],v[g+3]),i.x=v[g+0],i.y=v[g+1],r.x=v[g+2],r.y=v[g+3],0===g&&!0===c&&s.copy(r);break;case"Q":for(v=a(m),g=0,y=v.length;g<y;g+=4)e.quadraticCurveTo(v[g+0],v[g+1],v[g+2],v[g+3]),i.x=v[g+0],i.y=v[g+1],r.x=v[g+2],r.y=v[g+3],0===g&&!0===c&&s.copy(r);break;case"T":for(v=a(m),g=0,y=v.length;g<y;g+=2){var _=o(r.x,i.x),E=o(r.y,i.y);e.quadraticCurveTo(_,E,v[g+0],v[g+1]),i.x=_,i.y=E,r.x=v[g+0],r.y=v[g+1],0===g&&!0===c&&s.copy(r)}break;case"A":for(v=a(m),g=0,y=v.length;g<y;g+=7){var T=r.clone();r.x=v[g+5],r.y=v[g+6],i.x=r.x,i.y=r.y,n(e,v[g],v[g+1],v[g+2],v[g+3],v[g+4],T,r),0===g&&!0===c&&s.copy(r)}break;case"m":for(v=a(m),g=0,y=v.length;g<y;g+=2)r.x+=v[g+0],r.y+=v[g+1],i.x=r.x,i.y=r.y,0===g?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y),0===g&&!0===c&&s.copy(r);break;case"h":for(v=a(m),g=0,y=v.length;g<y;g++)r.x+=v[g],i.x=r.x,i.y=r.y,e.lineTo(r.x,r.y),0===g&&!0===c&&s.copy(r);break;case"v":for(v=a(m),g=0,y=v.length;g<y;g++)r.y+=v[g],i.x=r.x,i.y=r.y,e.lineTo(r.x,r.y),0===g&&!0===c&&s.copy(r);break;case"l":for(v=a(m),g=0,y=v.length;g<y;g+=2)r.x+=v[g+0],r.y+=v[g+1],i.x=r.x,i.y=r.y,e.lineTo(r.x,r.y),0===g&&!0===c&&s.copy(r);break;case"c":for(v=a(m),g=0,y=v.length;g<y;g+=6)e.bezierCurveTo(r.x+v[g+0],r.y+v[g+1],r.x+v[g+2],r.y+v[g+3],r.x+v[g+4],r.y+v[g+5]),i.x=r.x+v[g+2],i.y=r.y+v[g+3],r.x+=v[g+4],r.y+=v[g+5],0===g&&!0===c&&s.copy(r);break;case"s":for(v=a(m),g=0,y=v.length;g<y;g+=4)e.bezierCurveTo(o(r.x,i.x),o(r.y,i.y),r.x+v[g+0],r.y+v[g+1],r.x+v[g+2],r.y+v[g+3]),i.x=r.x+v[g+0],i.y=r.y+v[g+1],r.x+=v[g+2],r.y+=v[g+3],0===g&&!0===c&&s.copy(r);break;case"q":for(v=a(m),g=0,y=v.length;g<y;g+=4)e.quadraticCurveTo(r.x+v[g+0],r.y+v[g+1],r.x+v[g+2],r.y+v[g+3]),i.x=r.x+v[g+0],i.y=r.y+v[g+1],r.x+=v[g+2],r.y+=v[g+3],0===g&&!0===c&&s.copy(r);break;case"t":for(v=a(m),g=0,y=v.length;g<y;g+=2)_=o(r.x,i.x),E=o(r.y,i.y),e.quadraticCurveTo(_,E,r.x+v[g+0],r.y+v[g+1]),i.x=_,i.y=E,r.x=r.x+v[g+0],r.y=r.y+v[g+1],0===g&&!0===c&&s.copy(r);break;case"a":for(v=a(m),g=0,y=v.length;g<y;g+=7)T=r.clone(),r.x+=v[g+5],r.y+=v[g+6],i.x=r.x,i.y=r.y,n(e,v[g],v[g+1],v[g+2],v[g+3],v[g+4],T,r),0===g&&!0===c&&s.copy(r);break;case"Z":case"z":e.currentPath.autoClose=!0,e.currentPath.curves.length>0&&(r.copy(s),e.currentPath.currentPoint.copy(r),l=!0)}c=!1}return e}(e));break;case"rect":r=i(e,r),l=function(t){var e=c(t.getAttribute("x")||0),n=c(t.getAttribute("y")||0),r=c(t.getAttribute("rx")||0),i=c(t.getAttribute("ry")||0),o=c(t.getAttribute("width")),a=c(t.getAttribute("height")),s=new L.ShapePath;return s.moveTo(e+2*r,n),s.lineTo(e+o-2*r,n),(0!==r||0!==i)&&s.bezierCurveTo(e+o,n,e+o,n,e+o,n+2*i),s.lineTo(e+o,n+a-2*i),(0!==r||0!==i)&&s.bezierCurveTo(e+o,n+a,e+o,n+a,e+o-2*r,n+a),s.lineTo(e+2*r,n+a),(0!==r||0!==i)&&s.bezierCurveTo(e,n+a,e,n+a,e,n+a-2*i),s.lineTo(e,n+2*i),(0!==r||0!==i)&&s.bezierCurveTo(e,n,e,n,e+2*r,n),s}(e);break;case"polygon":r=i(e,r),l=function(t){var e=new L.ShapePath,n=0;return t.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,(function(t,r,i){var o=c(r),a=c(i);0===n?e.moveTo(o,a):e.lineTo(o,a),n++})),e.currentPath.autoClose=!0,e}(e);break;case"polyline":r=i(e,r),l=function(t){var e=new L.ShapePath,n=0;return t.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,(function(t,r,i){var o=c(r),a=c(i);0===n?e.moveTo(o,a):e.lineTo(o,a),n++})),e.currentPath.autoClose=!1,e}(e);break;case"circle":r=i(e,r),l=function(t){var e=c(t.getAttribute("cx")),n=c(t.getAttribute("cy")),r=c(t.getAttribute("r")),i=new L.Path;i.absarc(e,n,r,0,2*Math.PI);var o=new L.ShapePath;return o.subPaths.push(i),o}(e);break;case"ellipse":r=i(e,r),l=function(t){var e=c(t.getAttribute("cx")),n=c(t.getAttribute("cy")),r=c(t.getAttribute("rx")),i=c(t.getAttribute("ry")),o=new L.Path;o.absellipse(e,n,r,i,0,2*Math.PI);var a=new L.ShapePath;return a.subPaths.push(o),a}(e);break;case"line":r=i(e,r),l=function(t){var e=c(t.getAttribute("x1")),n=c(t.getAttribute("y1")),r=c(t.getAttribute("x2")),i=c(t.getAttribute("y2")),o=new L.ShapePath;return o.moveTo(e,n),o.lineTo(r,i),o.currentPath.autoClose=!1,o}(e)}l&&(void 0!==r.fill&&"none"!==r.fill&&l.color.setStyle(r.fill),function(t,e){function n(t){E.set(t.x,t.y,1).applyMatrix3(e),t.set(E.x,E.y)}!function(t){0!==t.elements[1]||t.elements[3]}(e);for(var r=t.subPaths,i=0,o=r.length;i<o;i++)for(var a=r[i].curves,s=0;s<a.length;s++){var l=a[s];l.isLineCurve?(n(l.v1),n(l.v2)):l.isCubicBezierCurve?(n(l.v0),n(l.v1),n(l.v2),n(l.v3)):l.isQuadraticBezierCurve?(n(l.v0),n(l.v1),n(l.v2)):l.isEllipseCurve&&(_.set(l.aX,l.aY),n(_),l.aX=_.x,l.aY=_.y,l.xRadius*=u(e),l.yRadius*=h(e))}}(l,T),p.push(l),l.userData={node:e,style:r});for(var x=e.childNodes,b=0;b<x.length;b++)t(x[b],r);s&&(f.pop(),f.length>0?T.copy(f[f.length-1]):T.identity())}}(x.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:p,xml:x.documentElement}}}),L.SVGLoader.getStrokeStyle=function(t,e,n,r,i){return{strokeColor:e=void 0!==e?e:"#000",strokeWidth:t=void 0!==t?t:1,strokeLineJoin:n=void 0!==n?n:"miter",strokeLineCap:r=void 0!==r?r:"butt",strokeMiterLimit:i=void 0!==i?i:4}},L.SVGLoader.pointsToStroke=function(t,e,n,r){var i=[],o=[],a=[];if(0===L.SVGLoader.pointsToStrokeWithBuffers(t,e,n,r,i,o,a))return null;var s=new L.BufferGeometry;return s.setAttribute("position",new L.Float32BufferAttribute(i,3)),s.setAttribute("normal",new L.Float32BufferAttribute(o,3)),s.setAttribute("uv",new L.Float32BufferAttribute(a,2)),s},L.SVGLoader.pointsToStrokeWithBuffers=(l=new L.Vector2,c=new L.Vector2,u=new L.Vector2,h=new L.Vector2,p=new L.Vector2,d=new L.Vector2,f=new L.Vector2,m=new L.Vector2,v=new L.Vector2,g=new L.Vector2,y=new L.Vector2,_=new L.Vector2,E=new L.Vector2,T=new L.Vector2,x=new L.Vector2,b=new L.Vector2,M=new L.Vector2,function(t,e,n,r,i,o,a,s){n=void 0!==n?n:12,r=void 0!==r?r:.001,s=void 0!==s?s:0;var A=(t=function(t){for(var e=!1,n=1,i=t.length-1;n<i;n++)if(t[n].distanceTo(t[n+1])<r){e=!0;break}if(!e)return t;var o=[];for(o.push(t[0]),n=1,i=t.length-1;n<i;n++)t[n].distanceTo(t[n+1])>=r&&o.push(t[n]);return o.push(t[t.length-1]),o}(t)).length;if(A<2)return 0;var S,O,w,L,D,C=t[0].equals(t[A-1]),P=t[0],N=e.strokeWidth/2,R=1/(A-1),I=0,U=!1,B=0,F=3*s,H=2*s;K(t[0],t[1],l).multiplyScalar(N),m.copy(t[0]).sub(l),v.copy(t[0]).add(l),g.copy(m),y.copy(v);for(var k=1;k<A;k++){S=t[k],O=k===A-1?C?t[1]:void 0:t[k+1];var z=l;K(P,S,z),u.copy(z).multiplyScalar(N),_.copy(S).sub(u),E.copy(S).add(u);var G=I+R;if(w=!1,void 0!==O){K(S,O,c),u.copy(c).multiplyScalar(N),T.copy(S).sub(u),x.copy(S).add(u),L=!0,u.subVectors(O,P),z.dot(u)<0&&(L=!1),1===k&&(U=L),u.subVectors(O,S),u.normalize();var W=Math.abs(z.dot(u));if(0!==W){var V=N/W;u.multiplyScalar(-V),h.subVectors(S,P),p.copy(h).setLength(V).add(u),b.copy(p).negate();var j=p.length(),Y=h.length();h.divideScalar(Y),d.subVectors(O,S);var X=d.length();switch(d.divideScalar(X),h.dot(b)<Y&&d.dot(b)<X&&(w=!0),M.copy(p).add(S),b.add(S),D=!1,w?L?(x.copy(b),E.copy(b)):(T.copy(b),_.copy(b)):tt(),e.strokeLineJoin){case"bevel":et(L,w,G);break;case"round":nt(L,w),L?$(S,_,T,G,0):$(S,x,E,G,1);break;case"miter":case"miter-clip":default:var Z=N*e.strokeMiterLimit/j;if(Z<1){if("miter-clip"!==e.strokeLineJoin){et(L,w,G);break}nt(L,w),L?(d.subVectors(M,_).multiplyScalar(Z).add(_),f.subVectors(M,T).multiplyScalar(Z).add(T),J(_,G,0),J(d,G,0),J(S,G,.5),J(S,G,.5),J(d,G,0),J(f,G,0),J(S,G,.5),J(f,G,0),J(T,G,0)):(d.subVectors(M,E).multiplyScalar(Z).add(E),f.subVectors(M,x).multiplyScalar(Z).add(x),J(E,G,1),J(d,G,1),J(S,G,.5),J(S,G,.5),J(d,G,1),J(f,G,1),J(S,G,.5),J(f,G,1),J(x,G,1))}else w?(L?(J(v,I,1),J(m,I,0),J(M,G,0),J(v,I,1),J(M,G,0),J(b,G,1)):(J(v,I,1),J(m,I,0),J(M,G,1),J(m,I,0),J(b,G,0),J(M,G,1)),L?T.copy(M):x.copy(M)):L?(J(_,G,0),J(M,G,0),J(S,G,.5),J(S,G,.5),J(M,G,0),J(T,G,0)):(J(E,G,1),J(M,G,1),J(S,G,.5),J(S,G,.5),J(M,G,1),J(x,G,1)),D=!0}}else tt()}else tt();C||k!==A-1||rt(t[0],g,y,L,!0,I),I=G,P=S,m.copy(T),v.copy(x)}if(C){if(w&&i){var q=M,Q=b;U!==L&&(q=b,Q=M),L?(D||U)&&(Q.toArray(i,0),Q.toArray(i,9),D&&q.toArray(i,3)):!D&&U||(Q.toArray(i,3),Q.toArray(i,9),D&&q.toArray(i,0))}}else rt(S,_,E,L,!1,G);return B;function K(t,e,n){return n.subVectors(e,t),n.set(-n.y,n.x).normalize()}function J(t,e,n){i&&(i[F]=t.x,i[F+1]=t.y,i[F+2]=0,o&&(o[F]=0,o[F+1]=0,o[F+2]=1),F+=3,a&&(a[H]=e,a[H+1]=n,H+=2)),B+=3}function $(t,e,r,i,o){l.copy(e).sub(t).normalize(),c.copy(r).sub(t).normalize();var a=Math.PI,s=l.dot(c);Math.abs(s)<1&&(a=Math.abs(Math.acos(s))),a/=n,u.copy(e);for(var p=0,d=n-1;p<d;p++)h.copy(u).rotateAround(t,a),J(u,i,o),J(h,i,o),J(t,i,.5),u.copy(h);J(h,i,o),J(r,i,o),J(t,i,.5)}function tt(){J(v,I,1),J(m,I,0),J(_,G,0),J(v,I,1),J(_,G,1),J(E,G,0)}function et(t,e,n){e?t?(J(v,I,1),J(m,I,0),J(_,G,0),J(v,I,1),J(_,G,0),J(b,G,1),J(_,n,0),J(T,n,0),J(b,n,.5)):(J(v,I,1),J(m,I,0),J(E,G,1),J(m,I,0),J(b,G,0),J(E,G,1),J(E,n,1),J(x,n,0),J(b,n,.5)):t?(J(_,n,0),J(T,n,0),J(S,n,.5)):(J(E,n,1),J(x,n,0),J(S,n,.5))}function nt(t,e){e&&(t?(J(v,I,1),J(m,I,0),J(_,G,0),J(v,I,1),J(_,G,0),J(b,G,1),J(_,I,0),J(S,G,.5),J(b,G,1),J(S,G,.5),J(T,I,0),J(b,G,1)):(J(v,I,1),J(m,I,0),J(E,G,1),J(m,I,0),J(b,G,0),J(E,G,1),J(E,I,1),J(b,G,0),J(S,G,.5),J(S,G,.5),J(b,G,0),J(x,I,1)))}function rt(t,n,r,o,a,s){switch(e.strokeLineCap){case"round":a?$(t,r,n,s,.5):$(t,n,r,s,.5);break;case"square":if(a)l.subVectors(n,t),c.set(l.y,-l.x),u.addVectors(l,c).add(t),h.subVectors(c,l).add(t),o?(u.toArray(i,3),h.toArray(i,0),h.toArray(i,9)):(u.toArray(i,3),u.toArray(i,9),h.toArray(i,0));else{l.subVectors(r,t),c.set(l.y,-l.x),u.addVectors(l,c).add(t),h.subVectors(c,l).add(t);var p=i.length;o?(u.toArray(i,p-3),h.toArray(i,p-6),h.toArray(i,p-12)):(u.toArray(i,p-6),h.toArray(i,p-3),h.toArray(i,p-12))}}}});var D=L.OrthographicCamera,C=L.PlaneBufferGeometry,P=L.Mesh;function N(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(N.prototype,{setSize:function(){},render:function(){}}),N.FullScreenQuad=function(){var t=new D(-1,1,1,-1,0,1),e=new C(2,2),n=function(t){this._mesh=new P(e,t)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),n}();var R=N,I={CopyShader:{uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")}},U=R,B=I.CopyShader;L.OutlinePass=function(t,e,n,r){this.renderScene=e,this.renderCamera=n,this.selectedObjects=void 0!==r?r:[],this.visibleEdgeColor=new L.Color(1,1,1),this.hiddenEdgeColor=new L.Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,U.call(this),this.resolution=void 0!==t?new L.Vector2(t.x,t.y):new L.Vector2(256,256);var i={minFilter:L.LinearFilter,magFilter:L.LinearFilter,format:L.RGBAFormat},o=Math.round(this.resolution.x/this.downSampleRatio),a=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new L.MeshBasicMaterial({color:16777215}),this.maskBufferMaterial.side=L.DoubleSide,this.renderTargetMaskBuffer=new L.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new L.MeshDepthMaterial,this.depthMaterial.side=L.DoubleSide,this.depthMaterial.depthPacking=L.RGBADepthPacking,this.depthMaterial.blending=L.NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=L.DoubleSide,this.prepareMaskMaterial.fragmentShader=function(t,e){var n=e.isPerspectiveCamera?"perspective":"orthographic";return t.replace(/DEPTH_TO_VIEW_Z/g,n+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new L.WebGLRenderTarget(this.resolution.x,this.resolution.y,i),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new L.WebGLRenderTarget(o,a,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new L.WebGLRenderTarget(o,a,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new L.WebGLRenderTarget(Math.round(o/2),Math.round(a/2),i),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new L.WebGLRenderTarget(o,a,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new L.WebGLRenderTarget(Math.round(o/2),Math.round(a/2),i),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(o,a),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(o/2),Math.round(a/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();var s=B;this.copyUniforms=L.UniformsUtils.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new L.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:L.NoBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new L.Color,this.oldClearAlpha=1,this.fsQuad=new U.FullScreenQuad(null),this.tempPulseColor1=new L.Color,this.tempPulseColor2=new L.Color,this.textureMatrix=new L.Matrix4},L.OutlinePass.prototype=Object.assign(Object.create(U.prototype),{constructor:L.OutlinePass,dispose:function(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()},setSize:function(t,e){this.renderTargetMaskBuffer.setSize(t,e);var n=Math.round(t/this.downSampleRatio),r=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,r),this.renderTargetBlurBuffer1.setSize(n,r),this.renderTargetEdgeBuffer1.setSize(n,r),this.separableBlurMaterial1.uniforms.texSize.value.set(n,r),n=Math.round(n/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(n,r),this.renderTargetEdgeBuffer2.setSize(n,r),this.separableBlurMaterial2.uniforms.texSize.value.set(n,r)},changeVisibilityOfSelectedObjects:function(t){function e(e){e.isMesh&&(t?(e.visible=e.userData.oldVisible,delete e.userData.oldVisible):(e.userData.oldVisible=e.visible,e.visible=t))}for(var n=0;n<this.selectedObjects.length;n++)this.selectedObjects[n].traverse(e)},changeVisibilityOfNonSelectedObjects:function(t){var e=[];function n(t){t.isMesh&&e.push(t)}for(var r=0;r<this.selectedObjects.length;r++)this.selectedObjects[r].traverse(n);this.renderScene.traverse((function(n){if(n.isMesh||n.isLine||n.isSprite){for(var r=!1,i=0;i<e.length;i++)if(e[i].id===n.id){r=!0;break}if(!r){var o=n.visible;t&&!n.bVisible||(n.visible=t),n.bVisible=o}}}))},updateTextureMatrix:function(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)},render:function(t,e,n,r,i){if(this.selectedObjects.length>0){this.oldClearColor.copy(t.getClearColor()),this.oldClearAlpha=t.getClearAlpha();var o=t.autoClear;t.autoClear=!1,i&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);var a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){var s=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(s),this.tempPulseColor2.multiplyScalar(s)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=L.OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=L.OutlinePass.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=L.OutlinePass.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=L.OutlinePass.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,i&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(n),this.fsQuad.render(t),t.setClearColor(this.oldClearColor,this.oldClearAlpha),t.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,t.setRenderTarget(null),this.fsQuad.render(t))},getPrepareMaskMaterial:function(){return new L.ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new L.Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:["#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","varying vec4 projTexCoord;","varying vec4 vPosition;","uniform mat4 textureMatrix;","void main() {","\t#include <skinbase_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <project_vertex>","\tvPosition = mvPosition;","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tprojTexCoord = textureMatrix * worldPosition;","}"].join("\n"),fragmentShader:["#include <packing>","varying vec4 vPosition;","varying vec4 projTexCoord;","uniform sampler2D depthTexture;","uniform vec2 cameraNearFar;","void main() {","\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));","\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );","\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;","\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);","}"].join("\n")})},getEdgeDetectionMaterial:function(){return new L.ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new L.Vector2(.5,.5)},visibleEdgeColor:{value:new L.Vector3(1,1,1)},hiddenEdgeColor:{value:new L.Vector3(1,1,1)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec3 visibleEdgeColor;\t\t\t\tuniform vec3 hiddenEdgeColor;\t\t\t\t\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\t\t\t\t}"})},getSeperableBlurMaterial:function(t){return new L.ShaderMaterial({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new L.Vector2(.5,.5)},direction:{value:new L.Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\t\t\t\tuniform sampler2D colorTexture;\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\tuniform float kernelRadius;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, kernelRadius);\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\t\t\t\t\tvec2 uvOffset = delta;\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\t\t\t\t\t\tfloat w = gaussianPdf(uvOffset.x, kernelRadius);\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\t\t\t\t\t\tweightSum += (2.0 * w);\t\t\t\t\t\tuvOffset += delta;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\t\t\t\t}"})},getOverlayMaterial:function(){return new L.ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D maskTexture;\t\t\t\tuniform sampler2D edgeTexture1;\t\t\t\tuniform sampler2D edgeTexture2;\t\t\t\tuniform sampler2D patternTexture;\t\t\t\tuniform float edgeStrength;\t\t\t\tuniform float edgeGlow;\t\t\t\tuniform bool usePatternTexture;\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\t\t\t\t\tif(usePatternTexture)\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\t\t\t\t\tgl_FragColor = finalColor;\t\t\t\t}",blending:L.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}),L.OutlinePass.BlurDirectionX=new L.Vector2(1,0),L.OutlinePass.BlurDirectionY=new L.Vector2(0,1),L.CSS2DObject=function(t){L.Object3D.call(this),this.element=t||document.createElement("div"),this.element.style.position="absolute",this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))},L.CSS2DObject.prototype=Object.assign(Object.create(L.Object3D.prototype),{constructor:L.CSS2DObject,copy:function(t,e){return L.Object3D.prototype.copy.call(this,t,e),this.element=t.element.cloneNode(!0),this}}),L.CSS2DRenderer=function(){var t,e,n,r,i=this,o=new L.Vector3,a=new L.Matrix4,s=new L.Matrix4,l={objects:new WeakMap},c=document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.getSize=function(){return{width:t,height:e}},this.setSize=function(i,o){n=(t=i)/2,r=(e=o)/2,c.style.width=i+"px",c.style.height=o+"px"};var u,h,p=function(t,e,a){if(t instanceof L.CSS2DObject){t.onBeforeRender(i,e,a),o.setFromMatrixPosition(t.matrixWorld),o.applyMatrix4(s);var u=t.element,h="translate(-50%,-50%) translate("+(o.x*n+n)+"px,"+(-o.y*r+r)+"px)";u.style.WebkitTransform=h,u.style.MozTransform=h,u.style.oTransform=h,u.style.transform=h,u.style.display=t.visible&&o.z>=-1&&o.z<=1?"":"none";var f={distanceToCameraSquared:d(a,t)};l.objects.set(t,f),u.parentNode!==c&&c.appendChild(u),t.onAfterRender(i,e,a)}for(var m=0,v=t.children.length;m<v;m++)p(t.children[m],e,a)},d=(u=new L.Vector3,h=new L.Vector3,function(t,e){return u.setFromMatrixPosition(t.matrixWorld),h.setFromMatrixPosition(e.matrixWorld),u.distanceToSquared(h)}),f=function(t){for(var e=function(t){var e=[];return t.traverse((function(t){t instanceof L.CSS2DObject&&e.push(t)})),e}(t).sort((function(t,e){return l.objects.get(t).distanceToCameraSquared-l.objects.get(e).distanceToCameraSquared})),n=e.length,r=0,i=e.length;r<i;r++)e[r].element.style.zIndex=n-r};this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),a.copy(e.matrixWorldInverse),s.multiplyMatrices(e.projectionMatrix,a),p(t,t,e),f(t)}},L.CSS3DObject=function(t){L.Object3D.call(this),this.element=t||document.createElement("div"),this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))},L.CSS3DObject.prototype=Object.assign(Object.create(L.Object3D.prototype),{constructor:L.CSS3DObject,copy:function(t,e){return L.Object3D.prototype.copy.call(this,t,e),this.element=t.element.cloneNode(!0),this}}),L.CSS3DSprite=function(t){L.CSS3DObject.call(this,t)},L.CSS3DSprite.prototype=Object.create(L.CSS3DObject.prototype),L.CSS3DSprite.prototype.constructor=L.CSS3DSprite,L.CSS3DRenderer=function(){var t,e,n,r,i=this,o=new L.Matrix4,a={camera:{fov:0,style:""},objects:new WeakMap},s=document.createElement("div");s.style.overflow="hidden",this.domElement=s;var l=document.createElement("div");l.style.WebkitTransformStyle="preserve-3d",l.style.transformStyle="preserve-3d",l.style.pointerEvents="none",s.appendChild(l);var c=/Trident/i.test(navigator.userAgent);function u(t){return Math.abs(t)<1e-10?0:t}function h(t){var e=t.elements;return"matrix3d("+u(e[0])+","+u(-e[1])+","+u(e[2])+","+u(e[3])+","+u(e[4])+","+u(-e[5])+","+u(e[6])+","+u(e[7])+","+u(e[8])+","+u(-e[9])+","+u(e[10])+","+u(e[11])+","+u(e[12])+","+u(-e[13])+","+u(e[14])+","+u(e[15])+")"}function p(t,e){var i=t.elements,o="matrix3d("+u(i[0])+","+u(i[1])+","+u(i[2])+","+u(i[3])+","+u(-i[4])+","+u(-i[5])+","+u(-i[6])+","+u(-i[7])+","+u(i[8])+","+u(i[9])+","+u(i[10])+","+u(i[11])+","+u(i[12])+","+u(i[13])+","+u(i[14])+","+u(i[15])+")";return c?"translate(-50%,-50%)translate("+n+"px,"+r+"px)"+e+o:"translate(-50%,-50%)"+o}this.getSize=function(){return{width:t,height:e}},this.setSize=function(i,o){n=(t=i)/2,r=(e=o)/2,s.style.width=i+"px",s.style.height=o+"px",l.style.width=i+"px",l.style.height=o+"px"};var d,f,m=(d=new L.Vector3,f=new L.Vector3,function(t,e){return d.setFromMatrixPosition(t.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),d.distanceToSquared(f)});function v(t){for(var e=function(t){var e=[];return t.traverse((function(t){t instanceof L.CSS3DObject&&e.push(t)})),e}(t).sort((function(t,e){return a.objects.get(t).distanceToCameraSquared-a.objects.get(e).distanceToCameraSquared})),n=e.length,r=0,i=e.length;r<i;r++)e[r].element.style.zIndex=n-r}this.render=function(t,e){var d=e.projectionMatrix.elements[5]*r;if(a.camera.fov!==d&&(e.isPerspectiveCamera?(s.style.WebkitPerspective=d+"px",s.style.perspective=d+"px"):(s.style.WebkitPerspective="",s.style.perspective=""),a.camera.fov=d),!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.isOrthographicCamera)var f=-(e.right+e.left)/2,g=(e.top+e.bottom)/2;var y=e.isOrthographicCamera?"scale("+d+")translate("+u(f)+"px,"+u(g)+"px)"+h(e.matrixWorldInverse):"translateZ("+d+"px)"+h(e.matrixWorldInverse),_=y+"translate("+n+"px,"+r+"px)";a.camera.style===_||c||(l.style.WebkitTransform=_,l.style.transform=_,a.camera.style=_),function t(e,n,r,s){if(e instanceof L.CSS3DObject){var u;e.onBeforeRender(i,n,r),e instanceof L.CSS3DSprite?(o.copy(r.matrixWorldInverse),o.transpose(),o.copyPosition(e.matrixWorld),o.scale(e.scale),o.elements[3]=0,o.elements[7]=0,o.elements[11]=0,o.elements[15]=1,u=p(o,s)):u=p(e.matrixWorld,s);var h=e.element,d=a.objects.get(e);if(void 0===d||d.style!==u){h.style.WebkitTransform=u,h.style.transform=u;var f={style:u};c&&(f.distanceToCameraSquared=m(r,e)),a.objects.set(e,f)}h.style.display=e.visible?"":"none",h.parentNode!==l&&l.appendChild(h),e.onAfterRender(i,n,r)}for(var v=0,g=e.children.length;v<g;v++)t(e.children[v],n,r,s)}(t,t,e,y),c&&v(t)}},function(){var t=L,e=function(){};e.computeTangents=function(t){t.computeTangents()},e.mergeBufferGeometries=function(e,n){void 0===n&&(n=!1);for(var r=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),o=new Set(Object.keys(e[0].morphAttributes)),a={},s={},l=e[0].morphTargetsRelative,c=new t.BufferGeometry,u=0,h=0;h<e.length;++h){var p=e[h],d=0;if(r!==(null!==p.index))return null;for(var f in p.attributes){if(!i.has(f))return null;void 0===a[f]&&(a[f]=[]),a[f].push(p.attributes[f]),d++}if(d!==i.size)return null;if(l!==p.morphTargetsRelative)return null;for(var m in p.morphAttributes){if(!o.has(m))return null;void 0===s[m]&&(s[m]=[]),s[m].push(p.morphAttributes[m])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(p.userData),n){var v=void 0;if(r)v=p.index.count;else{if(void 0===p.attributes.position)return null;v=p.attributes.position.count}c.addGroup(u,v,h),u+=v}}if(r){for(var g=0,y=[],_=0;_<e.length;++_){for(var E=e[_].index,T=0;T<E.count;++T)y.push(E.getX(T)+g);g+=e[_].attributes.position.count}c.setIndex(y)}for(var x in a){var b=this.mergeBufferAttributes(a[x]);if(!b)return null;c.setAttribute(x,b)}for(var M in s){var A=s[M][0].length;if(0===A)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[M]=[];for(var S=0;S<A;++S){for(var O=[],w=0;w<s[M].length;++w)O.push(s[M][w][S]);var L=this.mergeBufferAttributes(O);if(!L)return null;c.morphAttributes[M].push(L)}}return c},e.mergeBufferAttributes=function(e){for(var n,r,i,o=0,a=0;a<e.length;++a){var s=e[a];if(s.isInterleavedBufferAttribute)return null;if(void 0===n&&(n=s.array.constructor),n!==s.array.constructor)return null;if(void 0===r&&(r=s.itemSize),r!==s.itemSize)return null;if(void 0===i&&(i=s.normalized),i!==s.normalized)return null;o+=s.array.length}for(var l=new n(o),c=0,u=0;u<e.length;++u)l.set(e[u].array,c),c+=e[u].array.length;return new t.BufferAttribute(l,r,i)},e.interleaveAttributes=function(e){for(var n,r=0,i=0,o=0,a=e.length;o<a;++o){var s=e[o];if(void 0===n&&(n=s.array.constructor),n!==s.array.constructor)return null;r+=s.array.length,i+=s.itemSize}for(var l=new t.InterleavedBuffer(new n(r),i),c=0,u=[],h=["getX","getY","getZ","getW"],p=["setX","setY","setZ","setW"],d=0,f=e.length;d<f;d++){var m=e[d],v=m.itemSize,g=m.count,y=new t.InterleavedBufferAttribute(l,v,c,m.normalized);u.push(y),c+=v;for(var _=0;_<g;_++)for(var E=0;E<v;E++)y[p[E]](_,m[h[E]](_))}return u},e.estimateBytesUsed=function(t){var e=0;for(var n in t.attributes){var r=t.getAttribute(n);e+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var i=t.getIndex();return e+=i?i.count*i.itemSize*i.array.BYTES_PER_ELEMENT:0},e.mergeVertices=function(e,n){void 0===n&&(n=1e-4),n=Math.max(n,Number.EPSILON);for(var r={},i=e.getIndex(),o=e.getAttribute("position"),a=i?i.count:o.count,s=0,l=Object.keys(e.attributes),c={},u={},h=[],p=["getX","getY","getZ","getW"],d=0,f=l.length;d<f;d++){var m=l[d];c[m]=[];var v=e.morphAttributes[m];v&&(u[m]=new Array(v.length).fill().map((function(){return[]})))}for(var g=Math.log10(1/n),y=Math.pow(10,g),_=0;_<a;_++){for(var E=i?i.getX(_):_,T="",x=0,b=l.length;x<b;x++)for(var M=l[x],A=e.getAttribute(M),S=A.itemSize,O=0;O<S;O++)T+=~~(A[p[O]](E)*y)+",";if(T in r)h.push(r[T]);else{for(var w=0,L=l.length;w<L;w++)for(var D=l[w],C=e.getAttribute(D),P=e.morphAttributes[D],N=C.itemSize,R=c[D],I=u[D],U=0;U<N;U++){var B=p[U];if(R.push(C[B](E)),P)for(var F=0,H=P.length;F<H;F++)I[F].push(P[F][B](E))}r[T]=s,h.push(s),s++}}for(var k=e.clone(),z=0,G=l.length;z<G;z++){var W=l[z],V=e.getAttribute(W),j=new V.array.constructor(c[W]),Y=new t.BufferAttribute(j,V.itemSize,V.normalized);if(k.setAttribute(W,Y),W in u)for(var X=0;X<u[W].length;X++){var Z=e.morphAttributes[W][X],q=new Z.array.constructor(u[W][X]),Q=new t.BufferAttribute(q,Z.itemSize,Z.normalized);k.morphAttributes[W][X]=Q}}return k.setIndex(h),k},e.toTrianglesDrawMode=function(e,n){if(n===t.TrianglesDrawMode)return e;if(n===t.TriangleFanDrawMode||n===t.TriangleStripDrawMode){var r=e.getIndex();if(null===r){var i=[],o=e.getAttribute("position");if(void 0===o)return e;for(var a=0;a<o.count;a++)i.push(a);e.setIndex(i),r=e.getIndex()}var s=r.count-2,l=[];if(n===t.TriangleFanDrawMode)for(var c=1;c<=s;c++)l.push(r.getX(0)),l.push(r.getX(c)),l.push(r.getX(c+1));else for(var u=0;u<s;u++)u%2==0?(l.push(r.getX(u)),l.push(r.getX(u+1)),l.push(r.getX(u+2))):(l.push(r.getX(u+2)),l.push(r.getX(u+1)),l.push(r.getX(u)));l.length;var h=e.clone();return h.setIndex(l),h.clearGroups(),h}return e},e.computeMorphedAttributes=function(e){if(!0!==e.geometry.isBufferGeometry)return null;var n=new t.Vector3,r=new t.Vector3,i=new t.Vector3,o=new t.Vector3,a=new t.Vector3,s=new t.Vector3,l=new t.Vector3,c=new t.Vector3,u=new t.Vector3;function h(t,e,h,p,d,f,m,v,g){n.fromBufferAttribute(h,f),r.fromBufferAttribute(h,m),i.fromBufferAttribute(h,v);var y=t.morphTargetInfluences;if(e.morphTargets&&p&&y){l.set(0,0,0),c.set(0,0,0),u.set(0,0,0);for(var _=0,E=p.length;_<E;_++){var T=y[_],x=p[_];0!==T&&(o.fromBufferAttribute(x,f),a.fromBufferAttribute(x,m),s.fromBufferAttribute(x,v),d?(l.addScaledVector(o,T),c.addScaledVector(a,T),u.addScaledVector(s,T)):(l.addScaledVector(o.sub(n),T),c.addScaledVector(a.sub(r),T),u.addScaledVector(s.sub(i),T)))}n.add(l),r.add(c),i.add(u)}t.isSkinnedMesh&&(t.boneTransform(f,n),t.boneTransform(m,r),t.boneTransform(v,i)),g[3*f+0]=n.x,g[3*f+1]=n.y,g[3*f+2]=n.z,g[3*m+0]=r.x,g[3*m+1]=r.y,g[3*m+2]=r.z,g[3*v+0]=i.x,g[3*v+1]=i.y,g[3*v+2]=i.z}var p,d,f,m,v,g,y,_,E,T=e.geometry,x=e.material,b=T.index,M=T.attributes.position,A=T.morphAttributes.position,S=T.morphTargetsRelative,O=T.attributes.normal,w=T.morphAttributes.position,L=T.groups,D=T.drawRange,C=new Float32Array(M.count*M.itemSize),P=new Float32Array(O.count*O.itemSize);if(null!==b)if(Array.isArray(x))for(m=0,g=L.length;m<g;m++)for(E=x[(_=L[m]).materialIndex],v=Math.max(_.start,D.start),y=Math.min(_.start+_.count,D.start+D.count);v<y;v+=3)h(e,E,M,A,S,p=b.getX(v),d=b.getX(v+1),f=b.getX(v+2),C),h(e,E,O,w,S,p,d,f,P);else for(m=Math.max(0,D.start),g=Math.min(b.count,D.start+D.count);m<g;m+=3)h(e,x,M,A,S,p=b.getX(m),d=b.getX(m+1),f=b.getX(m+2),C),h(e,x,O,w,S,p,d,f,P);else if(void 0!==M)if(Array.isArray(x))for(m=0,g=L.length;m<g;m++)for(E=x[(_=L[m]).materialIndex],v=Math.max(_.start,D.start),y=Math.min(_.start+_.count,D.start+D.count);v<y;v+=3)h(e,E,M,A,S,p=v,d=v+1,f=v+2,C),h(e,E,O,w,S,p,d,f,P);else for(m=Math.max(0,D.start),g=Math.min(M.count,D.start+D.count);m<g;m+=3)h(e,x,M,A,S,p=m,d=m+1,f=m+2,C),h(e,x,O,w,S,p,d,f,P);return{positionAttribute:M,normalAttribute:O,morphedPositionAttribute:new t.Float32BufferAttribute(C,3),morphedNormalAttribute:new t.Float32BufferAttribute(P,3)}},t.BufferGeometryUtils=e}();var F=Object.create(null);F.echo=function(t,e){return(e=Array.prototype.slice.call(e))[0]="core:"+e[0],e.unshift(sessionStorage),Function.prototype.bind.apply(t,e)},F.setItem=function(){return F.echo(sessionStorage.setItem,arguments)};var H=Object.create(null),k={carrayCore:function(t){H.core=t},carrayModel:function(t){H.model=t},carrayPlayer:function(t){H.player=t},carraySceneRender:function(t){H.sceneRender=t},carrayTileDownloader:function(t){H.tileDownloader=t},getCore:function(){return H.core},getModel:function(){return H.model},getPlayer:function(){return H.player},getSceneRender:function(){return H.sceneRender},getTileDownloader:function(){return H.tileDownloader},getRenderMode:function(){return H.core.data.basic.render_mode},getRenderSet:function(){return H.core.data.basic.render_set},getTileSize:function(){var t=H.core.data.basic.render_set.split(/(-)/g);return t[t.length-1]},getModelId:function(){return H.core.data.basic.model_id}},z=Object.freeze({NEED_UPDATE:"need.update",NEED_ON_RESIZE:"need.on.resize",NEED_CORE_LOADED:"need.core.loaded",NEED_MODE_TRANSITION:"need.model.transition",NEED_MODE_CHANGE:"need.mode.change",NEED_MODEL_SET_FLOOR:"need.model.set.floor",NEED_PANORAMA_CAMERA_ROTATE:"need.panorama.camera.rotate",NEED_PANORAMA_CAMERA_ROTATE_STOP:"need.panorama.camera.rotate.stop",NEED_DOLLHOUSE_CAMERA_ROTATE:"need.dollhouse.camera.rotate",NEED_DOLLHOUSE_CAMERA_ROTATE_STOP:"need.dollhouse.camera.rotate.stop",NEED_PANORAMA_CAMERA_ZOOM_CHANGED:"need.panorama.camera.zoom.changed",NEED_DOLLHOUSE_CAMERA_ZOOM_CHANGED:"need.dollhouse.camerea.zoom.changed",NEED_SWITCH_MODEL:"need.switch.model",NEED_SWITCH_MODEL_COMPLETE:"need.switch.model.complete",NEED_SWITCH_WAYPOINT_START:"need.switch.waypoint.start",NEED_SWITCH_WAYPOINT_TRANSITION:"need.switch.waypoint.transition",NEED_SWITCH_WAYPOINT_COMPLETE:"need.switch.waypoint.complete",NEED_MOUSE_OUT:"neew.mouse.out",NEED_MOUSE_MOVE_STOP:"need.mouse.move.stop",NEED_MOUSE_LEFT_BUTTON_DOWN:"need.mouse.left.button.down",NEED_MOUSE_LEFT_BUTTON_UP:"need.mouse.left.button.UP",NEED_MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE:"need.mouse.left.button.down.within.move",NEED_MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE:"need.mouse.left.button.down.up.without.move",NEED_MOUSE_RIGHT_BUTTON_DOWN_UP_WITHOUT_MOVE:"need.mouse.right.button.down.up.without.move",NEED_MOUSE_MOVE_WITHOUT_BUTTON_DOWN:"need.mouse.move.without.button.down",NEED_MOUSE_MOVE_INTERSECT_WITHIN_MODEL:"need.mouse.move.intersect.within.model",NEED_POINTER_MOVE_UNGET_INTERSECT_WITHIN_MODEL:"need.pointer.move.unget.intersect.within.model",NEED_HANDLE_SINGLE_TOUCH_START:"need.handle.single.touch.start",NEED_HANDLE_SINGLE_TOUCH_END:"need.handle.single.touch.end",NEED_HANDLE_CLICK:"need.handle.click",NEED_ENTER_VR_MODE:"need.enter.vr.mode",NEED_EXIT_VR_MODE:"need.exit.vr.mode",NEED_XR_CONTROL_INTERSECT_WITHN_MODEL:"need.xr.control.intersect.within.model"}),G={PANORAMA:"panorama",DOLLHOUSE:"dollhouse",FLOORPLAN:"floorplan",TRANSITIONING:"transitioning"},W=Object.create(null),V=new Map;W.set=function(t,e){V.set(t,e)},W.get=function(t){return V.get(t)};var j=W,Y=Object.freeze({START_BOOT:"core.start.boot",CORE_BOOT_COMPLETE:"core.boot.complete",FIRST_PANO_LOADED:"first.pano.loaded",FIRST_PANO_ANIMATION_COMPLETE:"first.pano.animation.complete",CORE_LOADED:"core.loaded",DISABLE_DOLLHOUSE_CONTROL:"disable.dollhouse.control",DISABLE_PANORAMA_CONTROL:"disable.panorama.control",DISABLE_FLOORPLAN_CONTROL:"disable.floorplan.control",DISABLE_ZOOM_CONTROL:"disable.zoom.control",ENABLE_ZOOM_CONTROL:"enable.zoom.control",CORE_RENDER_STAGE_RESIZE:"core.render.stage.resize",ENABLE_MAGNIFYING_MODE:"core.enable.magnifying.mode",DISABLE_MAGNIFYING_MODE:"core.disable.magnifying.mode",LOADING_PANO_TILE:"loading.pano.tile",LOADED_PANO_TILE:"loaded.pano.tile",STOP_RENDER:"core.stop.render",PUREPANO_LOADED:"purepano.loaded",PUREPANO_ANIMATION_START:"purepano.animation.start",PUREPANO_ANIMATION_END:"purepano.animation.end",FRAME_UPDATE:"frame.update"}),X=Object.freeze({ACTION_MODE_DOLLHOUSE:"action.mode.dollhouse",ACTION_MODE_PANORAMA:"action.mode.panorama",ACTION_MODE_FLOORPLAN:"action.mode.floorplan",ACTION_MODE_TRANSITION:"action.mode.transitioning",MODE_CHANGED:"mode.changed",SWITCH_TO_PANORAMA_MODE_COMPLETE:"switch.to.panorama.mode.complete",SWITCH_TO_DOLLHOUSE_MODE_COMPLETE:"switch.to.dollhouse.mode.complete",SWITCH_TO_FLOORPLAN_MODE_COMPLETE:"switch.to.floorplan.mode.complete",SWITCH_TO_PANO:"switch.to.pano",SWITCH_TO_PANO_TRANSITION:"switch.to.pano.transition",SWITCH_TO_PANO_COMPLETE:"switch.to.pano.complete",DISABLE_SWITCH_TO_NEW_MODE:"disable.switch.to.new.mode",DISABLE_SWITCH_PANO:"disable.switch.pano",PANORAMA_CAMERA_ROTATE:"panorama.camera.rotate",DOLLHOUSE_CAMERA_ROTATE:"dollhouse.camera.rotate",PANORAMA_CAMERA_ROTATE_STOP:"panorama.camera.rotate.stop",DOLLHOUSE_CAMERA_ROTATE_STOP:"dollhouse.camera.rotate.stop",DISABLE_HIT_WALL:"disable.hit.wall",ENABLE_HIT_WALL:"enable.hit.wall",ANIMATION_HIT_WALL_START:"animation.hit.wall.start",ANIMATION_HIT_WALL_END:"animation.hit.wall.end",PANORAMA_CAMERA_ZOOM_CHANGED:"panorama.camera.zoom.changed",DOLLHOUSE_CAMERA_ZOOM_CHANGED:"dollhouse.camera.zoom.changed",DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CHANGED:"dollhouse.camera.distance.zoom.changed",FLOORPLAN_CAMERA_ZOOM_CHANGED:"floorplan.camera.zoom.changed",DOLLHOUSE_CAMERA_DRAG_MOVING:"dollhouse.camera.drag.moving",FLOORPLAN_CAMERA_DRAG_MOVING:"floorplan.camera.drag.moving"}),Z=function(){this.name="action.event.hook",this.hook=Object.create(null),this.hookCb=Object.create(null)};Z.prototype.addEventListener=function(t,e,r){var i=this.name+" add event listener<"+t+">";void 0!==this.hookCb[t]?-1===this.hookCb[t].indexOf(e)?this.hookCb[t].push(e):n.error(i+" failure, reason: repeat add callback!!!\r\n, cmd:"+r)():n.error(i+" failure, reason: invalid event<"+t+">")()},Z.prototype.removeEventListener=function(t,e,r){var i=this.name+" remove event listener<"+t+">";if(void 0!==this.hookCb[t]){var o=this.hookCb[t].indexOf(e);-1!==o?this.hookCb[t].splice(o,1):n.error(i+" failure, reason: unget callback!!!\r\n, cmd:"+r)()}else n.error(i+" failure, reason: invalid event<"+t+">")()},Z.prototype.bind=function(){var t=this;n.info(this.name+" bind")();var e=Object.create(null);Object.keys(X).forEach((function(n){t.hookCb[X[n]]=[],e[X[n]]={get:function(){return t.hookCb[X[n]]},set:function(e){t.hookCb[X[n]].push(e)}}})),Object.defineProperties(this.hook,e)},Z.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.hook=Object.create(null),this.hookCb=Object.create(null)};var q=Object.freeze({SWITCH_MODEL:"switch.model",SWITCH_MODEL_COMPLETE:"switch.model.complete",SWITCH_PUREPANO_MODEL:"switch.purepnoa.model",SWITCH_PUREPANO_MODEL_COMPLETE:"switch.purepano.model.complete",DISABLE_SWITCH_MODEL:"disable.switch.model",DISABLE_SWITCH_PUREPANO:"disable.switch.purepano",SWITCH_FLOOR_COMPLETE:"set.floor.complete",ADD_MODEL_COMPLETE:"add.model.complete",WAYPOINT_HOVER_IN:"waypoint.hover.in",WAYPOINT_HOVER_OUT:"waypoint.hover.out"}),Q=function(){this.name="model.event.hook",this.hook=Object.create(null),this.hookCb=Object.create(null)};Q.prototype.bind=function(){var t=this;n.info(this.name+" bind")();var e=Object.create(null);Object.keys(q).forEach((function(n){t.hookCb[q[n]]=[],e[q[n]]={get:function(){return t.hookCb[q[n]]},set:function(e){t.hookCb[q[n]].push(e)}}})),Object.defineProperties(this.hook,e)},Q.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.hook=Object.create(null),this.hookCb=Object.create(null)};var K=function(){this.name="core.event.hook",this.hook=Object.create(null),this.hookCb=Object.create(null)};K.prototype.bind=function(t){var e=this;n.info(this.name+" bind")();var r=Object.create(null);Object.keys(Y).forEach((function(t){e.hookCb[Y[t]]=[],r[Y[t]]={get:function(){return e.hookCb[Y[t]]},set:function(n){e.hookCb[Y[t]].push(n)}}})),Object.defineProperties(this.hook,r)},K.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.hook=Object.create(null),this.hookCb=Object.create(null)};var J=Object.freeze({INTERSECT_WITHIN_MODEL:"intersect.within.model",UNINTERSECT_WITHIN_MODEL:"unintersect.within.model"}),$=function(){this.name="RaycasterEventHook",this.hook=Object.create(null),this.hookCb=Object.create(null)};$.prototype.bind=function(){var t=this;n.info(this.name+" bind")();var e=Object.create(null);Object.keys(J).forEach((function(n){t.hookCb[J[n]]=[],e[J[n]]={get:function(){return t.hookCb[J[n]]},set:function(e){t.hookCb[J[n]].push(e)}}})),Object.defineProperties(this.hook,e)},$.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.hook=Object.create(null),this.hookCb=Object.create(null)};var tt=Object.freeze({SESSION_START:"session.start",SESSION_END:"session.end",RIGHT_GAMEPAD_SELECT_BTN_DOWN:"right.gamepad.select.btn.down",RIGHT_GAMEPAD_SELECT_BTN_UP:"right.gamepad.select.btn.up",RIGHT_GAMEPAD_SELECT_BTN_CLICK:"right.gamepad.select.btn.click",RIGHT_GAMEPAD_SQUEEZE_BTN_DOWN:"right.gamepad.squeeze.btn.down",RIGHT_GAMEPAD_SQUEEZE_BTN_UP:"right.gamepad.squeeze.btn.up",RIGHT_GAMEPAD_SQUEEZE_BTN_CLICK:"right.gamepad.squeeze.btn.click",RIGHT_GAMEPAD_A_BTN_DOWN:"right.gamepad.a.btn.down",RIGHT_GAMEPAD_A_BTN_UP:"right.gamepad.a.btn.up",RIGHT_GAMEPAD_A_BTN_CLICK:"right.gamepad.a.btn.click",RIGHT_GAMEPAD_B_BTN_DOWN:"right.gamepad.b.btn.down",RIGHT_GAMEPAD_B_BTN_UP:"right.gamepad.b.btn.up",RIGHT_GAMEPAD_B_BTN_CLICK:"right.gamepad.b.btn.click",RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START:"right.gamepad.thumb.btn.touch.start",RIGHT_GAMEPAD_THUMB_BTN_TOUCH_END:"right.gamepad.thumb.btn.touch.end",RIGHT_GAMEPAD_THUMB_BTN_AXES_CHANGE:"right.gamepad.thumb.btn.axes.change",RIGHT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER:"right.gamepad.thumb.btn.axes.left.trigger",RIGHT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER:"right.gamepad.thumb.btn.axes.right.trigger",RIGHT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE:"right.gamepad.thumb.btn.axes.reset.pose",LEFT_GAMEPAD_SELECT_BTN_DOWN:"left.gamepad.select.btn.down",LEFT_GAMEPAD_SELECT_BTN_UP:"left.gamepad.select.btn.up",LEFT_GAMEPAD_SELECT_BTN_CLICK:"left.gamepad.select.btn.click",LEFT_GAMEPAD_X_BTN_DOWN:"left.gamepad.a.btn.down",LEFT_GAMEPAD_X_BTN_UP:"left.gamepad.a.btn.up",LEFT_GAMEPAD_X_BTN_CLICK:"left.gamepad.a.btn.click",LEFT_GAMEPAD_Y_BTN_DOWN:"left.gamepad.b.btn.down",LEFT_GAMEPAD_Y_BTN_UP:"left.gamepad.b.btn.up",LEFT_GAMEPAD_Y_BTN_CLICK:"left.gamepad.b.btn.click",LEFT_GAMEPAD_THUMB_BTN_TOUCH_START:"left.gamepad.thumb.btn.touch.start",LEFT_GAMEPAD_THUMB_BTN_TOUCH_END:"left.gamepad.thumb.btn.touch.end",LEFT_GAMEPAD_THUMB_BTN_AXES_CHANGE:"left.gamepad.thumb.btn.axes.change",LEFT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER:"left.gamepad.thumb.btn.axes.left.trigger",LEFT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER:"left.gamepad.thumb.btn.axes.right.trigger",LEFT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE:"left.gamepad.thumb.btn.axes.reset.pose",INTERSECT_POINT:"controller.raylin.intersect.point"}),et=function(){this.name="web.xr.hook",this.hook=Object.create(null),this.hookCb=Object.create(null)};et.prototype.bind=function(){var t=this;n.info(this.name+" bind")();var e=Object.create(null);Object.keys(tt).forEach((function(n){t.hookCb[tt[n]]=[],e[tt[n]]={get:function(){return t.hookCb[tt[n]]},set:function(e){t.hookCb[tt[n]].push(e)}}})),Object.defineProperties(this.hook,e)},et.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.hook=Object.create(null),this.hookCb=Object.create(null)};var nt=Object.freeze({MOUSE_OVER:"mouse.over",MOUSE_OUT:"mouse.out",MOUSE_MOVE:"mouse.move",MOUSE_DOWN:"mouse.down",MOUSE_UP:"mouse.up",MOUSE_WHEEL:"mouse.wheel",MOUSE_LEFT_BUTTON_DOWN:"mouse.left.button.down",MOUSE_LEFT_BUTTON_UP:"mouse.left.button.up",MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE:"mouse.left.button.down.within.move",MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE:"mouse.left.button.down.up.without.move",MOUSE_RIGHT_BUTTON_DOWN:"mouse.right.button.down",MOUSE_RIGHT_BUTTON_UP:"mouse.right.button.up",MOUSE_RIGHT_BUTTON_DOWN_WITHIN_MOVE:"mouse.right.button.down.within.move",MOUSE_RIGHT_BUTTON_DOWN_UP_WITHOUT_MOVE:"mouse.right.button.down.without.move",MOUSE_MOVE_WITHOUT_BUTTON_DOWN:"mouse.move.without.button.down",MOUSE_MOVE_STOP:"mouse.move.stop",MOUSE_WHEEL_FORWARD:"mouse.wheel.forward",MOUSE_WHEEL_BACKWARD:"mouse.wheel.backward"}),rt=function(){this.name="mouse.event.hook",this.hook=Object.create(null),this.hookCb=Object.create(null)};rt.prototype.addEventListener=function(t,e,r){var i=this.name+" add event listener<"+t+">";void 0!==this.hookCb[t]?-1===this.hookCb[t].indexOf(e)?this.hookCb[t].push(e):n.error(i+" failure, reason: repeat add callback!!!\r\n, cmd:"+r)():n.error(i+" failure, reason: invalid event<"+t+">")()},rt.prototype.removeEventListener=function(t,e,r){var i=this.name+" remove event listener<"+t+">";if(void 0!==this.hookCb[t]){var o=this.hookCb[t].indexOf(e);-1!==o?this.hookCb[t].splice(o,1):n.error(i+" failure, reason: unget callback!!!\r\n, cmd:"+r)()}else n.error(i+" failure, reason: invalid event<"+t+">")()},rt.prototype.bind=function(){var t=this;n.info(this.name+" bind")();var e=Object.create(null);Object.keys(nt).forEach((function(n){t.hookCb[nt[n]]=[],e[nt[n]]={get:function(){return t.hookCb[nt[n]]},set:function(e){t.hookCb[nt[n]].push(e)}}})),Object.defineProperties(this.hook,e)},rt.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.hook=Object.create(null),this.hookCb=Object.create(null)};var it=Object.freeze({KEY_DOWN:"keyboard.down",KEY_UP:"keyboard.up",KEY_W_DOWN:"keyboard.w.down",KEY_A_DOWN:"keyboard.a.down",KEY_S_DOWN:"keyboard.s.down",KEY_D_DOWN:"keyboard.d.down",KEY_W_UP:"keyboard.w.up",KEY_A_UP:"keyboard.a.up",KEY_S_UP:"keyboard.s.up",KEY_D_UP:"keyboard.d.up",KEY_LEFT_ARROW_DOWN:"keyboard.left.arrow.down",KEY_RIGHT_ARROW_DOWN:"keyboard.right.arrow.down",KEY_UP_ARROW_DOWN:"keyboard.up.arrow.down",KEY_DOWN_ARROW_DOWN:"keyboard.down.arrow.down",KEY_LEFT_ARROW_UP:"keyboard.left.arrow.up",KEY_RIGHT_ARROW_UP:"keyboard.right.arrow.up",KEY_UP_ARROW_UP:"keyboard.up.arrow.up",KEY_DOWN_ARROW_UP:"keyboard.down.arrow.up"}),ot=function(){this.name="keyboard.event.hook",this.hook=Object.create(null),this.hookCb=Object.create(null)};ot.prototype.addEventListener=function(t,e,r){var i=this.name+" add event listener<"+t+">";void 0!==this.hookCb[t]?-1===this.hookCb[t].indexOf(e)?this.hookCb[t].push(e):n.error(i+" failure, reason: repeat add callback!!!\r\n, cmd:"+r)():n.error(i+" failure, reason: invalid event<"+t+">")()},ot.prototype.removeEventListener=function(t,e,r){var i=this.name+" remove event listener<"+t+">";if(void 0!==this.hookCb[t]){var o=this.hookCb[t].indexOf(e);-1!==o?this.hookCb[t].splice(o,1):n.error(i+" failure, reason: unget callback!!!\r\n, cmd:"+r)()}else n.error(i+" failure, reason: invalid event<"+t+">")()},ot.prototype.bind=function(){var t=this;n.info(this.name+" bind")();var e=Object.create(null);Object.keys(it).forEach((function(n){t.hookCb[it[n]]=[],e[it[n]]={get:function(){return t.hookCb[it[n]]},set:function(e){t.hookCb[it[n]].push(e)}}})),Object.defineProperties(this.hook,e)},ot.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.hook=Object.create(null),this.hookCb.clear()};var at=Object.freeze({HANDLE_TOUCH_START:"handle.touch.start",HANDLE_TOUCH_END:"handle.touch.end",HANDLE_TOUCH_MOVE:"handle.touch.move",HANDLE_TOUCH_CANCEL:"handle.touch.cancel",HANDLE_SINGLE_TOUCH_START:"handle.single.touch.start",HANDLE_SINGLE_TOUCH_END:"handle.single.touch.end",HANDLE_SINGLE_TOUCH_CLICK:"handle.single.touch.click",HANDLE_SINGLE_TOUCH_MOVE:"handle.single.touch.move",HANDLE_SINGLE_TOUCH_START_CHANGED:"handle.single.touch.start.changed",HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS:"handle.single.touch.start.of.long.press",HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS:"handle.single.touch.move.of.long.press",HANDLE_DOUBLE_TOUCH_START:"handle.double.touch.start",HANDLE_DOUBLE_TOUCH_MOVE:"handle.double.touch.move",HANDLE_DOUBLE_TOUCH_ZOOM_IN:"handle.double.touch.zoom.in",HANDLE_DOUBLE_TOUCH_ZOOM_OUT:"handle.double.touch.zoom.out",HANDLE_MANY_TOUCH_START:"handle.many.touch.start",HANDLE_MANY_TOUCH_MOVE:"handle.many.touch.move"}),st=function(){this.name="handle.event.hook",this.hook=Object.create(null),this.hookCb=Object.create(null)};st.prototype.addEventListener=function(t,e,r){var i=this.name+" add event listener<"+t+">";void 0!==this.hookCb[t]?-1===this.hookCb[t].indexOf(e)?this.hookCb[t].push(e):n.error(i+" failure, reason: repeat add callback!!!\r\n, cmd:"+r)():n.error(i+" failure, reason: invalid event<"+t+">")()},st.prototype.removeEventListener=function(t,e,r){var i=this.name+" remove event listener<"+t+">";if(void 0!==this.hookCb[t]){var o=this.hookCb[t].indexOf(e);-1!==o?this.hookCb[t].splice(o,1):n.error(i+" failure, reason: unget callback!!!\r\n, cmd:"+r)()}else n.error(i+" failure, reason: invalid event<"+t+">")()},st.prototype.bind=function(){var t=this;n.info(this.name+" bind")();var e=Object.create(null);Object.keys(at).forEach((function(n){t.hookCb[at[n]]=[],e[at[n]]={get:function(){return t.hookCb[at[n]]},set:function(e){t.hookCb[at[n]].push(e)}}})),Object.defineProperties(this.hook,e)},st.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.hook=Object.create(null),this.hookCb=Object.create(null)};var lt=Object.create(null);lt.init=function(){n.info("--- HookManager init ---")(),delete lt.init,this.core=new K,this.model=new Q,this.action=new Z,this.webxr=new et,this.raycaster=new $,this.mouse=new rt,this.handle=new st,this.keyboard=new ot,this.core.bind(),this.model.bind(),this.action.bind(),this.webxr.bind(),this.raycaster.bind(),this.mouse.bind(),this.handle.bind(),this.keyboard.bind()};var ct=function(){this.name="core.state.engine",this.state=Object.create(null)};ct.prototype.init=function(){var t=this;Object.keys(Y).forEach((function(e){var n=Y[e],r=Object.create(null);r._state=!1,r._data=null,r._exec=null,t.state[n]=r,t.defineGetterSetter(r,n)}))},ct.prototype.defineGetterSetter=function(t,e){var n=this;Object.defineProperties(t,{state:{get:function(){return t._state},set:function(r){n.checkEventState(t,e,r),t._state=r}},data:{get:function(){return t._data},set:function(e){t._data=e}},exec:{set:function(e){t._exec=e}}})},ct.prototype.checkEventState=function(t,e,n){switch(e){case Y.START_BOOT:lt.core.hook[Y.START_BOOT].forEach((function(e){return e(t._data)}));break;case Y.CORE_BOOT_COMPLETE:lt.core.hook[Y.CORE_BOOT_COMPLETE].forEach((function(e){return e(t._data)}));break;case Y.FIRST_PANO_LOADED:lt.core.hook[Y.FIRST_PANO_LOADED].forEach((function(e){return e(t._data)}));break;case Y.CORE_LOADED:!0===n&&lt.core.hook[Y.CORE_LOADED].forEach((function(e){return e(t._data)}));break;case Y.CORE_RENDER_STAGE_RESIZE:1==n&&lt.core.hook[Y.CORE_RENDER_STAGE_RESIZE].forEach((function(e){return e(t._data)}));break;case Y.DISABLE_ZOOM_CONTROL:!0===n&&(this.state[Y.ENABLE_ZOOM_CONTROL].state=!1);break;case Y.ENABLE_ZOOM_CONTROL:!0===n&&(this.state[Y.DISABLE_ZOOM_CONTROL].state=!1);break;case Y.ENABLE_MAGNIFYING_MODE:!0===n&&(this.state[Y.DISABLE_MAGNIFYING_MODE].state=!1,lt.core.hook[Y.ENABLE_MAGNIFYING_MODE].forEach((function(e){return e(t._data)})));break;case Y.DISABLE_MAGNIFYING_MODE:!0===n&&(this.state[Y.ENABLE_MAGNIFYING_MODE].state=!1,lt.core.hook[Y.DISABLE_MAGNIFYING_MODE].forEach((function(e){return e(t._data)})));break;case Y.LOADING_PANO_TILE:!0===n&&(this.state[Y.LOADED_PANO_TILE].state=!1,lt.core.hook[Y.LOADING_PANO_TILE].forEach((function(e){return e(t._data)})));break;case Y.LOADED_PANO_TILE:!0===n&&(this.state[Y.LOADING_PANO_TILE].state=!1,lt.core.hook[Y.LOADED_PANO_TILE].forEach((function(e){return e(t._data)})));break;case Y.PUREPANO_LOADED:!0===n&&(this.state[Y.PUREPANO_ANIMATION_START].state=!1,this.state[Y.PUREPANO_ANIMATION_END].state=!1,lt.core.hook[Y.PUREPANO_LOADED].forEach((function(e){return e(t._data)})));break;case Y.PUREPANO_ANIMATION_START:!0===n&&(this.state[Y.PUREPANO_ANIMATION_END].state=!1,lt.core.hook[Y.PUREPANO_ANIMATION_START].forEach((function(e){return e(t._data)})));break;case Y.PUREPANO_ANIMATION_END:!0===n&&lt.core.hook[Y.PUREPANO_ANIMATION_END].forEach((function(e){return e(t._data)}));break;case Y.FRAME_UPDATE:!0===n&&lt.core.hook[Y.FRAME_UPDATE].forEach((function(e){return e(t._data)}))}};var ut=null,ht=function(){ut=k.getCore(),this.name="action.state.engine",this.state=Object.create(null)};ht.prototype.init=function(){var t=this;Object.keys(X).forEach((function(e){var n=X[e],r=Object.create(null);r._state=!1,r._data=null,r._exec=null,t.state[n]=r,t.defineGetterSetter(r,n)}))},ht.prototype.defineGetterSetter=function(t,e){var n=this;Object.defineProperties(t,{state:{get:function(){return t._state},set:function(r){n.checkEventState(e,t,r),t._state=r}},data:{get:function(){return t._data},set:function(e){t._oldData=t.data,t._data=e}},exec:{set:function(e){t._exec=e}},cmd:{set:function(e){t._cmd=e},get:function(){return t._cmd}}})},ht.prototype.checkEventState=function(t,e,r){switch(t){case X.ACTION_MODE_PANORAMA:!0===r&&(this.state[X.ACTION_MODE_TRANSITION].state=!0,this.state[X.SWITCH_TO_PANORAMA_MODE_COMPLETE].state=!1,this.state[X.DISABLE_SWITCH_TO_NEW_MODE].state=!0,lt.action.hook[X.ACTION_MODE_PANORAMA].forEach((function(t){return t(e._data)})));break;case X.ACTION_MODE_DOLLHOUSE:!0===r&&(this.state[X.ACTION_MODE_TRANSITION].state=!0,this.state[X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].state=!1,this.state[X.DISABLE_SWITCH_TO_NEW_MODE].state=!0,lt.action.hook[X.ACTION_MODE_DOLLHOUSE].forEach((function(t){return t(e._data)})));break;case X.ACTION_MODE_FLOORPLAN:!0===r&&(this.state[X.ACTION_MODE_TRANSITION].state=!0,this.state[X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].state=!1,this.state[X.DISABLE_SWITCH_TO_NEW_MODE].state=!0,lt.action.hook[X.ACTION_MODE_FLOORPLAN].forEach((function(t){return t(e._data)})));break;case X.ACTION_MODE_TRANSITION:!0===r&&lt.action.hook[X.ACTION_MODE_TRANSITION].forEach((function(t){return t({mode:G.TRANSITIONING})})),!1===r&&(this.state[X.DISABLE_SWITCH_TO_NEW_MODE].state=!1);break;case X.MODE_CHANGED:!0===r&&(this.state[X.MODE_CHANGED].state=!1,ut.commonExtension[z.NEED_MODE_CHANGE]&&ut.commonExtension[z.NEED_MODE_CHANGE]({mode:e._data}),lt.action.hook[X.MODE_CHANGED].forEach((function(t){return t(e._data)})));break;case X.DISABLE_SWITCH_TO_NEW_MODE:break;case X.SWITCH_TO_PANORAMA_MODE_COMPLETE:!0===r&&(this.state[X.ACTION_MODE_TRANSITION].state=!1,this.state[X.ACTION_MODE_PANORAMA].state=!1,this.state[X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].state=!1,this.state[X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].state=!1,lt.action.hook[X.SWITCH_TO_PANORAMA_MODE_COMPLETE].forEach((function(t){return t({mode:G.PANORAMA})})));break;case X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE:!0===r&&(this.state[X.ACTION_MODE_TRANSITION].state=!1,this.state[X.ACTION_MODE_DOLLHOUSE].state=!1,this.state[X.SWITCH_TO_PANORAMA_MODE_COMPLETE].state=!1,this.state[X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].state=!1,lt.action.hook[X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].forEach((function(t){return t({mode:G.DOLLHOUSE})})));break;case X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE:!0===r&&(this.state[X.ACTION_MODE_TRANSITION].state=!1,this.state[X.ACTION_MODE_FLOORPLAN].state=!1,this.state[X.SWITCH_TO_PANORAMA_MODE_COMPLETE].state=!1,this.state[X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].state=!1,lt.action.hook[X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].forEach((function(t){return t({mode:G.FLOORPLAN})})));break;case X.SWITCH_TO_PANO:!0===r&&(this.state[X.SWITCH_TO_PANO_COMPLETE].state=!1,this.state[X.DISABLE_SWITCH_PANO].cmd=X.SWITCH_TO_PANO,this.state[X.DISABLE_SWITCH_PANO].state=!0,ut.commonExtension[z.NEED_SWITCH_WAYPOINT_START]&&ut.commonExtension[z.NEED_SWITCH_WAYPOINT_START](e._data),lt.action.hook[X.SWITCH_TO_PANO].forEach((function(t){return t(e._data)})));break;case X.DISABLE_SWITCH_PANO:break;case X.SWITCH_TO_PANO_TRANSITION:!0===r&&(ut.commonExtension[z.NEED_SWITCH_WAYPOINT_TRANSITION]&&ut.commonExtension[z.NEED_SWITCH_WAYPOINT_TRANSITION](e._data),lt.action.hook[X.SWITCH_TO_PANO_TRANSITION].forEach((function(t){return t(e._data)}))),!1===r&&(this.state[X.DISABLE_SWITCH_TO_NEW_MODE].state=!1);break;case X.SWITCH_TO_PANO_COMPLETE:!0===r&&(this.state[X.SWITCH_TO_PANO].state=!1,this.state[X.SWITCH_TO_PANO_TRANSITION].state=!1,this.state[X.DISABLE_SWITCH_PANO].cmd=X.SWITCH_TO_PANO_COMPLETE,this.state[X.DISABLE_SWITCH_PANO].state=!1,ut.commonExtension[z.NEED_SWITCH_WAYPOINT_COMPLETE]&&ut.commonExtension[z.NEED_SWITCH_WAYPOINT_COMPLETE](e._data),lt.action.hook[X.SWITCH_TO_PANO_COMPLETE].forEach((function(t){return t(e._data)})));break;case X.PANORAMA_CAMERA_ROTATE:!0===r&&(this.state[X.PANORAMA_CAMERA_ROTATE_STOP].state=!1,ut.commonExtension[z.NEED_PANORAMA_CAMERA_ROTATE]&&ut.commonExtension[z.NEED_PANORAMA_CAMERA_ROTATE](e._data),lt.action.hook[X.PANORAMA_CAMERA_ROTATE].forEach((function(t){return t(e._data)})));break;case X.DOLLHOUSE_CAMERA_ROTATE:!0===r&&(this.state[X.DOLLHOUSE_CAMERA_ROTATE_STOP].state=!1,lt.action.hook[X.DOLLHOUSE_CAMERA_ROTATE].forEach((function(t){return t(e._data)})));break;case X.PANORAMA_CAMERA_ROTATE_STOP:!0===r&&(this.state[X.PANORAMA_CAMERA_ROTATE].state=!1,ut.commonExtension[z.NEED_PANORAMA_CAMERA_ROTATE_STOP]&&ut.commonExtension[z.NEED_PANORAMA_CAMERA_ROTATE_STOP](e._data),lt.action.hook[X.PANORAMA_CAMERA_ROTATE_STOP].forEach((function(t){return t(e._data)})));break;case X.DOLLHOUSE_CAMERA_ROTATE_STOP:!0===r&&(this.state[X.DOLLHOUSE_CAMERA_ROTATE].state=!1,lt.action.hook[X.DOLLHOUSE_CAMERA_ROTATE_STOP].forEach((function(t){return t(e._data)})));break;case X.PANORAMA_CAMERA_ZOOM_CHANGED:!0===r&&(this.state[X.PANORAMA_CAMERA_ZOOM_CHANGED].state=!1,ut.commonExtension[z.NEED_PANORAMA_CAMERA_ZOOM_CHANGED]&&ut.commonExtension[z.NEED_PANORAMA_CAMERA_ZOOM_CHANGED](e._data),lt.action.hook[X.PANORAMA_CAMERA_ZOOM_CHANGED].forEach((function(t){return t(e._data)})));break;case X.DOLLHOUSE_CAMERA_ZOOM_CHANGED:!0===r&&(this.state[X.DOLLHOUSE_CAMERA_ZOOM_CHANGED].state=!1,ut.commonExtension[z.NEED_DOLLHOUSE_CAMERA_ZOOM_CHANGED]&&ut.commonExtension[z.NEED_DOLLHOUSE_CAMERA_ZOOM_CHANGED](e._data),lt.action.hook[X.DOLLHOUSE_CAMERA_ZOOM_CHANGED].forEach((function(t){return t(e._data)})));break;case X.DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CHANGED:!0===r&&(this.state[X.DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CHANGED].state=!1,lt.action.hook[X.DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CHANGED].forEach((function(t){return t(e._data)})));break;case X.FLOORPLAN_CAMERA_ZOOM_CHANGED:!0===r&&(this.state[X.FLOORPLAN_CAMERA_ZOOM_CHANGED].state=!1,lt.action.hook[X.FLOORPLAN_CAMERA_ZOOM_CHANGED].forEach((function(t){return t(e._data)})));break;case X.DOLLHOUSE_CAMERA_DRAG_MOVING:!0===r&&lt.action.hook[X.DOLLHOUSE_CAMERA_DRAG_MOVING].forEach((function(t){return t(e._data)}));break;case X.FLOORPLAN_CAMERA_DRAG_MOVING:!0===r&&lt.action.hook[X.FLOORPLAN_CAMERA_DRAG_MOVING].forEach((function(t){return t(e._data)}));break;case X.DISABLE_HIT_WALL:!0===r&&(this.state[X.ENABLE_HIT_WALL].state=!1);break;case X.ENABLE_HIT_WALL:!0===r&&(this.state[X.DISABLE_HIT_WALL].state=!1,this.state[X.DISABLE_SWITCH_PANO].cmd=X.ENABLE_HIT_WALL);break;case X.ANIMATION_HIT_WALL_START:n.error(X.ANIMATION_HIT_WALL_START,r)();break;case X.ANIMATION_HIT_WALL_END:n.error(X.ANIMATION_HIT_WALL_END,r)()}};var pt=function(){this.name="model.state.engine",this.state=Object.create(null)};function dt(t,e){return"[object String]"===Object.prototype.toString.call(t)||(n.error(e+" is not string")(),!1)}function ft(t,e){return"[object Number]"===Object.prototype.toString.call(t)||(n.error(e+" is not number")(),!1)}function mt(t,e){return"[object Function]"===Object.prototype.toString.call(t)||(n.error(e+" is not function")(),!1)}function vt(t,e){return"[object Object]"===Object.prototype.toString.call(t)||(n.error(e+" is not object")(),!1)}function gt(t,e){return"[object Array]"===Object.prototype.toString.call(t)||(e&&n.error(e+" is not array")(),!1)}function yt(t,e){return t instanceof L.Object3D||(n.error(e+" is not object3d!")(),!1)}function _t(t,e){return t.map((function(t,e){return{value:t,index:e}})).sort((function(t,n){var r=e(t.value,n.value);return 0!==r?r:t.index-n.index})).map((function(t){return t.value}))}function Et(t,e){return t.filter((function(t){return e.every((function(e){return e(t)}))}))}function Tt(t){var e=arguments;t=t||{};for(var n=1;n<arguments.length;n++){var r=e[n];if(r)for(var i in r)r.hasOwnProperty(i)&&("object"==typeof r[i]?t[i]=Tt(t[i],r[i]):t[i]=r[i])}return t}function xt(t){return JSON.parse(JSON.stringify(t))}function bt(){for(var t=[],e=0;e<36;e++)t[e]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}function Mt(){var t=0,e=new At;this.where=function(n,r){void 0===n&&(n=1e3),void 0===r&&(r=function(){}),t++,e.pipe(n,(function(){r(t),t=0}))}}function At(){var t=[];this.pipe=function(e,n){return t.push(Date.now()||(new Date).getTime()),2===t.length&&(e>t[1]-t[0]?(t.pop(),!0):(n&&n(),t.shift(),!1))},this.clear=function(){t=[]}}function St(t,e){var n=this;void 0===t&&(t=0),void 0===e&&(e=function(){}),this.result=[],this.count=t,this.record=function(t){n.result.push(t),n.count===n.result.length&&(e(),n.result=[],n.record=function(){})}}function Ot(t,e,n){for(var r=null,i=0,o=t.length;i<o;++i)if(n===t[i][e]){r=t[i];break}return r}function wt(t,e){return e.filter((function(e){return-1!==t.indexOf(e)}))}function Lt(t,e){return t.filter((function(t){return-1===e.indexOf(t)}))}pt.prototype.init=function(){var t=this;Object.keys(q).forEach((function(e){var n=q[e],r=Object.create(null);r._state=!1,r._data=null,r._exec=null,t.state[n]=r,t.defineProperty(r,n)}))},pt.prototype.defineProperty=function(t,e){var n=this;Object.defineProperties(t,{state:{get:function(){return t._state},set:function(r){n.checkEventState(e,t,r),t._state=r}},data:{get:function(){return t._data},set:function(e){t._data=e}},exec:{set:function(e){t._exec=e}}})},pt.prototype.checkEventState=function(t,e,n){switch(t){case q.SWITCH_MODEL:!0===n&&(this.state[q.SWITCH_MODEL_COMPLETE].state=!1,this.state[q.DISABLE_SWITCH_MODEL].state=!0,this.state[q.DISABLE_SWITCH_PUREPANO].state=!0,lt.model.hook[q.SWITCH_MODEL].forEach((function(t){return t(e.data)})));break;case q.SWITCH_PUREPANO_MODEL:!0===n&&(this.state[q.SWITCH_PUREPANO_MODEL_COMPLETE].state=!1,this.state[q.DISABLE_SWITCH_MODEL].state=!0,this.state[q.DISABLE_SWITCH_PUREPANO].state=!0,lt.model.hook[q.SWITCH_PUREPANO_MODEL].forEach((function(t){return t(e.data)})));break;case q.DISABLE_SWITCH_MODEL:case q.DISABLE_SWITCH_PUREPANO:break;case q.SWITCH_MODEL_COMPLETE:!0===n&&(this.state[q.SWITCH_MODEL].state=!1,this.state[q.DISABLE_SWITCH_MODEL].state=!1,this.state[q.DISABLE_SWITCH_PUREPANO].state=!1,lt.model.hook[q.SWITCH_MODEL_COMPLETE].forEach((function(t){return t(e.data)})));break;case q.SWITCH_PUREPANO_MODEL_COMPLETE:!0===n&&(this.state[q.SWITCH_PUREPANO_MODEL].state=!1,this.state[q.DISABLE_SWITCH_MODEL].state=!1,this.state[q.DISABLE_SWITCH_PUREPANO].state=!1);break;case q.SWITCH_FLOOR_COMPLETE:!0===n&&lt.model.hook[q.SWITCH_FLOOR_COMPLETE].forEach((function(t){return t(e.data)}));break;case q.ADD_MODEL_COMPLETE:!0===n&&lt.model.hook[q.ADD_MODEL_COMPLETE].forEach((function(t){return t(e.data)}));break;case q.WAYPOINT_HOVER_IN:!0===n&&(this.state[q.WAYPOINT_HOVER_OUT].state=!1,lt.model.hook[q.WAYPOINT_HOVER_IN].forEach((function(t){return t(e.data)})));break;case q.WAYPOINT_HOVER_OUT:!0===n&&(this.state[q.WAYPOINT_HOVER_IN].state=!1,lt.model.hook[q.WAYPOINT_HOVER_OUT].forEach((function(t){return t(e.data)})))}};var Dt={__proto__:null,stableSort:_t,filterAll:Et,extendObject:function(t,e){return Object.keys(e).forEach((function(n){t[n]=e[n]})),t},deepExtend:Tt,extend:function(t,e){for(var n in e.prototype)t.prototype[n]=e.prototype[n]},checkNestedPremers:function(t){function e(t){this.data=t}function n(t){this.root=t,this.flag=!0}return n.prototype.build=function(t,n){if(this.flag){var r=[].concat(n);r.push(t.data),new Set(r).size!==r.length&&(this.flag=!1);for(var i=Object.entries(t.data),o=0,a=i.length;o<a;++o){var s=i[o][0];if(this.flag&&t.data[s]&&t.data[s]instanceof Object){var l=new e(t.data[s]);this.build.call(this,l,r)}}}},function(t){var r=new n(new e(t));r.build(r.root,[]),r.flag}(t)},deepClone2:xt,createUuid:bt,checkObjIdentity:function(t,e){return t?t instanceof e&&t.constructor===e||(n.warn("checkCCoreUsable <obj> 类型错误")(),!1):(n.warn("checkCCoreUsable <obj> 不可用")(),!1)},arrayEleFind:Ot,deepFreeze:function(t){var e=function(t){for(var n=Object.keys(t),r=0;r<n.length;++r){var i=n[r];vt(t[i])&&(Object.freeze(t[i]),e(t[i]))}};e(t)},createCleanObj:function(t){for(var e=Object.create(null),n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];e[r]=i}return e},freezeObj:function(t){Object.freeze(t)},getArrayintersection:wt,getArrayExcept:Lt,Throttle:At,RecoredExecResult:St,UpdateFrameExecTimes:Mt},Ct=function(){j.set("mouse.state.engine",this),this.name="mouse.state.engine",this.state=Object.create(null)};Ct.prototype.init=function(){for(var t in nt){var e=nt[t],n=Object.create(null);n.name=e,n.uuid=bt(),n._state=!1,n._data=null,n._exec=null,this.state[e]=n,this.defineProperty(n,e)}},Ct.prototype.defineProperty=function(t,e){var r=this;try{Object.defineProperties(t,{state:{get:function(){return t._state},set:function(n){r.checkEventState(e,t,n),t._state=n}},data:{get:function(){return t._data},set:function(e){t._data=e}},exec:{set:function(e){t._exec=e}}})}catch(t){n.error("mouse state engine defineProperty catch err:",t)()}},Ct.prototype.checkEventState=function(t,e,n){switch(t){case nt.MOUSE_OVER:!0===n&&(this.state[nt.MOUSE_OUT].state=!1,lt.mouse.hook[nt.MOUSE_OVER].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_OUT:!0===n&&(this.state[nt.MOUSE_OVER].state=!1,this.state[nt.MOUSE_DOWN].state=!1,lt.mouse.hook[nt.MOUSE_OUT].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_MOVE:!0===n&&(this.state[nt.MOUSE_OUT].state=!1);break;case nt.MOUSE_DOWN:!0===n&&(this.state[nt.MOUSE_UP].state=!1),!1===n&&(this.state[nt.MOUSE_LEFT_BUTTON_DOWN].state=!1,this.state[nt.MOUSE_RIGHT_BUTTON_DOWN].state=!1);break;case nt.MOUSE_UP:!0===n&&(this.state[nt.MOUSE_DOWN].state=!1),!1===n&&(this.state[nt.MOUSE_LEFT_BUTTON_UP].state=!1,this.state[nt.MOUSE_RIGHT_BUTTON_UP].state=!1);break;case nt.MOUSE_LEFT_BUTTON_DOWN:!0===n&&(this.state[nt.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE].state=!1,lt.mouse.hook[nt.MOUSE_LEFT_BUTTON_DOWN].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_LEFT_BUTTON_UP:!0===n&&(this.state[nt.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE].state=!1,lt.mouse.hook[nt.MOUSE_LEFT_BUTTON_UP].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_WHEEL:break;case nt.MOUSE_WHEEL_FORWARD:!0===n&&(this.state[nt.MOUSE_WHEEL_BACKWARD].state=!1,lt.mouse.hook[nt.MOUSE_WHEEL_FORWARD].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_WHEEL_BACKWARD:!0===n&&(this.state[nt.MOUSE_WHEEL_FORWARD].state=!1,lt.mouse.hook[nt.MOUSE_WHEEL_BACKWARD].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE:!0===n&&(this.state[nt.MOUSE_LEFT_BUTTON_UP].state=!1,lt.mouse.hook[nt.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE:!0===n&&(this.state[nt.MOUSE_MOVE].state=!1,lt.mouse.hook[nt.MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_RIGHT_BUTTON_DOWN:!0===n&&(this.state[nt.MOUSE_RIGHT_BUTTON_UP].state=!1,lt.mouse.hook[nt.MOUSE_RIGHT_BUTTON_DOWN].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_RIGHT_BUTTON_UP:!0===n&&(this.state[nt.MOUSE_RIGHT_BUTTON_DOWN].state=!1,lt.mouse.hook[nt.MOUSE_RIGHT_BUTTON_UP].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_RIGHT_BUTTON_DOWN_WITHIN_MOVE:!0===n&&lt.mouse.hook[nt.MOUSE_RIGHT_BUTTON_DOWN_WITHIN_MOVE].forEach((function(t){return t(e._data)}));break;case nt.MOUSE_MOVE_STOP:!0===n&&(this.state[nt.MOUSE_MOVE].state=!1,lt.mouse.hook[nt.MOUSE_MOVE_STOP].forEach((function(t){return t(e._data)})));break;case nt.MOUSE_MOVE_WITHOUT_BUTTON_DOWN:!0===n&&(this.state[nt.MOUSE_DOWN].state=!1,lt.mouse.hook[nt.MOUSE_MOVE_WITHOUT_BUTTON_DOWN].forEach((function(t){return t(e._data)})))}};var Pt=function(){this.name="keyboard.state.engine",this.state=Object.create(null)};Pt.prototype.init=function(){for(var t in it){var e=it[t],n=Object.create(null);n.name=e,n._state=!1,n._data=null,n._exec=null,this.state[e]=n,this.defineProperty(n,e)}},Pt.prototype.getState=function(){return Object.freeze(this.state)},Pt.prototype.defineProperty=function(t,e){var n=this;Object.defineProperties(t,{state:{get:function(){return t._state},set:function(r){n.checkEventState(e,t,r),t._state=r}},data:{get:function(){return t._data},set:function(e){t._data=e}},exec:{set:function(e){t._exec=e}}})},Pt.prototype.checkEventState=function(t,e,n){switch(t){case it.KEY_LEFT_ARROW_DOWN:!0===n&&(this.state[it.KEY_LEFT_ARROW_UP].state=!1,lt.keyboard.hook[it.KEY_LEFT_ARROW_DOWN].forEach((function(t){return t(e._data)})));break;case it.KEY_LEFT_ARROW_UP:!0===n&&(this.state[it.KEY_LEFT_ARROW_DOWN].state=!1,lt.keyboard.hook[it.KEY_LEFT_ARROW_UP].forEach((function(t){return t(e._data)})));break;case it.KEY_RIGHT_ARROW_DOWN:!0===n&&(this.state[it.KEY_RIGHT_ARROW_UP].state=!1,lt.keyboard.hook[it.KEY_RIGHT_ARROW_DOWN].forEach((function(t){return t(e._data)})));break;case it.KEY_RIGHT_ARROW_UP:!0===n&&(this.state[it.KEY_RIGHT_ARROW_DOWN].state=!1,lt.keyboard.hook[it.KEY_RIGHT_ARROW_UP].forEach((function(t){return t(e._data)})));break;case it.KEY_UP_ARROW_DOWN:!0===n&&(this.state[it.KEY_UP_ARROW_UP].state=!1,lt.keyboard.hook[it.KEY_UP_ARROW_DOWN].forEach((function(t){return t(e._data)})));break;case it.KEY_UP_ARROW_UP:!0===n&&(this.state[it.KEY_UP_ARROW_DOWN].state=!1,lt.keyboard.hook[it.KEY_UP_ARROW_UP].forEach((function(t){return t(e._data)})));break;case it.KEY_DOWN_ARROW_DOWN:!0===n&&(this.state[it.KEY_DOWN_ARROW_UP].state=!1,lt.keyboard.hook[it.KEY_DOWN_ARROW_DOWN].forEach((function(t){return t(e._data)})));break;case it.KEY_DOWN_ARROW_UP:!0===n&&(this.state[it.KEY_DOWN_ARROW_DOWN].state=!1,lt.keyboard.hook[it.KEY_DOWN_ARROW_UP].forEach((function(t){return t(e._data)})));break;case it.KEY_W_DOWN:!0===n&&lt.keyboard.hook[it.KEY_W_DOWN].forEach((function(t){return t(e._data)}));break;case it.KEY_A_DOWN:!0===n&&lt.keyboard.hook[it.KEY_A_DOWN].forEach((function(t){return t(e._data)}));break;case it.KEY_S_DOWN:!0===n&&lt.keyboard.hook[it.KEY_S_DOWN].forEach((function(t){return t(e._data)}));break;case it.KEY_D_DOWN:!0===n&&lt.keyboard.hook[it.KEY_D_DOWN].forEach((function(t){return t(e._data)}))}};var Nt=function(){j.set("handle.state.engine",this),this.name="handle.state.engine",this.state=Object.create(null)};Nt.prototype.init=function(){var t=this;Object.keys(at).forEach((function(e){var n=at[e],r=Object.create(null);r.name=n,r.uuid=bt(),r._state=!1,r._data=null,r._exec=null,t.state[n]=r,t.defineProperty(r,n)}))},Nt.prototype.getState=function(){return Object.freeze(this.state)},Nt.prototype.defineProperty=function(t,e){var r=this;Object.defineProperties(t,{state:{get:function(){return t._state},set:function(i){(function(t,e){return"[object Boolean]"===Object.prototype.toString.call(t)||(n.error(e+" is not boolean")(),!1)})(i)&&(t._state=i,r.checkEventState(e,i,t))}},data:{get:function(){return t._data},set:function(e){t._data=e}},exec:{set:function(e){t._exec=e}}})},Nt.prototype.checkEventState=function(t,e,n){switch(t){case at.HANDLE_TOUCH_START:!0===e&&(this.state[at.HANDLE_TOUCH_END].state=!1,lt.handle.hook[at.HANDLE_TOUCH_START].forEach((function(t){return t(n._data)})));break;case at.HANDLE_TOUCH_END:!0===e&&(this.state[at.HANDLE_TOUCH_START].state=!1,this.state[at.HANDLE_TOUCH_MOVE].state=!1);break;case at.HANDLE_TOUCH_MOVE:!0===e&&(this.state[at.HANDLE_TOUCH_START].state=!1,this.state[at.HANDLE_TOUCH_END].state=!1);break;case at.HANDLE_SINGLE_TOUCH_START:!0===e&&lt.handle.hook[at.HANDLE_SINGLE_TOUCH_START].forEach((function(t){return t(n._data)})),!1===e&&(this.state[at.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS].state=!1);break;case at.HANDLE_SINGLE_TOUCH_END:!0===e&&(this.state[at.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS].state=!1,lt.handle.hook[at.HANDLE_SINGLE_TOUCH_END].forEach((function(t){return t(n._data)})));break;case at.HANDLE_SINGLE_TOUCH_CLICK:!0===e&&lt.handle.hook[at.HANDLE_SINGLE_TOUCH_CLICK].forEach((function(t){return t(n._data)}));break;case at.HANDLE_SINGLE_TOUCH_MOVE:!0===e&&(this.state[at.HANDLE_SINGLE_TOUCH_END].state=!1,this.state[at.HANDLE_DOUBLE_TOUCH_MOVE].state=!1,this.state[at.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS].state=!1,lt.handle.hook[at.HANDLE_SINGLE_TOUCH_MOVE].forEach((function(t){return t(n._data)}))),!1===e&&(this.state[at.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS].state=!1);break;case at.HANDLE_SINGLE_TOUCH_START_CHANGED:!0===e&&(this.state[at.HANDLE_SINGLE_TOUCH_END].state=!1,lt.handle.hook[at.HANDLE_SINGLE_TOUCH_START_CHANGED].forEach((function(t){return t(n._data)})));break;case at.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS:!0===e&&(this.state[at.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS].state=!1,lt.handle.hook[at.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS].forEach((function(t){return t(n._data)})));break;case at.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS:!0===e&&lt.handle.hook[at.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS].forEach((function(t){return t(n._data)}));break;case at.HANDLE_DOUBLE_TOUCH_START:!0===e&&(this.state[at.HANDLE_SINGLE_TOUCH_START].state=!1,this.state[at.HANDLE_SINGLE_TOUCH_MOVE].state=!1,this.state[at.HANDLE_DOUBLE_TOUCH_MOVE].state=!1,lt.handle.hook[at.HANDLE_DOUBLE_TOUCH_START].forEach((function(t){return t(n._data)})));break;case at.HANDLE_DOUBLE_TOUCH_MOVE:!0===e&&(this.state[at.HANDLE_SINGLE_TOUCH_MOVE].state=!1,lt.handle.hook[at.HANDLE_DOUBLE_TOUCH_MOVE].forEach((function(t){return t(n._data)}))),!1===e&&(this.state[at.HANDLE_DOUBLE_TOUCH_ZOOM_IN].state=!1,this.state[at.HANDLE_DOUBLE_TOUCH_ZOOM_OUT].state=!1);break;case at.HANDLE_DOUBLE_TOUCH_ZOOM_IN:!0===e&&(this.state[at.HANDLE_DOUBLE_TOUCH_ZOOM_OUT].state=!1,lt.handle.hook[at.HANDLE_DOUBLE_TOUCH_ZOOM_IN].forEach((function(t){return t(n._data)})));break;case at.HANDLE_DOUBLE_TOUCH_ZOOM_OUT:!0===e&&(this.state[at.HANDLE_DOUBLE_TOUCH_ZOOM_IN].state=!1,lt.handle.hook[at.HANDLE_DOUBLE_TOUCH_ZOOM_OUT].forEach((function(t){return t(n._data)})));break;case at.HANDLE_MANY_TOUCH_MOVE:!0===e&&(this.state[at.HANDLE_SINGLE_TOUCH_MOVE].state=!1,this.state[at.HANDLE_DOUBLE_TOUCH_MOVE].state=!1)}};var Rt=Object.freeze({HIT_WALL_ANIMATION_STARTED:"hit.wall.animation.started",HIT_WALL_ANIMATION_ENDED:"hit.wall.animation.ended"}),It=function(){this.name="animation.state.engine",this.state=Object.create(null)};It.prototype.init=function(){var t=this;Object.keys(Rt).forEach((function(e){var n=Rt[e],r=Object.create(null);r._state=!1,r._data=null,t.state[n]=r,t.defineGetterSetter(r,n)}))},It.prototype.defineGetterSetter=function(t,e){var n=this;Object.defineProperties(t,{state:{get:function(){return t._state},set:function(r){t._state=r,n.checkEventState(e,r,t._data)}},data:{get:function(){return t._data},set:function(e){t._data=e}}})},It.prototype.checkEventState=function(t,e,n){};var Ut=function(){this.name="raycaster.state.engine",this.state=Object.create(null)};Ut.prototype.init=function(){var t=this;Object.keys(J).forEach((function(e){var n=J[e],r=Object.create(null);r._state=!1,r._data=null,r._exec=null,t.state[n]=r,t.defineGetterSetter(r,n)}))},Ut.prototype.defineGetterSetter=function(t,e){var n=this;Object.defineProperties(t,{state:{get:function(){return t._state},set:function(r){n.checkEventState(e,t,r),t._state=r}},data:{get:function(){return t._data},set:function(e){t._data=e}},exec:{set:function(e){t._exec=e}}})},Ut.prototype.checkEventState=function(t,e,n){switch(t){case J.INTERSECT_WITHIN_MODEL:!0===n&&(this.state[J.UNINTERSECT_WITHIN_MODEL].state=!1,lt.raycaster.hook[J.INTERSECT_WITHIN_MODEL].forEach((function(t){return t(e._data)})));break;case J.UNINTERSECT_WITHIN_MODEL:!0===n&&(this.state[J.INTERSECT_WITHIN_MODEL].state=!1,lt.raycaster.hook[J.UNINTERSECT_WITHIN_MODEL].forEach((function(t){return t(e._data)})))}};var Bt=null,Ft=function(){this.name="webxr.state.engine",this.state=Object.create(null)};Ft.prototype.init=function(){var t=this;null===Bt&&(Bt=k.getCore()),Object.keys(tt).forEach((function(e){var n=tt[e],r=Object.create(null);r._state=!1,r._data=null,r._exec=null,t.state[n]=r,t.defineGetterSetter(r,n)}))},Ft.prototype.defineGetterSetter=function(t,e){var n=this;Object.defineProperties(t,{state:{get:function(){return t._state},set:function(r){n.checkEventState(e,t,r),t._state=r}},data:{get:function(){return t._data},set:function(e){t._data=e}},exec:{set:function(e){t._exec=e},get:function(){return t._exec}}})},Ft.prototype.checkEventState=function(t,e,n){switch(t){case tt.SESSION_START:!0===n&&(this.state[tt.SESSION_END].state=!1,lt.webxr.hook[tt.SESSION_START].forEach((function(t){return t()})));break;case tt.SESSION_END:!0===n&&(this.state[tt.SESSION_START].state=!1,lt.webxr.hook[tt.SESSION_END].forEach((function(t){return t()})));break;case tt.INTERSECT_POINT:!0===n&&lt.webxr.hook[tt.INTERSECT_POINT].forEach((function(t){return t(e._data)}));break;case tt.RIGHT_GAMEPAD_SELECT_BTN_DOWN:!0===n&&(this.state[tt.RIGHT_GAMEPAD_SELECT_BTN_UP].state=!1);break;case tt.RIGHT_GAMEPAD_SELECT_BTN_UP:!0===n&&(this.state[tt.RIGHT_GAMEPAD_SELECT_BTN_DOWN].state=!1);break;case tt.RIGHT_GAMEPAD_SELECT_BTN_CLICK:!0===n&&lt.webxr.hook[tt.RIGHT_GAMEPAD_SELECT_BTN_CLICK].forEach((function(t){return t(e._data)}));break;case tt.RIGHT_GAMEPAD_SQUEEZE_BTN_DOWN:1==n&&(this.state[tt.RIGHT_GAMEPAD_SQUEEZE_BTN_UP].state=!1,lt.webxr.hook[tt.RIGHT_GAMEPAD_SQUEEZE_BTN_DOWN].forEach((function(t){return t(e._data)})));break;case tt.RIGHT_GAMEPAD_SQUEEZE_BTN_UP:!0===n&&(this.state[tt.RIGHT_GAMEPAD_SQUEEZE_BTN_DOWN].state=!1,lt.webxr.hook[tt.RIGHT_GAMEPAD_SQUEEZE_BTN_UP].forEach((function(t){return t(e._data)})));break;case tt.RIGHT_GAMEPAD_A_BTN_DOWN:!0===n&&(this.state[tt.RIGHT_GAMEPAD_A_BTN_UP].state=!1);break;case tt.RIGHT_GAMEPAD_A_BTN_UP:!0===n&&(this.state[tt.RIGHT_GAMEPAD_A_BTN_DOWN].state=!1);break;case tt.RIGHT_GAMEPAD_A_BTN_CLICK:!0===n&&lt.webxr.hook[tt.RIGHT_GAMEPAD_A_BTN_CLICK].forEach((function(t){return t(e._data)}));break;case tt.RIGHT_GAMEPAD_B_BTN_DOWN:!0===n&&(this.state[tt.RIGHT_GAMEPAD_B_BTN_UP].state=!1);break;case tt.RIGHT_GAMEPAD_B_BTN_UP:!0===n&&(this.state[tt.RIGHT_GAMEPAD_B_BTN_DOWN].state=!1);break;case tt.RIGHT_GAMEPAD_B_BTN_CLICK:!0===n&&lt.webxr.hook[tt.RIGHT_GAMEPAD_B_BTN_CLICK].forEach((function(t){return t(e._data)}));break;case tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START:!0===n&&(this.state[tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_END].state=!1);break;case tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_END:!0===n&&(this.state[tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START].state=!1);break;case tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE:!0===n&&(this.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER].state=!1,this.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER].state=!1);break;case tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER:!0===n&&(this.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE].state=!1,lt.webxr.hook[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER].forEach((function(t){return t(e._data)})));break;case tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER:!0===n&&(this.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE].state=!1,lt.webxr.hook[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER].forEach((function(t){return t(e._data)})));break;case tt.LEFT_GAMEPAD_SELECT_BTN_DOWN:!0===n&&(this.state[tt.LEFT_GAMEPAD_SELECT_BTN_UP].state=!1);break;case tt.LEFT_GAMEPAD_SELECT_BTN_UP:!0===n&&(this.state[tt.LEFT_GAMEPAD_SELECT_BTN_DOWN].state=!1);break;case tt.LEFT_GAMEPAD_SELECT_BTN_CLICK:!0===n&&lt.webxr.hook[tt.LEFT_GAMEPAD_SELECT_BTN_CLICK].forEach((function(t){return t(e._data)}));break;case tt.LEFT_GAMEPAD_X_BTN_DOWN:!0===n&&(this.state[tt.LEFT_GAMEPAD_X_BTN_UP].state=!1);break;case tt.LEFT_GAMEPAD_X_BTN_UP:!0===n&&(this.state[tt.LEFT_GAMEPAD_X_BTN_DOWN].state=!1);break;case tt.LEFT_GAMEPAD_X_BTN_CLICK:!0===n&&lt.webxr.hook[tt.LEFT_GAMEPAD_X_BTN_CLICK].forEach((function(t){return t(e._data)}));break;case tt.LEFT_GAMEPAD_Y_BTN_DOWN:!0===n&&(this.state[tt.LEFT_GAMEPAD_Y_BTN_UP].state=!1);break;case tt.LEFT_GAMEPAD_Y_BTN_UP:!0===n&&(this.state[tt.LEFT_GAMEPAD_Y_BTN_DOWN].state=!1);break;case tt.LEFT_GAMEPAD_Y_BTN_CLICK:!0===n&&lt.webxr.hook[tt.LEFT_GAMEPAD_Y_BTN_CLICK].forEach((function(t){return t(e._data)}));break;case tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_START:!0===n&&(this.state[tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_END].state=!1);break;case tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_END:!0===n&&(this.state[tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_START].state=!1);break;case tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE:!0===n&&(this.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER].state=!1,this.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER].state=!1);break;case tt.LEFT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER:!0===n&&(this.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE].state=!1,lt.webxr.hook[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER].forEach((function(t){return t(e._data)})));break;case tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER:!0===n&&(this.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE].state=!1,lt.webxr.hook[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER].forEach((function(t){return t(e._data)})))}};var Ht=Object.create(null);Ht.init=function(){n.info("StatusManager init")(),delete this.init,this.coreStateEngine=new ct,this.actionStateEngine=new ht,this.animationStateEngine=new It,this.modelStateEngine=new pt,this.mouseStateEngine=new Ct,this.keyboardStateEngine=new Pt,this.handleStateEngine=new Nt,this.raycasterStateEngine=new Ut,this.webxr=new Ft};var kt="model",zt="virtual",Gt="dsm",Wt="purepano",Vt=Qt(),jt=null,Yt=null,Xt=null,Zt=null;function qt(){var t=Jt(),e=t.clientWidth/t.clientHeight;return isFinite(e)?e:0}function Qt(){return window.navigator.userAgent}function Kt(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?decodeURI(n[2]):null}function Jt(){return null===jt&&(jt=document.getElementById("renderer-stage")),null===jt&&n.error("unget renderer stage !!!")(),jt}function $t(){return null===Yt&&(Yt=document.getElementById("renderer-canvas")),null===Yt&&n.error("unget renderer canvas !!!")(),Yt}function te(){var t=Jt();return t.clientWidth/t.clientHeight}function ee(){if(Xt)return Xt;var t=0,e=0,n=0,r=Jt(),i=function(r){e+=r.offsetLeft,n+=r.offsetTop,r.offsetParent&&(t++,i(r.offsetParent))};return i(r),(Xt=Object.create(null)).parentCount=t,Xt.offset_left=e,Xt.offset_top=n,Xt}function ne(){return window.devicePixelRatio||1}function re(){return!ie()}function ie(){var t=/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i,e=-1!=Vt.indexOf("Safari")&&-1!=Vt.indexOf("Version"),n=-1!=Vt.indexOf("iPhone")&&-1!=Vt.indexOf("Version"),r=e&&!n,i="ontouchstart"in document&&"ontouchmove"in document&&"ontouchmove"in document;if(Vt&&t.test)return t.test(Vt)||r||i}function oe(){return Vt.indexOf("Android")>-1||Vt.indexOf("Adr")>-1}function ae(){return!!Vt.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}function se(){return"micromessenger"===Vt.toLowerCase().match(/MicroMessenger/i)}function le(){return!!Vt.match(/WindowsWechat/i)}function ce(t,e){void 0===t&&(t=function(){}),void 0===e&&(e=function(){});var r=window.navigator,i=function(){w.VrSupport.output(),Zt=!0,t()},o=function(){w.VrSupport.output(),Zt=!1,e()};if(null===Zt){var a=new St(5,(function(){i()}));w.VrSupport.input("has navigator.xr",!!r.xr),r.xr?(a.record(1),w.VrSupport.input("has featurePolicy",!!document.featurePolicy),document.featurePolicy?(a.record(2),w.VrSupport.input("has featurePolicy.allowsFeature",!!document.featurePolicy.allowsFeature),document.featurePolicy.allowsFeature?(a.record(3),w.VrSupport.input("featurePolicy.allowsFeature<xr-spatial-tracking>",document.featurePolicy.allowsFeature("xr-spatial-tracking")),!1!==document.featurePolicy.allowsFeature("xr-spatial-tracking")?(a.record(4),function(t,e){void 0===t&&(t=function(){}),void 0===e&&(e=function(){}),window.navigator.xr.isSessionSupported("immersive-vr").then((function(n){!0===n?t():e()})).catch((function(t){n.error("navigator.xr.isSessionSupported('immersive-vr') catch error:",t)(),e()}))}((function(){var t,e;w.VrSupport.input("support immersive-vr",!0),void 0===(t=function(){w.VrSupport.input("get immersive-vr session",!0),a.record(5)})&&(t=function(){}),void 0===(e=function(){w.VrSupport.input("get immersive-vr session",!1),o()})&&(e=function(){}),window.navigator.xr.requestSession("immersive-vr").then((function(e){t()})).catch((function(t){n.error("navigator.xr.requestSession('immersive-vr') catch error:",t)(),e()}))}),(function(){w.VrSupport.input("support immersive-vr",!1),o()}))):o()):o()):o()):o()}else Zt?i():o()}function ue(t){var e=t.split(";base64,"),r=e[0].split(":")[1],i=window.atob(e[1]),o=i.length,a=new Uint8Array(o);n.time("GET.RGBA."+o)();for(var s=0;s<o;++s){var l=i.charCodeAt(s);a[s]=l}return n.timeEnd("GET.RGBA."+o)(),new Blob([a],{type:r})}var he={__proto__:null,getDpr:ne,getAspectRatio:qt,getUserAgent:Qt,getUrlParam:Kt,getAnimationFrame:function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame},getCurrentXhr:function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},getRendererStage:Jt,getRendererCanvas:$t,getRendererStageAspectRatio:te,getRendererStageOffsetInfo:ee,isPc:re,isMobile:ie,isAndroid:oe,isIos:ae,isWeixin:se,isWeixinMinip:function(){return!1},isWindowsWechat:le,isPicoNeo3Browser:function(){return!!Vt.match(/Pico Neo 3/i)},isVr:ce,isVr2:function(){return!!Zt},isOculusBrowser:function(){},isIframe:function(){return window.top!==window.self},base64ToBlob:ue},pe={enterCustomPanorama:function(t){var e=k.getCore();n.debug("- show.custom.panorama - params:",t)();var r=e.player.model.getUserData("type");n.debug("model.type:",r)(),kt===r&&e.waypointManager.hideGroup()},renderStaticCover:function(t){void 0===t&&(t=function(){}),n.time("render.static.cover")();var e=k.getCore(),r=Jt(),i=$t(),o=ue(e.eventsManager.coreEvents.EventsDealt.GET_RENDERER_CANVAS_BASE64_OF_FULL_SCREEN().base64),a=URL.createObjectURL(o),s=1*getComputedStyle(i).zIndex||0,l=0===s?0:s-1,c=new Image;e.screenshotImage=c,c.style.cssText="\n    position:absolute;\n    width:100%;\n    height:100%;\n    top:0;\n    left:0;\n    z-index:"+l+";\n    pointer-events:none;\n  ",c.onload=function(){n.timeEnd("render.static.cover")(),t()},c.src=a,r.appendChild(c)}},de={zoom:{default:1,min:1,max:1.6},flying_to_pano:{transition_consuming:{default:1200,custom:null}},tile_2k_zoom_trigger:{default:1.1,current:1.1},tile_4k_zoom_trigger:{default:1.6,current:1.6}};Object.defineProperties(de,{defaultZoom:{get:function(){return de.zoom.default}},minZoom:{set:function(t){de.zoom.min=t},get:function(){return de.zoom.min}},maxZoom:{set:function(t){de.zoom.max=t},get:function(){return de.zoom.max}},tile2kZoomTrigger:{set:function(t){de.tile_2k_zoom_trigger.current=t},get:function(){return de.tile_2k_zoom_trigger.current}},tile4kZoomTrigger:{set:function(t){de.tile_4k_zoom_trigger.current=t},get:function(){return de.tile_4k_zoom_trigger.current}}});var fe={fov:{default:70},zoom:{default:1,min:.5,max:2},move:{default:1,min:1,max:1/0},polar_angle:{min:.1,max:90}};Object.defineProperties(fe,{defaultZoom:{set:function(t){t<=fe.zoom.max&&t>=fe.zoom.min?fe.zoom.default=t:n.error("set dollhouse control default zoom failure, reason: over limit!")()},get:function(){return fe.zoom.default}},minZoom:{set:function(t){fe.zoom.min=t},get:function(){return fe.zoom.min}},maxZoom:{set:function(t){fe.zoom.max=t},get:function(){return fe.zoom.max}},minPolarAngle:{set:function(t){fe.polar_angle.min=t},get:function(){return fe.polar_angle.min}},maxPolarAngle:{set:function(t){fe.polar_angle.max=t},get:function(){return fe.polar_angle.max}},defaultDistanceZoom:{set:function(t){fe.move.default=t},get:function(){return fe.move.default}},minMoveDistance:{set:function(t){fe.move.min=t},get:function(){return fe.move.min}},maxMoveDistance:{set:function(t){fe.move.max=t},get:function(){return fe.move.max}}});var me={zoom:{default:1,min:1,max:2}};Object.defineProperties(me,{defaultZoom:{set:function(t){t<=me.zoom.max&&t>=me.zoom.min?me.zoom.default=t:(t<me.zoom.min&&(me.zoom.default=me.zoom.min),t>me.zoom.max&&(me.zoom.default=me.zoom.max))},get:function(){return me.zoom.default}},minZoom:{set:function(t){me.zoom.min=t},get:function(){return me.zoom.min}},maxZoom:{set:function(t){me.zoom.max=t},get:function(){return me.zoom.max}}});var ve={DEFAULT:0,CHUNK:1,COLLIDER:2,COLLIDER_MASK:3,MARKER:4,MODEL_SKYBOX:5,PANO_SKYBOX:6,MAGNIFYING_CAMERA:7},ge={signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,dollhouseFOV:70,dollhouseNear:.1,dollhouseFar:5e3,insideFOV:70,insideNear:.1,insideFar:5e3,insideLookSpeed:.12,insideLookLimitUp:50,insideLookLimitDown:-50,orthoNear:1,orthoFar:5e3,orthoBase:10,narrowLandscapeHeight:290,reallyNarrowLandscapeHeight:250,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",windowHeightHighQualityThreshold:1200,tourStepDelayDefault:3500,tourStepDelaySlideShow:5e3,workshopApsect:9/16,highQualityMaxZoom:2,ultraHighQualityMaxZoom:1.5,unitMatrix4:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],BUFFER_FROM:"bWVzc2FnZSBtZXNoZXMgew0KICAgIHJlcXVpcmVkIHN0cmluZyB2ZXJzaW9uID0gMTsNCiAgICByZXBlYXRlZCBibG9ja19kZWZhdWx0IGJsb2NrX2RlZmF1bHQgPSAyOw0KICAgIHJlcGVhdGVkIGJsb2NrX21vZGVsIGJsb2NrX21vZGVsID0gMzsNCiAgICByZXBlYXRlZCBibG9ja19jdXN0b21pemVkIGJsb2NrX2N1c3RvbWl6ZWQgPSA0Ow0KfQ0KDQptZXNzYWdlIHZlcnRpY2VzX3NpbXBsZSB7DQogICAgcmVwZWF0ZWQgZmxvYXQgdXYgPSAxIFtwYWNrZWQ9dHJ1ZV07DQogICAgcmVwZWF0ZWQgZmxvYXQgeHl6ID0gMiBbcGFja2VkPXRydWVdOw0KfQ0KDQptZXNzYWdlIGZhY2VzX3NpbXBsZSB7DQogICAgcmVwZWF0ZWQgdWludDMyIGZhY2VzID0gMSBbcGFja2VkPXRydWVdOw0KfQ0KDQptZXNzYWdlIGJsb2NrX21vZGVsIHsNCiAgICBvcHRpb25hbCB2ZXJ0aWNlc19zaW1wbGUgdmVydGljZXMgPSAxOw0KICAgIG9wdGlvbmFsIGZhY2VzX3NpbXBsZSBmYWNlcyA9IDI7DQogICAgb3B0aW9uYWwgc3RyaW5nIGJsb2NrX25hbWUgPSAzOw0KICAgIG9wdGlvbmFsIHN0cmluZyB0eHRuYW1lID0gNDsNCn0NCg0KbWVzc2FnZSBibG9ja19kZWZhdWx0IHsNCiAgICByZXBlYXRlZCBibG9ja19kZWZhdWx0X3VuaXQgZGVmYXVsdF91bml0cyA9IDE7DQp9DQoNCm1lc3NhZ2UgYmxvY2tfZGVmYXVsdF91bml0IHsNCiAgICByZXF1aXJlZCBzdHJpbmcgdW5pdF9pZCA9IDE7DQogICAgb3B0aW9uYWwgdmVydGljZXNfc2ltcGxlIHZlcnRpY2VzID0gMjsNCiAgICBvcHRpb25hbCBmYWNlc19zaW1wbGUgZmFjZXMgPSAzOw0KICAgIG9wdGlvbmFsIHN0cmluZyBibG9ja19kZXMgPSA0Ow0KICAgIG9wdGlvbmFsIHN0cmluZyB0eHRuYW1lID0gNTsNCn0NCg0KbWVzc2FnZSBibG9ja19jdXN0b21pemVkIHsNCiAgICByZXBlYXRlZCBibG9ja19jdXN0b21pemVkX3VuaXQgY3VzdG9taXplZF91bml0cyA9IDE7DQp9DQoNCm1lc3NhZ2UgYmxvY2tfY3VzdG9taXplZF91bml0IHsNCiAgICByZXF1aXJlZCBzdHJpbmcgdW5pdF9pZCA9IDE7DQogICAgcmVxdWlyZWQgc3RyaW5nIHJlbGF0ZWRfaWQgPSAyOw0KICAgIG9wdGlvbmFsIHZlcnRpY2VzX3NpbXBsZSB2ZXJ0aWNlcyA9IDM7DQogICAgb3B0aW9uYWwgZmFjZXNfc2ltcGxlIGZhY2VzID0gNDsNCiAgICBvcHRpb25hbCBzdHJpbmcgYmxvY2tfZGVzID0gNTsNCiAgICBvcHRpb25hbCBzdHJpbmcgdHh0bmFtZSA9IDY7DQp9DQo="},ye=Object.freeze(ge),_e=Object.create(null),Ee=null,Te=null;_e.setCoreData=function(t){Te=JSON.parse(JSON.stringify(t)),de.tile2kZoomTrigger=t.zoom.tile_2k_trigger,de.tile4kZoomTrigger=t.zoom.tile_4k_trigger},_e.getModelData=function(){return Te},_e.getModelId=function(){return Te.basic.model_id||Te.basic.pano_id},_e.getPanoTileUrl=function(){return Te.basic.pano_tile_url},_e.getPano6CubeUrl=function(){return Te.waypoints_cube_path},_e.getPurepano6CubeUrl=function(){return Te.basic.tile_base_path},_e.getEntryInfo=function(t,e){if(Ee)return Ee;var r=Te.entry_point,i=t[r.location_id];if(i)return i.enable?(i.isFirstPano=!0,(Ee=Object.create(null)).mode=G.PANORAMA,Ee.pano=i,Ee.position=i.position,Ee.quaternion=r.rotation,Ee):(n.error("entry point "+i.id+" disabled!")(),void alert("entry point disabled!"));n.error("AdapterManager: get entry info failure, reason: invalid location_id: "+r.location_id)()},_e.getEntryMode=function(){return Te.entry_info.mode},_e.getEntryInfoOfDollhouse=function(){return{position:Te.entry_info.dollhouse_camera_position,quaternion:Te.entry_info.dollhouse_camera_quaternion,target:Te.entry_info.dollhouse_camera_target}},_e.getFloorplanRotateAngle=function(){return Te.entry_info.floorplan_rotate_angle||0},_e.getCameraFov=function(){return Te.basic.panorama_camera_fov||ye.insideFOV},_e.getEntryModeCameraFov=function(){if(kt===Te.type||zt===Te.type||Gt===Te.type)switch(Te.entry_info.mode){case G.PANORAMA:return Te.basic.panorama_camera_fov||ye.insideFOV;case G.DOLLHOUSE:case G.FLOORPLAN:return ye.dollhouseFOV}if(Wt===Te.type)return Te.basic.panorama_camera_fov},_e.getSceneCameraZoom=function(){if(kt===Te.type||zt===Te.type||Gt===Te.type)switch(Te.entry_info.mode){case G.PANORAMA:return _e.getPanoramaCameraZoom();case G.DOLLHOUSE:return _e.getDollhouseCameraZoom();case G.FLOORPLAN:return _e.getFloorplanCameraZoom()}if(Wt===Te.type)return Te.basic.panorama_camera_zoom||1},_e.getDollhouseCameraZoom=function(){return Te.basic.dollhouse_camera_zoom||1},_e.getDollhouseDistanceZoom=function(){return Te.basic.dollhouse_distance_zoom||1},_e.getFloorplanCameraZoom=function(){return Te.basic.floorplan_camera_zoom||1},_e.getPanoramaCameraZoom=function(){var t=Te.basic.panorama_camera_zoom||1;return t>de.zoom.max&&(n.error("default zoom invalid! will be reset to max.")(),t=de.zoom.max),t<de.zoom.min&&(n.error("default zoom invalid! will be reset to min.")(),t=de.zoom.min),t},_e.getRenderMode=function(){return Te.basic.render_mode},_e.getRenderSet=function(){return Te.basic.render_set},_e.getTileSize=function(){var t=Te.basic.render_set.split(/(-)/g);return t[t.length-1]},_e.getTileName=function(){return Te.basic.tile_name},_e.isSupport2k512=function(){return-1!==Te.basic.lod_support.indexOf("2048-512")},_e.isSupport4k512=function(){return-1!==Te.basic.lod_support.indexOf("4096-512")&&"off"!==Kt("render_4k")},_e.isSupportAutoCropTile=function(){return!!Te.basic.auto_crop_tile},_e.getAutoCropServer=function(){return Te.basic.auto_crop_server},_e.getSceneBackgroundSkyboxTile=function(){return Te.scene_background_skybox||[]},_e.clear=function(){n.info("%c AdapterManager clear","color:#f00;")(),Ee=null},_e.getModelTextureSize=function(){return Te.basic.model_texture_quality||1024},_e.get2kPanoTileTrigger=function(){return Te.zoom.tile_2k_trigger||1},_e.get4kPanoTileTrigger=function(){return Te.zoom.tile_4k_trigger||1.6};var xe=new L.TextureLoader,be=new L.CubeTextureLoader,Me=new L.ImageLoader,Ae=new Map,Se=document.createElement("canvas");function Oe(t,e,r){void 0===e&&(e=function(){}),void 0===r&&(r=function(){});var i=t.split(/(\/\/)/g)[2],o=Ae.get(i);if(o){var a=o;return e(a),a}return xe.load("//"+i,(function(t){Ae.set(i,t),e(t)}),(function(t){n.warn("loadTexture progress:",t)()}),(function(e){n.error("loadTexture <"+t+"> error:",e)(),r()}))}function we(t,e,r){return be.load(t,(function(t){mt(e,"loadCube success")&&e(t)}),(function(t){}),(function(t){mt(r,"loadCube fail")&&r(t),n.error("cubeTextureloader load error:",t)()}))}function Le(t,e){return new Promise((function(e,r){var i=_e.getRenderMode();Me.load(t,(function(r){if("lod"===i){var o=_e.getTileSize();window.createImageBitmap&&"on"===Kt("stb")?window.createImageBitmap(r,0,0,o,o,{resizeWidth:o-2,resizeHeight:o-2}).then((function(n){n.currentSrc=t,e(n)})).catch((function(t){})):e(r)}else n.warn("model has changed, texture.getImage invalid!")()}),void 0,(function(e){n.error("load image failure, url: "+t)(),r()}))}))}xe.setCrossOrigin(!0),xe.setCrossOrigin("Anonymous");var De={defalut_entry_mode:{dollhouse:{enabled:!1,auto_flying_pano:{enabled:!1,wait_time:1e3}},panorama:{enabled:!0},floorplan:{enabled:!1}},render_alpha:!1,dollhouse_use_light_material:!1},Ce={init:function(t){De.render_alpha=!!t.render_alpha,De.dollhouse_use_light_material=!!t.dollhouse_use_light_material},Base:De,PANORAMA:{show_panorama_tile_texture:!0,camera:{fov:82,mouse_control:{rotation_friction:.06,rotation_acceleration_inside:4.5}},marker:{pano_click_radius:.3,opacity_default:.4},tiled:{enable:!1}},FLOORPLAN:{},DOLLHOUSE:{}},Pe={PANORAMA_CAMERA_ROTATE:"panorama.camera.rotate",DOLLHOUSE_CAMERA_ROTATE:"dollhouse.camera.rotate",PANORAMA_CAMERA_ZOOM:"panorama.camera.zoom",DOLLHOUSE_CAMERA_ZOOM:"dollhouse.camera.zoom",FLY_TO_PANORAMA:"fly.to.panorama",FLY_TO_DOLLHOUE:"fly.to.dollhouse",FLY_TO_FLOORPLAN:"fly.to.floorplan",SWITCH_TO_PANO:"switch.to.pano",SWITCH_SCAN_MODEL:"switch.scan.model",SWITCH_VIRTUAL_MODEL:"switch.virtual.model",SWITCH_PURE_PANO:"switch.pure.pano"},Ne=Object.create(null);Ne[Pe.PANORAMA_CAMERA_ROTATE]={state:!1,rotation:null},Ne[Pe.DOLLHOUSE_CAMERA_ROTATE]={state:!1,lon:null,lat:null},Ne[Pe.DOLLHOUSE_CAMERA_ZOOM]={state:!1,value:null},Ne[Pe.PANORAMA_CAMERA_ZOOM]={state:!1,value:null},Ne[Pe.FLY_TO_PANORAMA]={state:!1},Ne[Pe.FLY_TO_DOLLHOUE]={state:!1},Ne[Pe.FLY_TO_FLOORPLAN]={state:!1},Ne[Pe.SWITCH_TO_PANO]={state:!1,pano_id:"",quaternion:null,lookat_target:null,switch_mode:"",switch_config:null,free_rotate:!1};var Re={SyncEvents:Pe,SyncData:Ne},Ie={UP:new L.Vector3(0,1,0),DOWN:new L.Vector3(0,-1,0),LEFT:new L.Vector3(-1,0,0),RIGHT:new L.Vector3(1,0,0),FORWARD:new L.Vector3(0,0,-1),BACK:new L.Vector3(0,0,1)};function Ue(t,e){var n=new L.Vector3;if(0===t.length)return n;for(var r=0,i=0;i<t.length;i++){var o=e?t[i][e]:t[i];n.add(o),r++}return n.divideScalar(r)}function Be(t,e,n){var r=Jt();return(n=n||new L.Vector2).x=t/r.clientWidth*2-1,n.y=-e/r.clientHeight*2+1,n}function Fe(t,e){e.updateMatrixWorld(),e.updateProjectionMatrix();var n=Jt(),r=t.clone().project(e),i=n.clientWidth/2,o=n.clientHeight/2;return{x:~~(r.x*i+i),y:~~(-r.y*o+o)}}function He(t){return Math.cos(L.Math.degToRad(t/2))}function ke(t,e){0===t.x&&-5===t.y&&0===t.z&&(t.z=-1);var n=(new L.Vector3).subVectors(e,t),r=0;0==n.x&&0==n.y&&0==n.z&&(n.z=1),r=Math.atan(n.z/n.x),r+=n.x<0?Math.PI:0,r+=n.x>0&&n.z<0?2*Math.PI:0;var i=L.Math.radToDeg(r)+180,o=Math.sqrt(n.x*n.x+n.z*n.z);return r=Math.atan(n.y/o),{lon:i,lat:-L.Math.radToDeg(r)}}function ze(t){var e=(new L.Vector3).copy(Ie.FORWARD);return e.applyQuaternion(t).normalize(),e}function Ge(t,e){var n=(new L.Matrix4).lookAt(t,e,Ie.UP);return(new L.Quaternion).setFromRotationMatrix(n)}function We(t,e){e.updateMatrixWorld(),e.updateProjectionMatrix();var n=t.clone().applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix),r=Math.abs(n.x)>1,i=Math.abs(n.y)>1,o=Math.abs(n.z)>1;return!!(r||i||o)}var Ve={__proto__:null,computeAverage:function(t,e){if(0===t.length)return null;for(var n=0,r=0,i=0;i<t.length;i++)n+=e?t[i][e]:t[i],r++;return n/r},computeAverageVectors:Ue,computeLowerMedian:function(t,e){return 0===t.length?null:(e=e||2,t.sort((function(t,e){return t-e})),t[Math.floor(t.length/e)])},computeWorldPositionOutCamera:We,convertVisionVector:function(t){return new L.Vector3(t.x,t.z,-t.y)},convertVisionQuaternion:function(t){return new L.Quaternion(t.x,t.z,-t.y,t.w).multiply((new L.Quaternion).setFromAxisAngle(new L.Vector3(0,1,0),L.Math.degToRad(90)))},convertVisionQuaternion2:function(t){return new L.Quaternion(t.x,t.z,-t.y,t.w).multiply((new L.Quaternion).setFromAxisAngle(new L.Vector3(0,1,0),L.Math.degToRad(-90)))},convertWorkshopQuaternion:function(t){return new L.Quaternion(-t.x,t.y,t.z,-t.w).multiply(new L.Quaternion(Math.sqrt(2)/2,Math.sqrt(2)/2,0,0))},convertScreenPositionToNDC:Be,convertVisionQuaternionAutoScene:function(t){return new L.Quaternion(t.x,t.y,t.z,t.w).multiply((new L.Quaternion).setFromAxisAngle(new L.Vector3(0,1,0),L.Math.degToRad(-90)))},convertWorldPositionToScreen:Fe,convertVec3ToLonLat:ke,converLonLatToVec3:function(t,e,n){var r=0,i=0,o=0,a=L.Math.degToRad(t),s=Math.abs(L.Math.degToRad(e));return e>=0&&e<=90?i=n*Math.sin(s):e>=-90&&e<0&&(i=-n*Math.sin(s)),0<t<=90?(r=-n*Math.cos(s)*Math.cos(a),o=n*Math.cos(s)*Math.sin(a)):90<t<=180?(r=n*Math.cos(s)*Math.cos(L.Math.degToRad(180-t)),o=n*Math.cos(s)*Math.sin(L.Math.degToRad(180-t))):-90<t<=0?(r=-n*Math.cos(s)*Math.cos(-a),o=-n*Math.cos(s)*Math.sin(-a)):-180<=t<=-90&&(r=n*Math.cos(s)*Math.cos(L.Math.degToRad(180+t)),o=-n*Math.cos(s)*Math.sin(L.Math.degToRad(180+t))),{x:r,y:i,z:o}},getFOVDotThreshold:He,get4x4UnitMatrix:function(){var t=new L.Matrix4;return t.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),t},getVerticesOfItemSize:function(t){for(var e=t.attributes.position,n=e.itemSize,r=[],i={},o=0,a=e.array.length;o<a;o+=n){var s=e.array[o],l=e.array[o+1],c=e.array[o+2],u="k_"+s+"_"+l+"_"+c;void 0===i[u]&&(r.push(new L.Vector3(s,l,c)),i[u]=1)}return r},getCameraDirectionOfQuaternion:ze,getCameraQuaternionOfLookAtPoint:Ge,getQuaternionOfDirection:function(t,e){return Ge(t,(new L.Vector3).addVectors(t,e))},checkVec3IsSame:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},checkVec4IsSame:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},calcFov:function(t,e,n){var r=e;return n<1&&(r/=n),2*Math.atan(r/t/2)*(180/Math.PI)}},je=L.BufferGeometry,Ye=L.Float32BufferAttribute,Xe=L.LineSegments,Ze=L.LineBasicMaterial,qe=L.Matrix3,Qe=L.Vector3,Ke=new Qe,Je=new Qe,$e=new qe;function tn(t,e,n,r){this.object=t,this.size=void 0!==e?e:1;var i=void 0!==n?n:16776960,o=void 0!==r?r:1,a=0,s=this.object.geometry;s&&s.isGeometry&&(a=s.faces.length);var l=new je,c=new Ye(2*a*3,3);l.setAttribute("position",c),Xe.call(this,l,new Ze({color:i,linewidth:o})),this.type="FaceNormalsHelper",this.matrixAutoUpdate=!1,this.update()}tn.prototype=Object.create(Xe.prototype),tn.prototype.constructor=tn,tn.prototype.update=function(){this.object.updateMatrixWorld(!0),$e.getNormalMatrix(this.object.matrixWorld);for(var t=this.object.matrixWorld,e=this.geometry.attributes.position,n=this.object.geometry,r=n.vertices,i=n.faces,o=0,a=0,s=i.length;a<s;a++){var l=i[a],c=l.normal;Ke.copy(r[l.a]).add(r[l.b]).add(r[l.c]).divideScalar(3).applyMatrix4(t),Je.copy(c).applyMatrix3($e).normalize().multiplyScalar(this.size).add(Ke),e.setXYZ(o,Ke.x,Ke.y,Ke.z),o+=1,e.setXYZ(o,Je.x,Je.y,Je.z),o+=1}e.needsUpdate=!0};var en=tn,nn=L.BufferGeometry,rn=L.Float32BufferAttribute,on=L.LineSegments,an=L.LineBasicMaterial,sn=L.Matrix3,ln=L.Vector3,cn=new ln,un=new ln,hn=new sn,pn=["a","b","c"];function dn(t,e,n){this.object=t,this.size=void 0!==e?e:.1;var r=void 0!==n?n:16711680,i=0,o=this.object.geometry;o&&o.isGeometry?i=3*o.faces.length:o&&o.isBufferGeometry&&(i=o.attributes.normal.count);var a=new nn,s=new rn(2*i*3,3);a.setAttribute("position",s),on.call(this,a,new an({color:r,toneMapped:!1})),this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}L.VertexNormalsHelper=dn,dn.prototype=Object.create(on.prototype),dn.prototype.constructor=dn,dn.prototype.update=function(){this.object.updateMatrixWorld(!0),hn.getNormalMatrix(this.object.matrixWorld);var t=this.object.matrixWorld,e=this.geometry.attributes.position,n=this.object.geometry;if(n&&n.isGeometry)for(var r=n.vertices,i=n.faces,o=0,a=0,s=i.length;a<s;a++)for(var l=i[a],c=0,u=l.vertexNormals.length;c<u;c++){var h=r[l[pn[c]]],p=l.vertexNormals[c];cn.copy(h).applyMatrix4(t),un.copy(p).applyMatrix3(hn).normalize().multiplyScalar(this.size).add(cn),e.setXYZ(o,cn.x,cn.y,cn.z),o+=1,e.setXYZ(o,un.x,un.y,un.z),o+=1}else if(n&&n.isBufferGeometry){var d=n.attributes.position,f=n.attributes.normal;for(o=0,c=0,u=d.count;c<u;c++)cn.set(d.getX(c),d.getY(c),d.getZ(c)).applyMatrix4(t),un.set(f.getX(c),f.getY(c),f.getZ(c)),un.applyMatrix3(hn).normalize().multiplyScalar(this.size).add(cn),e.setXYZ(o,cn.x,cn.y,cn.z),o+=1,e.setXYZ(o,un.x,un.y,un.z),o+=1}e.needsUpdate=!0};var fn=dn,mn=Object.create(null),vn=new Map;function gn(t,e,n,r){void 0===r&&(r=!1);var i=new L.BufferGeometry,o=[t.x,t.y,t.z,e.x,e.y,e.z];i.setAttribute("position",new L.BufferAttribute(new Float32Array(o),3));var a=new L.LineBasicMaterial({color:n,depthTest:r}),s=new L.Line(i,a,L.LineSegments);return s.renderOrder=999,s}function yn(t,e,n,r){void 0===r&&(r=1);var i=k.getCore(),o=new L.LineGeometry,a=[[t.x,t.y,t.z],[e.x,e.y,e.z]];o.setPositions(a[0].concat(a[1]));var s=new L.LineMaterial({color:n,linewidth:r,resolution:new L.Vector2(i.sceneRender.renderer.domElement.width,i.sceneRender.renderer.domElement.height)});return new L.Line2(o,s)}function _n(t,e,n,r,i){0<Object.keys(mn).length&&Tn(r);var o=gn(new L.Vector3(t.x,t.y,t.z),new L.Vector3(e.x,e.y,e.z),n,i);o.name=r,o&&(xn(o),mn[r]=o)}function En(t,e,n,r,i){0<vn.size&&function(t){var e=vn.get(t);e&&(e.traverse((function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})),bn(e),vn.delete(t),e=null)}(i);var o=.2*n,a=.1*o,s=new L.ArrowHelper(t,e,n,r,o,a);s.name=i,xn(s),vn.set(i,s)}function Tn(t){var e=mn[t];e&&(bn(e),e=null,delete mn[t])}function xn(t){k.getCore().sceneRender.scene.add(t)}function bn(t){k.getCore().sceneRender.remove(t,"removeFromScene")}function Mn(t,e){t.userData.line_segments&&An(t);var n=new L.WireframeGeometry(t.geometry),r=new L.LineSegments(n);r.material.color.setHex(e),r.rotation.copy(t.rotation),r.position.copy(t.position),t.userData.line_segments=r,t.add(r)}function An(t){if(t.userData.line_segments){var e=t.userData.line_segments;e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose(),t.remove(e),t.userData.line_segments=null}}var Sn={__proto__:null,createLine:gn,createFatline:yn,drawLine:_n,drawFatline:function(t,e,n,r,i){void 0===t&&(t=new L.Vector3),void 0===e&&(e=new L.Vector3(0,10,0)),void 0===n&&(n=255),void 0===r&&(r=1),void 0===i&&(i="fat.line"),0<Object.keys(mn).length&&Tn(i);var o=yn(new L.Vector3(t.x,t.y,t.z),new L.Vector3(e.x,e.y,e.z),n,r);o.name=i,o&&(xn(o),mn[i]=o)},drawArrowLine:En,removeLine:Tn,addWireFrame:Mn,removeWireFrame:An,addBoxHelper:function(t){var e=k.getCore(),n=new L.BoxHelper(t,16776960);e.sceneRender.scene.add(n)},addFaceNormalHelper:function(t){var e=k.getCore(),n=new en(t,.1,16711680,1);e.sceneRender.add(n)},addVertexNormalHelper:function(t){var e=k.getCore(),n=new fn(t,.4,16711680);e.sceneRender.add(n)}},On=Object.freeze({INIT_CONFIG:function(t){Ce.init(t)},CORE_BOOT:function(t){Ht.coreStateEngine.state[Y.START_BOOT].state=!0,!1===Ht.coreStateEngine.state[Y.CORE_BOOT_COMPLETE].state?(Ht.coreStateEngine.state[Y.CORE_BOOT_COMPLETE].state=!0,wn.boot(t)):n.error("boot failure, reason: already boot!")()},CORE_SCENE_ADD:function(t){(Ln=wn.sceneRender)?yt(t)?Ln.scene.add(t):n.error("add object3D failed",t)():n.error("add object3D failed, sceneRender invalid")()},CORE_SCENE_REMOVE:function(t){wn.sceneRender.remove(t,"core.scene.remove")},GET_RENDERER_STAGE:function(){return Jt()},GET_RENDERER_CANVAS:function(){return wn.sceneRender?wn.sceneRender.renderer.domElement:null},GET_RENDERER_CANVAS_BASE64_OF_FULL_SCREEN:function(){var t=wn.sceneRender.scene,e=wn.sceneRender.camera;wn.sceneRender.renderer.clear(),wn.sceneRender.renderer.render(t,e);var n=wn.sceneRender.renderer.domElement.toDataURL("image/png",1),r=wn.sceneRender.renderer.domElement.width,i=wn.sceneRender.renderer.domElement.height;return Object.create(null,{base64:{value:n},width:{value:r},height:{value:i}})},GET_RENDERER_CANCAS_BASE64_OF_CUSTOM_SIZE:function(t,e,n){void 0===n&&(n=function(){});var r=ne(),i=wn.sceneRender,o=wn.sceneRender.scene,a=wn.sceneRender.camera,s=i.renderer.getContext().drawingBufferWidth,l=i.renderer.getContext().drawingBufferHeight,c=[t/s,e/l],u=1*Math.max.apply(Math,c).toFixed(2);u>=1&&i.renderer.setPixelRatio(u),i.renderer.render(o,a),s=i.renderer.getContext().drawingBufferWidth,l=i.renderer.getContext().drawingBufferHeight;var h=.5*-(s-t),p=.5*-(l-e),d=i.renderer.domElement.toDataURL("image/jpeg",1),f=new Image;f.onload=function(){var o=document.createElement("canvas"),a=o.getContext("2d");o.width=t,o.height=e,a.fillStyle="rgba(255,255,255,1)",a.fillRect(0,0,t,e),a.drawImage(f,h,p,s,l),i.renderer.setPixelRatio(r);var c=o.toDataURL("image/jpeg",1);n(c),c=null},f.src=d},GET_CURRENT_MODE:function(){return wn.player?Object.create(null,{mode:{value:wn.player.mode}}):null},GET_CURRENT_PANO_ID:function(){var t=null;return wn.player&&wn.player.currentPano&&(t=wn.player.currentPano.id),t},GET_MOUSE_POINTER:function(){return wn.player.pointer},GET_MOUSE_INTERSECT_WITHIN_MODEL:function(){return wn.player.getMouseIntersect()},GET_VIEW_MODE:function(){if(wn.player)return wn.player.mode||null},GET_SCENE:function(){if(wn.sceneRender)return wn.sceneRender.scene||null},GET_SYNC_DATA:function(){return Re.SyncData},SET_SYNC_DATA:function(t){if(wn&&wn.player&&wn.player.control){var e=t.data,r=wn.player.mode;if("panorama"===r&&!0===e[Re.SyncEvents.PANORAMA_CAMERA_ROTATE].state&&!1===e[Re.SyncEvents.FLY_TO_PANORAMA].state&&!1===e[Re.SyncEvents.FLY_TO_DOLLHOUE].state&&!1===e[Re.SyncEvents.FLY_TO_FLOORPLAN].state){var i=e[Re.SyncEvents.PANORAMA_CAMERA_ROTATE].rotation;!0===function(t,e){return!!vt(t,e)&&(!1!==ft(t.x,"vec4 x")&&!1!==ft(t.y,"vec4 y")&&!1!==ft(t.z,"vec4 z")&&!1!==ft(t.w,"vec4 w")||(n.error(e+" is not vector4")(),!1))}(i,"sync.data.camera.rotate.rotation")&&(wn.player.control.camera.setQuaternion(i),wn.player.control.lookAtRotation(i))}if("dollhouse"===r&&!0===e[Re.SyncEvents.DOLLHOUSE_CAMERA_ROTATE].state&&!1===e[Re.SyncEvents.FLY_TO_PANORAMA].state&&!1===e[Re.SyncEvents.FLY_TO_DOLLHOUE].state&&!1===e[Re.SyncEvents.FLY_TO_FLOORPLAN].state&&!1===e[Re.SyncEvents.SWITCH_TO_PANO].state){var o=e[Re.SyncEvents.DOLLHOUSE_CAMERA_ROTATE].lon,a=e[Re.SyncEvents.DOLLHOUSE_CAMERA_ROTATE].lat;wn.player.control.updateCamera(o,a,"set.sync.data")}if("panorama"===r&&!0===e[Re.SyncEvents.PANORAMA_CAMERA_ZOOM].state){var s=e[Re.SyncEvents.PANORAMA_CAMERA_ZOOM].value;wn.player&&wn.player.control&&wn.player.control.setZoom(s)}if("dollhouse"===r&&!0===e[Re.SyncEvents.DOLLHOUSE_CAMERA_ZOOM].state){var l=e[Re.SyncEvents.DOLLHOUSE_CAMERA_ZOOM].value;wn.player&&wn.player.control&&wn.player.control.setZoom(l)}if(e[Re.SyncEvents.FLY_TO_DOLLHOUE].state&&!1===e[Re.SyncEvents.SWITCH_TO_PANO].state&&wn.commonEvents.actionEvents.flyToDollhouse(),e[Re.SyncEvents.FLY_TO_PANORAMA].state&&!1===e[Re.SyncEvents.SWITCH_TO_PANO].state&&wn.commonEvents.actionEvents.switchToPanoramaView(),e[Re.SyncEvents.FLY_TO_FLOORPLAN].state&&!1===e[Re.SyncEvents.SWITCH_TO_PANO].state&&wn.commonEvents.actionEvents.flyToFloorplan(),e[Re.SyncEvents.SWITCH_TO_PANO].state&&!1===Ht.actionStateEngine.state["switch.to.pano"].state){var c=e[Re.SyncEvents.SWITCH_TO_PANO],u=c.pano_id,h=c.lookat_target,p=c.quaternion,d=c.switch_mode,f=c.free_rotate;u&&wn.commonEvents.actionEvents.switchToPano({location_id:u,lookat_target:h,quaternion:p,switch_mode:d,free_rotate:f})}}},GET_WAYPOINTS_DATA:function(){var t=[];if(wn.data&&wn.data.waypoints)for(var e=wn.data.waypoints,n=wn.player.model.panos,r=0,i=e.length;r<i;++r){var o=e[r],a=n.get(o.location_id),s=a.marker;if(1===o.type){var l=Object.create(null);l.location_id=o.location_id,l.flooridx=o.flooridx,l.enable=a.enable,l.visible=s.visible,l.neighbour=o.neighbour,l.neighbour_visible=o.neighbour_visible;var c=Object.create(null);c.x=s.position.x,c.y=s.position.y,c.z=s.position.z,l.spot=c;var u=Object.create(null);u.x=o.viewpoint.x,u.y=o.viewpoint.y,u.z=o.viewpoint.z,l.viewpoint=u,t.push(l)}}return t},GET_LOCATION_DISTANCE:function(t,e){var r=null;if(wn&&wn.player&&wn.player.model){var i=wn.player.model.panos.get(t),o=wn.player.model.panos.get(e);i&&o?r=i.position.distanceTo(o.position):n.error("get location distance failure, reason: invalid location id")()}return r},DRAW_LINE:_n,DISABLE_PANORAMA_CONTROL:function(){wn.player.controls[G.PANORAMA].disable()},DISABLE_DOLLHOUSE_CONTROL:function(){wn.player.controls[G.DOLLHOUSE].disable()},DISABLE_DOLLHOUSE_CAMERA_ZOOM_CONTROL:function(){wn.player.controls[G.DOLLHOUSE].cameraZoomEnabled=!1},DISABLE_DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CONTROL:function(){wn.player.controls[G.DOLLHOUSE].distanceZoomEnabled=!1},ENABLE_FLOORPLAN_CONTROL:function(){wn.player.controls[G.FLOORPLAN].enable()},ENABLE_FLOORPLAN_ZOOM_CONTROL:function(){wn.player.controls[G.FLOORPLAN].enableZoomControl()},ENABLE_FLOORPLAN_PAN_CONTROL:function(){wn.player.controls[G.FLOORPLAN].enablePanControl()},DISABLE_FLOORPLAN_CONTROL:function(){wn.player.controls[G.FLOORPLAN].disable()},DISABLE_FLOORPLAN_ZOOM_CONTROL:function(){wn.player.controls[G.FLOORPLAN].disableZoomControl()},DISABLE_FLOORPLAN_PAN_CONTROL:function(){wn.player.controls[G.FLOORPLAN].disablePanControl()},ENABLE_PANORAMA_CONTROL:function(){wn.player.controls[G.PANORAMA].enable()},ENABLE_DOLLHOUSE_CONTROL:function(){wn.player.controls[G.DOLLHOUSE].enable()},ENABLE_DOLLHOUSE_CAMERA_ZOOM_CONTROL:function(){wn.player.controls[G.DOLLHOUSE].cameraZoomEnabled=!0},ENABLE_DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CONTROL:function(){wn.player.controls[G.DOLLHOUSE].distanceZoomEnabled=!0},GET_ACTIVE_CAMERA:function(){return wn&&wn.sceneRender?wn.sceneRender.camera.clone():null},GET_CAMERA_ORIENTATION:function(){var t=null;if(wn.player&&wn.player.control){var e=wn.player.control.camera.getDirection(),n=Object.create(null);n.x=e.x,n.y=e.y,n.z=e.z,t=n}return t},GET_CAMERA_QUATERNION:function(){var t=null;if(wn.player&&wn.player.control){var e=wn.player.control.camera,n=Object.create(null);n.x=e.quaternion.x,n.y=e.quaternion.y,n.z=e.quaternion.z,n.w=e.quaternion.w,t=n}return t},GET_CAMERA_POSITION:function(){var t=null;if(wn.sceneRender&&wn.sceneRender.camera){var e=Object.create(null);e.x=wn.sceneRender.camera.position.x,e.y=wn.sceneRender.camera.position.y,e.z=wn.sceneRender.camera.position.z,t=e}return t},GET_CAMERA_LON_LAT:function(){return wn.player&&wn.player.control?{lon:wn.player.control.lon,lat:wn.player.control.lat}:null},GET_CORE_DATA:function(){var t=wn.data||{};return JSON.parse(JSON.stringify(t))},GET_CAMERA_WORLD_MATRIX:function(){var t=null;if(!wn.player||!wn.player.control)return t;var e=wn.player.control.camera;return t=(new L.Matrix4).copy(e.matrixWorld)},GET_CAMERA_WORLD_MATRIX_INVERSE:function(){var t=null;if(!wn.player||!wn.player.control)return t;var e=wn.player.control.camera;return t=(new L.Matrix4).copy(e.matrixWorldInverse)},GET_CAMERA_PROJECTION_MATRIX:function(){var t=null;if(!wn.player||!wn.player.control)return t;var e=wn.player.control.camera;return e.updateMatrixWorld(),e.updateProjectionMatrix(),t=(new L.Matrix4).copy(e.projectionMatrix)},GET_CAMERA_PROJECTION_MATRIX_INVERSE:function(){var t=null;if(!wn.player||!wn.player.control)return t;var e=wn.player.control.camera;return e.updateMatrixWorld(),e.updateProjectionMatrix(),t=(new L.Matrix4).copy(e.projectionMatrixInverse)},GET_RAY_FROM_CAMERA:function(){return wn.player&&wn.player.control?void 0:null},GET_NEIGHBOURS_OF_VISIBLE:function(t){return wn.waypointManager.unbarrierMap[t]},GET_MARKER_POSITION:function(t){var e=wn.waypointManager.markerMap.get(t).position,n=Object.create(null);return n.x=e.x,n.y=e.y,n.z=e.z,n},SET_PANORAMA_MODE_ZOOM:function(t){de.minZoom=t.min,de.maxZoom=t.max},SET_DOLLHOUSE_MODE_ZOOM:function(t){fe.minZoom=t.min,fe.maxZoom=t.max},SET_FLOORPLAN_MODE_ZOOM:function(t){me.minZoom=t.min,me.maxZoom=t.max},SET_DOLLHOUSE_POLAR_ANGLE:function(t){fe.minPolarAngle=t.min,fe.maxPolarAngle=t.max;var e=wn.player.controls[G.DOLLHOUSE];e.minPolarAngle=L.MathUtils.degToRad(fe.minPolarAngle),e.maxPolarAngle=L.MathUtils.degToRad(fe.maxPolarAngle)},SET_DOLLHOUSE_CONTROL_TARGET:function(t){wn.player.controls[G.DOLLHOUSE].target.copy(t)},GET_DOLLHOUSE_CONTROL_TARGET:function(){var t=wn.player.controls[G.DOLLHOUSE].target;return{x:t.x,y:t.y,z:t.z}},GET_DOLLHOUSE_VIEW_DEFAULT_POSE:function(t){void 0===t&&(t={});var e=t.zoom||1,n=t.model_id,r=wn.player.controls[G.DOLLHOUSE].getDefaultPose({zoom:e,model_id:n}),i=Object.create(null);i.x=r.position.x,i.y=r.position.y,i.z=r.position.z;var o=Object.create(null);o.x=r.quaternion.x,o.y=r.quaternion.y,o.z=r.quaternion.z,o.w=r.quaternion.w;var a=Object.create(null);a.x=r.target.x,a.y=r.target.y,a.z=r.target.z;var s=Object.create(null);return s.position=i,s.quaternion=o,s.target=a,s},GET_DOLLHOUSE_VIEW_BACKWARD_POSE:function(t){void 0===t&&(t={});var e=t.zoom||1,n=t.model_id,r=wn.modelManager.getModel(n)||wn.player.model,i=wn.player.cameras[G.PANORAMA];r.center;var o=r.boundingBox,a=o.min.distanceTo(o.max),s=i.getPosition();i.getQuaternion();var l=i.getDirection();l.clone().negate();var c=l.clone().setY(0).normalize().clone().negate().clone();c.y+=.5,c.normalize();var u=s.clone().addScaledVector(c,a),h=Ge(u,s),p=(new L.Vector3).copy(s),d=c.clone().negate();return{position:(new L.Vector3).copy(u).addScaledVector(d,a-a/e),quaternion:h,target:p}},JUDGE_BARRIER_BETWEEN_THE_POINT:function(t,e){var n=wn.player.model,r=(new L.Vector3).copy(t),i=(new L.Vector3).copy(e),o=(new L.Vector3).subVectors(i,r),a=o.clone().normalize(),s=o.length();En(a,r,s,16711680,"ray.line");var l=n.getValidColliders(),c=!1,u=new L.Raycaster;u.layers.disableAll(),u.layers.enable(ve.COLLIDER),u.set(r,a),u.far=s;for(var h=0,p=l.length;h<p;++h){var d=u.intersectObject(l[h],!1);if(0<d.length){c=!0;var f=d[0],m=f.point;f.object.showBoxHelper(65280*Math.random()*10),_n(new L.Vector3(0,100,0),m,16711935,"intersect.point.line");break}}return c},JUDGE_BARRIER_BETWEEN_THE_POINT_2:function(t,e){var n=wn.player.model,r=(new L.Vector3).copy(t),i=(new L.Vector3).copy(e),o=(new L.Vector3).subVectors(i,r),a=o.clone().normalize(),s=o.length();En(a,r,s,16711680,"ray.line");var l=new L.Raycaster;l.layers.disableAll(),l.layers.enable(ve.COLLIDER),l.set(r,a),l.far=s;for(var c=n.getValidColliders(),u=!1,h=0,p=c.length;h<p;++h){var d=c[h],f=(new L.Box3).copy(d.geometry.boundingBox).applyMatrix4(n.matrixWorld);if(!0===l.ray.intersectsBox(f)){var m=l.intersectObject(d);if(0<m.length){u=!0;var v=m[0],g=v.point;v.object.showBoxHelper(65280*Math.random()*10),_n(new L.Vector3(0,10,0),g,16711935,"intersect.point.line");break}}}return u},JUDGE_BARRIER_BETWEEN_THE_POINT_3:function(t,e){var n=wn.player.model,r=(new L.Vector3).copy(t),i=(new L.Vector3).copy(e),o=(new L.Vector3).subVectors(i,r),a=o.clone().normalize(),s=o.length(),l=new L.Raycaster,c=new L.Ray;l.layers.disableAll(),l.layers.enable(ve.COLLIDER),l.set(r,a),l.far=s,c.set(r,a);for(var u=n.getValidColliders(),h=!1,p=0,d=u.length;p<d;++p){var f=u[p],m=(new L.Box3).copy(f.geometry.boundingBox).applyMatrix4(n.matrixWorld);if(!0===c.intersectsBox(m)){var v=f.userData.bvh;if(v){var g=v.raycastFirst(l.ray,L.FrontSide,0,s);if(g&&(g.point,g.distance<s)){h=!0;break}}else if(l.intersectObject(f,!1).length>0){h=!0;break}}}return h},GET_INTERSECT_COUNT_BETWEEN_THE_POINT:function(t,e){var n=(new L.Vector3).copy(t),r=(new L.Vector3).copy(e),i=(new L.Vector3).subVectors(r,n),o=i.clone().normalize(),a=i.length();En(o,n,a,16711680,"ray.line");var s=new L.Raycaster;s.layers.enable(ve.COLLIDER),s.set(n,o),s.far=i.length();var l=wn.player.model.getValidColliders(),c=[];return s.intersectObjects(l).forEach((function(t){t.object.showBoxHelper(65280*Math.random()*10),c.push({point:t.point,distance:t.distance})})),c},GET_INTERSECT_COUNT_BETWEEN_THE_POINT_2:function(t,e){var n=(new L.Vector3).copy(t),r=(new L.Vector3).copy(e),i=(new L.Vector3).subVectors(r,n),o=i.clone().normalize(),a=i.length();En(o,n,a,16711680,"ray.line");var s=new L.Raycaster;s.layers.enable(ve.COLLIDER),s.set(n,o),s.far=i.length();for(var l=wn.player.model.getValidColliders(),c=[],u=0,h=l.length;u<h;++u){var p=l[u],d=p.geometry.boundingBox;if(!0===s.ray.intersectsBox(d)){var f=s.intersectObject(p,!1);if(0<f.length){var m=f[0];m.object.showBoxHelper(65280*Math.random()*10),c.push({point:m.point,distance:m.distance})}}}return c},GET_INTERSECT_COUNT_BETWEEN_THE_POINT_3:function(t,e){var n=wn.player.model,r=(new L.Vector3).copy(t),i=(new L.Vector3).copy(e),o=(new L.Vector3).subVectors(i,r),a=o.clone().normalize(),s=o.length(),l=new L.Raycaster;l.layers.enable(ve.COLLIDER),l.set(r,a),l.far=o.length();for(var c=wn.player.model.getValidColliders(),u=[],h=0,p=c.length;h<p;++h){var d=c[h],f=(new L.Box3).copy(d.geometry.boundingBox).applyMatrix4(n.matrixWorld);if(!0===l.ray.intersectsBox(f)){var m=d.userData.bvh;if(m){var v=m.raycast(l.ray,L.FrontSide,0,s);v.length>0&&v.forEach((function(t){var e=t.distance,n=t.point;e<s&&u.push({point:n,distance:e})}))}else{var g=l.intersectObject(d,!1);if(g.length>0){var y=g[0],_=y.point,E=y.distance;u.push({point:_,distance:E})}}}}return u},SHOW_SCENE_AXES_HELPER:function(){wn.sceneRender.trickTools.showAxesHelper()},HIDE_SCENE_AXES_HELPER:function(){wn.sceneRender.trickTools.hideAxesHelper()},SET_VERTICAL_SCOPE_OF_PANORAMA_CONTROL:function(t,e){wn.player.control.setVerticalScope(t,e)},SET_HORIZONTAL_SCOPE_OF_PANORAMA_CONTROL:function(t,e){wn.player.control.setHorizontalScope(t,e)},RESET_VERTICAL_SCOPE_OF_PANORAMA_CONTROL:function(){wn.player.control.resetVerticalScope()},RESET_HORIZONTAL_SCOPE_OF_PANORAMA_CONTROL:function(){wn.player.control.resetHorizontalScope()},CAMERA_ROTATE_VERTICAL:function(t){wn&&wn.player&&wn.player.control&&wn.player.control.rotateVertical&&wn.player.control.rotateVertical(t)},DISABLE_ZOOM_CONTTROL:function(){wn&&wn.player&&wn.player.control&&(Ht.coreStateEngine.state[Y.DISABLE_ZOOM_CONTROL].state=!0)},ENABLE_ZOOM_CONTTROL:function(){wn&&wn.player&&wn.player.control&&(Ht.coreStateEngine.state[Y.ENABLE_ZOOM_CONTROL].state=!0)},ENTER_VR:function(){wn.eventsManager.webxrEvents.enterVrMode()},FLOORPLAN_CAMERA_ROTATE:function(t){wn&&wn.player&&wn.player.control&&wn.player.control.horizontalViewRotate(t)},HIDE_MODEL:function(){wn.player.model.hide()},SHOW_MODEL:function(){wn.player.model.show()},SET_MODEL_ALPHA:function(t){wn.player.model.setAlpha(t)},ENABLE_MAGNIFYING_MODE:function(){Ht.coreStateEngine.state[Y.ENABLE_MAGNIFYING_MODE].state=!0},DISABLE_MAGNIFYING_MODE:function(){Ht.coreStateEngine.state[Y.DISABLE_MAGNIFYING_MODE].state=!0},SET_MAGNIFYING_POSITION:function(t){wn.sceneRender.magnifying.setPosition(t.x,t.y)},GET_LAYERS:function(){return Object.freeze(ve)},HIDE_MAGNIFYING_GLASS:function(){wn.sceneRender&&wn.sceneRender.magnifying&&wn.sceneRender.magnifying.hide()},SHOW_MAGNIFYING_GLASS:function(){wn.sceneRender&&wn.sceneRender.magnifying&&wn.sceneRender.magnifying.show()},SET_MAGNIFYING_GLASS_SIZE:function(t,e){wn.sceneRender&&wn.sceneRender.magnifying&&wn.sceneRender.magnifying.setSize(t,e)},STOP_RENDER:function(){Ht.coreStateEngine.state[Y.STOP_RENDER].state=!0,wn.sceneRender.renderer.setAnimationLoop(null)},CONTINUE_RENDER:function(){Ht.coreStateEngine.state[Y.STOP_RENDER].state=!1;var t=wn.sceneRender.renderer.loopCallback;wn.sceneRender.renderer.setAnimationLoop(t)},CLEAR_RENDER:function(){var t="clear render",e=wn.player.model,r=e.getUserData("type");switch(n.error(t+", model type:"+r)(),r){case kt:wn.tileDownloader&&wn.tileDownloader.stop(),wn.tileDownloader&&wn.tileDownloader.clear(),wn.panoRenderer&&wn.panoRenderer.stop(),wn.panoRenderer&&wn.panoRenderer.clear(),wn.waypointManager&&wn.waypointManager.removeGroup(),wn.waypointManager&&wn.waypointManager.clear(),!e.destroyed&&e.destroy(""+t),wn.sceneRender&&wn.sceneRender.remove(e,t+" "+kt),wn.sceneRender&&wn.sceneRender.scene.dispose(),wn.sceneRender&&wn.sceneRender.renderer.dispose(),wn.sceneRender&&wn.sceneRender.renderer.clear();break;case zt:wn.tileDownloader&&wn.tileDownloader.stop(),wn.tileDownloader&&wn.tileDownloader.clear(),wn.panoRenderer&&wn.panoRenderer.stop(),wn.panoRenderer&&wn.panoRenderer.clear(),wn.waypointManager&&wn.waypointManager.removeGroup(),wn.waypointManager&&wn.waypointManager.clear(),!e.destroyed&&e.destroy(""+t),wn.sceneRender&&wn.sceneRender.remove(e,t+" "+zt),wn.sceneRender&&wn.sceneRender.scene.dispose(),wn.sceneRender&&wn.sceneRender.renderer.dispose(),wn.sceneRender&&wn.sceneRender.renderer.clear();break;case Gt:wn.tileDownloader&&wn.tileDownloader.stop(),wn.tileDownloader&&wn.tileDownloader.clear(),wn.panoRenderer&&wn.panoRenderer.stop(),wn.panoRenderer&&wn.panoRenderer.clear(),wn.waypointManager&&wn.waypointManager.removeGroup(),wn.waypointManager&&wn.waypointManager.clear(),!e.destroyed&&e.destroy(""+t),wn.sceneRender&&wn.sceneRender.remove(e,t+" "+Gt),wn.sceneRender&&wn.sceneRender.scene.dispose(),wn.sceneRender&&wn.sceneRender.renderer.dispose(),wn.sceneRender&&wn.sceneRender.renderer.clear();break;case Wt:wn.purepanoManager.tileRenderer&&wn.purepanoManager.tileRenderer.clearCache(),wn.purepanoManager.tileDownloader&&wn.purepanoManager.tileDownloader.stop(),!e.destroyed&&e.destroy(""+t),wn.sceneRender&&wn.sceneRender.remove(e,t+" "+Wt),wn.sceneRender&&wn.sceneRender.scene.dispose(),wn.sceneRender&&wn.sceneRender.renderer.dispose(),wn.sceneRender&&wn.sceneRender.renderer.clear()}},GET_PANO_POSE_MATRIX:function(t){var e=wn.player.model.panos.get(t);if(e)return e.poseMatrix.clone();n.error("get pano pose matrix failure, reason: invalid id<"+t+">")()},SET_SCENE_SKYBOX_BACKGROUND:function(t){var e=t.pics,n=t.complete;we(e,(function(t){wn.sceneRender.setSkyboxBackground(t),n()}))},HIDE_SCENE_SKYBOX_BACKGROUND:function(){wn.sceneRender.hideSkyboxBackground()},SHOW_SCENE_SKYBOX_BACKGROUND:function(){wn.sceneRender.showSkyboxBackground()},ENABLE_AMBIENT_LIGHT:function(t){wn.sceneRender.renderer.enableAmbientLight(t)},ENABLE_DIRECT_LIGHT:function(t){wn.sceneRender.renderer.enableDirectLight(t)},DISABLE_AMBIENT_LIGHT:function(){wn.sceneRender.renderer.disableAmbientLight()},DISABLE_DIRECT_LIGHT:function(){wn.sceneRender.renderer.disableDirectLight()},SET_AMBIENT_LIGHT_COLOR:function(t){wn.sceneRender.renderer.setAmbientLightColor(t)},SET_AMBIENT_LIGHT_INTENSITY:function(t){wn.sceneRender.renderer.setAmbientLightIntensity(t)},SET_DIRECT_LIGHT_COLOR:function(t){wn.sceneRender.renderer.setDirectLightColor(t)},SET_DIRECT_LIGHT_INTENSITY:function(t){wn.sceneRender.renderer.setDirectLightIntensity(t)},SET_DIRECT_LIGHT_POSITION:function(t){wn.sceneRender.renderer.setDirectLightPosition(t)},SET_DIRECT_LIGHT_LOOKAT:function(t){wn.sceneRender.renderer.setDirectLightLookAt(t)},RENDER_SCREEN_SHOT_IMAGE:function(t){void 0===t&&(t=function(){}),pe.renderStaticCover((function(){t()}))},ENABLE_SCENE_FOG:function(t){var e=t.color||13426943,n=t.near,r=t.far;wn.sceneRender.scene.fog=new L.Fog(e,n,r)},DISABLE_SCENE_FOG:function(){wn.sceneRender.scene.fog=null}}),wn=null,Ln=null,Dn=function(){wn=k.getCore(),this.name="CoreEvents",this.Events=Y,this.EventsDealt=On};Dn.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),Ht.coreStateEngine.init()},Dn.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)(),lt.core.hook[Y.CORE_RENDER_STAGE_RESIZE]=function(t){wn.commonExtension[z.NEED_ON_RESIZE]&&wn.commonExtension[z.NEED_ON_RESIZE](t)}},Dn.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)()},Dn.prototype.coreLoaded=function(t){wn.bootOptions.onLoaded(),wn.commonExtension[z.NEED_CORE_LOADED]&&wn.commonExtension[z.NEED_CORE_LOADED](t),Ht.coreStateEngine.state[Y.CORE_LOADED].data=t,Ht.coreStateEngine.state[Y.CORE_LOADED].state=!0};var Cn=null,Pn=function(){Cn=k.getCore(),this.name="RenderEvents"};Pn.prototype.init=function(){var t=this.name+" init";n.info(""+t)()},Pn.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)()},Pn.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)()},Pn.prototype.showFps=function(){Cn.sceneRender.trickTools.showFps()},Pn.prototype.hideFps=function(){Cn.sceneRender.trickTools.hideFps()},Pn.prototype.update=function(t){Cn.commonExtension[z.NEED_UPDATE]&&Cn.commonExtension[z.NEED_UPDATE](t),Ht.coreStateEngine.state[Y.FRAME_UPDATE].data=t,Ht.coreStateEngine.state[Y.FRAME_UPDATE].state=!0};var Nn=a((function(t,e){t.exports=function(){var t,e,n="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},r=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){var r=Object.keys(this._tweens);if(0===r.length)return!1;for(t=void 0!==t?t:n();r.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<r.length;i++){var o=this._tweens[r[i]];o&&!1===o.update(t)&&!e&&delete this._tweens[r[i]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),i={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-i.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*i.Bounce.In(2*t):.5*i.Bounce.Out(2*t-1)+.5}}},o={Linear:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),a=o.Utils.Linear;return e<0?a(t[0],t[1],r):e>1?a(t[n],t[n-1],n-r):a(t[i],t[i+1>n?n:i+1],r-i)},Bezier:function(t,e){for(var n=0,r=t.length-1,i=Math.pow,a=o.Utils.Bernstein,s=0;s<=r;s++)n+=i(1-e,r-s)*i(e,s)*t[s]*a(r,s);return n},CatmullRom:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),a=o.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),a(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],r-i)):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[n]-(a(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):a(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],r-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=o.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(e=[1],function(t){var n=1;if(e[t])return e[t];for(var r=t;r>1;r--)n*=r;return e[t]=n,n}),CatmullRom:function(t,e,n,r,i){var o=.5*(n-t),a=.5*(r-e),s=i*i;return(2*e-2*n+o+a)*(i*s)+(-3*e+3*n-2*o-a)*s+o*i+e}}},a=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),s=function(){function t(t,e){void 0===e&&(e=c),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=c.Easing.Linear.None,this._interpolationFunction=c.Interpolation.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=c.nextId(),this._isChainStopped=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){for(var n in t)this._valuesEnd[n]=t[n];return void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?c.now()+parseFloat(t):t:c.now(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,r){for(var i in n){var o=t[i],a=Array.isArray(o),s=a?"array":typeof o,l=!a&&Array.isArray(n[i]);if("undefined"!==s&&"function"!==s){if(l){var c=n[i];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,o)),n[i]=[o].concat(c)}if("object"!==s&&!a||!o||l)void 0===e[i]&&(e[i]=o),a||(e[i]*=1),r[i]=l?n[i].slice().reverse():e[i]||0;else{for(var u in e[i]=a?[]:{},o)e[i][u]=o[u];r[i]=a?[]:{},this._setupProperties(o,e[i],n[i],r[i])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this.update(1/0),this},t.prototype.pause=function(t){return this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=void 0===t?c.now():t,this._group.remove(this)),this},t.prototype.resume=function(t){return this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=(void 0===t?c.now():t)-this._pauseStart,this._pauseStart=0,this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this._chainedTweens=e,this},t.prototype.unchain=function(t){var e=this._chainedTweens.indexOf(t);-1!==e&&this._chainedTweens.splice(e,1)},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t){var e,n;if(t>this._startTime+this._duration&&!this._isPlaying)return!1;if(this.isPlaying||this.start(t),t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(t-this._startTime)/this._duration,n=0===this._duration||n>1?1:n;var r=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,r),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(e in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[e]||(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo&&this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var i=0,o=this._chainedTweens.length;i<o;i++)this._chainedTweens[i].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,r){for(var i in n)if(void 0!==e[i]){var o=e[i]||0,a=n[i],s=Array.isArray(t[i]),l=Array.isArray(a);!s&&l?t[i]=this._interpolationFunction(a,r):"object"==typeof a&&a?this._updateProperties(t[i],o,a,r):"number"==typeof(a=this._handleRelativeValue(o,a))&&(t[i]=o+(a-o)*r)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t];"string"==typeof this._valuesEnd[t]?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t]):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=e},t}(),l=this&&this.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)},function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}),c=new(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.version="18.5.0",e.now=n,e.Group=r,e.Easing=i,e.Interpolation=o,e.nextId=a.nextId,e.Tween=s,e}return l(e,t),e}(r));return c}()})),Rn={CoreData:function(t){var e,r,i="check init data integrity";if(!1===vt(t,i+", reason: data"))return!1;if(!1===dt(t.type,i+", reason: data.type"))return!1;if(kt===t.type||zt===t.type||Gt===t.type){if(!1==(!1!==vt(e=t.basic,(r=i)+", reason: basic")&&!1!==dt(e.model_id,r+", reason: basic.model_id")&&!1!==dt(e.model_nest_url,r+", reason: basic.model_nest_url")&&!1!==dt(e.model_texture_url,r+", reason basic.model_texture_url")&&0!=dt(e.pano_tile_url,r+", reason: basic.pano_tile_url")&&!1!==gt(e.cube_support,r+", reason: basic.cube_support")&&!1!==gt(e.lod_support,r+", reason: basic.lod_support")&&!1!==dt(e.render_mode,r+", reason: basic.render_mode")&&!1!==dt(e.render_set,r+", reason: basic.render_set")&&(ft(e.panorama_camera_fov),!0)))return!1;if(!1===function(t,e){return!1!==vt(t,e+", reason: data.building")&&(!1!==gt(t.blocks,e+", reason: building.blocks")&&(0===t.blocks.length?(n.error(e+", reason: building.blocks is empty array!!!")(),!1):!1!==gt(t.floors,e+", reason: building.floors")&&(0!==t.floors.length||(n.error(e+", reason: building.floors is empty array!!!")(),!1))))}(t.building,i))return!1;if(!1===function(t,e){return!1!==gt(t,e+", reason: data.waypoints")&&(0!==t.length||(n.error(e+", reason: data.waypoints is empty array!!!")(),!1))}(t.waypoints,i))return!1;if(!1===function(t,e){return!1!==vt(t,e+", reason: entry_info")&&(t.mode?!1!==dt(t.mode,e+", reason: entry_info.mode"):(n.error(e+", reason: entry_info.mode invalid!!!")(),!1))}(t.entry_info,i))return!1}if(Wt===t.type){if(!1===vt(t.basic,i+", reason: data.basic"))return!1;if(!t.basic.render_mode)return n.error(i+", reason: basic.render_mode invalid!!!")(),!1;if(!t.basic.render_set)return n.error(i+", reason: basic.render_set invalid!!!")(),!1;if(ft(t.basic.panorama_camera_fov,i+", reason: basic.panorama_camera_fov"),!1===vt(t.entry_info,i+", reason: data.entry_info"))return!1;if(!1===dt(t.entry_info.anima,i+", reason: entry_info.anima"))return!1}return!0}},In={GET_ACTIVE_MODEL_ID:kn,GET_ACTIVE_MODEL_TYPE:function(){var t=Bn.player.model;if(t)return t.userData.type;n.error("get active model type failure, reason: unget active model")()},GET_MODEL_BOX_SIZE:function(){if(Bn.player)return Bn.player.model.getBoxVertexScreenPosition()},GET_PANO_POSITION:function(t){var e=null,n=Bn.player.model;if(!n)return e;var r=n.panos.get(t);return r?e=(new L.Vector3).copy(r.position):e},SWITCH_PUREPANO:function(t){var e="switch purepano";n.debug(e+", options:",t)();var r=e+" failure";!0!==Ht.actionStateEngine.state["action.mode.panorama"].state?!0!==Ht.actionStateEngine.state["action.mode.dollhouse"].state?!0!==Ht.actionStateEngine.state["action.mode.floorplan"].state?Bn.purepanoManager.activePano&&Bn.purepanoManager.activePano.panoId===t.data.basic.pano_id?n.warn(r+", reason: samed pano!")():(Bn.commonExtension[z.NEED_SWITCH_MODEL]&&Bn.commonExtension[z.NEED_SWITCH_MODEL](t),Bn.purepanoManager.switchPano(t)):n.warn(r+", reason: fly to "+G.FLOORPLAN+" not complete")():n.warn(r+", reason: fly to "+G.DOLLHOUSE+" not complete")():n.warn(r+", reason: fly to "+G.PANORAMA+" not complete")()},SWITCH_MODEL:function(t){var e="ModelEvents switch model failure";!0!==Ht.modelStateEngine.state[q.DISABLE_SWITCH_MODEL].state?!1!==Rn.CoreData(t.data)?t.data.basic.model_id!==kn()?(Bn.commonExtension[z.NEED_SWITCH_MODEL]&&Bn.commonExtension[z.NEED_SWITCH_MODEL](t),Bn.modelManager.switchModel(t)):n.warn(e+", reason: same model!")():n.error(e+", reason: invalid options.data!")():n.warn(e+", reason: disable switch model")()},SWITCH_MODEL_VISIBLE:function(t){void 0===t&&(t=!0);var e=Bn.player.model;e&&(t?e.show():e.hide())},VIEW_MESH:function(){var t=Bn.player.model;"model"===t.userData.type&&t.setAlpha(1)},UN_VIEW_MESH:function(){var t=Bn.player.model;"model"===t.userData.type&&t.setAlpha(0)},ENABLE_PANO:function(t){Bn.player.model.panos.get(t).setEnable()},DISABLE_PANO:function(t){Bn.data.entry_point.location_id!==t?Bn.player.model.panos.get(t).setDisable():n.error("disable pano failure, reason: entry pano can't disabled")()},SHOW_WAYPOINT:function(t){Bn.waypointManager.markerMap.get(t).show()},HIDE_WAYPOINT:function(t){Bn.waypointManager.markerMap.get(t).hide()},SET_WAYPOINT_PIC:function(t){void 0===t&&(t={});var e=t.id,r=t.pic,i=t.default,o=t.complete||function(){};if(r){var a=Bn.player.model.panos.get(e);a?a.marker.setTexture(r,i,(function(){o()})):n.error("set marker texture failure, reason: invalid locationid")()}else n.error("set marker texture failure, reason: invalid pic")()},SET_WAYPOINT_TEXTURE:function(t){void 0===t&&(t={});var e=t.id,r=t.texture,i=t.default,o=t.complete||function(){};r?Bn.waypointManager.markerMap.get(e).setTexture2(r,i,(function(){o()})):n.error("set waypoint texture failure, reason: invalid texture")()},SET_WAYPOINT_COLOR:function(t,e){var r=Bn.waypointManager.markerMap.get(t);r?r.setColor(e):n.error("set waypoint color failure, reason: invalid id!")()},SET_WAYPOINT_SCALE:function(t,e){var r=Bn.waypointManager.markerMap.get(t);r?r.setScale(e):n.error("set waypoint scale failure, reason: invalid id!")()},SET_WAYPOINT_OPACITY:function(t,e){var r=Bn.waypointManager.markerMap.get(t);r?r.setOpacity(e):n.error("set waypoint opacity failure, reason: invalid id!")()},SET_ALL_WAYPOINT_PIC:function(t){var e=t.default,r=t.pic,i=t.complete||function(){},o=Bn.waypointManager.markerMap;r?Oe(r,(function(t){o.forEach((function(n){n.setTexture2(t,e)})),i()})):n.error("set all marker texture failure, reason: invalid pic")()},RESET_WAYPOINT:function(t){Bn.waypointManager.markerMap.get(t).reset()},RESET_ALL_WAYPOINT:function(){Bn.waypointManager.markerMap.forEach((function(t){t.reset()}))},DISABLE_SWITCH_MODEL:function(){Ht.modelStateEngine.state[q.DISABLE_SWITCH_MODEL].state=!0},ENABLE_SWITCH_MODEL:function(){Ht.modelStateEngine.state[q.DISABLE_SWITCH_MODEL].state=!1},DISABLE_SWITCH_PUREPANO:function(){Ht.modelStateEngine.state[q.DISABLE_SWITCH_PUREPANO].state=!0},ENABLE_SWITCH_PUREPANO:function(){Ht.modelStateEngine.state[q.DISABLE_SWITCH_PUREPANO].state=!1},SET_SINGLE_WAYPOINT_SWITCH_CONFIG:function(t){void 0===t&&(t={});var e=Bn.player.model.panos.get(t.id);e.switch_mode=t.switch_mode,e.switch_config=t.config},GET_WAYPOINT_POSITION:function(t){var e=Bn.player.model;if("model"!==e.userData.type)return null;var n=e.getSweepPointPosition(t),r=Object.create(null);return r.x=n.bottom.x,r.y=n.bottom.y+.05,r.z=n.bottom.z,Object.freeze(r)},GET_MODEL_FACES_COUNT:function(){},GET_MODEL_VERTICES_COUNT:function(){},SHOW_COLLIDER_MASK:function(t){Bn.player.model.trickTools.showColliderMask(t)},HIDE_COLLIDER_MASK:function(){Bn.player.model.trickTools.hideColliderMask()},GET_CENTER:function(){return Bn.player.model.center},GET_BOUDING_BOX:function(){return Bn.player.model.boundingBox},GET_ALL_FLOORS_INFO:function(){var t=Bn.player.model,e=[];return t.floors.forEach((function(t){var n=[],r=0;t.chunks.forEach((function(t){n.push(t.name),r+=t.getFaceCount()})),e.push({idx:t.floorIndex,size:(new L.Vector3).copy(t.size),chunks:n,face_count:r})})),e},GET_CURRENT_FLOOR_INFO:function(){var t=Bn.player.model.currentFloor;return t?{idx:t.floorIndex}:null},GET_FLOOR_TOP_VERTICES_SCREEN_POSITION:function(t){var e=Bn.player.model,n=Hn(),r=e.floors.get(t).getBoxTopWpVertices(),i=[];return r.forEach((function(t){var e=Fe(t,n);i.push(e)})),i},GET_FLOOR_CENTER:zn,GET_FLOOR_SCREEN_CENTER:function(t){var e=zn(t);if(!e)return null;var n=Hn();return Fe(e,n)},GET_FLOOR_SIZE:function(t){return Bn.player.model.floors.get(t).size},GET_FLOOR_BOX3:function(t){return Bn.player.model.floors.get(t).box3},SWITCH_FLOOR:function(t){Bn.player.model.switchFloor(t)},ENABLE_FLOOR:function(t){Bn.player.model.enableFloor(t)},DISABLE_FLOOR:function(t){Bn.player.model.disableFloor(t)},SHOW_FLOOR:function(t){Bn.player.model.floors.get(t).show()},HIDE_FLOOR:function(t){Bn.player.model.floors.get(t).hide()},SET_MODEL_OPACITY:function(t){Bn.player.model.setOpacity(t)},SET_FLOOR_OPACITY:function(t,e){Bn.player.model.setFloorOpacity(t,e)},SET_CHUNK_OPACITY:function(t,e){Bn.player.model.chunksMap.get(t).setOpacity(e)},ADD_MODEL:function(t){var e=t.data,n=t.complete||function(){},r=Bn.modelManager.createModel(e);Bn.modelManager.addModel(r),r.init(),r.load((function(){Bn.sceneRender.add(r),n({type:e.type,id:e.basic.model_id}),Ht.modelStateEngine.state[q.ADD_MODEL_COMPLETE].data={type:r.data.type,id:r.modelid},Ht.modelStateEngine.state[q.ADD_MODEL_COMPLETE].state=!0}))},REMOVE_MODEL:function(t){var e=Bn.modelManager.getModel(t);Bn.modelManager.removeModel(t),Bn.sceneRender.remove(e,"remove.model"),e.destroy("remove.model")},SET_CHUNKS_MATERIAL_SIDE:function(t){Bn.player.model.setChunksMaterialSide(t)}},Un={},Bn=null,Fn=function(){Bn=k.getCore(),this.name="ModelEvents",this.Events=q,this.EventsDealt=In,this.Methods=Un};function Hn(){return Bn.player.control?Bn.player.control.camera:null}function kn(){var t=Bn.player.model;if(!t)return n.error("get active model id failure, reason: unget active model")(),null;var e=t.userData.type;return"model"===e?t.modelid:"purepano"===e?t.panoId:void 0}function zn(t){var e=Bn.player.model;if(!e)return null;if("model"!==e.userData.type)return null;var n=e.floors.get(t);return n?n.box3.getCenter(new L.Vector3):null}Fn.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),Ht.modelStateEngine.init()},Fn.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)(),lt.model.hook[q.SWITCH_FLOOR_COMPLETE]=function(t){Bn.commonExtension[z.NEED_MODEL_SET_FLOOR]&&Bn.commonExtension[z.NEED_MODEL_SET_FLOOR](t)},lt.model.hook[q.SWITCH_MODEL_COMPLETE]=function(t){}},Fn.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)()},Fn.prototype.onSetMode=function(t){Bn.commonEvents.modelEvents.onSetMode(t)};var Gn={default:{max_distance:5},fixed_delay:{duration:1e3},uniform_motion:{speed:1.5},fade:{in:500,out:500}},Wn=null;function Vn(t){null===Wn&&(Wn=k.getCore());var e=Wn.player.cameras[G.DOLLHOUSE],n=(new L.Vector3).copy(t.origin_position),r=(new L.Vector3).copy(t.target_position),i=t.duration,o=t.delay,a=t.progress||function(){},s=t.complete||function(){},l=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Linear.None).delay(o).duration(i).onUpdate((function(t){var i=t.value,o=(new L.Vector3).copy(n).lerp(r,i);e.setPosition(o,"dollhouse.camera.switch.to.position.animation"),a()})).onComplete((function(t){l.stop()})).onStop((function(t){l=null,s()})).start()}var jn=null;function Yn(t){null===jn&&(jn=k.getCore());var e=jn.player.cameras[G.DOLLHOUSE],n=(new L.Quaternion).copy(t.origin_quaternion),r=(new L.Quaternion).copy(t.target_quaternion),i=t.duration,o=t.delay,a=t.progress||function(){},s=t.complete||function(){},l=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Linear.None).delay(o).duration(i).onUpdate((function(t){var i=t.value,o=(new L.Quaternion).copy(n).slerp(r,i);e.setQuaternion(o,"dollhouse.camera.switch.to.quaternion.animation"),a()})).onComplete((function(t){l.stop()})).onStop((function(t){l=null,s()})).start()}var Xn=null;function Zn(t){void 0===t&&(t={}),null===Xn&&(Xn=k.getCore());var e=Xn.player.controls[G.DOLLHOUSE];e.camera;var n=t.origin_pose,r=t.target_pose,i=t.duration,o=t.delay,a=t.progress||function(){},s=t.complete||function(){};!function(t){void 0===t&&(t={});var e=t.origin_pose,n=t.target_pose,r=t.duration,i=t.delay,o=t.progress,a=t.complete,s=e.position,l=e.quaternion;e.target;var c=n.position,u=n.quaternion;n.target;var h=new St(2,(function(){a()}));Vn({origin_position:s,target_position:c,duration:r,delay:i,progress:function(){},complete:function(){h.record(1)}}),Yn({origin_quaternion:l,target_quaternion:u,duration:r,delay:i,progress:function(){o()},complete:function(){h.record(2)}})}({origin_pose:n,target_pose:r,duration:i,delay:o,progress:function(){a()},complete:function(){var t=r.target;e.target.copy(t),s()}})}var qn={ACTION_MODE_DOLLHOUSE:function(t){void 0===t&&(t={});var e="fly to "+G.DOLLHOUSE+" failure";if(!0!==Ht.actionStateEngine.state[X.DISABLE_SWITCH_TO_NEW_MODE].state)if(!0!==Ht.actionStateEngine.state[X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].state){var r=t.position,i=t.quaternion,o=t.target,a=t.camera_zoom,s=t.ditance_zoom,l=t.complete||function(){};Re.SyncData[Re.SyncEvents.FLY_TO_DOLLHOUE].state=!0,Qn.player.flyToDollhouseMode({position:r,quaternion:i,target:o,camera_zoom:a,distance_zoom:s,complete:function(){Re.SyncData[Re.SyncEvents.FLY_TO_DOLLHOUE].state=!1;var t=Ht.actionStateEngine.state[X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].data;l(t)}})}else n.warn(e+", reason: bas been "+G.DOLLHOUSE+" mode")();else n.warn(e+", reason: disabled switch mode")()},SWITCH_PANORAMA_VIEW_OF_FLY:function(t){void 0===t&&(t={});var e="switch "+G.PANORAMA+" view of fly";if(!0!==Ht.actionStateEngine.state[X.DISABLE_SWITCH_TO_NEW_MODE].state)if(!0!==Ht.actionStateEngine.state[X.SWITCH_TO_PANORAMA_MODE_COMPLETE].state){var r=t.location_id,i=t.quaternion,o=t.lookat_target,a=t.zoom,s=t.duration;t.progress;var l=t.complete||function(){},c=Qn.player.model.panos.get(r);c?(void 0!==i?c.currentQuaternion=i:void 0!==o&&(c.currentQuaternion=Ge(c.position,o)),Re.SyncData[Re.SyncEvents.FLY_TO_PANORAMA].state=!0,Qn.player.updateTargetPano(c,e),Qn.player.flyToPanoramaMode({pano:c,zoom:a,duration:s,progress:function(){},complete:function(){Re.SyncData[Re.SyncEvents.FLY_TO_PANORAMA].state=!1;var t=Ht.actionStateEngine.state[X.SWITCH_TO_PANORAMA_MODE_COMPLETE].data;l(t)}})):n.error(e+" failure, reason: invalid pano!")()}else n.warn(e+" failure, reason: bas been "+G.PANORAMA+" view")();else n.warn(e+" failure, reason: disabled switch view!")()},SWITCH_TO_PANORAMA_VIEW_OF_FADE:function(t){void 0===t&&(t={});var e="switch "+G.PANORAMA+" view of fade";if(!0!==Ht.actionStateEngine.state[X.DISABLE_SWITCH_TO_NEW_MODE].state)if(!0!==Ht.actionStateEngine.state[X.SWITCH_TO_PANORAMA_MODE_COMPLETE].state){var r=t.location_id,i=t.quaternion,o=t.origin_opacity||0,a=t.fade_in_duration||300;t.progress;var s=t.complete||function(){},l=Qn.player.model.panos.get(r);l?(!!i&&(l.currentQuaternion=i),Re.SyncData[Re.SyncEvents.FLY_TO_PANORAMA].state=!0,Qn.player.updateTargetPano(l),pe.renderStaticCover((function(){Qn.player.model.hide(),Qn.player.flyToPanoramaMode({pano:l,duration:0,onPanoLoaded:function(){},progress:function(){},complete:function(){var t=Ht.actionStateEngine.state[X.SWITCH_TO_PANORAMA_MODE_COMPLETE].data;Qn.player.model.skybox.setOpacity(o),Qn.player.model.skybox.fadeIn({duration:a,complete:function(){Qn.screenshotImage&&(Jt().removeChild(Qn.screenshotImage),Qn.screenshotImage=null),Qn.player.model.show(),s(t)}})}})}))):n.error(e+" failure, reason: invalid pano!")()}else n.warn(e+" failure, reason: bas been "+G.PANORAMA+" view")();else n.warn(e+" failure, reason: disabled switch view!")()},ACTION_MODE_FLOORPLAN:function(t){void 0===t&&(t={});var e="fly to "+G.FLOORPLAN+" failure";if(!0!==Ht.actionStateEngine.state[X.DISABLE_SWITCH_TO_NEW_MODE].state)if(!0!==Ht.actionStateEngine.state[X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].state){var r=t.complete||function(){};Re.SyncData[Re.SyncEvents.FLY_TO_FLOORPLAN].state=!0,Qn.player.flyToFloorplanMode((function(){Re.SyncData[Re.SyncEvents.FLY_TO_FLOORPLAN].state=!1;var t=Ht.actionStateEngine.state[X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].data;r(t)}))}else n.warn(e+", reason: bas been "+G.FLOORPLAN+" mode")();else n.warn(e+", reason: disabled switch mode")()},ACTION_SWITCH_TO_PANO:function(t){void 0===t&&(t={});var e="ActionEvents switch to pano";if(!0!==Ht.actionStateEngine.state[X.DISABLE_SWITCH_PANO].state){var r=t.location_id,i=Qn.player.model.panos.get(r);if(i)if(!0===i.enable){var o=t.lookat_target,a=t.quaternion,s=t.zoom,l=t.switch_mode,c=t.free_rotate,u=t.duration,h=t.complete||function(){};void 0!==a?i.currentQuaternion=a:void 0!==o&&(i.currentQuaternion=Ge(i.position,o)),void 0!==s&&(i.camera_zoom=s),void 0!==c&&(i.free_rotate=c);var p=i.switch_mode,d=JSON.parse(JSON.stringify(i.switch_config));void 0!==l&&(i.switch_mode=l,i.switch_config=Gn[l]),"fixed_delay"===l&&(i.switch_config.duration=u);var f=Qn.player.mode;Qn.player.switchToTargetPano[f](i,(function(){i.lookat_target=null,i.switch_mode=p,i.switch_config=d,h()}))}else n.error(e+" failure, reason: is disabled!")();else n.error(e+" failure, reason: invalid location_id:"+r)()}else n.warn(e+" failure, reason: disable switch to pano")()},ACTION_CAMERA_LOOK_AT:function(t){var e=t.target,n=t.duration,r=t.progress||function(){},i=t.complete||function(){},o=Qn.sceneRender.camera.getPosition();if(0<n){var a=(new L.Matrix4).lookAt(o,e,Ie.UP),s=(new L.Quaternion).setFromRotationMatrix(a);Qn.player.control.lookAt3(s,n,(function(t){r(t)}),(function(){i()}))}else Qn.player.control.lookAt(e),i()},CAMERA_LOOKAT_ROTATION:function(t){var e=t.rotation,n=t.duration,r=t.progress||function(){},i=t.complete||function(){};Qn.player.control.lookAtRotation(e,n,(function(){r()}),(function(){i()}))},CAMERA_CLOCKWISE_ROTATE:function(t){if(Qn.player&&Qn.player.control&&Qn.player.controls[G.PANORAMA]){var e=t.deg,n=t.duration,r=t.progress,i=t.complete,o=t.stoped;Qn.player.controls[G.PANORAMA].clockwiseRotate(e,n,r,i,o)}},CAMERA_ANTICLOCKWISE_ROTATE:function(t){if(Qn.player&&Qn.player.control&&Qn.player.controls[G.PANORAMA]){var e=t.deg,n=t.duration,r=t.progress,i=t.complete,o=t.stoped;Qn.player.controls[G.PANORAMA].clockwiseRotate(-e,n,r,i,o)}},STOP_PANORAMA_CONTROL_ROTATION:function(){if(Qn.player){var t=Qn.player.controls[G.PANORAMA];t&&t.stopRotation()}},DISABLE_SWITCH_MODE:function(){Ht.actionStateEngine.state[X.DISABLE_SWITCH_TO_NEW_MODE].cmd="disable.switch.mode",Ht.actionStateEngine.state[X.DISABLE_SWITCH_TO_NEW_MODE].state=!0},DISABLE_SWITCH_PANO:function(){!0!==Ht.actionStateEngine.state[X.DISABLE_SWITCH_PANO].state?(Ht.actionStateEngine.state[X.DISABLE_SWITCH_PANO].cmd="ActionEvents.disable.switch.pano",Ht.actionStateEngine.state[X.DISABLE_SWITCH_PANO].state=!0):n.warn("disable switch pano failure, reason: already disabled!")()},ENABLE_SWITCH_MODE:function(){Qn.player&&Qn.player.model&&"model"===Qn.player.model.userData.type&&(Ht.actionStateEngine.state[X.DISABLE_SWITCH_TO_NEW_MODE].state=!1)},ENABLE_SWITCH_PANO:function(){!1!==Ht.actionStateEngine.state[X.DISABLE_SWITCH_PANO].state?(Ht.actionStateEngine.state[X.DISABLE_SWITCH_PANO].cmd="ActionEvents.enable.switch.pano",Ht.actionStateEngine.state[X.DISABLE_SWITCH_PANO].state=!1):n.warn("enable switch pano failure, already enabled!")()},DISABLE_HIT_WALL:function(){Ht.actionStateEngine.state[X.DISABLE_HIT_WALL].state=!0},ENABLE_HIT_WALL:function(){Ht.actionStateEngine.state[X.ENABLE_HIT_WALL].state=!0},DOLLHOUSE_CAMERA_SWITCH_TO_POSITION:function(t){var e=t.origin_position,n=t.target_position,r=t.duration||1e3,i=t.delay||0;t.progerss;var o=t.complete||function(){};Vn({origin_position:e,target_position:n,duration:r,delay:i,progerss:function(){},complete:function(){o()}})},DOLLHOUSE_CAMERA_SWITCH_TO_QUATERNION:function(t){var e=t.origin_quaternion,n=t.target_quaternion,r=t.duration||1e3,i=t.delay||0;t.progerss;var o=t.complete||function(){};Yn({origin_quaternion:e,target_quaternion:n,duration:r,delay:i,progresss:function(){},complete:function(){o()}})},DOLLHOUSE_CAMERA_SWITCH_POSE:function(t){var e=t.origin_pose,n=t.target_pose,r=t.duration||1e3,i=t.delay||0,o=t.progress||function(){},a=t.complete||function(){};Zn({origin_pose:e,target_pose:n,duration:r,delay:i,progress:function(t){o(t)},complete:function(){a()}})},FLY_TO_MODEL_PANORAMA_MODE:function(t){var e="switch to model panorama mode",r=t.model_id,i=t.pano_id,o=t.quaternion,a=t.lookat,s=t.zoom,l=t.duration;t.progress;var c=t.complete||function(){},u=Qn.player.mode;if(G.DOLLHOUSE===u){var h=Qn.modelManager.getModel(r);if(h){var p=Qn.player.model;Qn.data=h.data,_e.setCoreData(h.data);var d=_e.getCameraFov();Qn.player.controls[G.PANORAMA].setFov(d),Qn.waypointManager.destroy(),Qn.tileDownloader.stop(),Qn.panoRenderer.stop(),Qn.tileDownloader.clear(),Qn.panoRenderer.clear(),Qn.tileDownloader.setPanoData(h.modelid,h.panos),Qn.player.setModel(h),Qn.waypointManager.init(),Qn.waypointManager.computeWaypointBarrier(h.panos),h.panos.forEach((function(t){Qn.waypointManager.addMarker(t.marker)})),Qn.tileDownloader.start(),Qn.panoRenderer.start();var f,m=h.data.entry_point,v=i||m.location_id,g=h.panos.get(v);a&&(f=Ge(g.position,a));var y=o||f||m.rotation;g.currentQuaternion=(new L.Quaternion).copy(y),Qn.player.flyToPanoramaMode({pano:g,zoom:s,duration:l,progress:function(){},complete:function(){p.hide(),p.skybox.hide(e),p.setMode(G.PANORAMA),p.panos.forEach((function(t){t.minimumTiledPanoLoaded=!1,t.clear()})),c()}})}else n.error(e+" failure, reason: unget model<"+r+">")()}else n.error(e+" failure, reason: current mode is not "+G.DOLLHOUSE+"!")()},FLY_TO_MODEL_DOLLHOUSE_MODE:function(t){var e="switch to model panorama mode",r=t.model_id,i=Qn.player.mode;if(G.PANORAMA===i){var o=Qn.modelManager.getModel(r);if(o){var a=Qn.player.model;Qn.data=o.data,_e.setCoreData(o.data),Qn.waypointManager.destroy(),Qn.tileDownloader.stop(),Qn.panoRenderer.stop(),Qn.tileDownloader.clear(),Qn.panoRenderer.clear(),Qn.tileDownloader.setPanoData(o.modelid,o.panos),Qn.player.setModel(o),Qn.waypointManager.init(),Qn.waypointManager.computeWaypointBarrier(o.panos),o.panos.forEach((function(t){Qn.waypointManager.addMarker(t.marker)})),o.show();var s=Qn.player.controls[G.DOLLHOUSE].getDefaultPose(),l=t.position||s.position,c=t.quaternion||s.quaternion,u=t.target||s.target,h=t.progress||function(){},p=t.complete||function(){},d=new Nn.Tween({value:0}).to({value:1}).duration(500).easing(Nn.Easing.Linear.None).onUpdate((function(t){var e=t.value,n=1-e;a.setAlpha(e),a.skybox.setOpacity(n)})).onComplete((function(t){d.stop()})).onStop((function(t){d=null})).start();Qn.player.flyToDollhouseMode({position:l,quaternion:c,target:u,progress:function(t){h(t)},complete:function(){a.skybox.hide(e),a.panos.forEach((function(t){t.minimumTiledPanoLoaded=!1,t.clear()})),o.skybox.show(),Qn.tileDownloader.start(),Qn.panoRenderer.start(),p()}})}else n.error(e+" failure, reason: unget model<"+r+">")()}else n.error(e+" failure, reason: current mode is not "+G.PANORAMA+"!")()},SWITCH_TO_MODEL_PANORAMA_MODE_OF_FADE:function(t){var e="switch to model panorama mode of fade",r=t.model_id,i=t.pano_id,o=t.quaternion,a=t.lookat,s=t.zoom,l=t.swith_mode||"fade",c=t.fadein_duration||500,u=t.fadeout_duration||500,h=t.complete||function(){},p=Qn.player.model,d=Qn.modelManager.getModel(r);if(d)if(G.PANORAMA===Qn.player.mode){Qn.data=d.data,_e.setCoreData(d.data),Qn.waypointManager.destroy(),Qn.tileDownloader.stop(),Qn.panoRenderer.stop(),Qn.tileDownloader.clear(),Qn.panoRenderer.clear(),Qn.tileDownloader.setPanoData(d.modelid,d.panos),Qn.player.model=d,Qn.player.model.setAlpha(0),Qn.waypointManager.init(),Qn.waypointManager.computeWaypointBarrier(d.panos),d.panos.forEach((function(t){Qn.waypointManager.addMarker(t.marker)})),Qn.tileDownloader.start(),Qn.panoRenderer.start();var f,m=d.data.entry_point,v=i||m.location_id,g=d.panos.get(v);a&&(f=Ge(g.position,a));var y=o||f||m.rotation;g.currentQuaternion=(new L.Quaternion).copy(y),g.free_rotate=!1;var _=g.switch_mode,E=JSON.parse(JSON.stringify(g.switch_config));l&&(g.switch_mode=l,g.switch_config=Gn[l]),"fade"===l&&(g.switch_config.in=c,g.switch_config.out=u),g.camera_zoom=s,Qn.player.switchToTargetPano[G.PANORAMA](g,(function(){p.panos.forEach((function(t){t.minimumTiledPanoLoaded=!1,t.clear()})),g.switch_mode=_,g.switch_config=E,h()}))}else n.error(e+" failure, reason: current mode is not "+G.PANORAMA+"!")();else n.error(e+" failure, reason: unget model<"+r+">")()},SWITCH_TO_MODEL_PANORAMA_VIEW_OF_FADE_FROM_DOLLHOUSE_VIEW:function(t){var e="switch to model panorama mode",r=Qn.player.mode;if(G.DOLLHOUSE===r){var i=t.model_id,o=t.pano_id,a=t.quaternion,s=t.lookat,l=t.zoom;t.progress;var c=t.complete||function(){},u=t.origin_opacity||0,h=t.fade_in_duration||300,p=Qn.modelManager.getModel(i);if(p){var d=Qn.player.model;Qn.data=p.data,_e.setCoreData(p.data);var f=_e.getCameraFov(),m=Qn.player.controls[G.DOLLHOUSE],v=Qn.player.controls[G.PANORAMA];m.disable(),v.setFov(f),Qn.waypointManager.destroy(),Qn.tileDownloader.stop(),Qn.panoRenderer.stop(),Qn.tileDownloader.clear(),Qn.panoRenderer.clear(),Qn.tileDownloader.setPanoData(p.modelid,p.panos),Qn.player.setModel(p),Qn.waypointManager.init(),Qn.waypointManager.computeWaypointBarrier(p.panos),p.panos.forEach((function(t){Qn.waypointManager.addMarker(t.marker)})),Qn.tileDownloader.start(),Qn.panoRenderer.start();var g,y=p.data.entry_point,_=o||y.location_id,E=p.panos.get(_);s&&(g=Ge(E.position,s));var T=a||g||y.rotation;E.currentQuaternion=(new L.Quaternion).copy(T),pe.renderStaticCover((function(){Qn.player.flyToPanoramaMode({pano:E,zoom:l,duration:0,onPanoLoaded:function(){},progress:function(){},complete:function(){v.disable(),Qn.player.model.hide(),Qn.player.model.skybox.setOpacity(u),d.hide(),d.skybox.hide(e),d.setMode(G.PANORAMA),d.panos.forEach((function(t){t.minimumTiledPanoLoaded=!1,t.clear()})),Qn.player.model.skybox.show(),Qn.player.model.skybox.fadeIn({origin_opacity:u,duration:h,complete:function(){Qn.screenshotImage&&(Jt().removeChild(Qn.screenshotImage),Qn.screenshotImage=null),Qn.player.model.show(),v.enable(),c()}})}})}))}else n.error(e+" failure, reason: unget model<"+i+">")()}else n.error(e+" failure, reason: current mode is not "+G.DOLLHOUSE+"!")()}},Qn=null,Kn=function(){Qn=k.getCore(),this.name="ActionEvents",this.Events=X,this.Methods=qn};Kn.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),Ht.actionStateEngine.init()},Kn.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)(),lt.action.hook[X.ACTION_MODE_TRANSITION]=function(t){Ht.actionStateEngine.state[X.MODE_CHANGED].data=G.TRANSITIONING,Ht.actionStateEngine.state[X.MODE_CHANGED].state=!0},lt.action.hook[X.SWITCH_TO_PANORAMA_MODE_COMPLETE]=function(t){Ht.actionStateEngine.state[X.MODE_CHANGED].data=G.PANORAMA,Ht.actionStateEngine.state[X.MODE_CHANGED].state=!0},lt.action.hook[X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE]=function(t){Ht.actionStateEngine.state[X.MODE_CHANGED].data=G.DOLLHOUSE,Ht.actionStateEngine.state[X.MODE_CHANGED].state=!0},lt.action.hook[X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE]=function(t){Ht.actionStateEngine.state[X.MODE_CHANGED].data=G.FLOORPLAN,Ht.actionStateEngine.state[X.MODE_CHANGED].state=!0}},Kn.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)()};var Jn={SESSION_START:function(){Ht.webxr.state[tt.SESSION_START].state=!0},SESSION_END:function(){Ht.webxr.state[tt.SESSION_END].state=!0},INTERSECT_POINT:function(t){Ht.webxr.state[tt.INTERSECT_POINT].data=t,Ht.webxr.state[tt.INTERSECT_POINT].state=!0},RIGHT_PAD_BTN_DOWN:function(t){$n["_"+t]&&$n["_"+t].down(t)},RIGHT_PAD_BTN_UP:function(t){$n["_"+t]&&$n["_"+t].up(t)},RIGHT_GAMEPAD_BTN_TOUCH_START:function(t,e){tr["_"+t]&&tr["_"+t].start(t,e)},RIGHT_GAMEPAD_BTN_TOUCH_END:function(t,e){tr["_"+t]&&tr["_"+t].end(t,e)},RIGHT_GAMEPAD_SELECT_BTN_DOWN:function(t){!0!==Ht.webxr.state[tt.RIGHT_GAMEPAD_SELECT_BTN_DOWN].state&&(rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_SELECT_BTN_DOWN),Ht.webxr.state[tt.RIGHT_GAMEPAD_SELECT_BTN_DOWN].state=!0)},RIGHT_GAMEPAD_SELECT_BTN_UP:function(t){!0===Ht.webxr.state[tt.RIGHT_GAMEPAD_SELECT_BTN_DOWN].state&&(rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_SELECT_BTN_UP),Ht.webxr.state[tt.RIGHT_GAMEPAD_SELECT_BTN_UP].state=!0,Jn.RIGHT_GAMEPAD_SELECT_BTN_CLICK(t))},RIGHT_GAMEPAD_SELECT_BTN_CLICK:function(t){rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_SELECT_BTN_CLICK),Ht.webxr.state[tt.RIGHT_GAMEPAD_SELECT_BTN_CLICK].state=!0},RIGHT_SQUEEZE_BTN_DOWN:function(){},RIGHT_SQUEEZE_BTN_UP:function(){},RIGHT_SQUEEZE_BTN_CLICK:function(){},RIGHT_GAMEPAD_A_BTN_DOWN:function(){!0!==Ht.webxr.state[tt.RIGHT_GAMEPAD_A_BTN_DOWN].state&&(rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_A_BTN_DOWN),Ht.webxr.state[tt.RIGHT_GAMEPAD_A_BTN_DOWN].state=!0)},RIGHT_GAMEPAD_A_BTN_UP:function(t){!1!==Ht.webxr.state[tt.RIGHT_GAMEPAD_A_BTN_DOWN].state&&(rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_A_BTN_UP),Ht.webxr.state[tt.RIGHT_GAMEPAD_A_BTN_UP].state=!0,Jn.RIGHT_GAMEPAD_A_BTN_CLICK(t))},RIGHT_GAMEPAD_A_BTN_CLICK:function(){rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_A_BTN_CLICK),Ht.webxr.state[tt.RIGHT_GAMEPAD_A_BTN_CLICK].state=!0},RIGHT_GAMEPAD_B_BTN_DOWN:function(){!0!==Ht.webxr.state[tt.RIGHT_GAMEPAD_B_BTN_DOWN].state&&(Ht.webxr.state[tt.RIGHT_GAMEPAD_B_BTN_DOWN].state=!0,rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_B_BTN_DOWN))},RIGHT_GAMEPAD_B_BTN_UP:function(){!1!==Ht.webxr.state[tt.RIGHT_GAMEPAD_B_BTN_DOWN].state&&(Ht.webxr.state[tt.RIGHT_GAMEPAD_B_BTN_UP].state=!0,rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_B_BTN_UP),Jn.RIGHT_GAMEPAD_B_BTN_CLICK())},RIGHT_GAMEPAD_B_BTN_CLICK:function(){Ht.webxr.state[tt.RIGHT_GAMEPAD_B_BTN_CLICK].state=!0,rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_B_BTN_CLICK)},RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START:function(t,e){var n=Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START].data,r=Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_CHANGE].data||n;r?r.axes[0]===e[0]&&r.axes[1]===e[1]&&r.axes[2]===e[2]&&r.axes[3]===e[3]||Jn.RIGHT_GAMEPAD_THUMB_BTN_AXES_TOUCH_CHANGE(e):(rr.guiLogManager.addLog("no history data!"),Jn.RIGHT_GAMEPAD_THUMB_BTN_AXES_TOUCH_CHANGE(e)),!0!==Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START].state&&(Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START].data={axes:e},Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START].state=!0)},RIGHT_GAMEPAD_THUMB_BTN_TOUCH_END:function(){!0===Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START].state&&(Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_END].state=!0)},RIGHT_GAMEPAD_THUMB_BTN_AXES_TOUCH_CHANGE:function(t){Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_CHANGE].data={axes:t},Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_CHANGE].state=!0,0===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&Jn.RIGHT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE();var e=Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE].state;-1===t[2]&&!0===e&&Jn.RIGHT_GAMEPAD_THUMB_BTN_AXES_TOUCH_LEFT_TRIGGER(),1===t[2]&&!0===e&&Jn.RIGHT_GAMEPAD_THUMB_BTN_AXES_TOUCH_RIGHT_TRIGGER()},RIGHT_GAMEPAD_THUMB_BTN_AXES_TOUCH_LEFT_TRIGGER:function(){rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER),rr.guiLogManager.addLog(">"),Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER].state=!0},RIGHT_GAMEPAD_THUMB_BTN_AXES_TOUCH_RIGHT_TRIGGER:function(){rr.guiLogManager.addLog(tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER),rr.guiLogManager.addLog(">"),Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER].state=!0},RIGHT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE:function(){Ht.webxr.state[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE].state=!0},LEFT_GAMEPAD_YTN_DOWN:function(t){er["_"+t]&&er["_"+t].down(t)},LEFT_GAMEPAD_YTN_UP:function(t){er["_"+t]&&er["_"+t].up(t)},LEFT_GAMEPAD_YTN_TOUCH_START:function(t,e){nr["_"+t]&&nr["_"+t].start(t,e)},LEFT_GAMEPAD_YTN_TOUCH_END:function(t,e){nr["_"+t]&&nr["_"+t].end(t,e)},LEFT_GAMEPAD_SELECT_BTN_DOWN:function(t){!0!==Ht.webxr.state[tt.LEFT_GAMEPAD_SELECT_BTN_DOWN].state&&(rr.guiLogManager.addLog("on.left.gamepad.select.btn.down"),Ht.webxr.state[tt.LEFT_GAMEPAD_SELECT_BTN_DOWN].state=!0)},LEFT_GAMEPAD_SELECT_BTN_UP:function(t){!0===Ht.webxr.state[tt.LEFT_GAMEPAD_SELECT_BTN_DOWN].state&&(rr.guiLogManager.addLog("on.left.gamepad.select.btn.up"),Ht.webxr.state[tt.LEFT_GAMEPAD_SELECT_BTN_UP].state=!0,Jn.LEFT_GAMEPAD_SELECT_BTN_CLICK(t))},LEFT_GAMEPAD_SELECT_BTN_CLICK:function(t){rr.guiLogManager.addLog("on.left.gamepad.select.btn.click"),Ht.webxr.state[tt.LEFT_GAMEPAD_SELECT_BTN_CLICK].state=!0},LEFT_GAMEPAD_X_BTN_DOWN:function(){!0!==Ht.webxr.state[tt.LEFT_GAMEPAD_X_BTN_DOWN].state&&(rr.guiLogManager.addLog(tt.LEFT_GAMEPAD_X_BTN_DOWN),Ht.webxr.state[tt.LEFT_GAMEPAD_X_BTN_DOWN].state=!0)},LEFT_GAMEPAD_X_BTN_UP:function(t){!1!==Ht.webxr.state[tt.LEFT_GAMEPAD_X_BTN_DOWN].state&&(rr.guiLogManager.addLog(tt.LEFT_GAMEPAD_X_BTN_UP),Ht.webxr.state[tt.LEFT_GAMEPAD_X_BTN_UP].state=!0,Jn.LEFT_GAMEPAD_X_BTN_CLICK(t))},LEFT_GAMEPAD_X_BTN_CLICK:function(){rr.guiLogManager.addLog(tt.LEFT_GAMEPAD_X_BTN_CLICK),Ht.webxr.state[tt.LEFT_GAMEPAD_X_BTN_CLICK].state=!0},LEFT_GAMEPAD_Y_BTN_DOWN:function(){!0!==Ht.webxr.state[tt.LEFT_GAMEPAD_Y_BTN_DOWN].state&&(rr.guiLogManager.addLog(tt.LEFT_GAMEPAD_Y_BTN_DOWN),Ht.webxr.state[tt.LEFT_GAMEPAD_Y_BTN_DOWN].state=!0)},LEFT_GAMEPAD_Y_BTN_UP:function(t){!1!==Ht.webxr.state[tt.LEFT_GAMEPAD_Y_BTN_DOWN].state&&(rr.guiLogManager.addLog(tt.LEFT_GAMEPAD_Y_BTN_UP),Ht.webxr.state[tt.LEFT_GAMEPAD_Y_BTN_UP].state=!0,Jn.LEFT_GAMEPAD_Y_BTN_CLICK(t))},LEFT_GAMEPAD_Y_BTN_CLICK:function(){rr.guiLogManager.addLog(tt.LEFT_GAMEPAD_Y_BTN_CLICK),Ht.webxr.state[tt.LEFT_GAMEPAD_Y_BTN_CLICK].state=!0},LEFT_GAMEPAD_THUMB_BTN_TOUCH_START:function(t,e){var n=Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_START].data,r=Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_CHANGE].data||n;r?r.axes[0]===e[0]&&r.axes[1]===e[1]&&r.axes[2]===e[2]&&r.axes[3]===e[3]||Jn.LEFT_GAMEPAD_THUMB_BTN_AXES_TOUCH_CHANGE(e):(rr.guiLogManager.addLog("no historyData!"),Jn.LEFT_GAMEPAD_THUMB_BTN_AXES_TOUCH_CHANGE(e)),!0!==Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_START].state&&(Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_START].data={axes:e},Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_START].state=!0)},LEFT_GAMEPAD_THUMB_BTN_TOUCH_END:function(){!0===Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_START].state&&(Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_TOUCH_END].state=!0)},LEFT_GAMEPAD_THUMB_BTN_AXES_TOUCH_CHANGE:function(t){Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_CHANGE].data={axes:t},Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_CHANGE].state=!0,0===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&Jn.LEFT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE();var e=Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE].state;-1===t[2]&&!0===e&&Jn.LEFT_GAMEPAD_THUMB_BTN_AXES_TOUCH_LEFT_TRIGGER(),1===t[2]&&!0===e&&Jn.LEFT_GAMEPAD_THUMB_BTN_AXES_TOUCH_RIGHT_TRIGGER()},LEFT_GAMEPAD_THUMB_BTN_AXES_TOUCH_LEFT_TRIGGER:function(){rr.guiLogManager.addLog("on.left.gamepad.thumb.btn.axes.touch.left.trigger"),rr.guiLogManager.addLog(">"),Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER].state=!0},LEFT_GAMEPAD_THUMB_BTN_AXES_TOUCH_RIGHT_TRIGGER:function(){rr.guiLogManager.addLog("on.left.gamepad.thumb.btn.axes.touch.right.trigger"),rr.guiLogManager.addLog(">"),Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER].state=!0},LEFT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE:function(){Ht.webxr.state[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RESET_POSE].state=!0}},$n={_0:{down:Jn.RIGHT_GAMEPAD_SELECT_BTN_DOWN,up:Jn.RIGHT_GAMEPAD_SELECT_BTN_UP},_4:{down:Jn.RIGHT_GAMEPAD_A_BTN_DOWN,up:Jn.RIGHT_GAMEPAD_A_BTN_UP},_5:{down:Jn.RIGHT_GAMEPAD_B_BTN_DOWN,up:Jn.RIGHT_GAMEPAD_B_BTN_UP}},tr={_3:{start:Jn.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_START,end:Jn.RIGHT_GAMEPAD_THUMB_BTN_TOUCH_END}},er={_0:{down:Jn.LEFT_GAMEPAD_SELECT_BTN_DOWN,up:Jn.LEFT_GAMEPAD_SELECT_BTN_UP},_4:{down:Jn.LEFT_GAMEPAD_X_BTN_DOWN,up:Jn.LEFT_GAMEPAD_X_BTN_UP},_5:{down:Jn.LEFT_GAMEPAD_Y_BTN_DOWN,up:Jn.LEFT_GAMEPAD_Y_BTN_UP}},nr={_3:{start:Jn.LEFT_GAMEPAD_THUMB_BTN_TOUCH_START,end:Jn.LEFT_GAMEPAD_THUMB_BTN_TOUCH_END}},rr=null,ir=[],or=function(){rr=k.getCore(),this.name="WebXREvent",this.Events=tt,this.EventsDealt=Jn,this.enterVrMode=ar,this.exitVrMode=sr,this.getGlobalScale=lr,Object.defineProperties(this,{onExitVrMode:{set:function(t){ir.push(t)},get:function(){return ir}}})};function ar(){ce((function(){rr.player.control.stopRotation(),rr.webxrManager.enterVr()}),(function(){n.error("xr not support immersive-vr session!")()}))}function sr(){rr.webxrManager.exitVr()}function lr(){return 1*rr.webxrManager.global_scale}or.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),Ht.webxr.init()},or.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)(),lt.webxr.hook[tt.SESSION_START]=function(){rr.commonExtension[z.NEED_ENTER_VR_MODE]&&rr.commonExtension[z.NEED_ENTER_VR_MODE]()},lt.webxr.hook[tt.SESSION_END]=function(){rr.commonExtension[z.NEED_EXIT_VR_MODE]&&rr.commonExtension[z.NEED_EXIT_VR_MODE](),ir.forEach((function(t){return t()}))},lt.webxr.hook[tt.INTERSECT_POINT]=function(t){rr.commonExtension[z.NEED_XR_CONTROL_INTERSECT_WITHN_MODEL]&&rr.commonExtension[z.NEED_XR_CONTROL_INTERSECT_WITHN_MODEL](t)}},or.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)()};var cr=new L.Vector3(0,0,1),ur=new L.Raycaster;ur.layers.enable(ve.COLLIDER);var hr=new Map,pr=Object.create(null),dr=Object.create(null),fr=null,mr=function(){var t;fr=k.getCore(),this.name="RaycasterEvents",this.Events=J,hr.set("onIntersectOfModel",J.INTERSECT_WITHIN_MODEL),hr.set("onUngetIntersectOfModel",J.UNINTERSECT_WITHIN_MODEL),t=this,hr.forEach((function(t,e){var n=e,r=t;pr[r]=[],dr[n]={set:function(t){mt(t,"measureManager onApi failure, reason: "+n)&&pr[r].push(t)},get:function(){return pr[r]}}})),Object.defineProperties(t,dr),Object.defineProperties(this,{GET_INTERSECT_WITHIN_POINTER:{get:function(){return vr}}})};function vr(t,e){if(!fr.player&&!fr.player.model&&!fr.player.control)return null;var n=fr.sceneRender.camera,r=fr.player.model;Be(t,e,cr),ur.setFromCamera(cr,n);var i=function(t){if(fr.player){var e=ur.intersectObjects(t),n=null;return 0<e.length&&(n=e[0]),n}}(r.getValidColliders());return i?{point:i.point,normal:i.face.normal}:null}mr.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),this.registerEvents()},mr.prototype.registerEvents=function(){Ht.raycasterStateEngine.init()},mr.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)(),lt.raycaster.hook[J.INTERSECT_WITHIN_MODEL]=function(t){fr.commonExtension[z.NEED_MOUSE_MOVE_INTERSECT_WITHIN_MODEL]&&fr.commonExtension[z.NEED_MOUSE_MOVE_INTERSECT_WITHIN_MODEL](t),pr[J.INTERSECT_WITHIN_MODEL].forEach((function(e){return e(t)}))},lt.raycaster.hook[J.UNINTERSECT_WITHIN_MODEL]=function(t){fr.commonExtension[z.NEED_POINTER_MOVE_UNGET_INTERSECT_WITHIN_MODEL]&&fr.commonExtension[z.NEED_POINTER_MOVE_UNGET_INTERSECT_WITHIN_MODEL](t),pr[J.UNINTERSECT_WITHIN_MODEL].forEach((function(e){return e(t)}))}},mr.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)()};var gr=function(){k.getCore(),this.name="animation.events",this.Events=Rt};gr.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),Ht.animationStateEngine.init()},gr.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)()},gr.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)()};var yr=document.getElementById("p-cube1"),_r=document.getElementById("p-cube2"),Er={CONTEXT_MENU:function(t){t.preventDefault()},MOUSE_OVER:function(t){Cr(t)&&Dr(nt.MOUSE_OVER,!0)},MOUSE_OUT:function(t){Cr(t)&&(br.commonExtension[z.NEED_MOUSE_OUT]&&br.commonExtension[z.NEED_MOUSE_OUT](t),Dr(nt.MOUSE_OUT,!0))},MOUSE_MOVE:function(t){var e=j.get("eventsManager");if(!0===e.handleEvents.binded&&e.handleEvents.destroy(),Cr(t)){var n={x:t.offsetX,y:t.offsetY};Dr(nt.MOUSE_MOVE,!0,n),!!Mr.timer&&clearTimeout(Mr.timer),Mr.timer=setTimeout((function(){!function(t){br.commonExtension[z.NEED_MOUSE_MOVE_STOP]&&br.commonExtension[z.NEED_MOUSE_MOVE_STOP](t),Dr(nt.MOUSE_MOVE_STOP,!0)}(t)}),16),Sr[nt.MOUSE_LEFT_BUTTON_DOWN].state&&Sr[nt.MOUSE_MOVE].state&&!Sr[nt.MOUSE_LEFT_BUTTON_UP].state&&Er.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE(t),!Sr[nt.MOUSE_DOWN].state&&Er.MOUSE_MOVE_WITHOUT_BUTTON_DOWN(t),Sr[nt.MOUSE_RIGHT_BUTTON_DOWN].state&&Er.MOUSE_RIGHT_BUTTON_DOWN_WITHIN_MOVE(t)}},MOUSE_DOWN:function(t){if(Cr(t)){var e={x:t.offsetX,y:t.offsetY};Dr(nt.MOUSE_DOWN,!0,e);var n=t.button;Tr["_"+n].down(t)}},MOUSE_UP:function(t){Dr(nt.MOUSE_UP,!0);var e=t.button;Tr["_"+e].up(t)},MOUSE_WHEEL:function(t){if(t.stopPropagation(),t.preventDefault(),Cr(t)){Dr(nt.MOUSE_WHEEL,!0);var e=null;t.wheelDeltaY?e=t.wheelDeltaY:t.wheelDelta?e=t.wheelDelta:t.detail&&(e=-t.detail),0<e&&wr(e),0>e&&Lr(e)}},MOUSE_MOVE_WITHOUT_BUTTON_DOWN:function(t){var e={x:t.offsetX,y:t.offsetY,target:t.target};br.commonExtension[z.NEED_MOUSE_MOVE_WITHOUT_BUTTON_DOWN]&&br.commonExtension[z.NEED_MOUSE_MOVE_WITHOUT_BUTTON_DOWN](e),Dr(nt.MOUSE_MOVE_WITHOUT_BUTTON_DOWN,!0,e)},MOUSE_LEFT_BUTTON_DOWN:function(t){!!yr&&(yr.style.left=t.offsetX+"px",yr.style.top=t.offsetY+"px"),xr.MOUSE_LEFT_BUTTON_DOWN.clientX=t.offsetX,xr.MOUSE_LEFT_BUTTON_DOWN.clientY=t.offsetY,!br.commonExtension[z.NEED_MOUSE_LEFT_BUTTON_DOWN]||br.commonExtension[z.NEED_MOUSE_LEFT_BUTTON_DOWN](t);var e={x:t.offsetX,y:t.offsetY};Dr(nt.MOUSE_LEFT_BUTTON_DOWN,!0,e)},MOUSE_LEFT_BUTTON_UP:function(t){!!_r&&(_r.style.left=t.offsetX+"px",_r.style.top=t.offsetY+"px"),xr.MOUSE_LEFT_BUTTON_UP.clientX=t.offsetX,xr.MOUSE_LEFT_BUTTON_UP.clientY=t.offsetY,!br.commonExtension[z.NEED_MOUSE_LEFT_BUTTON_UP]||br.commonExtension[z.NEED_MOUSE_LEFT_BUTTON_UP](t);var e={x:t.offsetX,y:t.offsetY,ts:t.timeStamp};Dr(nt.MOUSE_LEFT_BUTTON_UP,!0,e);var n=xr.MOUSE_LEFT_BUTTON_DOWN,r=xr.MOUSE_LEFT_BUTTON_UP;n.clientX===r.clientX&&n.clientY===r.clientY&&Er.MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE(t)},MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE:function(t){var e={x:t.offsetX,y:t.offsetY,ts:t.timeStamp};br.commonExtension[z.NEED_MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE]&&br.commonExtension[z.NEED_MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE](e),Dr(nt.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE,!0,e)},MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE:function(t){var e={x:t.offsetX,y:t.offsetY,target:t.target};br.commonExtension[z.NEED_MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE]&&br.commonExtension[z.NEED_MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE](t),Dr(nt.MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE,!0,e)},MOUSE_RIGHT_BUTTON_DOWN:function(t){xr.MOUSE_RIGHT_BUTTON_DOWN.sX=t.offsetX,xr.MOUSE_RIGHT_BUTTON_DOWN.sY=t.offsetY;var e={x:t.offsetX,y:t.offsetY};Dr(nt.MOUSE_RIGHT_BUTTON_DOWN,!0,e)},MOUSE_RIGHT_BUTTON_UP:function(t){xr.MOUSE_RIGHT_BUTTON_UP.sX=t.offsetX,xr.MOUSE_RIGHT_BUTTON_UP.sY=t.offsetY;var e={x:t.offsetX,y:t.offsetY};Dr(nt.MOUSE_RIGHT_BUTTON_UP,!0,e);var n=xr.MOUSE_RIGHT_BUTTON_DOWN,r=xr.MOUSE_RIGHT_BUTTON_UP;n.sX===r.sX&&n.sY===r.sY&&Er.MOUSE_RIGHT_BUTTON_DOWN_UP_WITHOUT_MOVE(t)},MOUSE_RIGHT_BUTTON_DOWN_WITHIN_MOVE:function(t){var e={x:t.offsetX,y:t.offsetY,ts:t.timeStamp};Dr(nt.MOUSE_RIGHT_BUTTON_DOWN_WITHIN_MOVE,!0,e)},MOUSE_RIGHT_BUTTON_DOWN_UP_WITHOUT_MOVE:function(t){br.commonExtension[z.NEED_MOUSE_RIGHT_BUTTON_DOWN_UP_WITHOUT_MOVE]&&br.commonExtension[z.NEED_MOUSE_RIGHT_BUTTON_DOWN_UP_WITHOUT_MOVE](t)},MOUSE_WHEEL_FORWARD:wr,MOUSE_WHEEL_BACKWARD:Lr},Tr={_0:{down:Er.MOUSE_LEFT_BUTTON_DOWN,up:Er.MOUSE_LEFT_BUTTON_UP},_1:{down:function(){},up:function(){}},_2:{down:Er.MOUSE_RIGHT_BUTTON_DOWN,up:Er.MOUSE_RIGHT_BUTTON_UP}},xr={MOUSE_LEFT_BUTTON_DOWN:{clientX:0,clientY:0},MOUSE_LEFT_BUTTON_UP:{clientX:0,clientY:0},MOUSE_RIGHT_BUTTON_DOWN:{sX:0,sY:0},MOUSE_RIGHT_BUTTON_UP:{sX:0,sY:0}},br=null,Mr=null,Ar=null,Sr=null,Or=function(){br=k.getCore(),this.name="MouseEvents",Mr=this,this.Events=nt};function wr(t){Dr(nt.MOUSE_WHEEL_FORWARD,!0,t)}function Lr(t){Dr(nt.MOUSE_WHEEL_BACKWARD,!0,t)}function Dr(t,e,n){Sr[t].data=n,Sr[t].state=e}function Cr(t){var e=t.target.id,n=t.target._type;return!("renderer-stage"!==e&&"renderer-canvas"!==e&&"tag.title"!==n)}Or.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),this.registerEvents()},Or.prototype.registerEvents=function(){Ht.mouseStateEngine.init(),Sr=Ht.mouseStateEngine.state},Or.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)(),(Ar=Jt()).addEventListener("mouseover",Er.MOUSE_OVER),Ar.addEventListener("mouseout",Er.MOUSE_OUT),Ar.addEventListener("mousemove",Er.MOUSE_MOVE),Ar.addEventListener("mousedown",Er.MOUSE_DOWN),Ar.addEventListener("mouseup",Er.MOUSE_UP),Ar.addEventListener("mousewheel",Er.MOUSE_WHEEL),Ar.addEventListener("DOMMouseScroll",Er.MOUSE_WHEEL),Ar.addEventListener("contextmenu",Er.CONTEXT_MENU),this.binded=!0,this.destroyed=!1},Or.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)(),Ar.removeEventListener("mousemove",Er.MOUSE_MOVE),Ar.removeEventListener("mousedown",Er.MOUSE_DOWN),Ar.removeEventListener("mouseup",Er.MOUSE_UP),Ar.removeEventListener("mouseover",Er.MOUSE_OVER),Ar.removeEventListener("mouseout",Er.MOUSE_OUT),Ar.removeEventListener("mousewheel",Er.MOUSE_WHEEL),Ar.removeEventListener("DOMMouseScroll",Er.MOUSE_WHEEL),Ar.removeEventListener("contextmenu",Er.CONTEXT_MENU),this.binded=!1,this.destroyed=!0};var Pr=document.getElementById("handle-event"),Nr=document.getElementById("handle-event2"),Rr={HANDLE_TOUCH_START:function(t){var e=j.get("eventsManager");if(!0===e.mouseEvents.binded&&e.mouseEvents.destroy(),Gr(t)){var n=t.touches,r=t.targetTouches,i=t.changedTouches,o=n.length,a=r.length,s=i.length;!!Pr&&(Pr.value+="- touch start -\r\n"),!!Pr&&(Pr.value+="touches count: "+o+"\r\n"),!!Pr&&(Pr.value+="target touches count: "+a+"\r\n"),!!Pr&&(Pr.value+="changed touches count: "+s+"\r\n"),!!Pr&&(Pr.value+="------\r\n"),zr(at.HANDLE_TOUCH_START,!0,null),1===o&&(Ir.HANDEL_SINGLE_CLICK.start.x=n[0].clientX,Ir.HANDEL_SINGLE_CLICK.start.y=n[0].clientY,Ir.HANDLE_SINGLE_TOUCH_MOVE.start.x=n[0].clientX,Ir.HANDLE_SINGLE_TOUCH_MOVE.start.y=n[0].clientY,Rr.HANDLE_SINGLE_TOUCH_START(t)),2===o&&(Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.identifier=n[0].identifier,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.x=n[0].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.y=n[0].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.s_x=n[0].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.s_y=n[0].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.identifier=n[1].identifier,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.x=n[1].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.y=n[1].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.s_x=n[1].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.s_y=n[1].clientY,Wr(),Rr.HANDLE_DOUBLE_TOUCH_START()),2<o&&Rr.HANDLE_MANY_TOUCH_START(t)}},HANDLE_TOUCH_END:function(t){if(Gr(t)){Hr=1;var e=t.touches,n=t.changedTouches,r=e.length;n.length,Ir.HANDEL_SINGLE_CLICK.end.x=n[0].clientX,Ir.HANDEL_SINGLE_CLICK.end.y=n[0].clientY;var i=ee();if(0===r){var o=Ir.HANDEL_SINGLE_CLICK.end.x-i.offset_left,a=Ir.HANDEL_SINGLE_CLICK.end.y-i.offset_top;Rr.HANDLE_SINGLE_TOUCH_END({x:o,y:a,timeStamp:t.timeStamp}),Ir.HANDLE_SINGLE_TOUCH_MOVE.start.x=null,Ir.HANDLE_SINGLE_TOUCH_MOVE.start.y=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.identifier=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.x=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.y=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.s_x=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.s_y=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.identifier=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.x=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.y=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.s_x=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.s_y=null,Wr()}if(1===r){Ir.HANDLE_SINGLE_TOUCH_MOVE.start.x=e[0].clientX,Ir.HANDLE_SINGLE_TOUCH_MOVE.start.y=e[0].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.identifier=e[0].identifier,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.x=e[0].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.y=e[0].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.s_x=e[0].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.s_y=e[0].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.identifier=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.x=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.y=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.s_x=null,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.s_y=null;var s=e[0].clientX-i.offset_left,l=e[0].clientY-i.offset_top;Rr.HANDLE_SINGLE_TOUCH_CHANGED({x:s,y:l})}2===r&&(Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.identifier=e[0].identifier,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.x=e[0].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.y=e[0].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.s_x=e[0].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.s_y=e[0].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.identifier=e[0].identifier,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.x=e[1].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.y=e[1].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.s_x=e[1].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.s_y=e[1].clientY);var c=Math.abs(Ir.HANDEL_SINGLE_CLICK.start.x-Ir.HANDEL_SINGLE_CLICK.end.x),u=Math.abs(Ir.HANDEL_SINGLE_CLICK.start.y-Ir.HANDEL_SINGLE_CLICK.end.y);if(0===r&&(0===c||c<2)&&(0===u||u<2)){var h=ee(),p=Ir.HANDEL_SINGLE_CLICK.end.x-h.offset_left,d=Ir.HANDEL_SINGLE_CLICK.end.y-h.offset_top;Rr.HANDLE_SINGLE_TOUCH_CLICK({x:p,y:d},t)}zr(at.HANDLE_TOUCH_END,!0)}},HANDLE_TOUCH_MOVE:function(t){if(Gr(t)){var e=t.timeStamp,n=t.touches,r=t.targetTouches,i=t.changedTouches,o=n.length,a=r.length,s=i.length,l=ee();Ir.HANDLE_MOVE.touches=[];for(var c=0;c<o;++c)Ir.HANDLE_MOVE.touches[c]={x:n[c].clientX,y:n[c].clientY};if(!!Pr&&(Pr.value=""),!!Pr&&(Pr.value+="touch move\r\n"),!!Pr&&(Pr.value+="touches count:"+o+"\r\n"),!!Pr&&(Pr.value+="target touches count:"+a+"\r\n"),!!Pr&&(Pr.value+="changed touches count:"+s+"\r\n"),!!Pr&&(Pr.value+="------\r\n"),Ir.HANDLE_SINGLE_TOUCH_MOVE.touches_count===o&&null!==Ir.HANDLE_SINGLE_TOUCH_MOVE.start.x&&null!==Ir.HANDLE_SINGLE_TOUCH_MOVE.start.y){var u=Ir.HANDLE_SINGLE_TOUCH_MOVE.start;if(u.x!==n[0].clientX||u.y!==n[0].clientY){var h=n[0].clientX-l.offset_left,p=n[0].clientY-l.offset_top;Rr.HANDLE_SINGLE_TOUCH_MOVE({x:h,y:p,ts:e}),Ir.HANDLE_SINGLE_TOUCH_MOVE.start.x=n[0].clientX,Ir.HANDLE_SINGLE_TOUCH_MOVE.start.y=n[0].clientY}}if(Ir.HANDLE_DOUBLE_TOUCH_MOVE.touches_count===o){var d=Ir.HANDLE_DOUBLE_TOUCH_MOVE._0,f=Ir.HANDLE_DOUBLE_TOUCH_MOVE._1;if(null!==d.identifier&&null!==f.identifier&&(d.x!==n[0].clientX||d.y!==n[0].clientY||f.x!==n[1].clientX||f.y!==n[1].clientY)){var m=new L.Vector2(n[0].clientX,n[0].clientY).distanceTo(new L.Vector2(n[1].clientX,n[1].clientY)),v=new L.Vector2(d.s_x,d.s_y).distanceTo(new L.Vector2(f.s_x,f.s_y)),g=m/v;Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.identifier=n[0].identifier,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.x=n[0].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._0.y=n[0].clientY,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.identifier=n[1].identifier,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.x=n[1].clientX,Ir.HANDLE_DOUBLE_TOUCH_MOVE._1.y=n[1].clientY,Rr.HANDLE_DOUBLE_TOUCH_MOVE(g)}}2<o&&Rr.HANDLE_MANY_TOUCH_MOVE(t),zr(at.HANDLE_TOUCH_MOVE,!0)}},HANDLE_TOUCH_CANCEL:function(t){zr[(at.HANDLE_TOUCH_CANCEL,null)]},HANDLE_SINGLE_TOUCH_START:function(t){var e=ee(),n=Ir.HANDEL_SINGLE_CLICK.start.x-e.offset_left,r=Ir.HANDEL_SINGLE_CLICK.start.y-e.offset_top,i={x:n,y:r};!!Ur.commonExtension[z.NEED_HANDLE_SINGLE_TOUCH_START]&&Ur.commonExtension[z.NEED_HANDLE_SINGLE_TOUCH_START](t),zr(at.HANDLE_SINGLE_TOUCH_START,!0,i),Fr=setTimeout((function(){clearTimeout(Fr),Fr=null,Rr.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS(i)}),500)},HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS:function(t){!!Nr&&(Nr.value="handle 1 touch start of long press:"+Date.now()+"\r\n"),!!Nr&&(Nr.value+="------\r\n"),!window.navigator.vibrate||window.navigator.vibrate(100),zr(at.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS,!0,t)},HANDLE_SINGLE_TOUCH_END:function(t){!!Ur.commonExtension[z.NEED_HANDLE_SINGLE_TOUCH_END]&&Ur.commonExtension[z.NEED_HANDLE_SINGLE_TOUCH_END](t),zr(at.HANDLE_SINGLE_TOUCH_END,!0,t)},HANDLE_SINGLE_TOUCH_MOVE:function(t){Fr&&(clearTimeout(Fr),Fr=null),!0!==Br[at.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS].state?(!!Nr&&(Nr.value="handle 1 touch move:"+Date.now()+"\r\n"),zr(at.HANDLE_SINGLE_TOUCH_MOVE,!0,t)):Rr.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS(t)},HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS:function(t){!!Nr&&(Nr.value="handle 1 touch move of long press:"+Date.now()+"\r\n"),zr(at.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS,!0,t)},HANDLE_SINGLE_TOUCH_CLICK:function(t,e){!!Nr&&(Nr.value="on handle single touch click:"+Date.now()),!Ur.commonExtension[z.NEED_HANDLE_CLICK]||Ur.commonExtension[z.NEED_HANDLE_CLICK](e),zr(at.HANDLE_SINGLE_TOUCH_CLICK,!0,t)},HANDLE_SINGLE_TOUCH_CHANGED:function(t){!!Nr&&(Nr.value="on handle single touch changed:"+Date.now()),zr(at.HANDLE_SINGLE_TOUCH_START_CHANGED,!0,t)},HANDLE_DOUBLE_TOUCH_START:function(){zr(at.HANDLE_DOUBLE_TOUCH_START,!0,null)},HANDLE_DOUBLE_TOUCH_MOVE:function(t){zr(at.HANDLE_DOUBLE_TOUCH_MOVE,!0,t),t>1&&Rr.HANDLE_DOUBLE_TOUCH_ZOOM_IN(t,Hr),t<1&&Rr.HANDLE_DOUBLE_TOUCH_ZOOM_OUT(t,Hr),Hr=t},HANDLE_DOUBLE_TOUCH_ZOOM_IN:function(t,e){var n={new_scale:t,prev_scale:e};zr(at.HANDLE_DOUBLE_TOUCH_ZOOM_IN,!0,n)},HANDLE_DOUBLE_TOUCH_ZOOM_OUT:function(t,e){var n={new_scale:t,prev_scale:e};zr(at.HANDLE_DOUBLE_TOUCH_ZOOM_OUT,!0,n)},HANDLE_MANY_TOUCH_START:function(t){for(var e=t.touches,n=e.length,r=ee(),i=0,o=0,a=0;a<n;++a){var s=e[a].clientX-r.offset_left,l=e[a].clientY-r.offset_top;i+=s,o+=l}var c={x:i/n,y:o/n};zr(at.HANDLE_MANY_TOUCH_START,!0,c)},HANDLE_MANY_TOUCH_MOVE:function(t){for(var e=t.touches,n=e.length,r=ee(),i=0,o=0,a=0;a<n;++a){var s=e[a].clientX-r.offset_left,l=e[a].clientY-r.offset_top;i+=s,o+=l}var c={x:i/n,y:o/n};zr(at.HANDLE_MANY_TOUCH_MOVE,!0,c)}},Ir={HANDEL_SINGLE_CLICK:{touches_count:1,start:{x:null,y:null},end:{x:null,y:null}},HANDLE_SINGLE_TOUCH_MOVE:{touches_count:1,start:{identifier:null,x:null,y:null}},HANDLE_DOUBLE_TOUCH_MOVE:{touches_count:2,_0:{identifier:null,x:null,y:null,s_x:null,s_y:null},_1:{identifier:null,x:null,y:null,s_x:null,s_y:null}},HANDLE_MOVE:{touches:[]}},Ur=null,Br=null,Fr=null,Hr=1,kr=function(){Ur=k.getCore(),this.name="HandleEvents",this.Events=at};function zr(t,e,n){Br[t].data=n,Br[t].state=e}function Gr(t){var e=t.target.id,n=t.target._type;return"renderer-canvas"===e||"renderer-stage"===e||"tag.title"===n}function Wr(){Fr&&(clearTimeout(Fr),Fr=null)}kr.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),this.register()},kr.prototype.register=function(){Ht.handleStateEngine.init(),Br=Ht.handleStateEngine.getState()},kr.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)();var e=Jt();e.addEventListener("touchstart",Rr.HANDLE_TOUCH_START),e.addEventListener("touchend",Rr.HANDLE_TOUCH_END),e.addEventListener("touchmove",Rr.HANDLE_TOUCH_MOVE),e.addEventListener("touchcancel",Rr.HANDLE_TOUCH_CANCEL),this.binded=!0,this.destroyed=!1},kr.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)();var e=Jt();e.removeEventListener("touchstart",Rr.HANDLE_TOUCH_START),e.removeEventListener("touchend",Rr.HANDLE_TOUCH_END),e.removeEventListener("touchmove",Rr.HANDLE_TOUCH_MOVE),e.removeEventListener("touchcancel",Rr.HANDLE_TOUCH_CANCEL),this.binded=!1,this.destroyed=!0};var Vr=65,jr=68,Yr=83,Xr=87,Zr=37,qr=38,Qr=39,Kr=40,Jr=function(t){if(!1!==ii(t)){var e=t.keyCode;void 0!==e&&"number"==typeof e?ri(e,"DOWN"):n.warn("KeyCode<"+e+"> invalid")()}},$r=function(t){if(!1!==ii(t)){var e=t.keyCode;void 0!==e&&"number"==typeof e?ri(e,"UP"):n.warn("KeyCode<"+e+"> invalid")()}},ti=null,ei=function(){k.getCore(),this.name="KeyboardEvents",this.Events=it};function ni(t,e){ti[t].state=e}function ri(t,e){switch(t){case Zr:ni(it["KEY_LEFT_ARROW_"+e],!0);break;case Qr:ni(it["KEY_RIGHT_ARROW_"+e],!0);break;case qr:ni(it["KEY_UP_ARROW_"+e],!0);break;case Kr:ni(it["KEY_DOWN_ARROW_"+e],!0);break;case Xr:ni(it["KEY_W_"+e],!0);break;case Vr:ni(it["KEY_A_"+e],!0);break;case Yr:ni(it["KEY_S_"+e],!0);break;case jr:ni(it["KEY_D_"+e],!0)}}function ii(t){var e=t.target.tagName;return"INPUT"!==e&&"TEXTAREA"!==e}ei.prototype.init=function(){var t=this.name+" init";n.info(""+t)(),this.registerEvents()},ei.prototype.registerEvents=function(){Ht.keyboardStateEngine.init(),ti=Ht.keyboardStateEngine.getState()},ei.prototype.bind=function(){var t=this.name+" bind";n.info(""+t)(),document.addEventListener("keydown",Jr),document.addEventListener("keyup",$r)},ei.prototype.destroy=function(){var t=this.name+" destroy";n.warn(""+t)(),document.removeEventListener("keydown",Jr),document.removeEventListener("keyup",$r)};var oi,ai,si,li=Object.create(null);j.set("eventsManager",li),li.init=function(){n.info("--- EventsManager init ---")(),li.coreEvents=new Dn,li.renderEvents=new Pn,li.modelEvents=new Fn,li.actionEvents=new Kn,li.webxrEvents=new or,li.raycasterEvents=new mr,li.animationEvents=new gr,li.mouseEvents=new Or,li.handleEvents=new kr,li.keyboardEvents=new ei,li.coreEvents.init(),li.renderEvents.init(),li.modelEvents.init(),li.actionEvents.init(),li.webxrEvents.init(),li.raycasterEvents.init(),li.animationEvents.init(),li.mouseEvents.init(),li.handleEvents.init(),li.keyboardEvents.init()},li.bind=function(){n.info("%c--- EventsManager bind ---","color:#0f0;")(),li.coreEvents.bind(),li.renderEvents.bind(),li.modelEvents.bind(),li.actionEvents.bind(),li.webxrEvents.bind(),li.raycasterEvents.bind(),li.animationEvents.bind(),li.mouseEvents.bind(),li.handleEvents.bind(),li.keyboardEvents.bind()},li.destroy=function(t){n.error("--- EventsManager destroy ---")(),li.coreEvents.destroy(),li.renderEvents.destroy(),li.modelEvents.destroy(),li.actionEvents.destroy(),li.webxrEvents.destroy(),li.raycasterEvents.destroy(),li.animationEvents.destroy(),li.mouseEvents.destroy(),li.handleEvents.destroy(),li.keyboardEvents.destroy()};var ci={ENTRY_PANO_LOADED:"entry.pano.loaded",MODEL_NEST_LOADED:"model.nest.loaded",PARSE_MODEL_COMPLETE:"parse.model.complete",BUILD_CHUNK_COMPLETE:"build.chunk.complete",CHUNK_TEXTURE_LOADED:"chunk.texture.loaded"},ui={panorama:(oi={},oi[ci.ENTRY_PANO_LOADED]=10,oi[ci.MODEL_NEST_LOADED]=30,oi[ci.PARSE_MODEL_COMPLETE]=10,oi[ci.BUILD_CHUNK_COMPLETE]=10,oi[ci.CHUNK_TEXTURE_LOADED]=40,oi),dollhouse:(ai={},ai[ci.MODEL_NEST_LOADED]=30,ai[ci.PARSE_MODEL_COMPLETE]=10,ai[ci.BUILD_CHUNK_COMPLETE]=10,ai[ci.CHUNK_TEXTURE_LOADED]=50,ai),floorplan:(si={},si[ci.MODEL_NEST_LOADED]=30,si[ci.PARSE_MODEL_COMPLETE]=10,si[ci.BUILD_CHUNK_COMPLETE]=10,si[ci.CHUNK_TEXTURE_LOADED]=50,si)},hi=ci,pi={linearTween:function(t,e,n,r){return n*t/r+e},easeInCubic:function(t,e,n,r){return n*(t/=r)*t*t+e},easeOutCubic:function(t,e,n,r){return t/=r,t--,n*(t*t*t+1)+e},easeInOutSine:function(t,e,n,r){return-n/2*(Math.cos(Math.PI*t/r)-1)+e},easeInOutQuad:function(t,e,n,r){return void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=1),(t/=r/2)<1?n/2*t*t+e:(t--,-n/2*(t*(t-2)-1)+e)},easeInQuad:function(t,e,n,r){return n*(t/=r)*t+e},easeOutQuad:function(t,e,n,r){return-n*(t/=r)*(t-2)+e},easeInOutCubic:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,n,r){return n*(t/=r)*t*t*t+e},easeOutQuart:function(t,e,n,r){return t/=r,-n*(--t*t*t*t-1)+e},easeInOutQuart:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,n,r){return n*(t/=r)*t*t*t*t+e},easeOutQuint:function(t,e,n,r){return t/=r,n*(--t*t*t*t*t+1)+e},easeInOutQuint:function(t,e,n,r){return(t/=r/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,n,r){return-n*Math.cos(t/r*(Math.PI/2))+n+e},easeOutSine:function(t,e,n,r){return n*Math.sin(t/r*(Math.PI/2))+e},easeInExpo:function(t,e,n,r){return n*Math.pow(2,10*(t/r-1))+e},easeOutExpo:function(t,e,n,r){return n*(1-Math.pow(2,-10*t/r))+e},easeInOutExpo:function(t,e,n,r){return(t/=r/2)<1?n/2*Math.pow(2,10*(t-1))+e:(t--,n/2*(2-Math.pow(2,-10*t))+e)},easeInCirc:function(t,e,n,r){return t/=r,-n*(Math.sqrt(1-t*t)-1)+e},easeOutCirc:function(t,e,n,r){return t/=r,t--,n*Math.sqrt(1-t*t)+e},easeInOutCirc:function(t,e,n,r){return(t/=r/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,n/2*(Math.sqrt(1-t*t)+1)+e)},easeInElastic:function(t,e,n,r){var i=1.70158,o=0,a=n;return 0===t?e:1==(t/=r)?e+n:(o||(o=.3*r),a<Math.abs(n)?(a=n,i=o/4):i=o/(2*Math.PI)*Math.asin(n/a),-a*Math.pow(2,10*(t-=1))*Math.sin((t*r-i)*(2*Math.PI)/o)+e)},easeOutElastic:function(t,e,n,r){var i=1.70158,o=0,a=n;return 0===t?e:1==(t/=r)?e+n:(o||(o=.3*r),a<Math.abs(n)?(a=n,i=o/4):i=o/(2*Math.PI)*Math.asin(n/a),a*Math.pow(2,-10*t)*Math.sin((t*r-i)*(2*Math.PI)/o)+n+e)},easeInOutElastic:function(t,e,n,r){var i=1.70158,o=0,a=n;return 0===t?e:2==(t/=r/2)?e+n:(o||(o=r*(.3*1.5)),a<Math.abs(n)?(a=n,i=o/4):i=o/(2*Math.PI)*Math.asin(n/a),t<1?a*Math.pow(2,10*(t-=1))*Math.sin((t*r-i)*(2*Math.PI)/o)*-.5+e:a*Math.pow(2,-10*(t-=1))*Math.sin((t*r-i)*(2*Math.PI)/o)*.5+n+e)},easeInBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),n*(t/=r)*t*((i+1)*t-i)+e},easeOutBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),n*((t=t/r-1)*t*((i+1)*t+i)+1)+e},easeInOutBack:function(t,e,n,r,i){return void 0===i&&(i=1.70158),(t/=r/2)<1?n/2*(t*t*((1+(i*=1.525))*t-i))+e:n/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},easeOutBounce:function(t,e,n,r){return(t/=r)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInBounce:function(t,e,n,r){return n-pi.easeOutBounce(r-t,0,n,r)+e},easeInOutBounce:function(t,e,n,r){return t<r/2?.5*pi.easeInBounce(2*t,0,n,r)+e:.5*pi.easeOutBounce(void 0,2*t-r,0,n,r)+.5*n+e}},di={flydown:{movementEasing:"easeInOutQuad",movementDelay:.001,rotationEasing:"easeInOutQuad",rotationDelay:.5,modelTextureDelay:.75,skyboxDelay:.75},transition:{flySpeed:.01,flyTime:1150,flytimeMaxDistanceThreshold:5,flytimeDistanceMultiplier:150,aimTime:1150,aimSlowFactor:1.5,blur:.2,movementEasing:"easeInOutQuad",blendEasing:"easeInOutQuad",fastForwardFactor:1},navigation:{panoScores:!1,mouseDirection:!0,filterStrictness:.75,angleFactor:-30,directionFactor:10,distanceFactor:-1,optionalityFactor:3},panoramaNeighbourMaxDistance:5},fi=di=Tt(di,ye,{panorama:{transitionTime:1e3,modelAlpha:0,modelAlphaDelay:di.flydown.modelTextureDelay,modelAlphaLength:1,skyboxOpacity:1,skyboxOpacityDelay:di.flydown.skyboxDelay,skyboxOpacityLength:.9,fovLength:1,fovDelay:0,cameraMatrixDuration:.8,cameraMatrixDelay:0,cameraMatrixEase:pi.easeInCubic,reticuleOpacity:1,markerOpacity:.6,markerOpacityOnHover:1},dollhouse:{transitionTime:1e3,modelAlpha:1,modelAlphaDelay:0,modelAlphaLength:1-di.flydown.modelTextureDelay,skyboxOpacity:0,skyboxOpacityDelay:0,skyboxOpacityLength:1-di.flydown.skyboxDelay,fovLength:1,fovDelay:0,cameraMatrixDuration:.8,cameraMatrixDelay:.3,cameraMatrixEase:pi.easeInCubic,reticuleOpacity:1,markerOpacity:0,markerOpacityOnHover:0},floorplan:{transitionTime:1e3,modelAlpha:1,modelAlphaDelay:0,modelAlphaLength:1-di.flydown.modelTextureDelay,skyboxOpacity:0,skyboxOpacityDelay:0,skyboxOpacityLength:1-di.flydown.skyboxDelay,fovLength:1,fovDelay:0,cameraMatrixDuration:.5,cameraMatrixDelay:0,cameraMatrixEase:pi.easeOutCubic,reticuleOpacity:1,markerOpacity:0,markerOpacityOnHover:0},transitioning:{reticuleOpacity:0},"floorplan-dollhouse":{rotationDelay:0,rotationDuration:1},"floorplan-panorama":{rotationDelay:.5,rotationDuration:1},"dollhouse-panorama":{rotationDelay:.5,rotationDuration:1},"dollhouse-floorplan":{rotationDelay:0,rotationDuration:1,cameraMatrixDuration:1.05,cameraMatrixDelay:.5},"panorama-dollhouse":{rotationDelay:0,rotationDuration:.5},"panorama-floorplan":{transitionTime:1500,rotationDelay:0,rotationDuration:.5}}),mi=1,vi=1,gi=2,yi=3,_i=4,Ei=new At,Ti=[],xi=Object.create(null),bi=null,Mi=null,Ai=!1,Si=Object.create(null);function Oi(){!1!==Ai&&Ei.pipe(100,(function(){bi.player.currentPano&&function(t){Ri(),Pi(t),Ii()}(bi.player.currentPano.id)}))}function wi(t){return xi[t].isLoaded}function Li(t){return xi[t].isLoading}function Di(t,e){xi[t].isLoading=!0;var r=function(t){return xi[t].tilesUrl}(t),i=_e.getRenderSet(),o=_e.getModelId();we(r,(function(a){var s=r[0].split(/(\/)/g);if(s[s.length-11]===o)return xi[t].isLoading=!1,xi[t].texture=a,"512"===i||"1024"===i||"2048"===i?(xi[t].isLoaded=!0,void e(a)):void 0;n.warn("model is changed")()}))}function Ci(t){return bi.player.model.getSweepPointBottomPosition(t)}function Pi(t){for(var e=xi[t].neighbour,n=0,r=e.length;n<r;++n){var i=e[n];if(!1===wi(i)&&!1===Li(i)){var o=Ci(i);!We(o,bi.player.control.camera)&&Ni(i)}}}function Ni(t){Ti[Ti.length]=t}function Ri(){Ti.length=0}function Ii(){if(0!==Ti.length&&!Mi){var t=Ti[0];Mi=t,Di(t,(function(e,n){Ti.splice(0,1),Mi=null,xi[t].loadedComplete&&xi[t].loadedComplete(e,n),Ii()}))}}Object.defineProperties(Si,{loadedMap:{get:function(){return xi}},downloadQueue:{get:function(){return Ti}}}),Si.init=function(t){bi=k.getCore(),lt.action.addEventListener(li.actionEvents.Events.PANORAMA_CAMERA_ROTATE,Oi);var e=_e.getRenderSet();t.forEach((function(t){var n=t.pano_id,r=t.pano_neighbour,i=t["_"+e],o=t._512,a=t._1024;xi[n]=Object.create(null),xi[n].neighbour=r,xi[n].tilesUrl=i,xi[n].tileUrls_512=o,xi[n].tileUrls_1024=a,xi[n].texture=null,xi[n].isLoading=!1,xi[n].isLoaded=!1}))},Si.start=function(t){Ai=!0,Ri(),Pi(t),Ii()},Si.stop=function(){lt.action.removeEventListener(li.actionEvents.Events.PANORAMA_CAMERA_ROTATE,Oi),Ai=!1,xi=Object.create(null)},Si.load=function(t,e){if(xi[t].loadedComplete=e,!0===wi(t)){var n=function(t){return xi[t].texture}(t),r=function(t){return xi[t].texture_512}(t);xi[t].loadedComplete(n,r)}else!1===xi[t].isLoading&&Di(t,(function(e,n){xi[t].loadedComplete(e,n)}))};var Ui={pano_click_radius:.5,opacity_default:.5,opacity_hover:1,color:16777215},Bi=xt(Ui),Fi=new L.PlaneBufferGeometry(.2,.2),Hi=function(t){function e(e){t.call(this),this.name="waypoint-"+e.id,this.modelId=e.model_id,this.floor=e.floor,this.locationId=e.id,this.isHoverIn=!1,this.isClearCache=!1,this.layers.set(ve.MARKER),this.setUserData("id",e.id),this.setUserData("floor",e.floor),this.setUserData("pic",e.pic),this.setUserData("scale",e.scale),this.setUserData("visible",e.visible),this.init()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this.name+" init";this.setScale(0),!1===this.userData.visible&&this.hide(t),Ce.PANORAMA.marker&&this.initConfig(Ce.PANORAMA.marker);var e=k.getModel().panos.get(this.userData.id),n=Kt("mc");this.geometry=Fi,this.material=new L.MeshBasicMaterial({transparent:!0,side:L.FrontSide,color:this.config.color,opacity:this.config.opacity_default}),this.alignedPano(e),n&&this.tempSetColor(1*n),this.setUserData("current_scale",this.userData.scale)},e.prototype.initConfig=function(t){for(var e in t)Bi.hasOwnProperty(e)&&(Bi[e]=t[e]);this.config=Bi},e.prototype.restoreConfig=function(){this.init(xt(Ui))},e.prototype.reset=function(){k.getModel().panos.get(this.userData.id);var t=this.getUserData("default_texture");this.setMap(t,void 0,"reset")},e.prototype.setTexture=function(t,e,n,r){var i=this;void 0===e&&(e=!1),void 0===n&&(n=function(){}),void 0===r&&(r=function(){}),Oe(t,(function(t){i.setMap(t,e,"set.texture"),i.onLoaded&&i.onLoaded(),n()}),(function(){r()}))},e.prototype.setTexture2=function(t,e){void 0===e&&(e=!1),this.setMap(t,e,"set.texture2")},e.prototype.setColor=function(t){this.material.color.setHex(t)},e.prototype.tempSetColor=function(t){this.material.color.setHex(t)},e.prototype.setMap=function(t,e,n){this.material.map&&(this.material.map.dispose(),this.material.dispose(),this.material.map=null),this.material.map=t,this.material.needsUpdate=!0,e&&this.setUserData("default_texture",t)},e.prototype.setPosition=function(t){this.position.copy(t)},e.prototype.setPositionScalar=function(t){this.position.multiplyScalar(t)},e.prototype.computePointWithinTheRadius=function(t){var e=this.position.distanceTo(t),n=Bi.pano_click_radius;return e<(n*=this.scale.x)?(this.hoverIn(),!0):(this.hoverOut(),!1)},e.prototype.hoverIn=function(){!0!==this.isHoverIn&&(this.isHoverIn=!0,Ht.modelStateEngine.state[li.modelEvents.Events.WAYPOINT_HOVER_IN].data=this.locationId,Ht.modelStateEngine.state[li.modelEvents.Events.WAYPOINT_HOVER_IN].state=!0)},e.prototype.hoverOut=function(){!1!==this.isHoverIn&&(this.isHoverIn=!1,Ht.modelStateEngine.state[li.modelEvents.Events.WAYPOINT_HOVER_OUT].data=this.locationId,Ht.modelStateEngine.state[li.modelEvents.Events.WAYPOINT_HOVER_OUT].state=!0)},e.prototype.setScalar=function(t,e){this.scale.multiplyScalar(t)},e.prototype.setScale=function(t,e){this.scale.set(t,t,t),this.setUserData("current_scale",t)},e.prototype.setUserData=function(t,e){this.userData[t]=e},e.prototype.getUserData=function(t){return this.userData[t]||null},e.prototype.getPosition=function(){return this.position.clone()},e.prototype.getOpacity=function(){return this.material.opacity},e.prototype.setOpacity=function(t,e){this.material.opacity=t},e.prototype.alignedPano=function(t){var e=t.sweepData.spot,n=Ie.UP;this.lookAt(n.clone()),this.position.copy(e.clone()),this.position.y+=.05},e.prototype.computeSkyboxWithinTheAlignedUp=function(){var t=this.userData.id,e=k.getModel().panos.get(t),r=(new L.Vector3).subVectors(e.position,this.position).normalize();n.debug("location_id:",t,"\r\nalignedUp:",r)()},e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e.prototype.hasTexture=function(){return!!this.material.map},e.prototype.clearCache=function(t){var e=this.modelId+" "+this.name+" clear cache";this.isClearCache?n.error(e+" failure, already clean!, cmd:"+t)():(this.isClearCache=!0,this.geometry.dispose(),this.material.dispose(),this.material.map&&this.material.map.dispose())},e.prototype.clear=function(){},e.prototype.destroy=function(t){var e=this.modelId+" "+this.name+" destroy";this.clearCache(e+", cmd:"+t),this.clear(),F.setItem(""+e,!0)()},e}(L.Mesh),ki=null,zi=Object.create(null),Gi=Object.create(null),Wi=new L.Raycaster,Vi=function(t,e){ki=k.getCore(),this.name="panorama."+t.locationid,this.modelId=e,this.id=t.locationid,this.sweepData=t,this.enable=t.enable,this.visible=t.visible,this.alignmentType=t.alignmentType,this.neighbourUUIDs=t.neighbours||[],this.neighboursVisible=t.neighbours_visible||[],this.neighbourPanos=[],this.floorIndex=t.floor,this.position=(new L.Vector3).copy(t.position),this.quaternion=(new L.Quaternion).copy(t.quaternion),this.currentQuaternion=new L.Quaternion,this.poseMatrix=new L.Matrix4,this.marker=null,this.floorPosition=t.spot?t.spot.clone():null,this.skybox=null,this.tiledPanoRenderTarget=null,this.minimumTiledPanoLoaded=!1,this.shouldRedrawOnBaseLoaded=!1,this.lookat_target=null,this.free_rotate=!1,this.switch_mode="default",this.switch_config=Gn[this.switch_mode],this.zoomed=!1,this.init(),Object.defineProperties(this,{cubeTextureMap:{get:function(){return zi}}})};function ji(t){var e=k.getCore(),n={pano:null,candidates:[]},r=e.player.model.panos;return r?(r.findRankedByScore(0,[Vi.filters.isPanoAligned(),Vi.filters.inPanoDirection(e.player.position,t),Vi.filters.isNeighbourPanoTo(e.player.currentPano),Vi.filters.not(e.player.currentPano)],[Vi.scoreFunctions.distanceSquared(e.player.currentPano),Vi.scoreFunctions.direction(e.player.position,t)],n),n.pano&&(n.pano.currentQuaternion=e.player.quaternion),n.pano):null}Vi.prototype.init=function(){this.tileRendered=function(){},this.tileRenderFailed=function(){},this.panoRendered=function(){},this.poseMatrix.compose((new L.Vector3).copy(this.position),(new L.Quaternion).copy(this.quaternion),new L.Vector3(1,1,1)),this.skybox=new L.CubeTexture,this.skybox.name=this.name+".cube.texture",this.skybox.type=L.UnsignedByteType,this.skybox.format=L.RGBFormat,this.skybox.minFilter=L.LinearFilter,this.skybox.magFilter=L.LinearFilter,this.lowerSkybox=new L.CubeTexture,this.lowerSkybox.name=this.name+".lower.cube.texture",this.lowerSkybox.flipY=!1,this.lowerSkybox.type=L.UnsignedByteType,this.lowerSkybox.format=L.RGBFormat,this.lowerSkybox.magFilter=L.LinearFilter,this.lowerSkybox.minFilter=L.LinearFilter,this.lowerSkybox.matrixAutoUpdate=!1},Vi.prototype.build=function(){var t=this,e=this.name+" build failure",r=ki.modelManager.getModel(this.modelId),i=r.floors.list.length;if(null===this.marker&&(this.marker=new Hi({model_id:this.modelId,id:this.id,floor:this.floorIndex,scale:this.sweepData.scale,pic:this.sweepData.pic,visible:this.sweepData.visible})),null===this.floorIndex){this.floorIndex=r.floors.parseFloor(this.id);var o=this.marker.position;r.floors.list.forEach((function(e){e.box3.containsPoint(o)&&(t.floorIndex=e.floorIndex)}))}if(this.floorIndex>=i)n.error(e+", reason: total floor<"+i+">, current floor<"+this.floorIndex+">")();else{var a=r.floors.get(this.floorIndex);a.addPano(this);var s=this.position,l=this.sweepData.spot,c=(new L.Vector3).subVectors(l,s),u=c.clone().normalize();Wi.layers.enable(ve.COLLIDER),Wi.set(s,u),Wi.far=c.length()+1;var h=Wi.intersectObjects(a.collider.children);if(0<h.length){var p=h[0].object.userData.chunk_name;this.chunkName=p}else this.chunkName=""}},Vi.prototype.loadTiledPano=function(t,e,r){var i=this;void 0===e&&(e=(new L.Vector3).copy(Ie.FORWARD)),void 0===r&&(r=function(){}),this.panoRendered=function(t,e,n){},this.panoRendered=function(t,e){r(t,e),i.panoRendered=function(){}},this.tileLoadFailed=function(t){n.error("tile: "+i.id+" "+t+" load failure")()},ki.tileDownloader.forceQueueTilesForPano(this,t,e),this.tiledPanoRenderTarget=ki.panoRenderer.activateTiledPano(this,ki.qualityManager.getMaxNavPanoSize()),ki.panoRenderer.renderPanoTiles(this.id,e)},Vi.prototype.loadCube=function(t,e){var n=this;void 0===e&&(e=function(){});var r=_e.getRenderSet();Si.load(this.id,(function(t,i){n.skybox.image=t.image,Gi[n.id]=n.skybox,"512"!==r&&"1024"!==r&&"2048"!==r||e(n.skybox)}))},Vi.prototype.onUploadAttemptedForAllTiles=function(t,e,n){t===this.id&&e===ki.qualityManager.getPanoSize(vi)&&this.shouldRedrawOnBaseLoaded&&(this.shouldRedrawOnBaseLoaded=!1,ki.panoRenderer.resetRenderStatus(t),ki.panoRenderer.renderPanoTiles(this.id,null,!0,!0))},Vi.prototype.onTileRendered=function(t,e,n,r){t===this.id&&this.tileRendered(e,n,r)},Vi.prototype.onPanoRendered=function(t,e,n){t===this.id&&(this.minimumTiledPanoLoaded=!0,this.skybox=this.tiledPanoRenderTarget.texture,this.panoRendered&&this.panoRendered(e,n))},Vi.prototype.onTileRenderFail=function(t,e,n){t===this.id&&this.tileRenderFailed(e)},Vi.prototype.getSkyboxTexture=function(t){var e=_e.getRenderMode();if("lod"===e){var n=null;return this.minimumTiledPanoLoaded&&(n=this.zoomed?ki.panoRenderer.zoomRenderTarget.texture:this.tiledPanoRenderTarget.texture),n}if("6cube"===e)return this.skybox},Vi.prototype.getLowerSkyboxTexture=function(){return this.lowerSkybox},Vi.prototype.ensureSkyboxReadyForRender=function(){"6cube"===_e.getRenderMode()&&(this.skybox.loaded||(this.skybox.needsUpdate=!0,this.lowerSkybox.needsUpdate=!0),this.skybox.loaded=!0)},Vi.prototype.isAligned=function(){return this.alignmentType===mi},Vi.prototype.enter=function(){n.info("%c"+this.name+" enter","color:cyan;")();var t=ki.modelManager.getModel(this.modelId);if(ki.sceneRender.magnifyingCamera){var e=this.position.clone();ki.sceneRender.magnifyingCamera.setPosition(e)}t.onPanoEnter(this)},Vi.prototype.exit=function(){if(n.info("%c"+this.name+" exit","color:cyan;")(),!0!==ki.pure3D){var t=ki.modelManager.getModel(this.modelId);"lod"===_e.getRenderMode()&&(this.zoomed&&ki.player.stopLoadMaxZoomTIle(),this.setZoomed(!1,"pano.exit"),ki.panoRenderer.deactivateTiledPano(this)),t.onPanoExit(this)}},Vi.prototype.isLoaded=function(){return this.minimumTiledPanoLoaded},Vi.prototype.isLoadedCube=function(){return!!Gi[this.id]},Vi.prototype.clearSkybox=function(){this.skybox&&this.skybox.dispose(),this.lowerSkybox&&this.lowerSkybox.dispose()},Vi.prototype.clearCubeTextureMap=function(){zi=Object.create(null)},Vi.prototype.clearTiledRenderTarget=function(){this.tiledPanoRenderTarget&&(this.tiledPanoRenderTarget.dispose(),this.tiledPanoRenderTarget=null)},Vi.prototype.clearZoomRenderTarget=function(){ki.panoRenderer.zoomRenderTarget&&ki.panoRenderer.zoomRenderTarget.dispose()},Vi.prototype.clearSkyboxMap=function(){Object.keys(Gi).forEach((function(t){Gi[t].dispose(),Gi[t]=null})),Gi=Object.create(null)},Vi.prototype.setZoomed=function(t,e){this.zoomed=t,this.zoomed&&this.updateSkyboxForZoomLevel()},Vi.prototype.updateSkyboxForZoomLevel=function(){var t=ki.modelManager.getModel(this.modelId);this.minimumTiledPanoLoaded&&t.updateProjectedPanos()},Vi.prototype.setMode=function(t){},Vi.prototype.checkAndWaitLoad=function(t,e){void 0===t&&(t=512),void 0===e&&(e=function(){});var n=_e.getRenderMode();if("lod"===n)if(Ht.coreStateEngine.state[Y.LOADING_PANO_TILE].state=!0,this.isLoaded()){var r=ki.sceneRender.camera.getDirection();this.tiledPanoRenderTarget=ki.panoRenderer.activeLoadedPano(this,ki.qualityManager.getMaxNavPanoSize()),ki.panoRenderer.renderPanoTiles(this.id,r),Ht.coreStateEngine.state[Y.LOADED_PANO_TILE].state=!0,e()}else{var i=(new L.Vector3).copy(Ie.FORWARD);ki.sceneRender&&(i=ki.sceneRender.camera.getDirection()),this.loadTiledPano(t,i,(function(){Ht.coreStateEngine.state[Y.LOADED_PANO_TILE].state=!0,e()}))}"6cube"===n&&(this.isLoadedCube()?e(!0):this.loadCube(void 0,(function(){e()})))},Vi.prototype.setEnable=function(){this.enable=!0},Vi.prototype.setDisable=function(){this.enable=!1},Vi.prototype.clear=function(){var t=this.name+" clear";this.clearSkybox(),this.clearCubeTextureMap(),this.clearTiledRenderTarget(),"lod"===_e.getRenderMode()&&this.clearZoomRenderTarget(),this.clearSkyboxMap(),F.setItem(""+t,!0)()},Vi.scoreFunctions={distanceSquared:function(t,e){return e=e||fi.navigation.distanceFactor,function(n){return t?t.position.distanceToSquared(n.position)*e:0}},direction:function(t,e){return function(n){return n.position.clone().sub(t).normalize().dot(e)*fi.navigation.directionFactor}},angle:function(t,e){return function(n){return n.position.clone().sub(t).normalize().angleTo(e)*fi.navigation.angleFactor}}},Vi.filters={not:function(t){return function(e){return e!=t&&e.enable}},inPanoDirection:function(t,e,n){return void 0===n&&(n=.75),function(r){var i=r.floorPosition.clone().sub(t).normalize(),o=r.position.clone().sub(t).normalize();return i.dot(e)>n||o.dot(e)>n}},isNeighbourPanoTo:function(t){return function(e){return!t||!t.neighbourPanos||!!t.neighbourPanos[e.id]}},isPanoAligned:function(){return function(t){return t.isAligned()}}};var Yi={hitInAnimation:null,hitOutAnimation:null,start:function(){var t=this;if(!0!==Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_HIT_WALL].state&&!this.hitInAnimation&&!this.hitOutAnimation){var e=k.getCore(),n=e.sceneRender.camera,r=e.player.cameras[G.PANORAMA],i=e.player.zoomLevel,o=i+.04;this.hitInAnimation=new Nn.Tween({value:i}).to({value:o}).duration(300).easing(Nn.Easing.Linear.None).onUpdate((function(t){r.setZoom(t.value),n.setZoom(t.value)})).onComplete((function(e){t.hitInAnimation.stop()})).onStop((function(e){t.hitInAnimation=null})),this.hitOutAnimation=new Nn.Tween({value:o}).to({value:i}).duration(200).easing(Nn.Easing.Linear.None).onUpdate((function(t){r.setZoom(t.value),n.setZoom(t.value)})).onComplete((function(e){t.hitOutAnimation.stop()})).onStop((function(e){t.hitOutAnimation=null})),this.hitInAnimation.chain(this.hitOutAnimation).start()}},start2:function(t){var e=this;if(!0!==Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_HIT_WALL].state&&!this.hitInAnimation&&!this.hitOutAnimation){var n=k.getCore();n.sceneRender.camera;var r=n.player.cameras[G.PANORAMA],i=n.player.controls[G.PANORAMA],o=r.getPosition(),a=(new L.Vector3).copy(o).addScaledVector(t,.1);this.hitInAnimation=new Nn.Tween({value:0}).to({value:1}).duration(300).easing(Nn.Easing.Linear.None).onUpdate((function(t){var e=(new L.Vector3).copy(o).lerp(a,t.value);i.setPosition(e)})).onComplete((function(t){e.hitInAnimation.stop()})).onStop((function(t){e.hitInAnimation=null})),this.hitOutAnimation=new Nn.Tween({value:0}).to({value:1}).duration(185.4).easing(Nn.Easing.Linear.None).onUpdate((function(t){var e=(new L.Vector3).copy(a).lerp(o,t.value);i.setPosition(e)})).onComplete((function(t){e.hitOutAnimation.stop()})).onStop((function(t){e.hitOutAnimation=null})),this.hitInAnimation.chain(this.hitOutAnimation).start()}}},Xi=G.PANORAMA+".camera.switch.to.position.animation",Zi=null,qi=null,Qi=null;function Ki(t,e){void 0===t&&(t=1e3),void 0===e&&(e=function(){}),null===Qi&&(Qi=k.getCore());var n=Qi.player.model,r=Qi.player.controls[G.PANORAMA],i=Qi.player.cameras[G.PANORAMA],o=Qi.sceneRender.camera,a=Qi.player.currentPano,s=Qi.player.targetPano,l=(new L.Vector3).copy(a.position),c=(new L.Vector3).copy(s.position),u=(new L.Quaternion).copy(i.quaternion),h=(new L.Quaternion).copy(s.currentQuaternion),p=i.zoom,d=s.camera_zoom||1;n.setProjectedPanos(a,s,void 0,"switch.to.target.pano.transition");var f=new St(4,(function(){!0===Ht.webxr.state[li.webxrEvents.Events.SESSION_START].state&&n.hide(),a.exit(),s.enter(),s.camera_zoom=null,Qi.player.currentPano=s,Qi.player.targetPano=null,!1===s.free_rotate&&r.enable("move.to.target.complete"),e()}));!0===Ht.webxr.state[li.webxrEvents.Events.SESSION_START].state&&n.show(""+li.webxrEvents.Events.SESSION_START),Qi.pure3D?f.record("model.skybox.progress.complete"):n.skybox.runProgressAnimation(t,(function(){f.record("model.skybox.progress.complete")})),!1===s.free_rotate&&r.disable("target.pano.not.free.rotate"),n.runChunksProgressAnimation(t,(function(){f.record("model.chunk.progress.complete")})),function(t){null===Zi&&(Zi=k.getCore());var e=Zi.player.cameras[G.PANORAMA],n=(new L.Vector3).copy(t.origin_position),r=(new L.Vector3).copy(t.target_position),i=t.duration,o=t.delay,a=t.progress||function(){},s=t.complete||function(){},l=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Quadratic.InOut).delay(o).duration(i).onUpdate((function(t){var i=t.value,o=(new L.Vector3).copy(n).lerp(r,i);e.setPosition(o,Xi),a({value:i})})).onComplete((function(t){l.stop()})).onStop((function(t){l=null,s()})).start()}({origin_position:l,target_position:c,duration:t,delay:0,progress:function(t){!function(t){var e=t.value;if(p!==d){var n=p*(1-e)+d*e;i.setZoom(n),o.setZoom(n),Qi.player.zoomLevel=n}Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_TRANSITION].data={mode:Qi.player.mode,target_pano_id:Qi.player.targetPano.id},Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_TRANSITION].state=!0}(t)},complete:function(){f.record("move.to.target.complete")}}),function(t){null===qi&&(qi=k.getCore());var e=qi.player.controls[G.PANORAMA],n=(new L.Quaternion).copy(t.origin_quaternion),r=(new L.Quaternion).copy(t.target_quaternion),i=t.delay,o=t.duration,a=t.progress||function(){},s=t.complete||function(){},l=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Quadratic.InOut).delay(i).duration(o).onUpdate((function(t){var i=t.value,o=(new L.Quaternion).copy(n).slerp(r,i);e.lookAtRotation(o),a(t)})).onComplete((function(t){l.stop()})).onStop((function(t){l=null,s()})).start();e.switchToQuaternionAnimation=l}({origin_quaternion:u,target_quaternion:h,delay:0,duration:t,progress:function(){},complete:function(){f.record("turn.to.target.quaternion.complete")}})}var Ji=null,$i=null,to=null,eo=null,no=null;function ro(t,e){void 0===e&&(e=function(){}),no=k.getCore();var r="switch to target pano of panorama";if(!0!==Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_PANO].state)if(!0!==Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO].state)if(t)if(t.modelId!==no.player.currentPano.modelId||t.id!==no.player.currentPano.id)switch(null===no.player.targetPano&&no.player.updateTargetPano(t,r),Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].pano_id=t.id,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].quaternion={x:t.currentQuaternion.x,y:t.currentQuaternion.y,z:t.currentQuaternion.z,w:t.currentQuaternion.w},Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].lookat_target=t.lookat_target?{x:t.lookat_target.x,y:t.lookat_target.y,z:t.lookat_target.z}:null,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].switch_mode=t.switch_mode,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].switch_config=t.switch_config,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].free_rotate=t.free_rotate,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!0,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO].data={curent_pano:{id:no.player.currentPano.id},target_pano:{id:t.id}},Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO].state=!0,t.switch_mode){case"default":!function(t,e){null===Ji&&(Ji=k.getCore());var n=Ji.player.currentPano.position.distanceTo(t.position),r=150*Math.min(n,t.switch_config.max_distance)+800;Ji.pure3D?Ki(r,(function(){e()})):t.checkAndWaitLoad(void 0,(function(){Ki(r,(function(){e()}))}))}(t,(function(){Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_COMPLETE].data={mode:no.player.mode,current_pano_id:no.player.currentPano.id},Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_COMPLETE].state=!0,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!1,e()}));break;case"fixed_delay":!function(t,e){null===$i&&($i=k.getCore());var n=t.switch_config.duration;t.checkAndWaitLoad(void 0,(function(){Ki(n,(function(){e()}))}))}(t,(function(){Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_COMPLETE].data={mode:no.player.mode,current_pano_id:no.player.currentPano.id},Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_COMPLETE].state=!0,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!1,e()}));break;case"uniform_motion":!function(t,e){null===to&&(to=k.getCore());var n=to.player.currentPano.position.distanceTo(t.position)/t.switch_config.speed*1e3;t.checkAndWaitLoad(void 0,(function(){Ki(n,(function(){e()}))}))}(t,(function(){Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_COMPLETE].data={mode:no.player.mode,current_pano_id:no.player.currentPano.id},Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_COMPLETE].state=!0,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!1,e()}));break;case"fade":!function(t,e){var r="switch to target pano of fade";null===eo&&(eo=k.getCore());var i=eo.player.controls[G.PANORAMA],o=eo.player.cameras[G.PANORAMA],a=eo.sceneRender.camera,s=eo.player.model,l=eo.player.currentPano,c=eo.modelManager.getModel(l.modelId),u=c.skybox,h=s.skybox,p=o.zoom,d=t.camera_zoom||1;i.stopRotation(r),i.disable(r),n.time("fade.in.complete")(),pe.renderStaticCover((function(){eo.waypointManager.hideGroup(),!1===Ht.webxr.state[li.webxrEvents.Events.SESSION_START].state&&(c.hide(),s.hide()),f.record("render.screen.shot.image.complete")}));var f=new St(2,(function(){h.setOpacity(h.defaultOpacity),s.setProjectedPanos(l,t,void 0,"switch.to.target.pano.of.fade"),h.setProgress(1,(function(){m.record("model.skybox.set.progress.complete")})),s.setChunkProgress(1,(function(){m.record("set.model.chunk.progress.complete")})),o.setPosition(t.position),i.lookAtRotation(t.currentQuaternion),l.exit(),t.enter(),eo.player.currentPano=t,eo.player.targetPano=null,u.hide();var e=_e.getCameraFov();e!==eo.sceneRender.camera.fov&&(eo.sceneRender.camera.setFov(e),i.setFov(e)),p!==d&&(o.setZoom(d),a.setZoom(d),eo.player.zoomLevel=d),m.record("panorama.panoramaCamera.move.to.target.complete")})),m=new St(3,(function(){h.show(),h.onFadeInComplete=function(){!1===Ht.webxr.state[li.webxrEvents.Events.SESSION_START].state&&s.show(),eo.waypointManager.showGroup(),eo.screenshotImage&&(eo.commonEvents.coreEvents.getRendererStage().removeChild(eo.screenshotImage),eo.screenshotImage=null),!1===i.enabled&&i.enable(r+", fade in complete"),n.timeEnd("fade.in.complete")(),e()},h.fadeIn({duration:t.switch_config.in})}));t.checkAndWaitLoad(void 0,(function(){f.record("target.pano.loaded")}))}(t,(function(){Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_COMPLETE].data={mode:no.player.mode,current_pano_id:no.player.currentPano.id},Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO_COMPLETE].state=!0,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!1,e()}))}else n.warn(r+" failure, reason: has been in the pano")();else n.warn(r+" failure, reason: invalid pano")();else n.warn(r+" failure, reason: switch to pano")();else n.warn(r+" failure, reason: disable switch pano")()}var io=document.getElementById("rotation-event");document.getElementById("handle-event2");var oo=!1;Object.create(null).isBindEvents=!1;var ao=0,so=1*Kt("ra")||4.5,lo=-180,co=180,uo=-89,ho=89,po=null,fo=function(t){po=k.getCore(),this.name="panorama.control",this.camera=t,this.lon=0,this.lat=0,this.phi=0,this.theta=0,this.zoomSpeed=.06,this.originZoom=1,this.rotationHistory=[],this.target=new L.Vector3,this.lookVector=new L.Vector3,this.rotationAcc=new L.Vector2,this.rotationSpeed=new L.Vector2,this.pointer=new L.Vector2,this.rotationDifference=new L.Vector2,this.pointerDragStart=new L.Vector2,this.clockwiseRotateAnimation=null,this.isSetHorizontalScope=!1,this.isSetVerticalScope=!1,this.enabled=!1,this.disableCmds=[],this.config=Object.freeze(de),this.init()};fo.prototype.init=function(){this.onEvents()},fo.prototype.lookAt=function(t,e){this.stopRotation("lookAt");var n=ke(t,this.camera.getPosition()),r=n.lon,i=n.lat;this.lon=r,this.lat=i,this.phi=L.Math.degToRad(90-this.lat),this.theta=L.Math.degToRad(this.lon),this.lookVector.x=Math.sin(this.phi)*Math.cos(this.theta),this.lookVector.y=Math.cos(this.phi),this.lookVector.z=Math.sin(this.phi)*Math.sin(this.theta),this.target.copy(t),this.camera.lookAtTarget(this.target,this.name+" "+e+" lookAt"),po&&po.player&&po.player.currentPano&&(po.player.currentPano.currentQuaternion=this.camera.getQuaternion())},fo.prototype.lookAtDirection=function(t){var e=(new L.Vector3).addVectors(this.camera.getPosition(),t);this.lookAt(e,this.name+".lookat.direction")},fo.prototype.lookAt3=function(t,e,r,i){var o=this;if(void 0===r&&(r=function(){}),void 0===i&&(i=function(){}),this.lookAt3Animation)n.warn(this.name+" lookAt3Animation not complete")();else{var a=this.camera.getQuaternion(),s=(new L.Quaternion).copy(t),l=new L.Quaternion,c=new L.Vector3;this.lookAt3Animation=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Quadratic.InOut).duration(e).delay(0).onUpdate((function(t){l.copy(a).slerp(s,t.value),c.copy(Ie.FORWARD).applyQuaternion(l).add(o.camera.getPosition()),o.lookAt(c,o.name+".lookat3"),r()})).onComplete((function(t){o.lookAt3Animation.stop(),i()})).onStop((function(t){o.lookAt3Animation=null})).start()}},fo.prototype.lookAtRotation=function(t,e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=function(){}),void 0===r&&(r=function(){});var o=this.name+" look at rotation";if(0<e)this.lookAt3(t,e,n,r);else{this.camera.setQuaternion(t);var a=this.camera.getWorldDirection(new L.Vector3),s=(new L.Vector3).addVectors(this.camera.getPosition(),a);this.lookAt(s,o)}},fo.prototype.stopRotation=function(t){oo=!1,this.pointerDragStart.copy(this.pointer),this.rotationSpeed.set(0,0),this.rotationAcc.set(0,0),this.rotationHistory=[],this.clockwiseRotateAnimation&&this.clockwiseRotateAnimation.isPlaying()&&this.clockwiseRotateAnimation.stop()},fo.prototype.updateRotation=function(){this.camera.matrix.fromArray(ye.unitMatrix4),this.camera.matrixWorld.fromArray(ye.unitMatrix4);var t=new L.Vector3(this.pointerDragStart.x,this.pointerDragStart.y,-1).unproject(this.camera),e=new L.Vector3(this.pointer.x,this.pointer.y,-1).unproject(this.camera),n=Math.sqrt(t.x*t.x+t.z*t.z),r=Math.sqrt(e.x*e.x+e.z*e.z),i=Math.atan2(t.y,n),o=Math.atan2(e.y,r);this.rotationDifference.y=L.Math.radToDeg(i-o),t.y=0,e.y=0;var a=Math.acos(t.dot(e)/t.length()/e.length());!1===isNaN(a)&&(this.rotationDifference.x=L.Math.radToDeg(a),this.pointerDragStart.x<this.pointer.x&&(this.rotationDifference.x*=-1)),this.pointerDragStart.copy(this.pointer)},fo.prototype.updateRotationSpeed=function(t){void 0===t&&(t=.016),po.sceneRender&&30>=po.sceneRender.fps?(ao=1,oo=!1):ao=.06;var e=Kt("rf");e&&(ao=e*=1),re()&&(0!==this.rotationSpeed.x&&Math.abs(this.rotationSpeed.x)<3&&(this.rotationSpeed.x=0),0!==this.rotationSpeed.y&&Math.abs(this.rotationSpeed.y)<3&&(this.rotationSpeed.y=0)),ie()&&(0!==this.rotationSpeed.x&&Math.abs(this.rotationSpeed.x)<6&&(this.rotationSpeed.x=0),0!==this.rotationSpeed.y&&Math.abs(this.rotationSpeed.y)<6&&(this.rotationSpeed.y=0)),5<this.rotationHistory.length&&this.rotationHistory.shift(),this.rotationHistory.push(this.rotationDifference.clone()),io&&(io.value="rotationAcc:"+this.rotationAcc.x+", "+this.rotationAcc.y+"\r\n"),this.rotationSpeed.x=this.rotationSpeed.x*(1-ao)+this.rotationAcc.x*so,this.rotationSpeed.y=this.rotationSpeed.y*(1-ao)+this.rotationAcc.y*so,io&&(io.value+="rotationSpeed:"+this.rotationSpeed.x+", "+this.rotationSpeed.y+"\r\n"),io&&(io.value+="rotationDifference:"+this.rotationDifference.x+", "+this.rotationDifference.y+"\r\n"),this.lon+=this.rotationDifference.x,this.lat+=this.rotationDifference.y,this.lon+=this.rotationSpeed.x*t,this.lat+=this.rotationSpeed.y*t,io&&(io.value+="lon_lat: "+this.lon+", "+this.lat+"\r\n"),this.rotationDifference.set(0,0),this.isSetHorizontalScope&&(this.lon=Math.max(lo,Math.min(co,this.lon))),this.lat=Math.max(uo,Math.min(ho,this.lat)),io&&(io.value+="lon_lat: "+this.lon+", "+this.lat+"\r\n"),this.rotationDifference.set(0,0)},fo.prototype.zoomTo=function(t){if(0!==t){var e=this.camera.zoom+t,n=e;e<=de.minZoom&&(n=de.minZoom),e>=de.maxZoom&&(n=de.maxZoom),this.setZoom(n)}},fo.prototype.setFov=function(t,e){n.info(this.name+" set fov, fov:"+t+", cmd:"+e)(),this.camera.setFov(t)},fo.prototype.setZoom=function(t,e){this.name,this.camera.setZoom(t),this.enabled&&po.sceneRender.camera.setZoom(t),po&&po.player&&(po.player.zoomLevel=t),Re.SyncData[Re.SyncEvents.PANORAMA_CAMERA_ZOOM].state=!0,Re.SyncData[Re.SyncEvents.PANORAMA_CAMERA_ZOOM].value=t},fo.prototype.rotateTo=function(t,e){this.switchToQuaternionAnimation&&po.player.targetPano&&!0===po.player.targetPano.free_rotate&&(this.switchToQuaternionAnimation.stop(),this.switchToQuaternionAnimation=null),this.rotationAcc[t]=e,oo=!0},fo.prototype.moveTo=function(t){if(this.name,1!=Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_PANO].state){var e=ji(po.sceneRender.camera.getDirection(t.clone()));if(e){var n=function(){e.free_rotate=!0,ro(e,(function(){e.free_rotate=!1}))};1<po.player.zoomLevel?this.resetZoom((function(){n()})):n()}else{var r=(new L.Vector3).copy(t).applyQuaternion(this.camera.getQuaternion());Yi.start2(r)}}},fo.prototype.resetZoomOfForce=function(t){this.name,this.setZoom(de.defaultZoom)},fo.prototype.updateCamera=function(t,e,n){this.phi=L.Math.degToRad(90-e),this.theta=L.Math.degToRad(t),this.lookVector.x=Math.sin(this.phi)*Math.cos(this.theta),this.lookVector.y=Math.cos(this.phi),this.lookVector.z=Math.sin(this.phi)*Math.sin(this.theta),this.target.copy(this.lookVector).add(this.camera.getPosition()),this.camera.lookAtTarget(this.target,"panorama.control.update.camera"),po&&po.player&&po.player.currentPano&&(po.player.currentPano.currentQuaternion=this.camera.getQuaternion());var r={mode:G.PANORAMA,lon:this.lon,lat:this.lat,quaternion:this.camera.getQuaternion()};Ht.actionStateEngine.state[li.actionEvents.Events.PANORAMA_CAMERA_ROTATE].data=r,Ht.actionStateEngine.state[li.actionEvents.Events.PANORAMA_CAMERA_ROTATE].state=!0},fo.prototype.reset=function(){this.rotationAcc.set(0,0),this.rotationSpeed.set(0,0)},fo.prototype.setMode=function(t){switch(t){case"purepano":this.lookAt(new L.Vector3(0,0,-1),this.name+".set.mode")}},fo.prototype.clockwiseRotate=function(t,e,r,i,o){var a=this;void 0===e&&(e=500);var s=this.name+" clockwise rotate failure";if(100>e&&(e=100),this.clockwiseRotateAnimation&&this.clockwiseRotateAnimation.isPlaying())n.warn(s+", reason: animation is playing!")();else{var l=r||function(){},c=i||function(){},u=o||function(){},h=this.lon;null===this.clockwiseRotateAnimation&&(this.clockwiseRotateAnimation=new Nn.Tween({deg:0}).to({deg:t},e).easing(Nn.Easing.Linear.None).delay(10).onUpdate((function(t){var e=t.deg,n=h+e;a.lon=n,a.updateCamera(a.lon,a.lat),l(e)})).onComplete((function(t){a.clockwiseRotateAnimation.stop(),c()})).onStop((function(t){a.clockwiseRotateAnimation=null,a.stopRotation("clockwise.rotate.animation.stoped"),u()}))),this.clockwiseRotateAnimation.start()}},fo.prototype.clockwiseRotate2=function(t){var e=this.lon+t;this.lon=e,this.updateCamera(this.lon,this.lat)},fo.prototype.disableKeyboardControl=function(t){this.isDisableKeyBoardControl=!0},fo.prototype.enableKeyboardControl=function(){this.isDisableKeyBoardControl=!1},fo.prototype._needUpdateRotationSpeed=function(t){oo=t},fo.prototype.update=function(t){oo&&(this.updateRotationSpeed(t),this.updateCamera(this.lon,this.lat,"panorama.control.update"),this.computeCameraRotationStopedWorker&&this.computeCameraRotationStopedWorker.postMessage({rotation:{x:this.camera.rotation.x,y:this.camera.rotation.y,z:this.camera.rotation.z}}))},fo.prototype.destroy=function(t){n.info(this.name+".destroy, cmd: "+t),oo=!1,this.camera=null},fo.prototype.disable=function(t){var e=this.name+" disable";this.disableCmds.push(e+", cmd:"+t),!1===this.enabled&&n.warn(e+" failure, reason: is disabled!")(),this.dealtEvents("removeEventListener",e),this.removeWorker(),this.enabled=!1},fo.prototype.enable=function(t){var e=this.name+" enable";!0===this.enabled&&n.warn(e+" failure, reason: is enabled!")(),this.dealtEvents("addEventListener",e),this.defineWorker(),this.enabled=!0},fo.prototype.resetZoom=function(t){var e=this,r=this.name+" reset zoom";if(!this.zoomAnima){var i=po.sceneRender.camera,o=po.player.zoomLevel;1!==o?(this.disable("reset.zoom"),this.zoomAnima=new Nn.Tween({zoom:o}).to({zoom:1}).duration(300).easing(Nn.Easing.Linear.None).onStart((function(t){})).onUpdate((function(t){var n=t.zoom;e.setZoom(n),i.setZoom(n)})).onComplete((function(t){e.zoomAnima.stop()})).onStop((function(n){e.zoomAnima=null,e.enable("reset.zoom.complete"),t()})).start()):n.warn(r+" failure, samed zoom!")()}},fo.prototype.setVerticalScope=function(t,e){this.isSetVerticalScope=!0,uo=Math.max(t,-89),ho=Math.min(e,89)},fo.prototype.setHorizontalScope=function(t,e){this.isSetHorizontalScope=!0,lo=this.lon+t,co=this.lon+e},fo.prototype.resetVerticalScope=function(){this.isSetVerticalScope=!1,uo=-89,ho=89},fo.prototype.resetHorizontalScope=function(){this.isSetHorizontalScope=!1},fo.prototype.rotateVertical=function(t){var e=this.lat+=t;this.updateCamera(this.lon,e)},fo.prototype.setPosition=function(t,e){var n=this.name+" set position";this.camera.setPosition(t,""+n)},fo.prototype.defineWorker=function(){var t=this;if(!this.computeCameraRotationStopedWorker){var e=new Blob(["\n\n  const Len = 30;\n\n  var rotationHistory = [];\n\n  self.addEventListener('message', function (e) {\n\n    var data = e.data;\n    var cmd = data.cmd;\n\n    switch(cmd) {\n      case 'close': {\n        self.close();\n        break;\n      }\n    }\n\n    var rotation = data.rotation;\n\n    rotationHistory.push(rotation);\n\n    if (Len === rotationHistory.length) {\n\n      var firstVec3 = rotationHistory[0];\n      var sign = 0;\n\n      var thresholdValueOfX = 0.1;\n      var thresholdValueOfY = 0.1;\n      var thresholdValueOfZ = 0.1;\n\n      for (var i = 1; i < Len; ++i) {\n        \n        var vec3 = rotationHistory[i];\n        \n        var dx = Math.abs(vec3.x - firstVec3.x);\n        var dy = Math.abs(vec3.y - firstVec3.y);\n        var dz = Math.abs(vec3.z - firstVec3.z);\n\n        if (dx > thresholdValueOfX || dy > thresholdValueOfY || dz > thresholdValueOfZ) {\n          sign = 1;\n          break;\n        }\n      }\n      \n      if (0 === sign) {\n        self.postMessage('stop');\n      }\n      \n      if (1 === sign) {\n        self.postMessage('notstop');\n      }\n\n      rotationHistory = [];\n      \n    }\n\n  })\n"]),r=URL.createObjectURL(e);e=null,this.computeCameraRotationStopedWorker=new Worker(r),this.computeCameraRotationStopedWorker.onmessage=function(e){"stop"===e.data&&(t.stopRotation("worker compute camera rotate stop"),Ht.actionStateEngine.state[li.actionEvents.Events.PANORAMA_CAMERA_ROTATE_STOP].data={mode:G.PANORAMA},Ht.actionStateEngine.state[li.actionEvents.Events.PANORAMA_CAMERA_ROTATE_STOP].state=!0),"notstop"===e.data&&(oo=!0)},this.computeCameraRotationStopedWorker.onerror=function(t){n.error(t)()}}},fo.prototype.removeWorker=function(){this.computeCameraRotationStopedWorker&&(this.computeCameraRotationStopedWorker.terminate(),this.computeCameraRotationStopedWorker=null)},fo.prototype.onEvents=function(){var t=this;this.onMouseLeftButtonDown=function(e){var n=t.name+" on mouse left button down";t.switchToQuaternionAnimation&&po.player.targetPano&&!0===po.player.targetPano.free_rotate&&(t.switchToQuaternionAnimation.stop(),t.switchToQuaternionAnimation=null),t.enableKeyboardControl(),Be(e.x,e.y,t.pointer),t.stopRotation(n)},this.onMouseLeftButtonUp=function(e){if(t.name,0<e.ts-(t.lastMoveTime+100))t.stopRotation();else{var n=Ue(t.rotationHistory);t.rotationSpeed.set(40*n.x,40*n.y),oo=!0}},this.onMouseLeftButtonDownWithinMove=function(e){t.lastMoveTime=e.ts,Be(e.x,e.y,t.pointer),t.updateRotation(),t.updateRotationSpeed(),t.updateCamera(t.lon,t.lat)},this.onMouseMoveStop=function(){},this.onMouseOver=function(e){t.enableKeyboardControl()},this.onMouseOut=function(e){t.rotationAcc.x=0},this.onMouseWheelOfForward=function(e){var r=t.name+" zoom failure";!0!==Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO].state?!0!==Ht.coreStateEngine.state[li.coreEvents.Events.DISABLE_ZOOM_CONTROL].state?t.zoomTo(t.zoomSpeed):n.warn(r+", reason: disable zoom control")():n.warn(r+", reason: switch to pano")()},this.onMouseWheelOfBackward=function(e){var r=t.name+" zoom failure";!0!==Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO].state?!0!==Ht.coreStateEngine.state[li.coreEvents.Events.DISABLE_ZOOM_CONTROL].state?t.zoomTo(-t.zoomSpeed):n.warn(r+", reason: disable zoom control")():n.warn(r+", reason: switch to pano")()},this.onHandleSingleTouchStart=function(e){var n=e.x,r=e.y;t.switchToQuaternionAnimation&&po.player.targetPano&&!0===po.player.targetPano.free_rotate&&(t.switchToQuaternionAnimation.stop(),t.switchToQuaternionAnimation=null),Be(n,r,t.pointer),t.stopRotation("handle touch start")},this.onHandleSingleTouchStartChanged=function(e){Be(e.x,e.y,t.pointer),t.stopRotation("handle touch start changed")},this.onHandleSingleTouchMove=function(e){t.lastMoveTime=e.ts,Be(e.x,e.y,t.pointer),t.updateRotation(),t.updateRotationSpeed(),t.updateCamera(t.lon,t.lat)},this.onHandleSingleTouchEnd=function(e){if(0<e.timeStamp-(t.lastMoveTime+100))t.stopRotation();else{var n=Ue(t.rotationHistory);t.rotationSpeed.set(40*n.x,40*n.y),oo=!0}},this.onHandleDoubleTouchMove=function(t){},this.onHandleDoubleTouchZoomIn=function(e){t.name;var n=e.new_scale/e.prev_scale,r=t.camera.zoom*n;r>de.maxZoom&&(r=de.maxZoom),t.setZoom(r,"touch.zoom.in")},this.onHandleDoubleTouchZoomOut=function(e){t.name;var n=e.new_scale/e.prev_scale,r=t.camera.zoom*n;r<de.minZoom&&(r=de.minZoom),t.setZoom(r,"touch.zoom.out")},this.onKeyboardLeftArrowDown=function(){t.isDisableKeyBoardControl||t.rotateTo("x",-1)},this.onKeyboardLeftArrowUp=function(){t.isDisableKeyBoardControl||(t.rotationAcc.x=0)},this.onKeyboardRightArrowDown=function(){t.isDisableKeyBoardControl||t.rotateTo("x",1)},this.onKeyboardRightArrowUp=function(){t.isDisableKeyBoardControl||(t.rotationAcc.x=0)},this.onKeyboardUpArrowDown=function(){t.isDisableKeyBoardControl||t.rotateTo("y",1)},this.onKeyboardUpArrowUp=function(){t.isDisableKeyBoardControl||(t.rotationAcc.y=0)},this.onKeyboardDownArrowDown=function(){t.isDisableKeyBoardControl||t.rotateTo("y",-1)},this.onKeyboardDownArrowUp=function(){t.isDisableKeyBoardControl||(t.rotationAcc.y=0)},this.onKeyboardWDown=function(){t.isDisableKeyBoardControl||t.moveTo(Ie.FORWARD)},this.onKeyboardADown=function(){t.isDisableKeyBoardControl||t.moveTo(Ie.LEFT)},this.onKeyboardSDown=function(){t.isDisableKeyBoardControl||t.moveTo(Ie.BACK)},this.onKeyboardDDown=function(){t.isDisableKeyBoardControl||t.moveTo(Ie.RIGHT)}},fo.prototype.dealtEvents=function(t,e){lt.mouse[""+t](li.mouseEvents.Events.MOUSE_OVER,this.onMouseOver),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_OUT,this.onMouseOut),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_MOVE_STOP,this.onMouseMoveStop),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_DOWN,this.onMouseLeftButtonDown),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_UP,this.onMouseLeftButtonUp),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE,this.onMouseLeftButtonDownWithinMove),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_WHEEL_FORWARD,this.onMouseWheelOfForward),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_WHEEL_BACKWARD,this.onMouseWheelOfBackward),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_START,this.onHandleSingleTouchStart),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_START_CHANGED,this.onHandleSingleTouchStartChanged),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_MOVE,this.onHandleSingleTouchMove),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_END,this.onHandleSingleTouchEnd),lt.handle[""+t](li.handleEvents.Events.HANDLE_DOUBLE_TOUCH_MOVE,this.onHandleDoubleTouchMove),lt.handle[""+t](li.handleEvents.Events.HANDLE_DOUBLE_TOUCH_ZOOM_IN,this.onHandleDoubleTouchZoomIn),lt.handle[""+t](li.handleEvents.Events.HANDLE_DOUBLE_TOUCH_ZOOM_OUT,this.onHandleDoubleTouchZoomOut),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_W_DOWN,this.onKeyboardWDown),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_A_DOWN,this.onKeyboardADown),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_S_DOWN,this.onKeyboardSDown),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_D_DOWN,this.onKeyboardDDown),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_LEFT_ARROW_DOWN,this.onKeyboardLeftArrowDown),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_LEFT_ARROW_UP,this.onKeyboardLeftArrowUp),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_RIGHT_ARROW_DOWN,this.onKeyboardRightArrowDown),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_RIGHT_ARROW_UP,this.onKeyboardRightArrowUp),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_UP_ARROW_DOWN,this.onKeyboardUpArrowDown),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_UP_ARROW_UP,this.onKeyboardUpArrowUp),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_DOWN_ARROW_DOWN,this.onKeyboardDownArrowDown),lt.keyboard[""+t](li.keyboardEvents.Events.KEY_DOWN_ARROW_UP,this.onKeyboardDownArrowUp)};var mo=null,vo=function(t){function e(){t.call(this),mo=k.getCore(),this.name="PanoramaCamera",this.fov=_e.getCameraFov(),this.aspect=te(),this.near=ye.insideNear,this.far=ye.insideFar,this.zoom=_e.getPanoramaCameraZoom(),this.updateProjectionMatrix(),this.layers.disableAll()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateAspect=function(t,e){this.aspect=t,this.updateProjectionMatrix()},e.prototype.getAspect=function(){return this.aspect},e.prototype.setFov=function(t,e){this.fov=t,this.updateProjectionMatrix()},e.prototype.setZoom=function(t){this.name,this.zoom=t,this.updateProjectionMatrix(),Ht.actionStateEngine.state[li.actionEvents.Events.PANORAMA_CAMERA_ZOOM_CHANGED].data={zoom:t,mode:G.PANORAMA},Ht.actionStateEngine.state[li.actionEvents.Events.PANORAMA_CAMERA_ZOOM_CHANGED].state=!0},e.prototype.setPosition=function(t,e){this.position.copy(t),this.updateMatrixWorld(),mo&&mo.webxrManager&&mo.webxrManager.xrCamera&&mo.webxrManager.xrCamera.setPosition(t),mo.player.setPosition(t,this.name+" "+e)},e.prototype.setPositionScalar=function(t){this.position.multiplyScalar(t)},e.prototype.setQuaternion=function(t,e){this.quaternion.copy(t),this.updateMatrixWorld(),mo.player.setQuaternion(t,this.name+" "+e)},e.prototype.lookAtTarget=function(t,e){var n=new L.Vector3(t.x,t.y,t.z);this.lookAt(n),this.setQuaternion(this.getQuaternion(),this.name+" "+e),mo&&mo.webxrManager&&mo.webxrManager.xrCamera&&mo.webxrManager.xrCamera.setQuaternion(this.getQuaternion())},e.prototype.findPanoWithDirector=function(){if(mo.player){mo.player.model;var t=mo.player.currentPano;t.marker,t.skybox}},e.prototype.getPosition=function(){return this.position.clone()},e.prototype.getQuaternion=function(){return this.quaternion.clone()},e.prototype.getQuaternionForJson=function(){var t=this.getQuaternion(),e=Object.create(null);return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},e.prototype.getProjectionMatrix=function(){return this.projectionMatrix.clone()},e.prototype.getDirection=function(){var t=(new L.Vector3).copy(Ie.FORWARD);return t.applyQuaternion(this.quaternion).normalize(),t},e.prototype.getDirectionOfQuaternion=function(t){var e=(new L.Vector3).copy(Ie.FORWARD);return e.applyQuaternion(t).normalize(),e},e.prototype.getLookAtTarget=function(){var t=new L.Vector3,e=this.getDirection(),n=this.position;return t.addVectors(n,e),t},e.prototype.getFov=function(){return this.fov},e}(L.PerspectiveCamera),go={uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:"\n\n  precision highp float;\n  precision highp int;\n\n  uniform mat4 modelMatrix;\n  uniform mat4 modelViewMatrix;\n  uniform mat4 projectionMatrix;\n  uniform mat4 viewMatrix;\n  uniform mat3 normalMatrix;\n  uniform vec3 cameraPosition;\n  \n  attribute vec3 position;\n  attribute vec3 normal;\n  attribute vec2 uv;\n\n\n\n  varying vec3 vWorldPosition;\n\n  void main() {\n\n    vWorldPosition = position;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n  }\n\n",fragmentShader:"\n\n  precision highp float;\n  precision highp int;\n\n  uniform mat4 viewMatrix;\n  uniform vec3 cameraPosition;\n\n\n\n  uniform samplerCube map;\n  uniform float opacity;\n\n  varying vec3 vWorldPosition;\n\n  void main() {\n\n    vec4 color = textureCube( map, vec3( -vWorldPosition.x, vWorldPosition.yz ) );\n\n    gl_FragColor = vec4(color.rgb, opacity);\n\n  }\n\n"},yo=function(t){function e(){t.call(this),this.fragmentShader=go.fragmentShader,this.vertexShader=go.vertexShader,this.uniforms=L.UniformsUtils.clone(go.uniforms),this.side=L.BackSide,this.transparent=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setMap=function(t){this.uniforms.map.value=t,this.needsUpdate=!0},e}(L.RawShaderMaterial),_o=function(t){function e(e){var n=this;t.call(this),this.name="EntryPanoSkybox",this.geometry=new L.BoxBufferGeometry(1,1,1),this.material=new yo,this.setQuaternion(e.quaternion),this.copyCubeTexture(e.skybox),this.fadeInAnimation=null,this.fadeInCompleteCallback=[],this.layers.set(ve.PANO_SKYBOX),this.defaultOpacity=0,Object.defineProperties(this,{onFadeInComplete:{set:function(t){n.fadeInCompleteCallback.push(t)}}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e.prototype.setPosition=function(t){this.position.copy(t),this.updateMatrix(),this.updateMatrixWorld()},e.prototype.setQuaternion=function(t){this.quaternion.copy(t),this.updateMatrix(),this.updateMatrixWorld()},e.prototype.copyCubeTexture=function(t){"6cube"===_e.getRenderMode()&&(t.needsUpdate=!0),this.material.setMap(t)},e.prototype.setOpacity=function(t){this.material.uniforms.opacity.value=t,this.material.needsUpdate=!0},e.prototype.getOpacity=function(){return this.material.uniforms.opacity.value},e.prototype.fadeIn=function(t){var e=this;void 0===t&&(t=function(){});var r=this.name+" fade in";null===this.fadeInAnimation?this.fadeInAnimation=new Nn.Tween({opacity:this.defaultOpacity}).to({opacity:1}).easing(Nn.Easing.Quadratic.In).duration(500).onStart((function(t){})).onUpdate((function(t){e.setOpacity(t.opacity)})).onComplete((function(n){t(),e.fadeInCompleteCallback.forEach((function(t){return t()})),e.fadeInAnimation.stop()})).onStop((function(t){e.fadeInCompleteCallback=[],e.fadeInAnimation=null})).start():n.error(r+" failure, reason: animation is playing!")()},e.prototype.clearCache=function(){var t=this.name+" clear cache";this.isClearCache?n.error(t+" failure, clean cache!")():(this.isClearCache=!0,this.material.uniforms.map.value&&this.material.uniforms.map.value.dispose(),this.material.dispose(),this.geometry.dispose())},e.prototype.clear=function(){},e.prototype.destroy=function(){var t=this.name+" destroy";this.clearCache(),this.clear(),F.setItem(""+t,!0)()},e}(L.Mesh),Eo="start.mode.manager",To=Object.create(null),xo=null,bo=null,Mo=null,Ao=null;function So(){switch(_e.getEntryMode()){case G.PANORAMA:n.info("entry mode: "+G.PANORAMA)(),function(){xo.entryMode=G.PANORAMA;var t=xo.player.model.panos.index,e=_e.getEntryInfo(t,"dealt.panorama.start.mode"),n=e.pano;xo.player.updateTargetPano(n),Ao=new vo,(Mo=new fo(Ao)).ID="start.mode.pano.control";var r=_e.getRenderSet(),i=_e.getRenderMode();if(xo.pure3D)return xo.tileDownloader&&xo.tileDownloader.stop(),xo.lifeCycle.readyToLoadModel(),void wo();if("lod"===i){var o=xo.sceneRender.camera.getDirection();n.loadTiledPano(512,o,(function(){Oo(n),wo(),Mo.setPosition(n.position),Mo.lookAtRotation(e.quaternion,void 0,void 0,Eo),n.currentQuaternion.copy(Mo.camera.getQuaternion()),xo.lifeCycle.onFirstPanoLoaded(n)}))}else{var a=r;n.loadCube(a,(function(){Oo(n),wo(),Mo.setPosition(n.position),Mo.lookAtRotation(e.quaternion,void 0,void 0,Eo),n.currentQuaternion.copy(Mo.camera.getQuaternion()),xo.lifeCycle.onFirstPanoLoaded(n)}))}}();break;case G.DOLLHOUSE:n.info("entry mode: "+G.DOLLHOUSE)(),function(){xo.entryMode=G.DOLLHOUSE;var t=xo.player.model.panos.index,e=_e.getEntryInfo(t);e.pano.currentQuaternion=e.quaternion,xo.lifeCycle.readyToLoadModel()}();break;case G.FLOORPLAN:n.info("entry mode: "+G.FLOORPLAN)(),function(){xo.entryMode=G.FLOORPLAN;var t=xo.player.model.panos.index,e=_e.getEntryInfo(t);e.pano.currentQuaternion=e.quaternion,xo.lifeCycle.readyToLoadModel()}()}}function Oo(t){(bo=new _o(t)).setPosition(t.position),xo.sceneRender.scene.add(bo)}function wo(){xo.sceneRender.addComponent(Mo)}To.init=function(){null===xo&&(xo=k.getCore()),So()},To.destroy=function(){n.info("%c"+Eo+" destroy","color:#f00")(),xo.player.model.skybox.show(),xo.sceneRender.remove(bo,Eo+".destroy.skybox"),bo.destroy(),bo=null,xo.sceneRender.removeComponent(Mo),Mo.destroy(Eo+" destroy control"),Mo=null},Object.defineProperties(To,{skybox:{get:function(){return bo}},control:{get:function(){return Mo}},quickStartCamera:{get:function(){return Ao}}});var Lo="life.cycle.dealt",Do={panorama:function(){var t=k.getCore(),e=t.player.model.panos.index,n=t.adapterManager.getEntryInfo(e,"dealt.entry.of.panorama"),r=To.control.camera.quaternion;n.quaternion={x:r.x,y:r.y,z:r.z,w:r.w},t.player.stayedPanorama(n)},dollhouse:function(){var t=k.getCore(),e=t.adapterManager.getEntryInfoOfDollhouse();t.player.stayedDollhouse(e)},floorplan:function(){k.getCore().player.stayedFloorplan()}},Co={};Co[kt]=Ro,Co[zt]=Ro,Co[Gt]=Ro,Co[Wt]=function(){};var Po={};Po[kt]=Uo,Po[zt]=Uo,Po[Gt]=Uo,Po[Wt]=function(t){n.info("%clife.cycle.dealt dealt switch purepano","color:cyan;")();var e=k.getCore();e.data=t,_e.setCoreData(t),e.lifeCycle.onSwitchPurepano(t),e.purepanoManager.tileRenderer.init();var r=t.basic.pano_id,i=t.basic.panorama_camera_fov,o=e.purepanoManager.createPanoSphere({id:r,fov:i});o.hide(),o.entry_anima=t.entry_info.anima||o.entry_anima,o.entry_quaternion=t.entry_info.rotation,e.purepanoManager.enter("switch",o,(function(){e.player.control.setFov(i,"ccore.purepanoManager.enter"),e.sceneRender.camera.setFov(e.player.control.camera.fov,"ccore.purepanoManager.enter"),e.player.control.resetZoomOfForce("ccore.purepanoManager.enter"),e.sceneRender.camera.setZoom(e.player.control.camera.zoom),o.show()}),(function(){e.lifeCycle.onSwitchPurepanoComplete()}))};var No={};function Ro(){var t=k.getCore();if(G.PANORAMA===t.entryMode&&t.startModeManager.destroy(),"6cube"===_e.getRenderMode()){var e=t.player.model.panos.index,n=_e.getEntryInfo(e,"six.cube.loader.start");Si.start(n.pano.id)}}function Io(t,e){void 0===e&&(e=function(){});var r=Lo+" dealt prev model";n.info("%c"+r,"color:cyan;",t)();var i=k.getCore(),o=i.player.model,a=o.data.basic.render_mode,s=t.next_model_type;t.prev_model_view_mode;var l=t.next_model_view_mode,c=function(){"lod"===a&&(i.panoRenderer&&(i.panoRenderer.stop(),i.panoRenderer.clear()),i.tileDownloader&&(i.tileDownloader.stop(),i.tileDownloader.clear()),i.sceneRender&&i.sceneRender.destoryTextureMap()),"6cube"===a&&Si.stop()},u=function(){!o.destroyed&&o.destroy(""+r),i.sceneRender.remove(o,r),i.waypointManager.group&&i.waypointManager.removeGroup(),i.waypointManager.clear(),kt!==s&&zt!==s&&Gt!==s||i.sceneRender.clear(),Wt===s&&i.player.setMode(G.PANORAMA),i.player.clear(),i.adapterManager.clear()};return G.DOLLHOUSE===l||G.FLOORPLAN===l?(c(),u(),void e()):void(G.PANORAMA===l&&pe.renderStaticCover((function(){c(),u(),e()})))}function Uo(t){var e=Lo+" dealt switch model";n.info("%c"+e,"color:cyan;")();var r=k.getCore();r.data=t,_e.setCoreData(t);var i=_e.getEntryModeCameraFov(),o=_e.getSceneCameraZoom();r.sceneRender.camera.setFov(i,e),r.sceneRender.camera.setZoom(o),r.initData(t)}function Bo(t,e){var n=setTimeout((function(){t&&t(),clearTimeout(n),n=null}),e)}No[kt]=Io,No[zt]=Io,No[Gt]=Io,No[Wt]=function(t,e){void 0===e&&(e=function(){});var r=Lo+" dealt prev purepano";n.info("%c"+r,"color:cyan;")();var i=k.getCore(),o=t.next_model_type,a=t.next_model_view_mode,s=i.purepanoManager.activePano;if(i.purepanoManager.tileDownloader.stop(),kt===o||zt===o||Gt===o){if(G.PANORAMA===a)return void pe.renderStaticCover((function(){i.sceneRender.clear(),i.player.clear(),i.purepanoManager.tileRenderer.clearCache(),i.purepanoManager.tileRenderer.clear(),!s.destroyed&&s.destroy(r),i.sceneRender.remove(s,r),i.purepanoManager.activePano=null,e()}));if(G.DOLLHOUSE===a)return i.sceneRender.clear(),i.player.clear(),i.purepanoManager.tileRenderer.clearCache(),i.purepanoManager.tileRenderer.clear(),!s.destroyed&&s.destroy(r),i.sceneRender.remove(s,r),i.purepanoManager.activePano=null,void e();if(G.FLOORPLAN===a)return i.sceneRender.clear(),i.player.clear(),i.purepanoManager.tileRenderer.clearCache(),i.purepanoManager.tileRenderer.clear(),!s.destroyed&&s.destroy(r),i.sceneRender.remove(s,r),i.purepanoManager.activePano=null,void e()}if(Wt===o)return i.player.clear(),void pe.renderStaticCover((function(){i.purepanoManager.tileRenderer.clearCache(),i.purepanoManager.tileRenderer.clear(),!s.destroyed&&s.destroy(r),i.sceneRender.remove(s,r),i.purepanoManager.activePano=null,e()}))};var Fo=null,Ho=null,ko=function(){Fo=k.getCore(),this.name="life.cycle",this.progressPercent=0};ko.prototype.start=function(){n.info("%c"+this.name+" start","color:#0000ff;")(),this.onWindowEvents()},ko.prototype.onBoot=function(t){n.info("%c"+this.name+" start boot","color:#0000ff;")()},ko.prototype.progress=function(t){this.progressPercent+=t,Fo.bootOptions.onProgress(this.progressPercent)},ko.prototype.onCreatedModel=function(t){n.info("%c"+this.name+" created model","color:#0000ff;")(),Ho=t},ko.prototype.onFirstPanoLoaded=function(){var t=this,e=this.name+" on first pano loaded";n.info("%c"+e,"color:#0000ff;")(),this.progress(ui[Fo.adapterManager.getEntryMode()][hi.ENTRY_PANO_LOADED]);var r=Fo.startModeManager.skybox;r.setOpacity(r.defaultOpacity),Ht.coreStateEngine.state[li.coreEvents.Events.FIRST_PANO_LOADED].state=!0,r.fadeIn((function(){Fo.screenshotImage&&(Jt().removeChild(Fo.screenshotImage),Fo.screenshotImage=null),t.onFirstPanoSkyboxAnimationComplete()}))},ko.prototype.onFirstPanoSkyboxAnimationComplete=function(){var t=this.name+" on first pano skybox animation complete";n.info("%c"+t,"color:#0000ff;")(),Ht.coreStateEngine.state[li.coreEvents.Events.FIRST_PANO_ANIMATION_COMPLETE].state=!0},ko.prototype.readyToLoadModel=function(){var t=this,e=this.name+" ready to load model";n.info("%c"+e,"color:#0000ff;")();var r=_e.getSceneBackgroundSkyboxTile();r.length>0?we(r,(function(e){Fo.sceneRender.setSkyboxBackground(e),t.onModelLoading()})):this.onModelLoading()},ko.prototype.onModelLoading=function(){var t=this,e=this.name+" on model loading";n.info("%c"+e,"color:#0000ff;")(),Ho.hide(),Fo.sceneRender.add(Ho),Ho.load((function(){t.onModelLoaded(Ho)}))},ko.prototype.onModelLoaded=function(){var t=this.name+" on model loaded";n.info("%c"+t,"color:#0000ff;")(),Fo.player.init(),Fo.sceneRender.addComponent(Fo.player),Fo.panoRenderer&&Fo.sceneRender.addComponent(Fo.panoRenderer),Fo.player.start(t),Do[Fo.entryMode](),Fo.waypointManager.init(),Fo.waypointManager.computeWaypointBarrier(Ho.panos),Ho.panos.forEach((function(t){return Fo.waypointManager.addMarker(t.marker)})),this.onLoaded(kt)},ko.prototype.onPurepanoLoaded=function(t){var e=this.name+" on purepano loaded";n.info("%c"+e,"color:#0000ff;")(),"boot"===t&&(Fo.player.init(),Fo.player.setMode(G.PANORAMA),Fo.sceneRender.addComponent(Fo.player,e),Fo.player.start(e),this.onLoaded(Wt)),Ht.coreStateEngine.state[li.coreEvents.Events.PUREPANO_LOADED].state=!0},ko.prototype.onPurepanoAnimationStart=function(){var t=this.name+" on purepano animation start";n.info("%c"+t,"color:#0000ff;")(),Ht.coreStateEngine.state[li.coreEvents.Events.PUREPANO_ANIMATION_START].state=!0},ko.prototype.onPurepanoAnimationComplete=function(){var t=this.name+" on purepano animation complete";n.info("%c"+t,"color:#0000ff;")(),Fo.purepanoManager.areaPicker.init(),Ht.coreStateEngine.state[li.coreEvents.Events.PUREPANO_ANIMATION_END].state=!0,!1===Ht.coreStateEngine.state[li.coreEvents.Events.CORE_LOADED].state?Fo.eventsManager.coreEvents.coreLoaded({type:"purepano",id:Fo.player.model.panoId}):Ht.modelStateEngine.state[li.modelEvents.Events.SWITCH_PUREPANO_MODEL_COMPLETE].state=!0},ko.prototype.onPurepanoEnterComplete=function(){var t=this.name+" on purepano enter complete";n.info("%c"+t,"color:#0000ff;")(),Fo.player.control.enable(t)},ko.prototype.onWaypointLoaded=function(){var t=this.name+" on waypoint loaded";n.info("%c"+t,"color:#0000ff;")();var e=Ht.coreStateEngine.state[li.coreEvents.Events.CORE_LOADED].state;!1===e&&Bo((function(){Fo.eventsManager.coreEvents.coreLoaded({type:"model",id:Fo.player.model.modelid,mode:Fo.player.mode})}),160),!0===e&&Bo((function(){Fo.lifeCycle.onSwitchSceneComplete({type:"model",id:Fo.player.model.modelid,mode:Fo.player.mode})}),160)},ko.prototype.onLoaded=function(t){var e=this.name+" on loaded";n.debug("%c"+e,"color:#0000ff;",t)(),Fo.uilogManager.init(),Fo.webxrManager.init(),Fo.commonExtension.init(),Co[t]()},ko.prototype.onSwitchScene=function(t){var e=this.name+" on switch model";n.info("%c"+e,"color:#0000ff;")();var r=Fo.player.model.userData.type,i=t.type,o=t.entry_info.mode||G.PANORAMA;Fo.player.control.stopRotation(),Fo.player.control.disable("switch.model"),Fo.player.dealtEvents("removeEventListener"),Fo.sceneRender.camera.setProjectionMatrix(Fo.player.control.camera.getProjectionMatrix()),Bo((function(){No[r]({prev_model_type:r,next_model_type:i,prev_model_view_mode:Fo.player.mode,next_model_view_mode:o},(function(){Po[t.type](t)}))}),166)},ko.prototype.onSwitchSceneComplete=function(t){var e=this.name+" on switch scene complete";n.debug("%c"+e,"color:#0000ff;")(),Fo.screenshotImage&&(Jt().removeChild(Fo.screenshotImage),Fo.screenshotImage=null),Fo.player.dealtEvents("addEventListener"),Fo.commonExtension[z.NEED_SWITCH_MODEL_COMPLETE]&&Fo.commonExtension[z.NEED_SWITCH_MODEL_COMPLETE](t),Ht.modelStateEngine.state[li.modelEvents.Events.SWITCH_MODEL_COMPLETE].data=t,Ht.modelStateEngine.state[li.modelEvents.Events.SWITCH_MODEL_COMPLETE].state=!0},ko.prototype.onSwitchPurepano=function(){var t=this.name+" on switch purepano";n.info("%c"+t,"color:#0000ff;")()},ko.prototype.onSwitchPurepanoComplete=function(){var t=this.name+" on switch purepano complete";n.info("%c"+t,"color:#0000ff;")(),Fo.player.control.enable(t),this.onSwitchSceneComplete({type:Wt,mode:G.PANORAMA,id:Fo.purepanoManager.activePano.panoId})},ko.prototype.onPageRefreshBefore=function(){var t=this.name+" on page refresh before";F.setItem(""+t,Date.now())()},ko.prototype.onPageRefresh=function(){var t=this.name+" on page refresh";F.setItem(""+t,Date.now())()},ko.prototype.onPageHide=function(){var t=this.name+" on page hide";F.setItem(""+t,Date.now())(),Fo.tileDownloader&&Fo.tileDownloader.stop(),Fo.tileDownloader&&Fo.tileDownloader.clear(),Fo.panoRenderer&&Fo.panoRenderer.stop(),Fo.panoRenderer&&Fo.panoRenderer.clear(),Fo.player&&Fo.player.model&&Fo.player.model.destroy(t),Fo.player&&Fo.player.model&&Fo.sceneRender.remove(Fo.player.model,""+t),Fo.player&&Fo.player.clear(),Fo.modelManager&&Fo.modelManager.clear(),Fo.purepanoManager&&Fo.purepanoManager.clear(),Fo.waypointManager&&Fo.waypointManager.removeGroup(),Fo.waypointManager&&Fo.waypointManager.clear(),Fo.sceneRender&&Fo.sceneRender.clear(),Fo.sceneRender&&Fo.sceneRender.renderer.dispose(),Fo.sceneRender&&Fo.sceneRender.scene.dispose(),F.setItem(t+" dealt complete",!0)()},ko.prototype.onVisibilityChange=function(){var t=this.name+" on visibility change";F.setItem(""+t,Date.now())()},ko.prototype.onWindowEvents=function(){var t=this;window.addEventListener("beforeunload",(function(e){t.onPageRefreshBefore()})),window.addEventListener("unload",(function(e){t.onPageRefresh()})),window.addEventListener("pagehide",(function(e){t.onPageHide()})),window.addEventListener("visibilitychange",(function(e){t.onVisibilityChange()}))};var zo=0,Go=1,Wo=2,Vo=3,jo=4,Yo=5,Xo=[0,1,2,3,4,5],Zo={0:Wo,1:jo,2:zo,3:Yo,4:Go,5:Vo};function qo(t){return Zo[t]}function Qo(t,e){var n=_e.getPanoTileUrl(),r={_512:"low",_1024:"high",_2048:"2048"};return Xo.map((function(i){return n+"locations/pc/"+r["_"+e]+"/"+t+"_"+qo(i)+".jpg"}))}var Ko="\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vUv = uv;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n  }\n\n",Jo="\n\n  varying vec2 vUv;\n\n  uniform float alpha;\n  uniform sampler2D tDiffuse;\n\n  void main() {\n\n    vec4 texColor = texture2D(tDiffuse, vUv);\n\n    gl_FragColor = vec4(texColor.rgb, texColor.a * alpha);\n\n  }\n\n";new L.SVGLoader;var $o={enabled:[ve.CHUNK,ve.MAGNIFYING_CAMERA],disabled:[ve.DEFAULT]},ta={enabled:[ve.DEFAULT,ve.CHUNK,ve.MARKER,ve.MODEL_SKYBOX,ve.PANO_SKYBOX,ve.MAGNIFYING_CAMERA],disabled:[ve.COLLIDER]},ea={Near:.1,Far:5e3},na=null,ra=function(t){function e(){t.call(this),na=k.getCore(),this.name="SceneCamera",this.fov=_e.getEntryModeCameraFov(),this.aspect=te(),this.near=ea.Near,this.far=ea.Far,this.zoom=_e.getSceneCameraZoom(),this.updateProjectionMatrix(),this.init()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){var t=this;ta.enabled.forEach((function(e){t.layers.enable(e)}))},e.prototype.setPosition=function(t,e){var n=new L.Vector3(t.x,t.y,t.z);this.position.copy(n),this.updateMatrixWorld()},e.prototype.setQuaternion=function(t,e){this.name;var n=new L.Quaternion(t.x,t.y,t.z,t.w);this.quaternion.copy(n)},e.prototype.setZoom=function(t){this.name,this.zoom=t,this.updateProjectionMatrix()},e.prototype.setFov=function(t,e){this.name,this.fov=t,this.updateProjectionMatrix()},e.prototype.setAspect=function(t){if(this.aspect=t,na.player&&G.FLOORPLAN!==na.player.mode&&this.updateProjectionMatrix(),na.player&&G.FLOORPLAN===na.player.mode){var e=na.player.cameras[G.FLOORPLAN];this.setProjectionMatrix(e.projectionMatrix)}},e.prototype.setFar=function(t){this.name,this.far=t,this.updateProjectionMatrix()},e.prototype.setNear=function(t){this.name,this.near=t,this.updateProjectionMatrix()},e.prototype.setProjectionMatrix=function(t){this.projectionMatrix.copy(t)},e.prototype.getAspect=function(){return this.aspect},e.prototype.getPosition=function(){return this.position.clone()},e.prototype.getQuaternion=function(){return this.quaternion.clone()},e.prototype.getZoom=function(){return this.zoom},e.prototype.getFov=function(){return this.fov},e.prototype.getDirection=function(t){return void 0===t&&(t=(new L.Vector3).copy(Ie.FORWARD)),t.applyQuaternion(this.getQuaternion())},e}(L.PerspectiveCamera);a((function(t,e){var n;t.exports=((n=function(){function t(t){return i.appendChild(t.dom),t}function e(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";r=t}var r=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e(++r%i.children.length)}),!1);var o=(performance||Date).now(),a=o,s=0,l=t(new n.Panel("FPS","#0ff","#002")),c=t(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new n.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:i,addPanel:t,showPanel:e,begin:function(){o=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(c.update(t-o,200),t>a+1e3&&(l.update(1e3*s/(t-a),100),a=t,s=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:i,setMode:e}}).Panel=function(t,e,n){var r=1/0,i=0,o=Math.round,a=4*o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,h=3*a,p=15*a,d=74*a,f=30*a,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var v=m.getContext("2d");return v.font="bold "+9*a+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=n,v.fillRect(0,0,s,l),v.fillStyle=e,v.fillText(t,c,u),v.fillRect(h,p,d,f),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(h,p,d,f),{dom:m,update:function(l,g){r=Math.min(r,l),i=Math.max(i,l),v.fillStyle=n,v.globalAlpha=1,v.fillRect(0,0,s,p),v.fillStyle=e,v.fillText(o(l)+" "+t+" ("+o(r)+"-"+o(i)+")",c,u),v.drawImage(m,h+a,p,d-a,f,h,p,d-a,f),v.fillRect(h+d-a,p,a,f),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(h+d-a,p,a,o((1-l/g)*f))}}},n)}));var ia=function(){this.name="scene.trick.tools",this.axesHelper=null,this.exportCount=0};ia.prototype.showAxesHelper=function(){var t=k.getCore();this.axesHelper=new L.AxesHelper(100),t.sceneRender.add(this.axesHelper)},ia.prototype.hideAxesHelper=function(){k.getCore().sceneRender.remove(this.axesHelper,"hideAxesHelper")};var oa=null,aa=function(t){function e(){t.call(this),oa=k.getCore(),this.name="MagnifyingCamera",this.defaultZoom=10,this.fov=82,this.aspect=1,this.near=.1,this.far=ea.Far,this.zoom=this.defaultZoom,this.updateProjectionMatrix(),this.init()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){},e.prototype.addHelper=function(){this.helper=new L.CameraHelper(this),this.helper.name=this.name+"Helper",this.helper.material.depthTest=!1,this.helper.update(),oa.sceneRender.add(this.helper)},e.prototype.setPosition=function(t){this.position.copy(t)},e.prototype.getPosition=function(){return this.position.clone()},e.prototype.lookAtTarget=function(t){this.lookAt(t)},e.prototype.setZoom=function(t){this.zoom=t,this.updateProjectionMatrix()},e.prototype.setFov=function(t){this.fov=t,this.updateProjectionMatrix()},e.prototype.setNear=function(t){this.near=t,this.updateProjectionMatrix()},e.prototype.setFar=function(t){this.far=t,this.updateProjectionMatrix()},e.prototype.setAspect=function(t){this.aspect=t,this.updateProjectionMatrix()},e.prototype.getDirection=function(){return this.getWorldDirection(new L.Vector3)},e.prototype.getLookAtTarget=function(){return(new L.Vector3).addVectors(this.position,this.getDirection())},e}(L.PerspectiveCamera),sa=null,la=0,ca=0,ua=new Uint8Array(196608),ha=new L.DataTexture(ua,256,256,L.RGBFormat),pa=function(t){function e(){t.call(this),this.geometry=new L.PlaneBufferGeometry(2,2),this.material=new L.MeshBasicMaterial({map:null,transparent:!0,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1}),this.init(),this.setBgMap(),this.addFace()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){k.getCore(),sa=Jt(),la=.5*sa.clientWidth,ca=.5*sa.clientHeight},e.prototype.hide=function(){this.visible=!1},e.prototype.show=function(){this.visible=!0},e.prototype.setBgMap=function(){var t,e,n,r,i=(t="#4a4a4a",e=128,n=document.createElement("canvas"),r=n.getContext("2d"),n.width=260,n.height=260,r.beginPath(),r.arc(130,130,e,0,2*Math.PI),r.fillStyle=t,r.fill(),r.closePath(),new L.CanvasTexture(n));this.material.map=i,this.material.needsUpdate=!0},e.prototype.addFace=function(){var t=new L.CircleBufferGeometry(.97,128),e=new L.MeshBasicMaterial({map:ha,transparent:!0}),n=new L.Mesh(t,e);this.face=n,this.add(n)},e.prototype.hideFace=function(){this.face&&(this.face.visible=!1)},e.prototype.showFace=function(){this.face&&(this.face.visible=!0)},e.prototype.setScale=function(t){this.scale.set(t,t,1)},e.prototype.setScalar=function(t){this.scale.multiplyScalar(t)},e.prototype.setSize=function(t,e){this.scale.set(t,e,1)},e.prototype.setPosition=function(t,e){var n=-la+t,r=ca-e;this.position.set(n,r,1)},e.prototype.setUserData=function(t,e){this.userData[t]=e},e.prototype.getUserData=function(t){return this.userData[t]},e}(L.Mesh),da=null,fa=function(t){function e(e){t.call(this,e),da=k.getCore(),this.name="Renderer",this.aLight=null,this.dLight=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.enableShadow=function(){this.shadowMap.type=L.PCFSoftShadowMap,this.shadowMap.enabled=!0;var t=da.sceneRender.camera.near,e=da.sceneRender.camera.far;this.dLight.castShadow=!0,this.dLight.shadow.camera.near=t,this.dLight.shadow.camera.far=e,this.dLight.shadow.camera.left=-300,this.dLight.shadow.camera.right=300,this.dLight.shadow.camera.top=300,this.dLight.shadow.camera.bottom=-300,this.dLight.shadow.mapSize.width=512,this.dLight.shadow.mapSize.height=512},e.prototype.disableShadow=function(){this.shadowMap.enabled=!1},e.prototype.enableAmbientLight=function(t){if(null===this.aLight){var e=t.color,r=t.intensity;this.aLight=new L.AmbientLight(e,r),this.aLight.layers.disableAll(),this.aLight.layers.enable(ve.CHUNK),da.sceneRender.add(this.aLight)}else n.error(this.name+" has enabled ambient light!")()},e.prototype.enableDirectLight=function(t){if(null===this.dLight){var e=t.color,r=t.intensity,i=t.position;this.dLight=new L.DirectionalLight(e,r),this.dLight.layers.disableAll(),this.dLight.layers.enable(ve.CHUNK),this.dLight.position.copy(i),da.sceneRender.add(this.dLight)}else n.error(this.name+" has enabled directional light!")()},e.prototype.disableAmbientLight=function(){da.sceneRender.remove(this.aLight,"disableAmbientLight"),this.aLight=null},e.prototype.disableDirectLight=function(){da.sceneRender.remove(this.dLight,"disableDirectLight"),this.dLight=null},e.prototype.setAmbientLightColor=function(t){this.aLight.color=new L.Color(t)},e.prototype.setAmbientLightIntensity=function(t){this.aLight.intensity=t},e.prototype.setDirectLightColor=function(t){this.dLight.color=new L.Color(t)},e.prototype.setDirectLightIntensity=function(t){this.dLight.intensity=new L.Color(t)},e.prototype.setDirectLightPosition=function(t){this.dLight.position.copy(t)},e.prototype.setDirectLightLookAt=function(t){this.dLight.lookAt(t.x,t.y,t.z)},e.prototype.showDlightHelper=function(){this.dLightHelper=new L.DirectionalLightHelper(this.dLight,10,16776960),this.dLightHelper.name="dLight-helper",this.dLightHelper.children[0].renderOrder=999,this.dLightHelper.children[1].renderOrder=999,this.dLightHelper.children[0].material.depthTest=!1,this.dLightHelper.children[1].material.depthTest=!1,da.sceneRender.add(this.dLightHelper)},e.prototype.enableChunksShadow=function(t){var e=t.cast_shadow,n=t.receive_shadow;da.player.model.chunks.forEach((function(t){-1!==e.indexOf(t.userData.type)&&(t.castShadow=!0),-1!==n.indexOf(t.userData.type)&&(t.receiveShadow=!0)}))},e.prototype.setDLightShadowCameraSize=function(t){this.dLight.shadow.camera.left=-t,this.dLight.shadow.camera.right=t,this.dLight.shadow.camera.top=t,this.dLight.shadow.camera.bottom=-t,this.dLight.shadow.camera.updateProjectionMatrix()},e.prototype.setDLightShadowSize=function(t,e){this.dLight.shadow.mapSize.width=t,this.dLight.shadow.mapSize.height=e},e}(L.WebGLRenderer),ma=L.ShaderMaterial,va=L.UniformsUtils,ga=R,ya=function(t,e){ga.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof ma?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=va.clone(t.uniforms),this.material=new ma({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new ga.FullScreenQuad(this.material)};ya.prototype=Object.assign(Object.create(ga.prototype),{constructor:ya,render:function(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}});var _a=ya,Ea=R,Ta=function(t,e){Ea.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};Ta.prototype=Object.assign(Object.create(Ea.prototype),{constructor:Ta,render:function(t,e,n){var r,i,o=t.getContext(),a=t.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(r=0,i=1):(r=1,i=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.buffers.stencil.setFunc(o.ALWAYS,r,4294967295),a.buffers.stencil.setClear(i),a.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(o.EQUAL,1,4294967295),a.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.buffers.stencil.setLocked(!0)}});var xa=function(){Ea.call(this),this.needsSwap=!1};xa.prototype=Object.create(Ea.prototype),Object.assign(xa.prototype,{render:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}});var ba={MaskPass:Ta,ClearMaskPass:xa},Ma=L.Clock,Aa=L.LinearFilter,Sa=L.Mesh,Oa=L.OrthographicCamera,wa=L.PlaneBufferGeometry,La=L.RGBAFormat,Da=L.Vector2,Ca=L.WebGLRenderTarget,Pa=I.CopyShader,Na=_a,Ra=ba.MaskPass,Ia=ba.ClearMaskPass,Ua=function(t,e){if(this.renderer=t,void 0===e){var n={minFilter:Aa,magFilter:Aa,format:La,stencilBuffer:!1},r=t.getSize(new Da);this._pixelRatio=t.getPixelRatio(),this._width=r.width,this._height=r.height,(e=new Ca(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Na(Pa),this.clock=new Ma};Object.assign(Ua.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},isLastEnabledPass:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());var e,n,r=this.renderer.getRenderTarget(),i=!1,o=this.passes.length;for(n=0;n<o;n++)if(!1!==(e=this.passes[n]).enabled){if(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),e.needsSwap){if(i){var a=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),s.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Ra&&(e instanceof Ra?i=!0:e instanceof Ia&&(i=!1))}this.renderer.setRenderTarget(r)},reset:function(t){if(void 0===t){var e=this.renderer.getSize(new Da);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this._width=t,this._height=e;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)},setPixelRatio:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}});var Ba=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(Ba.prototype,{setSize:function(){},render:function(){}}),Ba.FullScreenQuad=function(){var t=new Oa(-1,1,1,-1,0,1),e=new wa(2,2),n=function(t){this._mesh=new Sa(e,t)};return Object.defineProperty(n.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(n.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),n}();var Fa=Ua,Ha=R,ka=function(t,e,n,r,i){Ha.call(this),this.scene=t,this.camera=e,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};ka.prototype=Object.assign(Object.create(Ha.prototype),{constructor:ka,render:function(t,e,n){var r,i,o,a=t.autoClear;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(r=t.getClearColor().getHex(),i=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(r,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=a}});var za=ka,Ga=L.Vector2,Wa={defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Ga(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","void SMAAEdgeDetectionVS( vec2 texcoord ) {","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );","\tvOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );","}","void main() {","\tvUv = uv;","\tSMAAEdgeDetectionVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {","\tvec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );","\tvec4 delta;","\tvec3 C = texture2D( colorTex, texcoord ).rgb;","\tvec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;","\tvec3 t = abs( C - Cleft );","\tdelta.x = max( max( t.r, t.g ), t.b );","\tvec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;","\tt = abs( C - Ctop );","\tdelta.y = max( max( t.r, t.g ), t.b );","\tvec2 edges = step( threshold, delta.xy );","\tif ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )","\t\tdiscard;","\tvec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;","\tt = abs( C - Cright );","\tdelta.z = max( max( t.r, t.g ), t.b );","\tvec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;","\tt = abs( C - Cbottom );","\tdelta.w = max( max( t.r, t.g ), t.b );","\tfloat maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );","\tvec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;","\tt = abs( C - Cleftleft );","\tdelta.z = max( max( t.r, t.g ), t.b );","\tvec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;","\tt = abs( C - Ctoptop );","\tdelta.w = max( max( t.r, t.g ), t.b );","\tmaxDelta = max( max( maxDelta, delta.z ), delta.w );","\tedges.xy *= step( 0.5 * maxDelta, delta.xy );","\treturn vec4( edges, 0.0, 0.0 );","}","void main() {","\tgl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );","}"].join("\n")},Va={defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Ga(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 3 ];","varying vec2 vPixcoord;","void SMAABlendingWeightCalculationVS( vec2 texcoord ) {","\tvPixcoord = texcoord / resolution;","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );","\tvOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );","}","void main() {","\tvUv = uv;","\tSMAABlendingWeightCalculationVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )","uniform sampler2D tDiffuse;","uniform sampler2D tArea;","uniform sampler2D tSearch;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[3];","varying vec2 vPixcoord;","#if __VERSION__ == 100","vec2 round( vec2 x ) {","\treturn sign( x ) * floor( abs( x ) + 0.5 );","}","#endif","float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {","\te.r = bias + e.r * scale;","\treturn 255.0 * texture2D( searchTex, e, 0.0 ).r;","}","float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 0.0, 1.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord -= vec2( 2.0, 0.0 ) * resolution;","\t\tif ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;","\t}","\ttexcoord.x += 0.25 * resolution.x;","\ttexcoord.x += resolution.x;","\ttexcoord.x += 2.0 * resolution.x;","\ttexcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);","\treturn texcoord.x;","}","float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 0.0, 1.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord += vec2( 2.0, 0.0 ) * resolution;","\t\tif ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;","\t}","\ttexcoord.x -= 0.25 * resolution.x;","\ttexcoord.x -= resolution.x;","\ttexcoord.x -= 2.0 * resolution.x;","\ttexcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );","\treturn texcoord.x;","}","float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 1.0, 0.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord += vec2( 0.0, 2.0 ) * resolution;","\t\tif ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;","\t}","\ttexcoord.y -= 0.25 * resolution.y;","\ttexcoord.y -= resolution.y;","\ttexcoord.y -= 2.0 * resolution.y;","\ttexcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );","\treturn texcoord.y;","}","float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {","\tvec2 e = vec2( 1.0, 0.0 );","\tfor ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {","\t\te = texture2D( edgesTex, texcoord, 0.0 ).rg;","\t\ttexcoord -= vec2( 0.0, 2.0 ) * resolution;","\t\tif ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;","\t}","\ttexcoord.y += 0.25 * resolution.y;","\ttexcoord.y += resolution.y;","\ttexcoord.y += 2.0 * resolution.y;","\ttexcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );","\treturn texcoord.y;","}","vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {","\tvec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;","\ttexcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );","\ttexcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;","\treturn texture2D( areaTex, texcoord, 0.0 ).rg;","}","vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {","\tvec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );","\tvec2 e = texture2D( edgesTex, texcoord ).rg;","\tif ( e.g > 0.0 ) {","\t\tvec2 d;","\t\tvec2 coords;","\t\tcoords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );","\t\tcoords.y = offset[ 1 ].y;","\t\td.x = coords.x;","\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).r;","\t\tcoords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );","\t\td.y = coords.x;","\t\td = d / resolution.x - pixcoord.x;","\t\tvec2 sqrt_d = sqrt( abs( d ) );","\t\tcoords.y -= 1.0 * resolution.y;","\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;","\t\tweights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );","\t}","\tif ( e.r > 0.0 ) {","\t\tvec2 d;","\t\tvec2 coords;","\t\tcoords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );","\t\tcoords.x = offset[ 0 ].x;","\t\td.x = coords.y;","\t\tfloat e1 = texture2D( edgesTex, coords, 0.0 ).g;","\t\tcoords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );","\t\td.y = coords.y;","\t\td = d / resolution.y - pixcoord.y;","\t\tvec2 sqrt_d = sqrt( abs( d ) );","\t\tcoords.y -= 1.0 * resolution.y;","\t\tfloat e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;","\t\tweights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );","\t}","\treturn weights;","}","void main() {","\tgl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );","}"].join("\n")},ja={uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Ga(1/1024,1/512)}},vertexShader:["uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","void SMAANeighborhoodBlendingVS( vec2 texcoord ) {","\tvOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );","\tvOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );","}","void main() {","\tvUv = uv;","\tSMAANeighborhoodBlendingVS( vUv );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tColor;","uniform vec2 resolution;","varying vec2 vUv;","varying vec4 vOffset[ 2 ];","vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {","\tvec4 a;","\ta.xz = texture2D( blendTex, texcoord ).xz;","\ta.y = texture2D( blendTex, offset[ 1 ].zw ).g;","\ta.w = texture2D( blendTex, offset[ 1 ].xy ).a;","\tif ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {","\t\treturn texture2D( colorTex, texcoord, 0.0 );","\t} else {","\t\tvec2 offset;","\t\toffset.x = a.a > a.b ? a.a : -a.b;","\t\toffset.y = a.g > a.r ? -a.g : a.r;","\t\tif ( abs( offset.x ) > abs( offset.y )) {","\t\t\toffset.y = 0.0;","\t\t} else {","\t\t\toffset.x = 0.0;","\t\t}","\t\tvec4 C = texture2D( colorTex, texcoord, 0.0 );","\t\ttexcoord += sign( offset ) * resolution;","\t\tvec4 Cop = texture2D( colorTex, texcoord, 0.0 );","\t\tfloat s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );","\t\tC.xyz = pow(C.xyz, vec3(2.2));","\t\tCop.xyz = pow(Cop.xyz, vec3(2.2));","\t\tvec4 mixed = mix(C, Cop, s);","\t\tmixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));","\t\treturn mixed;","\t}","}","void main() {","\tgl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );","}"].join("\n")},Ya={SMAAEdgesShader:Wa,SMAAWeightsShader:Va,SMAABlendShader:ja},Xa=L.LinearFilter,Za=L.NearestFilter,qa=L.RGBAFormat,Qa=L.RGBFormat,Ka=L.ShaderMaterial,Ja=L.Texture,$a=L.UniformsUtils,ts=L.WebGLRenderTarget,es=R,ns=Ya.SMAAEdgesShader,rs=Ya.SMAAWeightsShader,is=Ya.SMAABlendShader,os=function(t,e){es.call(this),this.edgesRT=new ts(t,e,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:Xa,format:Qa}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new ts(t,e,{depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!1,minFilter:Xa,format:qa}),this.weightsRT.texture.name="SMAAPass.weights";var n=this,r=new Image;r.src=this.getAreaTexture(),r.onload=function(){n.areaTexture.needsUpdate=!0},this.areaTexture=new Ja,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=r,this.areaTexture.format=Qa,this.areaTexture.minFilter=Xa,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;var i=new Image;i.src=this.getSearchTexture(),i.onload=function(){n.searchTexture.needsUpdate=!0},this.searchTexture=new Ja,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=i,this.searchTexture.magFilter=Za,this.searchTexture.minFilter=Za,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,this.uniformsEdges=$a.clone(ns.uniforms),this.uniformsEdges.resolution.value.set(1/t,1/e),this.materialEdges=new Ka({defines:Object.assign({},ns.defines),uniforms:this.uniformsEdges,vertexShader:ns.vertexShader,fragmentShader:ns.fragmentShader}),this.uniformsWeights=$a.clone(rs.uniforms),this.uniformsWeights.resolution.value.set(1/t,1/e),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new Ka({defines:Object.assign({},rs.defines),uniforms:this.uniformsWeights,vertexShader:rs.vertexShader,fragmentShader:rs.fragmentShader}),this.uniformsBlend=$a.clone(is.uniforms),this.uniformsBlend.resolution.value.set(1/t,1/e),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new Ka({uniforms:this.uniformsBlend,vertexShader:is.vertexShader,fragmentShader:is.fragmentShader}),this.needsSwap=!1,this.fsQuad=new es.FullScreenQuad(null)};os.prototype=Object.assign(Object.create(es.prototype),{constructor:os,render:function(t,e,n){this.uniformsEdges.tDiffuse.value=n.texture,this.fsQuad.material=this.materialEdges,t.setRenderTarget(this.edgesRT),this.clear&&t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialWeights,t.setRenderTarget(this.weightsRT),this.clear&&t.clear(),this.fsQuad.render(t),this.uniformsBlend.tColor.value=n.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(),this.fsQuad.render(t))},setSize:function(t,e){this.edgesRT.setSize(t,e),this.weightsRT.setSize(t,e),this.materialEdges.uniforms.resolution.value.set(1/t,1/e),this.materialWeights.uniforms.resolution.value.set(1/t,1/e),this.materialBlend.uniforms.resolution.value.set(1/t,1/e)},getAreaTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="},getSearchTexture:function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}});var as=os,ss=null,ls=[],cs=function(){k.carraySceneRender(this),ss=k.getCore(),this.name="scene.renderer",this.scene=null,this.camera=null,this.renderer=null,this.dpr=ne(),this.components=[],this.updateListeners=[],this.resizeListeners=[],this.clock=new L.Clock,this.composer=null,this.trickTools=new ia,this.updateFrameExecTimes=new Mt,this.fpsStableCallback=[],this.stopedRender=!1,this.chunksBoxHelper=new L.Group,this.chunksBoxHelper.name="chunks.box.helper",this.chunksBoxPlaneCollider=new L.Group,this.chunksBoxPlaneCollider.name="chunks.box.plane.collider",this.onResizeThrottle=new At,this.enableCss3dRender=!1,this.enableCss2dRender=!1,this.rendererStage=null,this._inited=!1,this._started=!1,Object.defineProperties(this,{textureMap:{get:function(){return ls}}}),this.init()};cs.prototype.init=function(){if(this._inited)n.warn(this.name+" inited!!!")();else{this._inited=!0,this.rendererStage=Jt();var t=new ra,e=new L.Scene;this.width=this.rendererStage.clientWidth,this.height=this.rendererStage.clientHeight,this.camera=t,this.scene=e}},cs.prototype.start=function(){this._started?n.warn(this.name+" started!!!")():(this._started=!0,this.createGLRender(),this.update())},cs.prototype.initComposer=function(t){var e=t.clientWidth,n=t.clientHeight;this.composer=new Fa(this.renderer),this.initRenderPass(e,n),this.initOutlinePass(e,n),this.initSMAA(e,n)},cs.prototype.initRenderPass=function(t,e){this.renderPass=new za(this.scene,this.camera),this.composer.addPass(this.renderPass)},cs.prototype.initOutlinePass=function(t,e){var n=new L.Vector2(t,e);this.outlinePass=new L.OutlinePass(n,this.scene,this.camera),this.outlinePass.edgeStrength=3,this.outlinePass.edgeThickness=1,this.outlinePass.visibleEdgeColor.set(59381),this.outlinePass.hiddenEdgeColor.set(59381),this.composer.addPass(this.outlinePass)},cs.prototype.initSMAA=function(t,e){this.smaaPass=new as(t,e),this.smaaPass.renderToScreen=!0,this.composer.addPass(this.smaaPass)},cs.prototype.createGLRender=function(){try{this.renderer=new fa({powerPreference:"high-performance",antialias:!1,alpha:Ce.Base.render_alpha}),this.css3dRenderer=new L.CSS3DRenderer,this.css2dRenderer=new L.CSS2DRenderer,this.renderer.setPixelRatio(this.dpr),this.setSize(this.rendererStage.clientWidth,this.rendererStage.clientHeight),this.glContext=this.renderer.getContext(),this.glContext.isWebGL2=!!window.WebGL2RenderingContext;var t=this.renderer.domElement;t.id="renderer-canvas",t.style.cssText="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;",this.rendererStage.appendChild(t);var e=this.css2dRenderer.domElement;e.id="renderer-css2d",this.rendererStage.appendChild(e),e.style.cssText="position:absolute;top:0;left:0;z-index:2;pointer-events:none;";var r=this.css3dRenderer.domElement;r.id="renderer-css3d",this.rendererStage.appendChild(r),r.style.cssText="position:absolute;top:0;left:0;z-index:2;pointer-events:none;"}catch(t){n.error("Unable to create a WebGL rendering gl")(),n.error(t)()}},cs.prototype.addComponent=function(t){n.debug(this.name+" add component",t.name)(),-1===this.components.findIndex((function(e){return t.name===e.name}))?(this.components.push(t),t.update&&this.updateListeners.push(t),t.setSize&&this.resizeListeners.push(t)):n.error("comp: <"+t.name+"> already added!")()},cs.prototype.removeComponent=function(t){n.info("%c"+this.name+" remove component, "+t.name,"color:#f00;")();var e=function(e){return e!==t};this.components=this.components.filter(e),this.updateListeners=this.updateListeners.filter(e),this.resizeListeners=this.resizeListeners.filter(e)},cs.prototype.showNewModelCover=function(){this.backgroundMesh&&(this.backgroundMesh.visible=!1)},cs.prototype.onResize=function(t,e){var n=this;this.onResizeThrottle.pipe(12.5,(function(){Ht.coreStateEngine.state[li.coreEvents.Events.CORE_RENDER_STAGE_RESIZE].data={width:t,height:e},Ht.coreStateEngine.state[li.coreEvents.Events.CORE_RENDER_STAGE_RESIZE].state=!0,n.setSize(t,e)}))},cs.prototype.setSize=function(t,e){this.renderWidth=t,this.renderHeight=e;var n=t/e;this.camera&&this.camera.setAspect(n),this.renderer&&this.renderer.setSize(t,e),this.css2dRenderer&&this.css2dRenderer.setSize(t,e),this.css3dRenderer&&this.css3dRenderer.setSize(t,e),this.composer&&this.composer.setSize(t,e),this.resizeListeners.forEach((function(n){n.setSize(t,e)}))},cs.prototype.addMagnifying=function(){var t=this,e=.5*this.rendererStage.clientWidth,n=.5*this.rendererStage.clientHeight,r=this.camera.position.clone();this.magnifyingCamera=new aa,this.magnifyingCamera.setPosition(r),$o.enabled.forEach((function(e){t.magnifyingCamera.layers.enable(e)})),$o.disabled.forEach((function(e){t.magnifyingCamera.layers.disable(e)})),this.magnifyingScene=new L.Scene,this.magnifyingCamera2=new L.OrthographicCamera(-e,e,n,-n,1,256),this.magnifyingCamera2.position.z=2,this.magnifying=new pa,this.magnifying.setPosition(e,n),this.magnifying.setScalar(100),this.magnifyingScene.add(this.magnifying)},cs.prototype.enableCss2d=function(){this.enableCss2dRender=!0},cs.prototype.disableCss2d=function(){this.enableCss2dRender=!1},cs.prototype.enableCss3d=function(){this.enableCss3dRender=!0},cs.prototype.disableCss3d=function(){this.enableCss3dRender=!1},cs.prototype.render=function(){!0===Ht.coreStateEngine.state[li.coreEvents.Events.ENABLE_MAGNIFYING_MODE].state?this.magnifyingRender():this.defaultRender(),this.enableCss2dRender&&this.css2DRender(),this.enableCss3dRender&&this.css3DRender()},cs.prototype.defaultRender=function(){this.composer?this.composer.render():this.renderer.render(this.scene,this.camera)},cs.prototype.css2DRender=function(){this.css2dRenderer.render(this.scene,this.camera)},cs.prototype.css3DRender=function(){this.css3dRenderer.render(this.scene,this.camera)},cs.prototype.magnifyingRender=function(){if(this.magnifyingCamera&&this.magnifyingCamera2&&this.magnifying){var t=256/this.dpr,e=this.rendererStage.clientWidth,n=this.rendererStage.clientHeight;this.renderer.autoClear=!1,this.renderer.setViewport(0,0,t,t),this.renderer.setScissor(0,0,t,t),this.renderer.render(this.scene,this.magnifyingCamera),this.renderer.copyFramebufferToTexture({x:0,y:0},this.magnifying.face.material.map),this.renderer.clear(),this.renderer.setViewport(0,0,e,n),this.renderer.setScissor(0,0,e,n),this.renderer.render(this.scene,this.camera),this.magnifyingScene&&this.magnifyingCamera2&&this.renderer.render(this.magnifyingScene,this.magnifyingCamera2),this.renderer.autoClear=!0}},cs.prototype.updateScreenSize=function(){var t=this.rendererStage.clientWidth,e=this.rendererStage.clientHeight;t==this.renderWidth&&e==this.renderHeight||this.onResize(t,e)},cs.prototype.updateComponents=function(t){for(var e=0,n=this.updateListeners.length;e<n;++e)this.updateListeners[e].update(t)},cs.prototype.deallocateCubeTexture=function(t){var e=this.glContext,n=this.renderer.properties.get(t);e.deleteTexture(n.__webglTexture)},cs.prototype.clear=function(){n.info(this.name+" clear")(),this.components=[],this.updateListeners=[],this.resizeListeners=[],this.destoryTextureMap(),F.setItem(this.name+" clear",!0)()},cs.prototype.add=function(t){this.scene&&this.scene.add(t)},cs.prototype.remove=function(t,e){var r=this.name+" remove";!1!==yt(t,r+" object")?this.scene.remove(t):n.error(r+" failure, reason: invalid object!, cmd:"+e)()},cs.prototype.destoryTextureMap=function(){for(var t=0,e=ls.length;t<e;++t){var n=ls[t];this.deallocateCubeTexture(n)}ls=[],F.setItem(this.name+".destoryTextureMap",!0)()},cs.prototype.destoryImageMap=function(){},cs.prototype.detectFpsStable=function(t){if(t>=30){if(0===this.fpsStableCallback.length)return;for(var e=0,r=this.fpsStableCallback.length;e<r;++e)this.fpsStableCallback[e]();this.fpsStableCallback=[]}else n.warn("fps too low!")()},cs.prototype.setSkyboxBackground=function(t){this.backgroundSkybox=t,this.scene.background=t},cs.prototype.hideSkyboxBackground=function(){this.scene.background=null},cs.prototype.showSkyboxBackground=function(){this.scene.background=this.backgroundSkybox},cs.prototype.update=function(){var t=this,e=null,r=function(r){if(r!==e){e=r;var i=t.clock.getDelta();t.onFrameUpdate(r,i)}else n.warn("invalid frame! ts: "+r)()};this.renderer.loopCallback=r,this.renderer.setAnimationLoop(r)},cs.prototype.onFrameUpdate=function(t,e){this.updateScreenSize(),this.updateComponents(e),li.renderEvents.update(e),ss.purepanoManager&&ss.purepanoManager.onFrameUpdate(),Nn.update(t),this.render()};var us=[];function hs(t){var e=this,r=0,i=0,o=0;this.start=function(){r=performance.now()},this.end=function(){i=performance.now(),o=i-r,us.push({cmd:t,"ts(ms)":o}),n.debug(t+".exec."+o+".ms")(),e.clear()},this.clear=function(){r=0,i=0,o=0}}function ps(){new hs("<find.target.pano>");var t=k.getCore(),e=null;if(t.player.closetWaypoint){var r=t.player.closetWaypoint.userData.id;e=t.player.model.panos.get(r)}else G.PANORAMA===t.player.mode?e=ji(t.player.getMouseDirection()):t.player.intersect&&(e=t.player.getClosestPanoWithinIntersect(t.player.intersect));if(!e)return n.warn("not find any pano?")(),null;if(G.PANORAMA!==t.player.mode){var i=t.player.control.camera.getWorldDirection(new L.Vector3).clone().setY(0).normalize(),o=e.position,a=Ge(o,(new L.Vector3).addVectors(o,i));e.currentQuaternion=a}return G.PANORAMA===t.player.mode&&(e.currentQuaternion=t.player.quaternion),!0!==e.enable?(n.warn("find target pano<"+e.id+">, but pano is disabled!")(),null):e}hs.print=function(){n.table(us)()};var ds,fs=null,ms=null,vs=((ds={})[G.DOLLHOUSE+"_flyto_"+G.PANORAMA]={duration:1500,model_alpha:{duration:.2,delay:.8},camera_matrix:{duration:.8,delay:0},camera_rotation:{duration:.5,delay:.5}},ds[G.FLOORPLAN+"_flyto_"+G.PANORAMA]={duration:1500,model_alpha:{duration:.2,delay:.8},camera_matrix:{duration:1,delay:0},camera_rotation:{duration:.5,delay:.5}},ds[G.PANORAMA+"_flyto_"+G.DOLLHOUSE]={duration:1500,model_alpha:{duration:.2,delay:0},camera_matrix:{duration:1,delay:0},camera_rotation:{duration:.5,delay:0}},ds[G.FLOORPLAN+"_flyto_"+G.DOLLHOUSE]={duration:1500,model_alpha:{duration:0,delay:0},camera_matrix:{duration:1,delay:0},camera_rotation:{duration:1,delay:0}},ds[G.PANORAMA+"_flyto_"+G.FLOORPLAN]={duration:1500,model_alpha:{duration:.2,delay:0},camera_matrix:{duration:.5,delay:0},camera_rotation:{duration:.5,delay:0}},ds[G.DOLLHOUSE+"_flyto_"+G.FLOORPLAN]={duration:1500,model_alpha:{duration:0,delay:0},camera_matrix:{duration:1,delay:0},camera_rotation:{duration:1,delay:0}},ds),gs=null;function ys(t,e,n,r,i){if(void 0===i&&(i=function(){}),null===gs&&(gs=k.getCore()),gs.pure3D)i();else var o=r.duration*n,a=r.delay*n,s=gs.player.model.AlphaMap[e],l=gs.player.model.AlphaMap[t],c=new Nn.Tween({value:0}).to({value:1}).delay(a).duration(o).easing(Nn.Easing.Linear.None).onStart((function(t){})).onUpdate((function(e){var n=e.value,r=s*(1-n)+l*n,i=1-r;gs.player.model.setAlpha(r),G.PANORAMA===t&&gs.player.model.skybox.setOpacity(i,"fly.to.new.mode.model.alpha.animation")})).onComplete((function(t){c.stop(),i()})).onStop((function(t){c=null})).start()}var _s=null;function Es(t,e,n,r){void 0===r&&(r=function(){}),null===_s&&(_s=k.getCore());var i="fly.to.new.mode.camera.position.animation";_s.player.controls[e];var o=_s.player.controls[t],a=_s.player.cameras[e],s=_s.player.cameras[t],l=(new L.Vector3).copy(a.getPosition()),c=(new L.Vector3).copy(o.targetPosition),u=n,h="on"===Kt("smb"),p=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Quadratic.InOut).delay(0).duration(u).onUpdate((function(t){var e=t.value,n=(new L.Vector3).copy(l).lerp(c,e);h?_s.player.setPosition(n,i):s.setPosition(n,i)})).onComplete((function(t){p.stop(),r()})).onStop((function(t){p=null})).start()}var Ts="fly.to.new.mode.camera.quaternion.animation",xs=null;function bs(t,e,n,r,i){void 0===i&&(i=function(){}),null===xs&&(xs=k.getCore()),xs.player.controls[e];var o=xs.player.controls[t],a=xs.player.cameras[e],s=xs.player.cameras[t],l=(new L.Quaternion).copy(a.getQuaternion()),c=(new L.Quaternion).copy(o.targetQuaternion),u=r.duration*n,h=r.delay*n,p="on"===Kt("smb"),d=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Quadratic.InOut).delay(h).duration(u).onStart((function(t){})).onUpdate((function(t){var e=t.value,n=(new L.Quaternion).copy(l).slerp(c,e);p?xs.player.setQuaternion(n,Ts):s.setQuaternion(n,Ts)})).onComplete((function(t){d.stop(),i()})).onStop((function(t){d=null})).start()}var Ms=null;function As(t,e,n,r,i){void 0===i&&(i=function(){}),null===Ms&&(Ms=k.getCore());var o=Ms.player.cameras[t],a=r.duration*n,s=r.delay*n,l=Ms.sceneRender.camera.projectionMatrix,c=o.projectionMatrix,u=l.clone(),h={};h[G.PANORAMA]=Nn.Easing.Cubic.In,h[G.DOLLHOUSE]=Nn.Easing.Quadratic.InOut,h[G.FLOORPLAN]=Nn.Easing.Cubic.Out;var p=new Nn.Tween({value:0}).to({value:1}).easing(h[t]).delay(s).duration(a).onStart((function(t){})).onUpdate((function(t){for(var e=t.value,n=l.elements,r=u.elements,i=c.elements,o=0;o<16;++o)n[o]=r[o]*(1-e)+i[o]*e})).onComplete((function(t){p.stop(),i()})).onStop((function(t){p=null})).start()}var Ss=null;function Os(t){void 0===t&&(t={}),Ss=k.getCore();var e=G.DOLLHOUSE,r="switch to "+e+" failure";if(!0!==Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_TO_NEW_MODE].state)if(e!==Ss.player.mode){Ht.actionStateEngine.state[li.actionEvents.Events.ACTION_MODE_DOLLHOUSE].state=!0,Ss.player.intersect=null,Ss.player.control.stopRotation();var i=Ss.player.mode,o=vs[i+"_flyto_"+e].duration,a=Ss.player.controls[e],s=a.getDefaultPose(),l=t.position?(new L.Vector3).copy(t.position):(new L.Vector3).copy(s.position),c=t.quaternion?(new L.Quaternion).copy(t.quaternion):(new L.Quaternion).copy(s.quaternion),u=t.target?(new L.Vector3).copy(t.target):(new L.Vector3).copy(s.target),h=t.camera_zoom||a.config.defaultZoom;t.distance_zoom,t.progress;var p=t.complete||function(){};a.targetPosition=l,a.targetQuaternion=c,a.setZoom(h),G.PANORAMA===i&&(Ss.player.currentPano.exit(),Ss.player.currentPano=null),function(t,e,n,r){void 0===r&&(r=function(){}),Ss.player.setMode(G.TRANSITIONING),Ss.player.model.setMode(G.TRANSITIONING,"flyToNewModeAnimation"),!Ss.player.model.skybox||Ss.player.model.skybox.setOpacity(0);var i=new St(4,(function(){r()}));ys(t,e,n,vs[e+"_flyto_"+t].model_alpha,(function(){i.record("fly.to.new.mode.model.alpha.animation.complete")})),Es(t,e,n,(function(){i.record("fly.to.new.mode.camera.position.animation.complete")})),bs(t,e,n,vs[e+"_flyto_"+t].camera_rotation,(function(){i.record("fly.to.new.mode.camera.quaternion.animation.complete")})),As(t,0,n,vs[e+"_flyto_"+t].camera_matrix,(function(){i.record("fly.to.new.mode.camera.matrix.animation.complete")}))}(e,i,o,(function(){var t="switch to "+e+" animation complete";n.info(""+t)(),a.reset(),a.resetPose(a.targetPosition,a.targetQuaternion,u,h,t),Ss.sceneRender.camera.fov!==a.camera.fov&&Ss.sceneRender.camera.setFov(a.camera.fov),Ss.sceneRender.camera.zoom!==a.camera.zoom&&Ss.sceneRender.camera.setZoom(a.camera.zoom),Ss.player.setMode(e),Ss.player.model.setMode(e,"fly.to.dollhouse.mode");var r=Object.create(null);r.current_mode=e,r.prev_mode=i,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].data=r,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].state=!0,p()}))}else n.warn(r+", reason: has been in "+e)();else n.warn(r+", reason: disabled switch mode")()}var ws=null,Ls=null;function Ds(t,e,n,r,i){if(void 0===i&&(i=function(){}),null===ws&&(ws=k.getCore()),null===Ls&&(Ls=k.getModel()),ws.pure3D)i();else var o=r.duration*n,a=r.delay*n,s=new Nn.Tween({value:.1}).to({value:1}).delay(a).duration(o).easing(Nn.Easing.Linear.None).onStart((function(t){})).onUpdate((function(t){Ls.chunks.forEach((function(e){1!==e.getOpacity()&&e.setOpacity(t.value,"switch.to.panorama.mode.model.opacity.animation")}))})).onComplete((function(t){s.stop(),i()})).onStop((function(t){s=null})).start()}var Cs=null;function Ps(t){void 0===t&&(t={});var e="switch to panorama mode";if(null===Cs&&(Cs=k.getCore()),!0!==Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_TO_NEW_MODE].state)if(G.PANORAMA!==Cs.player.mode){var r=t.pano,i=t.zoom||de.defaultZoom,o=t.duration,a=t.onPanoLoaded||function(){};t.progress;var s=t.complete||function(){};i>de.zoom.max&&(n.error(e+" zoom invalid! will be reset to max")(),i=de.zoom.max),i<de.zoom.min&&(n.error(e+" zoom invalid! will be reset to min")(),i=de.zoom.min),Ht.actionStateEngine.state[li.actionEvents.Events.ACTION_MODE_PANORAMA].state=!0,Cs.player.control.stopRotation(),Cs.player.control.disable("switch.to.panorama.mode");var l=r.lookat_target;l&&(r.currentQuaternion=Ge(r.position,l));var c=Cs.player.controls[G.PANORAMA];c.targetPosition=r.position,c.targetQuaternion=r.currentQuaternion,c.setZoom(i);var u=function(){a();var t=Cs.player.mode,n=void 0!==o?o:vs[t+"_flyto_"+G.PANORAMA].duration;Cs.player.model.setProjectedPanos(r,r,void 0,"switch.to.panorama.mode"),function(t,e,n){void 0===n&&(n=function(){});var r=Cs.player.controls[G.PANORAMA];Cs.player.setMode(G.TRANSITIONING),Cs.player.model.setMode(G.TRANSITIONING,"flyToNewModeAnimation");var i=new St(5,(function(){r.lookAtRotation(r.camera.getQuaternion()),n()}));ys(G.PANORAMA,t,e,vs[t+"_flyto_"+G.PANORAMA].model_alpha,(function(){i.record("fly.to.new.mode.model.alpha.animation.complete")})),Ds(0,0,e,vs[t+"_flyto_"+G.PANORAMA].model_alpha,(function(){i.record("switch.to.panorama.mode.model.opacity.animation.complete")})),Es(G.PANORAMA,t,e,(function(){i.record("fly.to.new.mode.camera.position.animation.complete")})),bs(G.PANORAMA,t,e,vs[t+"_flyto_"+G.PANORAMA].camera_rotation,(function(){i.record("fly.to.new.mode.camera.quaternion.animation.complete")})),As(G.PANORAMA,0,e,vs[t+"_flyto_"+G.PANORAMA].camera_matrix,(function(){i.record("fly.to.new.mode.camera.matrix.animation.complete")}))}(t,n,(function(){Cs.sceneRender.camera.setFov(_e.getCameraFov()),Cs.sceneRender.camera.setZoom(i),Cs.player.targetPano=null,Cs.player.currentPano=r,Cs.player.setMode(G.PANORAMA),Cs.player.model.setMode(G.PANORAMA,e),r.enter();var n=Object.create(null);n.current_mode=G.PANORAMA,n.prev_mode=t,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANORAMA_MODE_COMPLETE].data=n,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANORAMA_MODE_COMPLETE].state=!0,s()}))};Cs.pure3D?u():r.checkAndWaitLoad(void 0,(function(){u()}))}else n.warn(e+" failure, reason: has been in "+G.PANORAMA)();else n.warn(e+" failure, reason: disabled switch mode")()}var Ns=null;function Rs(t){void 0===t&&(t=function(){}),Ns=k.getCore();var e=G.FLOORPLAN,r="switch to "+e+" failure";if(e!==Ns.player.mode)if(!0!==Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_TO_NEW_MODE].state){Ht.actionStateEngine.state[li.actionEvents.Events.ACTION_MODE_FLOORPLAN].state=!0,Ns.player.intersect=null,Ns.player.control.stopRotation();var i=Ns.player.mode,o=Ns.player.controls[e],a=o.getInitPose();o.targetPosition=a.position,o.targetQuaternion=a.quaternion;var s=vs[i+"_flyto_"+e].duration;G.PANORAMA===i&&(Ns.player.currentPano.exit(),Ns.player.currentPano=null),function(t,e,n,r){void 0===r&&(r=function(){});var i=Ns.player.controls[G.FLOORPLAN];Ns.player.setMode(G.TRANSITIONING),Ns.player.model.setMode(G.TRANSITIONING,"flyToNewModeAnimation"),!Ns.player.model.skybox||Ns.player.model.skybox.setOpacity(0),i.zoomToContain(Ns.player.model.size),i.updateZoom();var o=new St(4,(function(){r()}));ys(t,e,n,vs[e+"_flyto_"+t].model_alpha,(function(){o.record("fly.to.new.mode.model.alpha.animation.complete")})),Es(t,e,n,(function(){o.record("fly.to.new.mode.camera.position.animation.complete")})),bs(t,e,n,vs[e+"_flyto_"+t].camera_rotation,(function(){o.record("fly.to.new.mode.camera.quaternion.animation.complete")})),As(t,0,n,vs[e+"_flyto_"+t].camera_matrix,(function(){o.record("fly.to.new.mode.camera.matrix.animation.complete")}))}(e,i,s,(function(){var r="switch to "+e+" animation complete";n.info(""+r)(),o.reset(),o.resetPose(r),Ns.player.setMode(e),Ns.player.model.setMode(e,r);var a=Object.create(null);a.current_mode=e,a.prev_mode=i,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].data=a,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].state=!0,t()}))}else n.warn(r+", reason: disabled switch mode")();else n.warn(r+", reason: has been in "+e)()}var Is=null,Us=function(t){function e(){t.call(this),Is=k.getCore(),this.name="DollhouseCamera",this.fov=ye.dollhouseFOV,this.aspect=te(),this.near=ye.dollhouseNear,this.far=ye.dollhouseFar,this.raycaster=new L.Raycaster,this.raycaster.layers.enable(ve.COLLIDER),this.layers.disableAll()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateAspect=function(t,e){this.aspect=t,this.updateProjectionMatrix()},e.prototype.getAspect=function(){return this.aspect},e.prototype.setFov=function(t){this.fov=t,this.updateProjectionMatrix()},e.prototype.getFov=function(){return this.fov},e.prototype.setZoom=function(t){this.name,this.zoom=t,this.updateProjectionMatrix();var e=Object.create(null);e.zoom=t,e.mode=G.DOLLHOUSE},e.prototype.setPosition=function(t,e){this.position.copy(t),this.updateMatrixWorld(),Is.player.setPosition(t,this.name+" "+e)},e.prototype.setPositionScalar=function(t){this.position.multiplyScalar(t),this.updateMatrixWorld()},e.prototype.setQuaternion=function(t,e){this.quaternion.copy(t),this.updateMatrixWorld(),Is.player.setQuaternion(t,this.name+" "+e)},e.prototype.getPosition=function(){return this.position.clone()},e.prototype.getQuaternion=function(){return this.quaternion.clone()},e.prototype.getProjectionMatrix=function(){return this.projectionMatrix.clone()},e.prototype.lookAtTarget=function(t,e){var n=this.name+" lookAtTarget",r=new L.Vector3(t.x,t.y,t.z);this.lookAt(r),this.setQuaternion(this.getQuaternion(),n+" "+e)},e.prototype.getDirection=function(){var t=(new L.Vector3).copy(Ie.FORWARD);return t.applyQuaternion(this.quaternion),t},e.prototype.getLookAtTarget=function(){var t=new L.Vector3,e=this.getDirection();return t.addVectors(this.position,e),t},e.prototype.getIntersectWithinModel=function(){this.name;var t=null,e=Is.player.model.getValidColliders(),n=this.position,r=this.getDirection();this.raycaster.set(n,r);var i=this.raycaster.intersectObjects(e);if(0<i.length){var o=i[0];t={point:o.point,normal:o.face.normal,distance:o.distance}}return t},e.prototype.getIntersectWithinModelControlPlane=function(){this.name;var t=null,e=Is.player.model.controlPlanes,n=this.position,r=this.getDirection();this.raycaster.set(n,r);var i=this.raycaster.intersectObjects(e),o=Is.player.model.center,a=[];if(0<i.length){i.forEach((function(t,e){var n=t.point.distanceTo(o);a.push({distance_to_model:n,ditance:t.distance,intersect_point:t.point,intersect_normal:t.face.normal})})),a.sort((function(t,e){return t.distance_to_model-e.distance_to_model}));var s=a[0];t={point:s.intersect_point,normal:s.intersect_normal,distance:s.distance}}return t},e}(L.PerspectiveCamera),Bs={orthoBase:10,orthoFar:5e3,orthoNear:1},Fs=null,Hs=function(t){function e(){t.call(this),Fs=k.getCore(),this.name="FloorplanCamera";var e=te();this.left=-Bs.orthoBase,this.right=Bs.orthoBase,this.top=Bs.orthoBase/e,this.bottom=-Bs.orthoBase/e,this.near=Bs.orthoNear,this.far=Bs.orthoFar,this.updateAspect(e,"self"),this.layers.disableAll(),function(t){Object.defineProperties(t,{defaultConfig:{get:function(){return Bs}}})}(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateAspect=function(t,e){this.aspect=t,this.top=Bs.orthoBase/t,this.bottom=-Bs.orthoBase/t,this.updateProjectionMatrix()},e.prototype.getAspect=function(){return this.aspect},e.prototype.setZoom=function(t,e){this.zoom=t,this.updateProjectionMatrix()},e.prototype.setPosition=function(t,e){this.position.copy(t),this.updateMatrixWorld(),Fs.player.setPosition(t,this.name+" "+e)},e.prototype.setQuaternion=function(t,e){var n=this.name+" set quaternion";this.quaternion.copy(t),this.updateMatrixWorld(),Fs.player.setQuaternion(t,n+" "+e)},e.prototype.getPosition=function(){return this.position.clone()},e.prototype.getQuaternion=function(){return this.quaternion.clone()},e.prototype.getProjectionMatrix=function(){return this.projectionMatrix.clone()},e.prototype.getDirection=function(){return this.getWorldDirection(new L.Vector3)},e.prototype.getLookAtTarget=function(){var t=new L.Vector3,e=this.getDirection();return t.addVectors(this.position,e),t},e.prototype.lookAtTarget=function(t,e){this.name,this.lookAt(t.x,t.y,t.z),this.setQuaternion(this.getQuaternion())},e.prototype.updateZoom=function(t){this.name,this.zoomScale=t,this.left=-Bs.orthoBase*t,this.right=Bs.orthoBase*t,this.top=Bs.orthoBase*t/this.aspect,this.bottom=-Bs.orthoBase*t/this.aspect,this.updateProjectionMatrix()},e.prototype.horizontalViewRotate=function(t){var e=this.name+" horizontalViewRotate",n=this.getDirection();this.rotateOnWorldAxis(n,t),this.setQuaternion(this.getQuaternion(),e)},e.prototype.horizontalViewRotate2=function(t){var e=this.name+" horizontalViewRotate2";this.rotateOnWorldAxis(Ie.DOWN,t),this.setQuaternion(this.getQuaternion(),e)},e.prototype.setLayers=function(t){this.layers.set(t)},e}(L.OrthographicCamera);document.getElementById("handle-event2");var ks=new L.Vector3(1,1,1).normalize();new Mt;var zs=null,Gs=0;re()&&(Gs=.2),ie()&&(Gs=.4);var Ws=new At,Vs=new At,js=null,Ys=function(t){js=k.getCore(),zs=Jt(),this.name="dollhouse.control",this.enabled=!1,this.camera=t,this.rotateSpeed=1,this.autoRotateSpeed=1,this.phiDelta=0,this.thetaDelta=0,this.zoomSpeed=.1,this.moveSpeed=1.2,this.lon=0,this.lat=0,this.lastMoveTime=0,this.updateDelta=0,this.cameraZoomEnabled=!1,this.distanceZoomEnabled=!1,this.target=new L.Vector3,this.targetBounds=new L.Box3,this.rotationAcceleration=new L.Vector2,this.rotationSpeed=new L.Vector2,this.rotateStart=new L.Vector2,this.rotateEnd=new L.Vector2,this.rotateDelta=new L.Vector2,this.offset=new L.Vector3,this.panAcceleration=new L.Vector2,this.panVector=new L.Vector3,this.panStart=new L.Vector2,this.panEnd=new L.Vector2,this.panDelta=new L.Vector2,this.panOffset=new L.Vector3,this.originZoom=null,this.config=fe,fe.defaultZoom=_e.getDollhouseCameraZoom(),fe.defaultDistanceZoom=_e.getDollhouseDistanceZoom(),this.onEvents()};Ys.prototype.pan=function(t,e){var n=this.camera.getPosition().sub(this.target).length();n*=Math.tan(this.camera.fov/2*Math.PI/180),this.panLeft(2*t*n/zs.clientWidth),this.panUp(-2*e*n/zs.clientHeight),Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_DRAG_MOVING].state=!0},Ys.prototype.getOffsetLength=function(){return this.offset.length()},Ys.prototype.setZoomBounds=function(t){},Ys.prototype.resetRanges=function(){},Ys.prototype.setBounds=function(t){this.targetBounds=t},Ys.prototype.rotateLeft=function(t){void 0===t&&(t=this.getAutoRotationAngle()),this.thetaDelta-=t},Ys.prototype.rotateUp=function(t){void 0===t&&(t=this.getAutoRotationAngle()),this.phiDelta-=t},Ys.prototype.panLeft=function(t){var e=this.name+".panLeft",n=this.camera.matrix.elements;this.panOffset.set(n[0],0,n[2]).normalize(),this.panOffset.multiplyScalar(-t),this.panVector.add(this.panOffset),this.offset.copy((new L.Vector3).subVectors(this.camera.getPosition(),this.target)),this.target.add(this.panVector);var r=(new L.Vector3).addVectors(this.target,this.offset);this.camera.setPosition(r),this.camera.lookAtTarget(this.target,e),this.panVector.set(0,0,0)},Ys.prototype.panUp=function(t){var e=this.name+".panUp",n=this.camera.matrix.elements;this.panOffset.set(n[4],0,n[6]).normalize(),this.panOffset.multiplyScalar(-t),this.panVector.add(this.panOffset),this.offset.copy((new L.Vector3).subVectors(this.camera.getPosition(),this.target)),this.target.add(this.panVector);var r=(new L.Vector3).addVectors(this.target,this.offset);this.camera.setPosition(r),this.camera.lookAtTarget(this.target,e),this.panVector.set(0,0,0)},Ys.prototype.getLonLat=function(){this.name;var t=this.camera.getPosition();this.offset.copy((new L.Vector3).subVectors(t,this.target));var e=Math.atan2(this.offset.x,this.offset.z),n=Math.atan2(Math.sqrt(this.offset.x*this.offset.x+this.offset.z*this.offset.z),this.offset.y),r=L.Math.degToRad(fe.minPolarAngle),i=L.Math.degToRad(fe.maxPolarAngle);return e+=this.thetaDelta,n+=this.phiDelta,n=Math.max(r,Math.min(i,n)),{lon:e,lat:n=Math.max(1e-6,Math.min(Math.PI-1e-6,n))}},Ys.prototype.update=function(t){void 0===t&&(t=0),this.updateDelta=t},Ys.prototype.updateCamera=function(t,e){var n=this.name+" update camera",r=this.camera.getPosition();this.lon=t,this.lat=e;var i=r.distanceTo(this.target);this.target.add(this.panVector),this.offset.x=i*Math.sin(this.lat)*Math.sin(this.lon),this.offset.y=i*Math.cos(this.lat),this.offset.z=i*Math.sin(this.lat)*Math.cos(this.lon);var o=(new L.Vector3).addVectors(this.target,this.offset);this.camera.setPosition(o),this.camera.lookAtTarget(this.target,n)},Ys.prototype.updateRotationSpeed=function(){this.name,this.rotationSpeed.multiplyScalar(1-Gs).addScaledVector(this.rotationAcceleration,.15*this.updateDelta),this.rotateLeft(-this.rotationSpeed.x),this.rotateUp(this.rotationSpeed.y);var t=this.getLonLat(),e=t.lon,n=t.lat;this.updateCamera(e,n,"dollhouse.update.rotation.speed"),this.thetaDelta=0,this.phiDelta=0,this.panVector.set(0,0,0)},Ys.prototype.getAutoRotationAngle=function(){return this.autoRotateSpeed*(Math.PI/180)},Ys.prototype.startRotation=function(t,e,n){this.name,this.rotateEnd.set(t,e),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateLeft(2*Math.PI*this.rotateDelta.x/zs.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/zs.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd),this.lastMoveTime=n,this.updateRotationSpeed(),Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_ROTATE].data={mode:G.DOLLHOUSE,quaternion:this.camera.getQuaternion()},Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_ROTATE].state=!0},Ys.prototype.stopRotation=function(t){this.name,this.rotationSpeed.set(0,0),this.rotationAcceleration.set(0,0),this.panAcceleration.set(0,0),Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_ROTATE_STOP].data={mode:G.DOLLHOUSE},Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_ROTATE_STOP].state=!0},Ys.prototype.lookAt=function(t,e){var n=this.name+" look at";this.camera.lookAtTarget(t,n)},Ys.prototype.lookAtRotation=function(t,e){this.name;var n=ze(t),r=(new L.Vector3).addVectors(this.camera.getPosition(),n);this.lookAt(r,this.name+" "+e+" lookAtRotation")},Ys.prototype.setZoom=function(t,e){var r=this.name+" set zoom";t<this.config.minZoom||t>this.config.maxZoom?n.error(r+" failure, reason: over limit!")():(this.camera.setZoom(t),!0===this.enabled&&js.sceneRender.camera.setZoom(t),Re.SyncData[Re.SyncEvents.DOLLHOUSE_CAMERA_ZOOM].state=!0,Re.SyncData[Re.SyncEvents.DOLLHOUSE_CAMERA_ZOOM].value=t)},Ys.prototype.setDistanceZoom=function(t){var e=(new L.Vector3).copy(this.camera.getPosition()),n=(new L.Vector3).copy(this.target),r=e.divideScalar(t),i=n.divideScalar(t);this.camera.setPosition(r),this.target.copy(i)},Ys.prototype.zoomTo=function(t){var e=this.camera.zoom+t,n=e;e<=fe.minZoom&&(n=fe.minZoom),e>=fe.maxZoom&&(n=fe.maxZoom),this.setZoom(n),Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_ZOOM_CHANGED].data=n,Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_ZOOM_CHANGED].state=!0},Ys.prototype.moveTo=function(t){this.name,this.camera.setPosition(t);var e=this.camera.getIntersectWithinModel()||this.camera.getIntersectWithinModelControlPlane();e&&this.target.copy(e.point),Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CHANGED].data=null,Ht.actionStateEngine.state[li.actionEvents.Events.DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CHANGED].state=!0},Ys.prototype.setFov=function(t,e){n.info(this.name+" set fov, fov:"+t+", cmd:"+e)(),this.camera.setFov(t)},Ys.prototype.resetZoomOfForce=function(t,e){void 0===t&&(t=fe.defaultZoom);var r=this.name+" reset zoom force";n.error(r+", zoom: "+t+", cmd: "+e)(),this.setZoom(t,r)},Ys.prototype.resetPose=function(t,e,n,r,i){var o=this.name+" reset pose";this.setZoom(r),this.camera.setPosition(t,o),this.lookAtRotation(e),this.target.copy(n);var a=this.getLonLat(),s=a.lon,l=a.lat;this.lon=s,this.lat=l},Ys.prototype.reset=function(t){this.name,this.target.set(0,0,0),this.offset.set(0,0,0),this.panOffset.set(0,0,0),this.panVector.set(0,0,0),this.panDelta.set(0,0),this.panStart.set(0,0),this.panEnd.set(0,0),this.panAcceleration.set(0,0),this.rotateDelta.set(0,0),this.rotateStart.set(0,0),this.rotateEnd.set(0,0),this.rotationSpeed.set(0,0),this.rotationAcceleration.set(0,0)},Ys.prototype.getDefaultPose=function(t){void 0===t&&(t={}),this.name;var e=t.zoom||1,n=t.model_id,r=js.modelManager.getModel(n)||js.player.model,i=r.center,o=r.boundingBox.min.distanceTo(r.boundingBox.max),a=(new L.Vector3).addScaledVector(ks,o),s=(new L.Vector3).addVectors(i,a);return{position:s=(new L.Vector3).copy(s).addScaledVector(ks.clone().negate(),o-o/e),quaternion:Ge(s,i),target:i}},Ys.prototype.getCurrentPose=function(){var t=this.camera.getPosition(),e=this.camera.getQuaternion(),n=this.target;return{position:Object.assign(Object.create(null),t),target:Object.assign(Object.create(null),n),quaternion:Object.assign(Object.create(null),{x:e.x,y:e.y,z:e.z,w:e.w})}},Ys.prototype.disable=function(t){var e=this.name+" disable, cmd:"+t;!1===this.enabled&&n.warn(e+" failure, reason: is disabled!, cmd:"+t)(),this.dealtEvents("removeEventListener",e),this.enabled=!1},Ys.prototype.enable=function(t){var e=this.name+" enable, cmd:"+t;!0===this.enabled&&n.warn(e+" failure, reason: is enabled!, cmd:"+e)(),this.dealtEvents("addEventListener",e),this.enabled=!0},Ys.prototype.computeDynamicMoveSpeed=function(t){this.moveSpeed=.1*t,!0===ie()&&(this.moveSpeed=.05*t)},Ys.prototype.getDistanceToModel=function(){var t=js.player.model.center;return this.camera.position.distanceTo(t)},Ys.prototype.zoomIn=function(){if(this.name,!0===this.cameraZoomEnabled&&this.zoomTo(this.zoomSpeed),!0===this.distanceZoomEnabled){var t=this.camera.position,e=js.player.model.center,n=(new L.Vector3).copy(e);!1===ie()&&(js.player.intersect?n.copy(js.player.intersect.point):n.copy(js.player.model.getIntersectWithinControlPlane()));var r=t.distanceTo(n);this.computeDynamicMoveSpeed(r);var i=(new L.Vector3).subVectors(n,t).normalize(),o=(new L.Vector3).copy(t).addScaledVector(i,this.moveSpeed);if(o.distanceTo(n)<fe.minMoveDistance)return;this.moveTo(o)}},Ys.prototype.zoomOut=function(){if(this.name,!0===this.cameraZoomEnabled&&this.zoomTo(-this.zoomSpeed),!0===this.distanceZoomEnabled){var t=this.camera.position,e=js.player.model.center,n=(new L.Vector3).copy(e);!1===ie()&&(js.player.intersect?n.copy(js.player.intersect.point):n.copy(js.player.model.getIntersectWithinControlPlane()));var r=t.distanceTo(n);this.computeDynamicMoveSpeed(r);var i=(new L.Vector3).subVectors(n,t).normalize(),o=(new L.Vector3).copy(t).addScaledVector(i,-this.moveSpeed);if(o.distanceTo(n)>fe.maxMoveDistance)return;this.moveTo(o)}},Ys.prototype.onEvents=function(){var t=this;this.onMouseLeftButtonDown=function(e){var n=e.x,r=e.y;t.rotateStart.set(n,r)},this.onMouseMoveStop=function(){},this.onMouseLeftButtonUp=function(e){t.rotateDelta.set(0,0),t.stopRotation("on.mouse.left.button.up")},this.onMouseLeftButtonDownWithinMove=function(e){Ws.pipe(16.6,(function(){var n=e.x,r=e.y,i=e.ts;t.startRotation(n,r,i)}))},this.onMouseRightButtonDown=function(e){var n=e.x,r=e.y;t.rotationSpeed.set(0,0),t.panStart.set(n,r)},this.onMouseRightButtonDownWithinMove=function(e){Vs.pipe(16.6,(function(){var n=e.x,r=e.y;t.panEnd.set(n,r),t.panDelta.subVectors(t.panEnd,t.panStart),t.pan(t.panDelta.x,t.panDelta.y),t.panStart.copy(t.panEnd)}))},this.onMouseRightButtonUp=function(t){},this.onMouseWheelForward=function(e){!0!==Ht.coreStateEngine.state[li.coreEvents.Events.DISABLE_ZOOM_CONTROL].state&&t.zoomIn()},this.onMouseWheelBackward=function(e){!0!==Ht.coreStateEngine.state[li.coreEvents.Events.DISABLE_ZOOM_CONTROL].state&&t.zoomOut()},this.onHandleTouchStart=function(e){t.originZoom=t.camera.zoom},this.onHandleSingleTouchStart=function(e){var n=e.x,r=e.y;t.rotateStart.set(n,r)},this.onHandleSingleTouchStartChanged=function(e){var n=e.x,r=e.y;t.rotateStart.set(n,r)},this.onHandleSingleTouchMove=function(e){var n=e.x,r=e.y;t.startRotation(n,r)},this.onHandleSingleTouchStartOfLongPress=function(e){var n=e.x,r=e.y;t.rotationSpeed.set(0,0),t.panStart.set(n,r)},this.onHandleSingleTouchMoveOfLongPress=function(e){var n=e.x,r=e.y;t.panEnd.set(n,r),t.panDelta.subVectors(t.panEnd,t.panStart),t.pan(t.panDelta.x,t.panDelta.y),t.panStart.copy(t.panEnd)},this.onHandleSingleTouchEnd=function(e){t.rotateDelta.set(0,0),t.stopRotation("on handle single touch end")},this.onHandleDoubleTouchZoomIn=function(e){t.name,t.zoomIn()},this.onHandleDoubleTouchZoomOut=function(e){t.name,t.zoomOut()}},Ys.prototype.dealtEvents=function(t,e){lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_DOWN,this.onMouseLeftButtonDown),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_UP,this.onMouseLeftButtonUp),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_RIGHT_BUTTON_DOWN,this.onMouseRightButtonDown),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_RIGHT_BUTTON_UP,this.onMouseRightButtonUp),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE,this.onMouseLeftButtonDownWithinMove),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_RIGHT_BUTTON_DOWN_WITHIN_MOVE,this.onMouseRightButtonDownWithinMove),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_MOVE_STOP,this.onMouseMoveStop),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_WHEEL_FORWARD,this.onMouseWheelForward),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_WHEEL_BACKWARD,this.onMouseWheelBackward),lt.handle[""+t](li.handleEvents.Events.HANDLE_TOUCH_START,this.onHandleTouchStart),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_START,this.onHandleSingleTouchStart),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_START_CHANGED,this.onHandleSingleTouchStartChanged),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_MOVE,this.onHandleSingleTouchMove),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS,this.onHandleSingleTouchStartOfLongPress),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS,this.onHandleSingleTouchMoveOfLongPress),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_END,this.onHandleSingleTouchEnd),lt.handle[""+t](li.handleEvents.Events.HANDLE_DOUBLE_TOUCH_ZOOM_IN,this.onHandleDoubleTouchZoomIn),lt.handle[""+t](li.handleEvents.Events.HANDLE_DOUBLE_TOUCH_ZOOM_OUT,this.onHandleDoubleTouchZoomOut)};var Xs=document.getElementById("handle-event2"),Zs=null,qs=new At,Qs=null,Ks=function(t){Qs=k.getCore(),Zs=Jt(),this.name="floorplan.controls",this.camera=t,this.absoluteScale=1,this.currentScale=1,this.panStart=new L.Vector2,this.panEnd=new L.Vector2,this.panDelta=new L.Vector2,this.panVector=new L.Vector3,this.panOffset=new L.Vector3,this.target=new L.Vector3,this.offset=new L.Vector3,this.targetBounds=new L.Box3,this.zoomSpeed=.06,this.zoomSpeed2=.1,this.handleLongPress=!1,this.originZoom=1,this.enabled=!1,this.zoomEnabled=!1,this.panEnabled=!1,me.defaultZoom=_e.getFloorplanCameraZoom(),this.setZoom(me.defaultZoom,"set.default.zoom"),this.config=Object.freeze(me),this.onEvents()};Ks.prototype.zoomToContain=function(t){var e=this.camera.defaultConfig.orthoBase,n=Math.max(t.x,t.z),r=Math.min(t.x,t.z),i=Math.max(n,r*this.camera.aspect),o=Math.max(r,n*this.camera.aspect);this.absoluteScale=(qt()<1?i:o)/2/e*1.6,this.currentScale=this.absoluteScale},Ks.prototype.rotateToView=function(t){var e=this.name+" rotate to view";this.target.copy(t),this.lookAt(t,e),this.updateZoom();var n=_e.getFloorplanRotateAngle();this.horizontalViewRotate2(n)},Ks.prototype.lookAt=function(t,e){this.name,this.camera.lookAtTarget(t)},Ks.prototype.updateZoom=function(){this.absoluteScale=Math.max(.1,Math.min(this.absoluteScale,10)),this.currentScale=.8*this.currentScale+.2*this.absoluteScale,this.camera.updateZoom(this.currentScale)},Ks.prototype.setBounds=function(t){this.targetBounds=t},Ks.prototype.resetPose=function(t){var e=this.name+" reset pose",n=Qs.player.model,r=n.size,i=n.center,o=n.boundingBox.min.distanceTo(n.boundingBox.max),a=i.clone();a.setY(r.y),a.y+=o,this.setPosition(a,e),this.zoomToContain(r),this.rotateToView(i),Qs.sceneRender.camera.setProjectionMatrix(this.camera.projectionMatrix)},Ks.prototype.reset=function(){this.name,this.offset.set(0,0,0),this.target.set(0,0,0),this.panVector.set(0,0,0),this.panOffset.set(0,0,0),this.panDelta.set(0,0),this.panStart.set(0,0),this.panEnd.set(0,0)},Ks.prototype.getInitPose=function(){var t=Qs.player.model,e=t.size,n=t.center,r=t.boundingBox.min.distanceTo(t.boundingBox.max),i=n.clone();i.setY(e.y),i.y+=r;var o=Ge(i,t.center),a=_e.getFloorplanRotateAngle();return o.premultiply((new L.Quaternion).setFromAxisAngle({x:0,y:-1,z:0},a)),{position:i,quaternion:o}},Ks.prototype.setPosition=function(t,e){this.name,this.camera.setPosition(t)},Ks.prototype.stopRotation=function(){},Ks.prototype.setZoom=function(t,e){var n=this.name+" set zoom",r=t;this.camera.setZoom(r,n),!0===this.enabled&&(Qs.sceneRender.camera.setProjectionMatrix(this.camera.projectionMatrix),Ht.actionStateEngine.state[li.actionEvents.Events.FLOORPLAN_CAMERA_ZOOM_CHANGED].data={zoom:r},Ht.actionStateEngine.state[li.actionEvents.Events.FLOORPLAN_CAMERA_ZOOM_CHANGED].state=!0)},Ks.prototype.resetZoomOfForce=function(){this.setZoom(me.defaulZoom,"reset.zoom.force")},Ks.prototype.setMode=function(t){},Ks.prototype.horizontalViewRotate=function(t){this.camera.horizontalViewRotate(t)},Ks.prototype.horizontalViewRotate2=function(t){this.camera.horizontalViewRotate2(t)},Ks.prototype.enable=function(t){var e=this.name+" enable";!0===this.enabled&&n.warn(e+" failure, reason: is enabled!")(),this.dealtEvents("addEventListener",e),this.store&&(this.store.originScale=me.defaultZoom/1),this.enabled=!0},Ks.prototype.disable=function(t){var e=this.name+" disable";!1===this.enabled&&n.warn(e+" failure, reason: is disabled!")(),this.dealtEvents("removeEventListener",e),this.store&&(this.store.originScale=null),this.enabled=!1},Ks.prototype.enableZoomControl=function(){this.zoomEnabled=!0},Ks.prototype.disableZoomControl=function(){this.zoomEnabled=!1},Ks.prototype.enablePanControl=function(){this.panEnabled=!0},Ks.prototype.disablePanControl=function(){this.panEnabled=!1},Ks.prototype.pan=function(t,e){var n=t*(this.camera.right-this.camera.left)/Zs.clientWidth,r=-e*(this.camera.top-this.camera.bottom)/Zs.clientHeight;this.panLeft(n),this.panUp(r)},Ks.prototype.panLeft=function(t){this.name;var e=this.camera.matrix.elements;this.panOffset.set(e[0],0,e[2]).normalize(),this.panOffset.multiplyScalar(-t),this.panVector.add(this.panOffset),this.offset.copy((new L.Vector3).subVectors(this.camera.getPosition(),this.target)),this.target.add(this.panVector);var n=(new L.Vector3).addVectors(this.target,this.offset);this.camera.setPosition(n),this.panVector.set(0,0,0)},Ks.prototype.panUp=function(t){this.name;var e=this.camera.matrix.elements;this.panOffset.set(e[4],0,e[6]).normalize(),this.panOffset.multiplyScalar(-t),this.panVector.add(this.panOffset),this.offset.copy((new L.Vector3).subVectors(this.camera.getPosition(),this.target)),this.target.add(this.panVector);var n=(new L.Vector3).addVectors(this.target,this.offset);this.camera.setPosition(n),this.panVector.set(0,0,0)},Ks.prototype.updateCamera=function(){this.name},Ks.prototype.onEvents=function(){var t=this;this.onMouseRightButtonDown=function(e){var n=e.x,r=e.y;t.panStart.set(n,r)},this.onMouseRightButtonUp=function(t){},this.onMouseRightButtonDownWithinMove=function(e){!1!==t.enabled&&!1!==t.panEnabled&&qs.pipe(16,(function(){var n=e.x,r=e.y;t.panEnd.set(n,r),t.panDelta.subVectors(t.panEnd,t.panStart),t.pan(t.panDelta.x,t.panDelta.y),t.panStart.copy(t.panEnd),Ht.actionStateEngine.state[li.actionEvents.Events.FLOORPLAN_CAMERA_DRAG_MOVING].data=null,Ht.actionStateEngine.state[li.actionEvents.Events.FLOORPLAN_CAMERA_DRAG_MOVING].state=!0}))},this.onMouseWheelOfForward=function(e){if(!1!==t.enabled&&!1!==t.zoomEnabled){var n=t.camera.zoom+t.zoomSpeed;n>me.maxZoom&&(n=me.maxZoom),t.setZoom(n)}},this.onMouseWheelOfBackward=function(e){if(!1!==t.enabled&&!1!==t.zoomEnabled){var n=t.camera.zoom-t.zoomSpeed;n<me.minZoom&&(n=me.minZoom),t.setZoom(n)}},this.onHandleSingleTouchStart=function(e){t.originZoom=t.camera.zoom},this.onHandleSingleTouchMove=function(t){},this.onHandleSingleTouchStartOfLongPress=function(e){var n=e.x,r=e.y;t.panStart.set(n,r)},this.onHandleSingleTouchMoveOfLongPress=function(e){if(!1!==t.enabled&&!1!==t.panEnabled){var n=e.x,r=e.y;t.panEnd.set(n,r),t.panDelta.subVectors(t.panEnd,t.panStart),t.pan(t.panDelta.x,t.panDelta.y),t.panStart.copy(t.panEnd)}},this.onHandleSingleTouchEnd=function(e){t.handleLongPress=!1},this.onHandleDoubleTouchMove=function(t){Xs&&(Xs.value+="scale: "+t+"\r\n"),Xs&&(Xs.value+="---\r\n")},this.onHandleDoubleTouchZoomIn=function(e){if(!1!==t.enabled&&!1!==t.zoomEnabled){var n=e.new_scale/e.prev_scale,r=t.camera.zoom*n;r>me.maxZoom&&(r=me.maxZoom),t.setZoom(r)}},this.onHandleDoubleTouchZoomOut=function(e){if(!1!==t.enabled&&!1!==t.zoomEnabled){var n=e.new_scale/e.prev_scale,r=t.camera.zoom*n;r<me.minZoom&&(r=me.minZoom),t.setZoom(r)}}},Ks.prototype.dealtEvents=function(t,e){lt.mouse[""+t](li.mouseEvents.Events.MOUSE_RIGHT_BUTTON_DOWN,this.onMouseRightButtonDown),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_RIGHT_BUTTON_UP,this.onMouseRightButtonUp),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_RIGHT_BUTTON_DOWN_WITHIN_MOVE,this.onMouseRightButtonDownWithinMove),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_WHEEL_FORWARD,this.onMouseWheelOfForward),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_WHEEL_BACKWARD,this.onMouseWheelOfBackward),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_START,this.onHandleSingleTouchStart),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_MOVE,this.onHandleSingleTouchMove),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_START_OF_LONG_PRESS,this.onHandleSingleTouchStartOfLongPress),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_MOVE_OF_LONG_PRESS,this.onHandleSingleTouchMoveOfLongPress),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_END,this.onHandleSingleTouchEnd),lt.handle[""+t](li.handleEvents.Events.HANDLE_DOUBLE_TOUCH_MOVE,this.onHandleDoubleTouchMove),lt.handle[""+t](li.handleEvents.Events.HANDLE_DOUBLE_TOUCH_ZOOM_IN,this.onHandleDoubleTouchZoomIn),lt.handle[""+t](li.handleEvents.Events.HANDLE_DOUBLE_TOUCH_ZOOM_OUT,this.onHandleDoubleTouchZoomOut)};var Js={};Js[G.PANORAMA]=ro,Js[G.DOLLHOUSE]=function(t,e){void 0===e&&(e=function(){}),fs=k.getCore(),!0!==Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_PANO].state?(Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].pano_id=t.id,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].quaternion={x:t.currentQuaternion.x,y:t.currentQuaternion.y,z:t.currentQuaternion.z,w:t.currentQuaternion.w},Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].lookat_target=t.lookat_target?{x:t.lookat_target.x,y:t.lookat_target.y,z:t.lookat_target.z}:null,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].switch_mode=t.switch_mode,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].switch_config=t.switch_config,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].free_rotate=t.free_rotate,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!0,fs.player.updateTargetPano(t),fs.player.flyToPanoramaMode({pano:t,duration:void 0,zoom:t.camera_zoom,progress:function(){},complete:function(){Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!1,e()}})):n.warn("switch to target pano of dollhouse view mode failure, reason: disable switch pano")()},Js[G.FLOORPLAN]=function(t,e){if(void 0===e&&(e=function(){}),ms=k.getCore(),!0!==Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_PANO].state){var r=ms.sceneRender.camera.getDirection().setY(0).normalize(),i=t.position,o=(new L.Vector3).addVectors(i,r),a=(new L.PerspectiveCamera).copy(ms.player.cameras[G.FLOORPLAN]);a.position.copy(i),a.lookAt(o),t.currentQuaternion=a.quaternion,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].pano_id=t.id,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].quaternion={x:t.currentQuaternion.x,y:t.currentQuaternion.y,z:t.currentQuaternion.z,w:t.currentQuaternion.w},Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].lookat_target=t.lookat_target?{x:t.lookat_target.x,y:t.lookat_target.y,z:t.lookat_target.z}:null,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].switch_mode=t.switch_mode,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].switch_config=t.switch_config,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].free_rotate=t.free_rotate,Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!0,ms.player.updateTargetPano(t),ms.player.flyToPanoramaMode({pano:t,duration:void 0,zoom:t.camera_zoom,progress:function(){},complete:function(){Re.SyncData[Re.SyncEvents.SWITCH_TO_PANO].state=!1,e()}})}else n.warn("switch to target pano of floorplan failure, reason: disable switch to pano")()};var $s=["1024-512","2048-512"],tl=null,el=function(){k.carrayPlayer(this),tl=k.getCore(),this.name="player",this.mode=null,this.currentPano=null,this.targetPano=null,this.prevPano=null,this.closetWaypoint=null,this.model=null,this.intersect=null,this.intersectFloor=null,this.controls=Object.create(null),this.cameras=Object.create(null),this.intersectedObjects=[],this.pointer=new L.Vector3(0,0,1),this.position=new L.Vector3,this.quaternion=new L.Quaternion,this.control=null,this.getMouseIntersectThrottle=new At,this.raycaster=new L.Raycaster,this.flyToPanoramaMode=Ps,this.flyToDollhouseMode=Os,this.flyToFloorplanMode=Rs,this._zoomLevel=1,this.onEvents()},nl={zoomLevel:{configurable:!0},switchToTargetPano:{configurable:!0}};nl.zoomLevel.get=function(){return this._zoomLevel},nl.zoomLevel.set=function(t){this._zoomLevel=t,this.onZoomLevelChanged(t)},nl.switchToTargetPano.get=function(){return Js},el.prototype.init=function(t){var e=this.name+" init";n.info("%c"+e+", cmd: "+t,"color:cyan;")(),this.inited=!0,this.setUpControls()},el.prototype.start=function(t){var e=this.name+" start";n.info("%c"+e+", cmd: "+t,"color:cyan;")(),this.started=!0,this.updateModelDependentData(),this.raycaster.layers.enable(ve.COLLIDER)},el.prototype.setPosition=function(t,e){this.position.copy(t),tl.sceneRender.camera.setPosition(t,e)},el.prototype.setQuaternion=function(t,e){this.quaternion.copy(t),tl.sceneRender.camera.setQuaternion(t,e)},el.prototype.setMode=function(t,e){this.onModeChange(this.mode,t),this.mode=t},el.prototype.onModeChange=function(t,e){void 0===e&&(e="");var n=this.model.getUserData("type");kt!==n&&zt!==n&&Gt!==n||G.PANORAMA!==e||!0===Ht.webxr.state[li.webxrEvents.Events.SESSION_START].state&&this.model.hide(),this.switchControlsForNewMode(e)},el.prototype.setModel=function(t){n.info("%c"+this.name+" set model<"+t.modelid+">","color:#0f0;")(),this.model=t},el.prototype.updateModelDependentData=function(){if(kt===this.model.userData.type){this.controls[G.DOLLHOUSE].setZoomBounds(this.model.boundingBox);var t=this.model.boundingBox.clone();this.controls[G.DOLLHOUSE].setBounds(t),this.controls[G.FLOORPLAN].setBounds(t)}},el.prototype.switchControlsForNewMode=function(t){var e=this.name+" switch controls for new mode:"+t;switch(n.info("%c"+e,"color:cyan;")(),t){case G.DOLLHOUSE:var r=this.controls[G.FLOORPLAN],i=this.controls[G.PANORAMA];i.resetZoomOfForce(e),i.enabled&&i.disable(e),r.enabled&&r.disable(e),this.control=this.controls[G.DOLLHOUSE],this.control.enable(e);break;case G.PANORAMA:var o=this.controls[G.DOLLHOUSE],a=this.controls[G.FLOORPLAN];o.enabled&&o.disable(e),a.enabled&&a.disable(e),this.control=this.controls[G.PANORAMA],this.control.enable(e);break;case G.FLOORPLAN:var s=this.controls[G.DOLLHOUSE],l=this.controls[G.PANORAMA];l.resetZoomOfForce(e),s.enabled&&s.disable(e),l.enabled&&l.disable(e),this.control=this.controls[G.FLOORPLAN],this.control.enable(e);break;case G.TRANSITIONING:this.control.enabled&&this.control.disable(e),this.control=null;break;default:n.error(e+" failure, reason: invalid new mode:"+t)(),this.control=null}},el.prototype.setUpControls=function(){var t=this.name+" setup controls";n.info("%c"+t,"color:cyan;")(),this.cameras[G.PANORAMA]=new vo,this.cameras[G.DOLLHOUSE]=new Us,this.cameras[G.FLOORPLAN]=new Hs,this.controls[G.PANORAMA]=new fo(this.cameras[G.PANORAMA]),this.controls[G.DOLLHOUSE]=new Ys(this.cameras[G.DOLLHOUSE]),this.controls[G.FLOORPLAN]=new Ks(this.cameras[G.FLOORPLAN])},el.prototype.stayedPanorama=function(t){var e=this.name+" stayed "+G.PANORAMA;n.info("%c"+e,"color:#0f0;")();var r=t.pano,i=t.quaternion,o=this.controls[G.PANORAMA];this.model.setProjectedPanos(r,r,void 0,"stayed.panorama"),o.setPosition(r.position,e),o.lookAtRotation(i,e),this.setMode(G.PANORAMA),this.model.setMode(G.PANORAMA,"stayed.panorama"),this.model.show(),this.targetPano=null,this.currentPano=r,this.zoomLevel=o.camera.zoom,this.model.floors.get(r.floorIndex).enter(this.mode,e),tl.pure3D?this.model.setAlpha(1):this.model.setAlpha(0),this.model.skybox.setOpacity(1),r.enter()},el.prototype.stayedDollhouse=function(t){var e=this.name+" stayed "+G.DOLLHOUSE;n.info("%c"+e,"color:#0f0;")();var r=this.controls[G.DOLLHOUSE];this.setMode(G.DOLLHOUSE),this.model.show(),this.model.setMode(G.DOLLHOUSE,"stayed.dollhouse"),r.resetRanges(),r.reset();var i=r.getDefaultPose(),o=t.position||i.position,a=t.quaternion||i.quaternion,s=t.target||i.target,l=r.config.defaultZoom;o=(new L.Vector3).copy(o).divideScalar(r.config.defaultDistanceZoom),s=(new L.Vector3).copy(s).divideScalar(r.config.defaultDistanceZoom),r.resetPose(o,a,s,l,e)},el.prototype.stayedFloorplan=function(){var t=this.name+" stayed "+G.FLOORPLAN;n.info("%c"+t,"color:#0f0;")(),this.setMode(G.FLOORPLAN),this.controls[G.FLOORPLAN].resetPose(this.name+" stayed.floorplan"),this.model.show(),this.model.setMode(G.FLOORPLAN,"stayed.floorplan")},el.prototype.setSize=function(t,e){var n=t/e;for(var r in this.cameras)this.cameras[r].updateAspect(n);if(this.mode===G.FLOORPLAN&&(this.control.zoomToContain(this.model.size),this.control.updateZoom(),tl.sceneRender.camera.setProjectionMatrix(this.control.camera.projectionMatrix)),G.TRANSITIONING===this.mode){var i=this.controls.floorplan;i.zoomToContain(this.model.size),i.updateZoom(),tl.sceneRender.camera.setProjectionMatrix(i.camera.projectionMatrix)}},el.prototype.findClosetWaypoint=function(){if(this.intersect){var t=this.intersect.point,e=this.intersectFloor,n=[],r=this.currentPano||this.prevPano;switch(this.mode){case G.PANORAMA:for(var i=r.neighbourUUIDs,o=0,a=i.length;o<a;++o){var s=i[o],l=this.model.panos.get(s),c=l.marker;l&&l.enable&&c.computePointWithinTheRadius(t)&&n.push(c)}break;case G.DOLLHOUSE:if(!e)return;for(var u=e.markers,h=0,p=u.length;h<p;++h){var d=u[h],f=d.locationId,m=this.model.panos.get(f);m&&m.enable&&d.computePointWithinTheRadius(t)&&n.push(d)}break;case G.FLOORPLAN:if(!e)return;for(var v=e.markers,g=0,y=v.length;g<y;++g){var _=v[g],E=_.locationId,T=this.model.panos.get(E);T&&T.enable&&_.computePointWithinTheRadius(t)&&n.push(_)}}0<n.length?this.closetWaypoint=n[n.length-1]:this.closetWaypoint=null}},el.prototype.getMouseDirection=function(){var t=this.pointer,e=new L.Vector3(t.x,t.y,-1).unproject(this.control.camera),n=new L.Vector3(t.x,t.y,1).unproject(this.control.camera);return(new L.Vector3).subVectors(n,e).normalize()},el.prototype.getClosestPanoWithinIntersect=function(t){if(!1===this.intersectFloor.selected)return n.warn("can't pickup floor, reason: floor unselected")(),null;for(var e=this.intersectFloor.panos.filter((function(t){return 1===t.alignmentType&&t.enable})),r=t.point,i=[],o=0,a=e.length;o<a;++o){var s=e[o].floorPosition.distanceTo(r);i.push(s)}var l=Math.min.apply(Math,i),c=i.indexOf(l);return i=[],e[c]},el.prototype.getMouseIntersect=function(){var t=this.getIntersectWithinModelCollider();return t?{point:t.point,normal:t.face.normal,mode:this.mode}:null},el.prototype.updateZoomPano=function(){if(this.model&&Wt!==this.model.userData.type&&!tl.panoRenderer.zoomPanoRenderingDisabled&&G.PANORAMA===this.mode&&this.currentPano){var t=this.currentPano,e=_e.getRenderSet(),n=1;if(-1!==$s.indexOf(e)){"1024-512"===e&&(n=de.tile2kZoomTrigger),"2048-512"===e&&(n=de.tile4kZoomTrigger);var r=tl.qualityManager.detectMaxZoomPanoSize()>tl.qualityManager.detectMaxNavPanoSize(),i=this.zoomLevel>n&&r;i&&!t.zoomed&&this.renderPano(t,!0),!i&&t.zoomed&&this.renderPano(t,!1)}}},el.prototype.renderPano=function(t,e){this.name,!0===e&&!0!==tl.panoRenderer.zoomingActive||(tl.panoRenderer.resetRenderStatus(t.id,!1,!0,1024),tl.panoRenderer.clearAllQueuedUploadsForPano(t.id),tl.panoRenderer.renderPanoTiles(t.id,null,!1,!1),t.setZoomed(e,this.name+" render pano"))},el.prototype.updatePointer=function(t,e){Be(t,e,this.pointer),this.control&&this.raycaster.setFromCamera(this.pointer,this.control.camera)},el.prototype.updateTargetPano=function(t,e){var r=this.name+" update target pano";this.targetPano&&t&&this.targetPano.name===t.name?n.error(r+" failure, reason: samed target pano!, cmd:"+e)():this.targetPano=t},el.prototype.update=function(t){_e.getRenderMode(),this.control&&this.control.update&&this.control.update(t),tl.tileDownloader&&tl.tileDownloader.onFrameUpdate(),tl.panoRenderer&&this.updateZoomPano()},el.prototype.clear=function(){this.model=null,this.targetPano=null,this.currentPano=null,this.prevPano=null,F.setItem(this.name+".clear",!0)()},el.prototype.startLoadMaxZoomTile=function(t){tl.tileDownloader.tilePrioritizer.setZoomingActive(!0,"start.load."+t+".tile"),tl.panoRenderer.setZoomingActive(!0,this.currentPano,"start.load."+t+".tile")},el.prototype.stopLoadMaxZoomTIle=function(t){tl.tileDownloader.tilePrioritizer.setZoomingActive(!1,"stop.load."+t+".tile"),tl.panoRenderer.setZoomingActive(!1,this.currentPano,"stop.load."+t+".tile")},el.prototype.getMouseIntersectFloor=function(){if(!this.intersect)return null;var t=this.intersect.object.userData.floor_index;return this.model.floors.get(t)},el.prototype.getIntersectWithinModelCollider=function(){if("model"===this.model.getUserData("type")){var t=tl.sceneRender.reticule,e=this.model.getValidColliders(),n=this.raycasterObjects(e);if(e=[],n?(Ht.raycasterStateEngine.state[J.INTERSECT_WITHIN_MODEL].data={mode:this.mode,point:n.point,normal:n.face.normal,chunk_type:n.object.userData.chunk_type,chunk_name:n.object.userData.chunk_name},Ht.raycasterStateEngine.state[J.INTERSECT_WITHIN_MODEL].state=!0):Ht.raycasterStateEngine.state[J.UNINTERSECT_WITHIN_MODEL].state=!0,"on"===Kt("show_intersect_line")&&n&&_n(new L.Vector3(0,0,0),n.point,255,"intersect.point",!1),t&&n){var r=n.point,i=n.face.normal;t.follow(i,r)}return n}if(Wt===this.model.getUserData("type")){var o=this.model.getValidColliders(),a=this.raycasterObjects(o);return a&&(Ht.raycasterStateEngine.state[J.INTERSECT_WITHIN_MODEL].data={mode:this.mode,point:a.point,normal:a.face.normal,chunk_type:a.object.userData.chunk_type,chunk_name:a.object.userData.chunk_name},Ht.raycasterStateEngine.state[J.INTERSECT_WITHIN_MODEL].state=!0),o=[],"on"===Kt("show_intersect_line")&&a&&_n(new L.Vector3(0,0,100),a.point,255,"intersect.point",!0),a}},el.prototype.raycasterObjects=function(t){this.name;for(var e=this.model,n=null,r=[],i=new Map,o=0,a=t.length;o<a;++o){var s=t[o],l=(new L.Box3).copy(s.geometry.boundingBox).applyMatrix4(e.matrixWorld);if(!0===this.raycaster.ray.intersectsBox(l)){var c=s.userData.bvh;if(!c){var u=this.raycaster.intersectObject(s,!1);if(0===u.length)continue;return n=u[0]}var h=c.raycastFirst(this.raycaster.ray,L.FrontSide);if(!h)continue;var p=h.distance;(n=h).object=s,r.push(p),i.set(p,n)}}var d=Math.min.apply(Math,r);return n=i.get(d),r=[],i.clear(),n},el.prototype.onEvents=function(){var t=this;this.onMouseLeftBtnClick=function(e){if(t.name,(!t.model||Wt!==t.model.userData.type)&&1!=Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_PANO].state&&!0!==Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO].state)if(t.targetPano)n.warn(t.name+" has target pano un enter!")();else{t.intersect=t.getIntersectWithinModelCollider(),t.intersectFloor=t.getMouseIntersectFloor(),t.findClosetWaypoint();var r=ps();if(!r&&G.PANORAMA===t.mode){var i=t.getMouseDirection();Yi.start2(i)}if(r){var o=function(){r.free_rotate=!0,Js[""+t.mode](r,(function(){t.currentPano.free_rotate=!1}))};"panorama"===t.mode&&1<t.zoomLevel?t.control.resetZoom((function(){Bo((function(){o()}),160)})):o()}}},this.onMouseLeftButtonDown=function(e){t.updatePointer(e.x,e.y)},this.onMouseLeftButtonDownWithinMove=function(e){t.updatePointer(e.x,e.y)},this.onMouseMoveWithoutButtonDown=function(e){if(G.TRANSITIONING!==t.mode){var n=e.x,r=e.y;t.updatePointer(n,r),"model"===t.model.getUserData("type")&&t.getMouseIntersectThrottle.pipe(12.5,(function(){t.intersect=t.getIntersectWithinModelCollider(),t.intersectFloor=t.getMouseIntersectFloor(),t.findClosetWaypoint()})),Wt===t.model.getUserData("type")&&(t.intersect=t.getIntersectWithinModelCollider())}},this.onHandleSingleTouchStart=function(e){if(t.mode!==G.TRANSITIONING){var n=e.x,r=e.y;t.updatePointer(n,r)}},this.onHandleSingleTouchEnd=function(t){},this.onHandleSingleTouchClick=function(e){var r=t.name+" on handle single click";if(!t.model||Wt!==t.model.getUserData("type"))if(1!=Ht.actionStateEngine.state[li.actionEvents.Events.DISABLE_SWITCH_PANO].state)if(!0!==Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO].state)if(t.targetPano)n.warn(t.name+" has target pano un enter!")();else{t.intersect=t.getIntersectWithinModelCollider(),t.intersectFloor=t.getMouseIntersectFloor(),t.findClosetWaypoint();var i=ps();if(i){var o=function(){i.free_rotate=!0,Js[""+t.mode](i,(function(){t.currentPano.free_rotate=!1}))};G.PANORAMA===t.mode&&1<t.zoomLevel?t.control.resetZoom((function(){Bo((function(){o()}),160)})):o()}else if(G.PANORAMA===t.mode){var a=t.getMouseDirection();Yi.start2(a)}}else n.warn(r+" failure, reason: "+li.actionEvents.Events.SWITCH_TO_PANO)();else n.warn(r+" failure, reason: disable switch to pano")()},this.onZoomLevelChanged=function(e){if("model"===t.model.userData.type){var n=_e.getRenderSet(),r=1,i=0;if("lod"===_e.getRenderMode()&&-1!==$s.indexOf(n)){"1024-512"===n&&(r=de.tile2kZoomTrigger,i=2),"2048-512"===n&&(r=de.tile4kZoomTrigger,i=3);var o=tl.qualityManager.detectMaxZoomPanoSize()>tl.qualityManager.detectMaxNavPanoSize();e>r?o&&t.startLoadMaxZoomTile(i):o&&t.stopLoadMaxZoomTIle(i)}}}},el.prototype.dealtEvents=function(t){var e=this.name+" deal events<"+t+">";lt.mouse.hook&&(lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_DOWN,this.onMouseLeftButtonDown,e),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE,this.onMouseLeftButtonDownWithinMove),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE,this.onMouseLeftBtnClick),lt.mouse[""+t](li.mouseEvents.Events.MOUSE_MOVE_WITHOUT_BUTTON_DOWN,this.onMouseMoveWithoutButtonDown)),lt.handle.hook&&(lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_START,this.onHandleSingleTouchStart),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_END,this.onHandleSingleTouchEnd),lt.handle[""+t](li.handleEvents.Events.HANDLE_SINGLE_TOUCH_CLICK,this.onHandleSingleTouchClick))},Object.defineProperties(el.prototype,nl);var rl=function(){this.name="quality.manager",this.maxNavPanoSize=0,this.maxZoomPanoSize=0,this.baseSize=0,this.standardSize=0,this.highSize=0,this.ultraHighSize=0,this.panoSizeClassMap=Object.create(null)};rl.prototype.init=function(){this.buildPanoSizeClassMap(),this.baseSize=this.getPanoSize(vi),this.standardSize=this.getPanoSize(gi),this.highSize=this.getPanoSize(yi),this.ultraHighSize=this.getPanoSize(_i),this.updateMaximums(void 0,this.name+".init")},rl.prototype.buildPanoSizeClassMap=function(){this.panoSizeClassMap[vi]=512,this.panoSizeClassMap[gi]=1024,this.panoSizeClassMap[yi]=2048,this.panoSizeClassMap[_i]=4096},rl.prototype.getPanoSize=function(t){return this.panoSizeClassMap[t]},rl.prototype.getMaxPossiblePanoSize=function(){var t=_e.getRenderSet();return"1024-512"===t||"2048-512"===t?_e.isSupport4k512()?this.getPanoSize(_i):this.getPanoSize(yi):void 0},rl.prototype.getMaxNavPanoSize=function(){return this.maxNavPanoSize},rl.prototype.getMaxZoomPanoSize=function(){return this.maxZoomPanoSize},rl.prototype.detectMaxNavPanoSizeClass=function(){var t=_e.getRenderSet();return"1024-512"===t?gi:"2048-512"===t?yi:void 0},rl.prototype.detectMaxNavPanoSize=function(){var t=this.detectMaxNavPanoSizeClass();return this.getPanoSize(t)},rl.prototype.detectMaxZoomPanoSize=function(){var t=_e.getRenderSet();return"1024-512"===t||"2048-512"===t?_e.isSupport4k512()?this.getPanoSize(_i):this.getPanoSize(yi):void 0},rl.prototype.updateMaximums=function(t,e){this.maxNavPanoSize=this.detectMaxNavPanoSize(),this.maxZoomPanoSize=this.detectMaxZoomPanoSize(t)};var il,ol,al={};al.RADIANS_PER_DEGREE=Math.PI/180,al.DEGREES_PER_RADIAN=180/Math.PI,al.Vector3=function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0},al.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},al.Matrix4.prototype={copy:function(t){return this.elements.set(t.elements),this},applyToVector3:function(t){var e=t.x,n=t.y,r=t.z,i=this.elements;return t.x=i[0]*e+i[4]*n+i[8]*r+i[12],t.y=i[1]*e+i[5]*n+i[9]*r+i[13],t.z=i[2]*e+i[6]*n+i[10]*r+i[14],this},makeRotationFromQuaternion:function(t){var e=this.elements,n=t.x,r=t.y,i=t.z,o=t.w,a=n+n,s=r+r,l=i+i,c=n*a,u=n*s,h=n*l,p=r*s,d=r*l,f=i*l,m=o*a,v=o*s,g=o*l;return e[0]=1-(p+f),e[4]=u-g,e[8]=h+v,e[1]=u+g,e[5]=1-(c+f),e[9]=d-m,e[2]=h-v,e[6]=d+m,e[10]=1-(c+p),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},al.Quaternion=function(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==r?r:1},al.Quaternion.prototype={get x(){return this._x},set x(t){this._x=t},get y(){return this._y},set y(t){this._y=t},get z(){return this._z},set z(t){this._z=t},get w(){return this._w},set w(t){this._w=t},copy:function(t){this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w},inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this},setFromUnitVectors:function(t,e){return void 0===il&&(il=new al.Vector3),(ol=al.dot(t,e)+1)<1e-6?(ol=0,Math.abs(t.x)>Math.abs(t.z)?al.setVector(il,-t.y,t.x,0):al.setVector(il,0,-t.z,t.y)):(al.cross(t,e,il),this._x=il.x,this._y=il.y,this._z=il.z,this._w=ol),this.normalize},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,i=t._z,o=t._w,a=e._x,s=e._y,l=e._z,c=e._w;return this._x=n*c+o*a+r*l-i*s,this._y=r*c+o*s+i*a-n*l,this._z=i*c+o*l+n*s-r*a,this._w=o*c-n*a-r*s-i*l,this}},al.convertWorkshopVector=function(t){return new al.Vector3(-t.x,t.y,t.z)},al.convertWorkshopQuaternion=function(t){return new al.Quaternion(-t.x,t.y,t.z,-t.w).multiply(new al.Quaternion(Math.sqrt(2)/2,Math.sqrt(2)/2,0,0))},al.convertWorkshopOrthoZoom=function(t){return-1===t?-1:t/4},al.convertWorkshopPanoramaQuaternion=function(t){return new al.Quaternion(t.x,-t.y,-t.z,t.w).normalize().multiply((new al.Quaternion).setFromAxisAngle(new al.Vector3(0,1,0),270*al.RADIANS_PER_DEGREE))},al.normalize=function(t){var e=t.x*t.x+t.y*t.y+t.z*t.z,n=Math.sqrt(e);t.x/=n,t.y/=n,t.z/=n},al.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},al.cross=function(t,e,n){var r=t.x,i=t.y,o=t.z;n.x=i*e.z-o*e.y,n.y=o*e.x-r*e.z,n.z=r*e.y-i*e.x},al.setVector=function(t,e,n,r){t.x=e,t.y=n,t.z=r},al.copyVector=function(t,e){e.x=t.x,e.y=t.y,e.z=t.z},al.addVector=function(t,e){t.x+=e.x,t.y+=e.y,t.z+=e.z},al.subVector=function(t,e){t.x-=e.x,t.y-=e.y,t.z-=e.z},al.applyQuaternionToVector=function(t,e){var n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z,l=t.w,c=l*n+a*i-s*r,u=l*r+s*n-o*i,h=l*i+o*r-a*n,p=-o*n-a*r-s*i;e.x=c*l+p*-o+u*-s-h*-a,e.y=u*l+p*-a+h*-o-c*-s,e.z=h*l+p*-s+c*-a-u*-o},al.angleBetweenVectors=function(t,e){return Math.acos(al.dot(t,e))};var sl,ll,cl,ul,hl,pl={0:Wo,1:jo,2:zo,3:Yo,4:Go,5:Vo},dl=Object.create(null);dl.TILE_SIZE=512,dl.FACES_PER_PANO=6,dl.LocationOnTile={Center:0,UpperLeft:1,UpperRight:2,LowerRight:3,LowerLeft:4},dl.getTileVector=function(t,e,n,r,i,o,a,s){void 0===o&&(o=dl.LocationOnTile.Center);var l=t/e,c=e/t*2,u=c/2,h=r/l*2-1+u,p=(i=l-1-i)/l*2-1+u;switch(o){case dl.LocationOnTile.UpperLeft:h-=u,p+=u,h+=a*c;break;case dl.LocationOnTile.UpperRight:h+=u,p+=u,p-=a*c;break;case dl.LocationOnTile.LowerRight:h+=u,p-=u,h-=a*c;break;case dl.LocationOnTile.LowerLeft:h-=u,p-=u,p+=a*c;break;case dl.LocationOnTile.Center:}switch(n){case zo:al.setVector(s,-1,p,-h);break;case Go:al.setVector(s,1,p,h);break;case Wo:al.setVector(s,-h,1,-p);break;case Vo:al.setVector(s,-h,-1,p);break;case jo:al.setVector(s,-h,p,1);break;case Yo:al.setVector(s,h,p,-1)}al.normalize(s)},dl.getFaceForTile=function(t,e){var n=dl.TILE_SIZE;t<dl.TILE_SIZE&&(n=t);var r=Math.floor(t/n),i=r*r;return Math.floor(e/i)},dl.getTileLocation=function(t,e,n){var r=dl.TILE_SIZE;t<dl.TILE_SIZE&&(r=t);var i=dl.getFaceForTile(t,e),o=Math.floor(t/r),a=e-i*(o*o);n.face=i,n.faceTileIndex=a,n.tileX=a%o,n.tileY=Math.floor(a/o)},dl.getTileCountForSize=function(t){if(t<=dl.TILE_SIZE)return dl.FACES_PER_PANO;var e=Math.floor(t/dl.TILE_SIZE);return e*e*dl.FACES_PER_PANO},dl.getRelativeDirection=(ul=new al.Matrix4,hl=new al.Quaternion,function(t,e){hl.copy(t),hl.inverse(),ul.makeRotationFromQuaternion(hl),ul.applyToVector3(e),al.normalize(e)}),dl.matchingTilesInDirection=(ll=function(t,e){t.push({face:e.face,faceTileIndex:e.faceTileIndex,tileX:e.tileX,tileY:e.tileY})},cl=function(){var t={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return function(e,n,r){for(var i=dl.getTileCountForSize(e),o=0,a=0;a<i;a++)dl.getTileLocation(e,a,t),n&&!n(t)||(o++,r&&ll(r,t));return o}}(),function(t,e,n,r,i,o){if(dl.getTileCountForSize(e),!r&&!i)return cl(e,null,o)}),dl.isTileWithinFrustum=(sl=new al.Vector3,function(t,e,n,r,i,o,a,s){for(var l=Math.tan(.5*s*al.RADIANS_PER_DEGREE),c=-l,u=Math.tan(.5*a*al.RADIANS_PER_DEGREE),h=-u,p=dl.mapFaceToCubemapFace(n),d=0,f=0,m=0,v=0,g=0,y=dl.LocationOnTile.Center;y<=dl.LocationOnTile.LowerLeft;y++)if(dl.getTileVector(t,e,p,r,i,y,0,sl),al.applyQuaternionToVector(o,sl),sl.z>=-1e-5);else{var _=-1/sl.z,E=sl.x*_,T=sl.y*_;T>l?d++:T<c&&f++,E>u?m++:E<h&&v++,g++}return f!==g&&d!==g&&m!==g&&v!==g}),dl.isTileWithinFOV=function(){var t=new al.Vector3,e=new al.Vector3(0,1,0),n=new al.Vector3(1,0,0);return function(r,i,o,a,s,l,c){var u=dl.mapFaceToCubemapFace(o);if(al.cross(l,e,n),dl.getTileVector(r,i,u,a,s,dl.LocationOnTile.Center,0,t),dl.isWithinFOV(t,l,c))return!0;for(var h=c/360,p=Math.floor(1/h),d=0,f=0;f<p;f++){for(var m=dl.LocationOnTile.UpperLeft;m<=dl.LocationOnTile.LowerLeft;m++)if(dl.getTileVector(r,i,u,a,s,m,d,t),dl.isWithinFOV(t,l,c))return!0;d+=h}return!1}}(),dl.isWithinFOV=function(){var t=new al.Vector3;return function(e,n,r){al.copyVector(e,t);var i=r/2*al.RADIANS_PER_DEGREE,o=Math.cos(i);return al.dot(t,n)>=o}}(),dl.mapFaceToCubemapFace=function(t){return pl[t]},dl.getCubeOrientationForCubeFace=function(t,e){switch(t){case zo:e.set(0,-Math.PI/2,0);break;case Go:e.set(0,Math.PI/2,0);break;case Wo:e.set(Math.PI/2,Math.PI,0);break;case Vo:e.set(-Math.PI/2,Math.PI,0);break;case jo:e.set(0,-Math.PI,0);break;case Yo:e.set(0,0,0)}};var fl={None:0,Queued:1,ForceQueued:2,Downloading:3,Downloaded:4,DownloadFailed:5},ml=function(t,e,n,r){this.pano=t,this.cameraPosition=(new L.Vector3).copy(e),this.cameraDir=(new L.Vector3).copy(n),this.panoSpaceDir=(new L.Vector3).copy(r),this.zoomingActive=!1};ml.prototype.update=function(){};var vl=null,gl=null,yl=60,_l=[],El=[],Tl=[];function xl(){Jt(),vl=k.getCore(),gl=k.getTileDownloader(),this.name="TilePrioritizer",this.maxNavQuality=vl.qualityManager.getMaxNavPanoSize(),this.maxZoomQuality=vl.qualityManager.getMaxZoomPanoSize(),this.baseSize=vl.qualityManager.baseSize,this.standardSize=vl.qualityManager.standardSize,this.highSize=vl.qualityManager.highSize,this.ultraHighSize=vl.qualityManager.ultraHighSize,this.priorityCriteria=new ml(null,new L.Vector3(0,0,0),new L.Vector3(0,0,-1),new L.Vector3(0,0,-1)),Object.defineProperties(this,{DIRECTIONAL_FOV:{get:function(){return yl},set:function(t){yl=t}}}),xl.DIRECTIONAL_FOV_NARROW=6,xl.MAX_SCORED_PANOS_TOCONSIDER=6,xl.MAX_SCORED_PANOS_TOADD=2}xl.appendQueue=function(t,e,n){if(t&&e)for(var r=0;r<e.length;++r){var i=e[r];t.push(i)}},xl.prototype.updateCriteria=function(t,e,n){this.priorityCriteria.pano=t,this.priorityCriteria.cameraPosition.copy(e),this.priorityCriteria.cameraDir.copy(n),this.maxNavQuality=vl.qualityManager.getMaxNavPanoSize(),this.maxZoomQuality=vl.qualityManager.getMaxZoomPanoSize()},xl.prototype.filterAndPrioritize=function(t,e){this.populateNeighborPanos(this.priorityCriteria.pano,e,El),this.populateScoredPanos(this.priorityCriteria.pano,e,Tl,this.priorityCriteria.cameraDir,xl.MAX_SCORED_PANOS_TOCONSIDER);var n=this.baseSize,r=this.standardSize,i=this.highSize,o=this.ultraHighSize;this.queueTilesForPano(t,this.priorityCriteria.pano,n),_l.length=0,this.canDownloadSize(r)&&this.queueTilesInDirectionForPano(_l,this.priorityCriteria.pano,r,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,xl.DIRECTIONAL_FOV_NARROW),xl.sortPanoTiles(_l,this.priorityCriteria.pano,this.priorityCriteria.cameraDir),xl.appendQueue(t,_l,"1"),this.queueTilesForPanos(t,Tl,n,xl.MAX_SCORED_PANOS_TOADD),_l.length=0,this.canDownloadSize(i)&&this.queueTilesInDirectionForPano(_l,this.priorityCriteria.pano,i,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,xl.DIRECTIONAL_FOV_NARROW),this.canDownloadSize(o)&&this.queueTilesInDirectionForPano(_l,this.priorityCriteria.pano,o,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,xl.DIRECTIONAL_FOV_NARROW),xl.sortPanoTiles(_l,this.priorityCriteria.pano,this.priorityCriteria.cameraDir),xl.appendQueue(t,_l,"2"),_l.length=0,this.canDownloadSize(r)&&this.queueTilesInDirectionForPano(_l,this.priorityCriteria.pano,r,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,yl),this.canDownloadSize(i)&&this.queueTilesInDirectionForPano(_l,this.priorityCriteria.pano,i,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,yl),this.canDownloadSize(o)&&this.queueTilesInDirectionForPano(_l,this.priorityCriteria.pano,o,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,yl),xl.sortPanoTiles(_l,this.priorityCriteria.pano,this.priorityCriteria.cameraDir),xl.appendQueue(t,_l,"3"),this.queueTilesForPanos(t,El,n)},xl.prototype.canDownloadSize=function(t){return this.maxNavQuality>=t||this.maxZoomQuality>=t&&this.zoomingActive},xl.prototype.populateNeighborPanos=function(t,e,n){var r=n||[];r.length=0;var i=e.getNeighbours(t),o=0;for(var a in i)if(i[a]){var s=e.get(a);if(t.id!==s.id&&(r.push(s),1==++o))break}return r},xl.prototype.populateScoredPanos=function(t,e,n,r,i){(n=n||[]).length=0;var o=[Vi.filters.inPanoDirection(t.position,r),Vi.filters.not(t)],a=[Vi.scoreFunctions.distanceSquared(t),Vi.scoreFunctions.direction(t.position,r)],s=e.sortByScore(o,a);if(s)for(var l=0;l<s.length&&l<i;l++){var c=s[l].pano;n.push(c)}return n},xl.prototype.queueTilesForPanos=function(t,e,n,r){for(var i=0,o=0;o<e.length;o++){var a=e[o];if(i+=this.queueTilesForPano(t,a,n)>0?1:0,r&&i>=r)break}return i},xl.prototype.queueTilesForPano=function(){var t={filter:0};return function(e,n,r){return this.filterAndQueueTileDownloadDescriptors(e,n,r,t)}}(),xl.prototype.queueTilesInDirectionForPano=function(){var t={filter:1,direction:new L.Vector3,fov:60},e=new L.Vector3;return function(n,r,i,o,a,s){return e.copy(a),dl.getRelativeDirection(r.quaternion,e),t.direction.copy(e),t.fov=s,this.filterAndQueueTileDownloadDescriptors(n,r,i,t)}}(),xl.prototype.filterAndQueueTileDownloadDescriptors=function(){var t=[];return function(e,n,r,i){var o=gl.getTileDownloadDescriptors(n,r);t.length=0,this.filterTileDownloadDescriptors(n,o,t,i);for(var a=0,s=0;s<t.length;s++){var l=t[s];l&&(e.push(l),a++)}return a}}(),xl.prototype.filterTileDownloadDescriptors=function(t,e,n,r){switch(r.filter){case 1:for(var i=0;i<e.length;i++){var o=e[i];dl.isTileWithinFOV(o.panoSize,o.tileSize,o.face,o.tileX,o.tileY,r.direction,r.fov)&&n.push(o)}break;default:for(var a=0;a<e.length;a++){var s=e[a];n.push(s)}}for(var l=0;l<n.length;l++){var c=n[l];this.canIncludeDescriptor(c)||(n[l]=null)}},xl.prototype.canIncludeDescriptor=function(t){return t.status!==fl.Downloading&&t.status!==fl.Downloaded},xl.updateDirectionalFov=function(t){yl=.0259*t+50.2913},xl.sortPanoTiles=function(t,e,n){Sl._panoSpaceDir.copy(n),dl.getRelativeDirection(e.quaternion,Sl._panoSpaceDir),Sl._fovThresholdNarrow=He(xl.DIRECTIONAL_FOV_NARROW),Sl._fovThreshold=He(yl),t.length>0&&t.sort(Sl)},xl.insertSortedPanoTile=function(t,e,n,r){Sl._panoSpaceDir.copy(r),dl.getRelativeDirection(n.quaternion,Sl._panoSpaceDir),Sl._fovThresholdNarrow=He(xl.DIRECTIONAL_FOV_NARROW),Sl._fovThreshold=He(yl);for(var i=-1,o=0;o<t.length;o++)if(Sl(e,t[o])<=0){i=o;break}if(-1===i)t[t.length]=e;else{for(var a=t.length;a>i;a--)t[a]=t[a-1];t[i]=e}},xl.prototype.setZoomingActive=function(t,e){this.zoomingActive=t},xl.prototype.onZoomChanged=function(t){},xl.prototype.destory=function(){El=[],Tl=[],_l=[],F.setItem(this.name+" destory",!0)()};var bl,Ml,Al,Sl=function(){function t(e,n){var r=t._panoSpaceDir,i=t._fovThreshold,o=t._fovThresholdNarrow,a=Math.max(Math.min(r.dot(e.direction),1),-1),s=Math.max(Math.min(r.dot(n.direction),1),-1);return e._dot=a,n._dot=s,a>=i&&s<i?-1:a<i&&s>=i?1:a>=o&&s<o?-1:a<o&&s>=o||e.panoSize>n.panoSize?1:n.panoSize>e.panoSize?-1:-(a-s)}return t._panoSpaceDir=new L.Vector3,t._fovThreshold=-1,t._fovThresholdNarrow=-1,t}(),Ol={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1},wl=null,Ll=null,Dl=!1;function Cl(){k.carrayTileDownloader(this),wl=k.getCore(),Ll=Jt(),this.name="TileDownloader",this.panos=null,this.tilePrioritizer=null,this.refreshInterval=null,this.panoLoadCallbacks={},this.downloadDescriptors=Object.create(null),this.downloadTestResults=Object.create(null),this.priorityQueue=[],this.forceQueue=[],this.activeDownloads=[],this.concurrentDownloads=4,this.panoGroupId="",Object.defineProperties(this,{processPriorityQueue:{get:function(){return Dl},set:function(t){Dl=t}}})}Cl.prototype.init=function(){this.initTilePrioritizer()},Cl.prototype.start=function(){n.info("%c"+this.name+" start","color:#0f0;")(),this.stoped=!1,this.refreshUpdateInterval(0)},Cl.prototype.stop=function(){n.warn(this.name+" stop")(),this.stoped=!0,this.refreshInterval&&(clearTimeout(this.refreshInterval),this.refreshInterval=null),F.setItem(this.name+".stop",!0)()},Cl.prototype.initTilePrioritizer=function(){xl.updateDirectionalFov(Ll.clientWidth),this.tilePrioritizer=new xl},Cl.prototype.setPanoData=function(t,e){this.panoGroupId=t,this.panos=e},Cl.prototype.refreshUpdateInterval=function(t){var e=this;void 0===t&&(t=0),this.refreshInterval=setTimeout((function(){e.update()?e.refreshUpdateInterval(0):e.refreshUpdateInterval(500)}),t)},Cl.prototype.update=function(){var t=this.forceQueue.length>0;return this.processQueueForDownloading(this.forceQueue,void 0,"update"),this.processPriorityQueue&&(this.queuePrioritizedTilesForPanos(this.panos),this.priorityQueue.length>0&&(t=!0),this.processQueueForDownloading(this.priorityQueue,void 0,"update 2")),t},Cl.prototype.forceQueueTilesForPano=(Ml=[],Al=[],function(t,e,n,r,i,o){Ml.length=0;for(var a=this.getTileDownloadDescriptors(t,e),s=0;s<a.length;s++){var l=a[s];l.status!==fl.None&&l.status!==fl.Queued||Ml.push(l)}if(n&&Ml.length>0){xl.sortPanoTiles(Ml,t,n),Al.length=0,dl.matchingTilesInDirection(t,e,n,r,i,Al);for(var c=function(t){return t.face===h.face&&t.faceTileIndex===h.faceTileIndex},u=0;u<Ml.length;){var h=Ml[u];Al.findIndex(c)<0?Ml.splice(u,1):u++}}for(var p=0;p<Ml.length;p++)this.forceQueue.push(Ml[p]);this.setStatusForAllDescriptors(this.forceQueue,fl.ForceQueued),this.clearFromQueue(this.priorityQueue,fl.ForceQueued,!1)}),Cl.prototype.clearForceQueue=function(){this.clearQueue(this.forceQueue)},Cl.prototype.queuePrioritizedTilesForPanos=function(t){this.tilePrioritizer&&(this.clearQueue(this.priorityQueue),this.tilePrioritizer.filterAndPrioritize(this.priorityQueue,t),this.clearFromQueue(this.priorityQueue,fl.None,!0),this.setStatusOrRemoveForAllDescriptors(this.priorityQueue,fl.Queued))},Cl.prototype.clearQueue=function(t){this.setStatusForAllDescriptors(t,fl.None),t.length=0},Cl.prototype.clearFromQueue=function(t,e,n){for(var r=0;r<t.length;r++){var i=t[r];i&&(e===i.status&&!n||e!==i.status&&n)&&(t[r]=null)}},Cl.prototype.setStatusForAllDescriptors=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];r&&(r.status=e)}},Cl.prototype.setStatusOrRemoveForAllDescriptors=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];r&&(r.status!==e?r.status=e:t[n]=null)}},Cl.prototype.getTileDownloadDescriptors=function(t,e){var n=this.getAllTileDownloadDescriptorsForPano(t),r=n[e];return r||(r=this.buildDownloadDescriptorArray(e),n[e]=r,this.initTileDownloadDescriptors(r,t,e)),r},Cl.prototype.getAllTileDownloadDescriptorsForPano=function(t){var e=this.downloadDescriptors[t.id];return e||(e={},this.downloadDescriptors[t.id]=e),e},Cl.prototype.processQueueForDownloading=function(t,e,n){if(this.cleanupActiveDownloads(),this.activeDownloads.length<this.concurrentDownloads||e)var r=e?t.length:this.concurrentDownloads-this.activeDownloads.length;for(var i=0,o=0;i<r&&t.length>0;o++){var a=t.shift();a&&(this.startDownload(a),i++)}},Cl.prototype.startDownload=function(t){var e=wl.player.model.panos;if(e){var r=t.pano.id;e.get(r)?(t.status=fl.Downloading,this.activeDownloads.push(t),this.loadImage(t)):n.error("tile download error! invalid panoId: "+r)}},Cl.prototype.cleanupActiveDownloads=(bl=[],function(){bl.length=0;for(var t=0;t<this.activeDownloads.length;t++){var e=this.activeDownloads[t];e.status!==fl.Downloaded&&e.status!==fl.Failed&&bl.push(e)}this.activeDownloads.length=0,this.activeDownloads.push.apply(this.activeDownloads,bl)}),Cl.prototype.isPanoDownloaded=function(t){var e=t.pano,n=t.panoSize,r=this.getTileDownloadDescriptors(e,n);if(r.length<=0)return!1;for(var i=0,o=r.length;i<o;i++)if(r[i].status!==fl.Downloaded)return!1;return!0},Cl.prototype.buildDownloadDescriptorArray=function(t){for(var e=dl.getTileCountForSize(t),n=[],r=0;r<e;r++){var i=this.buildDownloadDescriptor();n.push(i)}return n},Cl.prototype.buildDownloadDescriptor=function(){var t=Object.create(null);return t.panoGroupId=null,t.pano=null,t.panoSize=-1,t.tileSize=-1,t.tileIndex=-1,t.totalTiles=-1,t.faceTileIndex=-1,t.status=fl.None,t.url=null,t.image=null,t.direction=new L.Vector3,t.face=-1,t.cubeFace=-1,t.tileX=-1,t.tileY=-1,t},Cl.prototype.initTileDownloadDescriptors=function(t,e,n){for(var r=0;r<t.length;r++){var i=t[r];this.initTileDownloadDescriptor(i,e,n,r)}},Cl.prototype.initTileDownloadDescriptor=function(t,e,n,r){var i=n>=dl.TILE_SIZE?dl.TILE_SIZE:n;t.face=dl.getFaceForTile(n,r),t.cubeFace=qo(t.face),t.panoGroupId=this.panoGroupId,t.pano=e,t.panoSize=n,t.tileSize=i,t.tileIndex=r,t.totalTiles=dl.getTileCountForSize(n),t.status=fl.None,t.image=null,dl.getTileLocation(t.panoSize,t.tileIndex,t),dl.getTileVector(t.panoSize,t.tileSize,t.cubeFace,t.tileX,t.tileY,dl.LocationOnTile.Center,0,t.direction)},Cl.prototype.getTileUrl=function(t,e,n,r){var i,o=_e.getRenderSet();i="2048-1024"===o?{512:"1k",1024:"2k"}:{512:"512",1024:"1k",2048:"2k",4096:"4k"},dl.getTileLocation(e,r,Ol);var a,s=~~(e/n),l=~~(r/(s*s));return a="2048-1024"===o?"multiple_1024/"+t+"/"+i[e]+"_face"+l+"_"+Ol.tileX+"_"+Ol.tileY+".jpg":"multiple/"+t+"/"+i[e]+"_face"+l+"_"+Ol.tileX+"_"+Ol.tileY+".jpg",_e.getPanoTileUrl()+a},Cl.prototype.getTileUrl2=function(t,e,n){var r=_e.getAutoCropServer(),i=_e.getPano6CubeUrl()[t];dl.getTileLocation(e,n,Ol);var o,a=dl.getFaceForTile(e,n),s="",l=Ol.tileX*dl.TILE_SIZE,c=Ol.tileY*dl.TILE_SIZE;switch(o=t+"_"+a+".jpg",r){case"oss":s="?x-oss-process=image/resize,m_fixed,limit_0,w_"+e+",h_"+e+"/crop,w_"+dl.TILE_SIZE+",h_"+dl.TILE_SIZE+",x_"+l+",y_"+c;break;case"minio":s="&fit=fill&w="+e+"&h="+e+"&cw="+dl.TILE_SIZE+"&ch="+dl.TILE_SIZE+"&cx="+l+"&cy="+c+"&q=100"}return""+i+o+s},Cl.prototype.loadImage=function(t){var e=this;Le(_e.isSupportAutoCropTile()?this.getTileUrl2(t.pano.id,t.panoSize,t.tileIndex):this.getTileUrl(t.pano.id,t.panoSize,t.tileSize,t.tileIndex)).then((function(r){e.stoped?n.warn("model is changed!, downloaded tile invalid!")():(t.image=r,e.downloadComplete(t))})).catch((function(r){n.error("loadImage catch error:",r)(),e.downloadFailed(t)}))},Cl.prototype.clear=function(){this.tilePrioritizer&&this.tilePrioritizer.destory(),this.downloadDescriptors=Object.create(null),this.downloadTestResults=Object.create(null),this.forceQueue=[],this.priorityQueue=[],this.panos=null,this.processPriorityQueue=!1,this.panoLoadCallbacks={},this.activeDownloads=[],F.setItem(this.name+".clear",!0)()},Cl.prototype.onFrameUpdate=function(){if(!this.stoped&&wl.player.currentPano){var t=wl.player.currentPano,e=wl.player.position,n=wl.sceneRender.camera.getDirection();this.tilePrioritizer.updateCriteria(t,e,n,null),this.processPriorityQueue=!0}},Cl.prototype.downloadFailed=function(t){n.error(this.name+" download failure",t)()},Cl.prototype.downloadComplete=function(t){if(t.panoGroupId===this.panoGroupId){t.status=fl.Downloaded;var e=Object.create(null);e.panoId=t.pano.id,e.image=t.image,e.tileSize=t.tileSize,e.panoSize=t.panoSize,e.tileIndex=t.tileIndex,e.faceTileIndex=t.faceTileIndex,e.totalTiles=t.totalTiles,e.face=t.face,e.tileX=t.tileX,e.tileY=t.tileY,e.direction=t.direction,wl.panoRenderer.onTileDownloaded(e)}else n.warn("tile not belong to the group: "+t.panoGroupId+" - "+this.panoGroupId)()};var Pl=0,Nl=function(t,e){this.pid=e?e.id:null,this.children=[],this.id=++Pl},Rl=new Map;function Il(t,e){var n;this.name="TileThree",this.root=null,this.levels=e,this.tileSize=t,(n=this).root=function t(e,n,r){if(r>e.levels)return null;var i=new Nl(e,n);Rl.set(i.id,i);for(var o=0;o<4;o++)i.children[o]=t(e,i,r+1);return i}(n,null,0)}Il.prototype.getSubNode=function(t,e,n){(!e||t<this.tileSize)&&(e=0),(!n||t<this.tileSize)&&(n=0),t<this.tileSize&&(t=this.tileSize);var r=Il.getLevelCountForSize(this.tileSize,t,"getSubNode");return function t(e,n,r,i,o){if(!e)return null;if(0===r)return e;if(!e.children||0===e.children.length)return null;var a=Math.pow(2,r)/2,s=i%a,l=o%a,c=2*Math.floor(o/a)+Math.floor(i/a);return t(e.children[c],n+1,r-1,s,l)}(this.root,0,r,e,n)},Il.prototype.breadthFirst=function(t){void 0===t&&(t=Object.create(null));var e=t.maxLevel,n=t.minLevel,r=t.callback,i=t.saveVisited,o=[],a=Object.create(null),s=0;for(o.push(this.root),o.push(a);o.length>0&&!(e&&s>e);){var l=o.shift();if(l===a)o.length>0&&o.push(a),s++;else{if(l.children)for(var c=0,u=l.children.length;c<u;++c)l.children[c]&&o.push(l.children[c]);var h=this.getFaceIndexFromNode(l);(!n||s>=n)&&(r&&r(l,s,h),i&&i.push(l))}}},Il.prototype.getFaceIndexFromNode=function(t){if(!t)return-1;for(var e=1,n=t,r=0,i=0;;){var o=Rl.get(n.pid);if(!o)break;for(var a=-1,s=0;s<o.children.length;s++)o.children[s]===n&&(a=s);r=a%2*e+r,i=Math.floor(a/2)*e+i,e*=2,n=o}return i*e+r},Il.prototype.destory=function(){F.setItem(this.name+".destory",!0)(),Rl.clear()},Il.TraversalType=Object.freeze({PreOrder:0,PostOrder:1}),Il.getLevelCountForSize=function(t,e,n){for(var r=0;!((e/=2)<t);)r++;return r},Il.getSizeForLevel=function(t,e){return Math.pow(2,e)*t},Il.getNode=function(t){return Rl.get(t)};var Ul="\n\n  varying vec3 vWorldPos;\n\n  void main() {\n\n    vWorldPos = vec3(-position.x, -position.y, position.z);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n  }\n\n",Bl="\n\n  varying vec3 vWorldPos;\n\n  uniform float alpha;\n  uniform samplerCube tDiffuse;\n\n  void main() {\n\n    vec4 texColor = textureCube(tDiffuse, vWorldPos);\n\n    gl_FragColor = vec4(texColor.rgb, texColor.a * alpha);\n\n  }\n\n";function Fl(t){switch(t){case L.ClampToEdgeWrapping:return"CLAMP_TO_EDGE";case L.LinearFilter:return"LINEAR";case L.LinearMipMapLinearFilter:return"LINEAR_MIPMAP_LINEAR"}}var Hl=null,kl=!1,zl=null,Gl=null,Wl=null,Vl=null,jl=null,Yl=null,Xl=null,Zl=null,ql=null,Ql=0,Kl=100,Jl=function(){ql=k.getCore(),this.name="PanoRenderer",this.activePanos=[],this.forceQueue=[],this.needActivePanos=[],this.tileDirectory=Object.create(null),this.activeRenderTargetDescriptors=Object.create(null),this.panoLODDescriptors=Object.create(null),this.panoDescriptors=Object.create(null),this.tileTrees=Object.create(null),this.uploadQueues=Object.create(null),this.overlayTilesBasic=Object.create(null),this.overlayTilesEnhanced=Object.create(null),this.uploadInterval=null,this.uploadIntervalCancelled=!1,this.overlayTilesLoaded=!1,this.overlayTileBase=null,this.zoomRenderTarget=null,this.zoomPano=null,this.zoomingActive=!1,this.zoomPanoId=null,this.zoomPanoRenderingDisabled=!1,this.direction=new L.Vector3,this.maxBaseUploadsPerFrame=6,this.maxNonBaseUploadsPerFrame=2,this.initialIntervalDelay=0,this.uploadIntervalDelay=10,this.stoped=!1,this.descriptorList=[],this.nodeList=[],this.lastTime_update=performance.now(),this.tilesInfoOfNodeId=new Map,this.updateCount=0};Jl.prototype.getActiveRenderTargetDescriptor=function(t){return this.activeRenderTargetDescriptors[t]},Jl.prototype.setActiveRenderTargetDescriptor=function(t,e){this.activeRenderTargetDescriptors[t]=e},Jl.prototype.setupZoomRenderTarget=function(t){this.zoomRenderTarget=this.createRenderTarget(ql.qualityManager.getMaxZoomPanoSize(),"setup zoom render target")},Jl.prototype.activateTiledPano=function(t,e,n){n&&this.clearAllQueuedUploads();for(var r=0;r<dl.FACES_PER_PANO;r++)this.initTileTree(t.id,r,ql.qualityManager.getMaxPossiblePanoSize());this.linkAllTilesAndNodes(t);var i=this.getActiveRenderTargetDescriptor(t.id);if(!i||e!==i.size){if(i&&this.disableDescriptor(i.renderTarget),!(i=this.enableDescriptor(e))){var o=this.createRenderTarget(e,"activate tiled pano");o.id=t.id,(i=this.buildDescriptor(o.width)).renderTarget=o}i.pano=t,this.resetPanoLODDescriptors(t.id),this.resetRenderStatus(t.id,!0,!0)}this.setActiveRenderTargetDescriptor(t.id,i);var a=n?0:1;return this.updateActivePanos(t,a),i.renderTarget},Jl.prototype.activeLoadedPano=function(t,e){this.linkAllTilesAndNodes(t);var n=this.enableDescriptor(e);if(!n){var r=this.createRenderTarget(e,"activate tiled pano");r.id=t.id,(n=this.buildDescriptor(r.width)).renderTarget=r}return n.pano=t,this.resetPanoLODDescriptors(t.id),this.resetRenderStatus(t.id,!0,!0),this.setActiveRenderTargetDescriptor(t.id,n),this.updateActivePanos(t,1),n.renderTarget},Jl.prototype.resetPanoDescriptor=function(t){this.getPanoDescriptor(t)},Jl.prototype.deactivateTiledPano=function(t){var e=this.getActiveRenderTargetDescriptor(t.id);this.isRenderTargetDescriptorValid(e)&&this.disableDescriptor(e.renderTarget),this.setActiveRenderTargetDescriptor(t.id,null);var n=this.getUploadQueueForPano(t.id);this.clearUploadQueue(n),this.updateActivePanos()},Jl.prototype.updateActivePanos=function(t,e){var n;this.needActivePanos.length=0;for(var r=0;r<this.activePanos.length;r++){t&&this.needActivePanos.length===e&&this.needActivePanos.push(t);var i=this.activePanos[r],o=this.getActiveRenderTargetDescriptor(i.id);t&&i.id===t.id||this.isRenderTargetDescriptorValid(o)&&this.needActivePanos.push(i)}e>=this.needActivePanos.length&&t&&this.needActivePanos.push(t),this.activePanos.length=0,(n=this.activePanos).push.apply(n,this.needActivePanos)},Jl.prototype.resetRenderStatus=function(t,e,n,r){var i=this,o=function(t){var r=t.id,o=i.tilesInfoOfNodeId.get(r);n&&(o.zoomUploaded=!1),e&&(o.uploaded=!1)},a=null;r&&(a=Il.getLevelCountForSize(dl.TILE_SIZE,r,"resetRenderStatus")+1);for(var s=0;s<dl.FACES_PER_PANO;s++)this.getTileTree(t,s).breadthFirst({callback:function(t,e,n){o(t)},minLevel:a})},Jl.prototype.copyBaseRenderStatusToZoomed=function(t){for(var e=this,n=Il.getLevelCountForSize(dl.TILE_SIZE,ql.qualityManager.getMaxNavPanoSize(),"copyBaseRenderStatusToZoomed"),r=function(t){var n=t.id,r=e.tilesInfoOfNodeId.get(n);r.zoomUploaded=r.uploaded,t.zoomCovered=t.covered},i=0;i<dl.FACES_PER_PANO;i++)this.getTileTree(t,i).breadthFirst({callback:function(t){r(t)},maxLevel:n})},Jl.prototype.renderPanoTiles=function(t,e){var r=_e.getRenderSet(),i=ql.qualityManager.detectMaxZoomPanoSize()>ql.qualityManager.detectMaxNavPanoSize();!1===this.zoomPanoRenderingDisabled&&("1024-512"===r&&!this.zoomRenderTarget&i&&this.setupZoomRenderTarget("1024-512"),"2048-512"===r&&!this.zoomRenderTarget&i&&this.setupZoomRenderTarget("2048-512")),e=e||this.direction||Ie.FORWARD;var o=this.getActiveRenderTargetDescriptor(t);this.isRenderTargetDescriptorValid(o)||n.warn("PanoRenderer.renderPanoTiles() -> Cannot render to a pano that is not activated.")();for(var a=0;a<dl.FACES_PER_PANO;a++){var s=this.getTileTree(t,a);this.nodeList.length=0,s.breadthFirst({saveVisited:this.nodeList});for(var l=0,c=this.nodeList.length;l<c;l++){var u=this.nodeList[l],h=this.tilesInfoOfNodeId.get(u.id);this.queueTileUpload(h,!1)}}this.updateDirection(e)},Jl.prototype.isRenderTargetDescriptorValid=function(t){if(t)return t.renderTarget},Jl.prototype.isPanoActive=function(t){var e=this.getActiveRenderTargetDescriptor(t);return this.isRenderTargetDescriptorValid(e)},Jl.prototype.isPanoZoomed=function(t){return this.zoomingActive&&this.zoomPanoId===t},Jl.prototype.initTileTree=function(t,e,n){void 0===this.tileTrees[t]&&(this.tileTrees[t]=[]);var r=this.tileTrees[t],i=r[e];if(void 0===i){var o=Il.getLevelCountForSize(dl.TILE_SIZE,n,"init.tile.tree");i=new Il(dl.TILE_SIZE,o),r[e]=i}},Jl.prototype.getTileTree=function(t,e){var r=this.tileTrees[t];r||n.info("PanoRenderer.getTileTree() -> Tree array not yet initialized!")();var i=r[e];return i||n.info("PanoRenderer.getTileTree() -> Tree not yet initialized!")(),i},Jl.prototype.createRenderTarget=function(t,e){"2048-1024"===_e.getRenderSet()&&(t*=2);var n=null;return"118"==L.REVISION&&(n=new L.WebGLCubeRenderTarget(t,{stencilBuffer:!1,depthBuffer:!1})),"130"==L.REVISION&&(n=new L.WebGLCubeRenderTarget(t,{stencilBuffer:!1,depthBuffer:!1})),n.viewport.set(0,0,n.width,n.height),n},Jl.prototype.getUploadQueueForPano=function(t){var e=this.uploadQueues[t];return e||(e=[],this.uploadQueues[t]=e),e},Jl.prototype.getNextItemFromQueue=function(t){var e=t.shift();return e.uploadQueued=!1,e},Jl.prototype.getNextFromUploadQueue=function(){if(this.forceQueue.length>0)return this.getNextItemFromQueue(this.forceQueue);var t=this.getTopUploadQueue();return t&&t.length>0?this.getNextItemFromQueue(t):null},Jl.prototype.isTileUploaded=function(t){return this.isPanoZoomed(t.panoId)?t.zoomUploaded:t.uploaded},Jl.prototype.setUploaded=function(t,e){this.isPanoZoomed(t.panoId)?t.zoomUploaded=e:t.uploaded=e},Jl.prototype.queueTileUpload=function(t,e,n){var r=this.getActiveRenderTargetDescriptor(t.panoId);if(this.isRenderTargetDescriptorValid(r)&&t.downloaded&&!this.isTileUploaded(t)&&(!t.uploadQueued||n)&&(t.panoSize<=ql.qualityManager.getMaxNavPanoSize()||this.zoomingActive)){var i=this.getUploadQueueForPano(t.panoId);n?this.uploadTile(t,!1,"queueTileUpload"):(this.shoulPushToFrontOfQueue(t)?this.forceQueue.push(t):e&&this.direction?xl.insertSortedPanoTile(i,t,r.pano,this.direction):i.push(t),t.uploadQueued=!0,this.uploadInterval||this.uploadIntervalCancelled||this.refreshUploadInterval(this.initialIntervalDelay))}},Jl.prototype.shoulPushToFrontOfQueue=function(t){return 0===Il.getLevelCountForSize(dl.TILE_SIZE,t.panoSize,"shouldPushToFrontOfQueue")},Jl.prototype.getTopUploadQueue=function(){for(var t=null,e=null,n=Ql;n<=Kl;n++)for(var r=0;r<this.activePanos.length;r++)if(t=this.activePanos[r],(e=this.getUploadQueueForPano(t.id)).length>0)switch(n){case Ql:if(0===e[0].level)return e;break;case Kl:return e}return null},Jl.prototype.peekNextFromUploadQueue=function(){if(this.forceQueue.length>0)return this.forceQueue[0]},Jl.prototype.clearAllQueuedUploads=function(){this.clearAllUploadQueues(null,0)},Jl.prototype.clearAllUploadQueues=function(t,e){if(t)this.clearUploadQueue(this.getUploadQueueForPano(t),e),this.clearUploadQueue(this.forceQueue,e,t);else{for(var n=0;n<this.activePanos.length;n++){var r=this.activePanos[n];this.clearUploadQueue(this.getUploadQueueForPano(r.id),e)}this.clearUploadQueue(this.forceQueue,e)}},Jl.prototype.clearUploadQueue=function(t,e,n){void 0===e&&(e=0);for(var r=0;r<t.length;){var i=t[r];n&&n===i.tile.panoId&&i.level>=e?(i.uploadQueued=!1,t.splice(r,1)):r++}},Jl.prototype.refreshUploadInterval=function(t){var e=this;this.uploadIntervalCancelled||(this.uploadInterval=setTimeout((function(){e.uploadIntervalCancelled||e.overlayTilesLoaded||(e.updateUploadQueue(e.maxNonBaseUploadsPerFrame,e.maxBaseUploadsPerFrame),e.peekNextFromUploadQueue()?e.refreshUploadInterval(e.uploadIntervalDelay):e.clearUploadInterval())}),t),this.uploadIntervalDelay=t)},Jl.prototype.start=function(){n.info("%c"+this.name+" start","color:#0f0;")(),this.stoped=!1,this.uploadIntervalCancelled=!1},Jl.prototype.stop=function(){n.warn(this.name+" stop")(),this.stoped=!0,this.uploadIntervalCancelled=!0,this.clearUploadInterval()},Jl.prototype.update=function(){if(this.uploadIntervalCancelled=!0,this.clearUploadInterval(),(performance.now()-this.lastTime_update>this.uploadIntervalDelay||0===this.updateCount)&&(this.updateUploadQueue(this.maxNonBaseUploadsPerFrame,this.maxBaseUploadsPerFrame),this.lastTime_update=performance.now()),this.updateCount++,G.PANORAMA===ql.player.mode){var t=ql.sceneRender.camera.getDirection();this.updateDirection(t)}},Jl.prototype.updateUploadQueue=function(t,e){void 0===t&&(t=1);for(var n=0;!(0>=e||n>=t);){var r=this.getNextFromUploadQueue();if(!r)break;if(0!==r.level?n++:e++,r.panoSize<=ql.qualityManager.getMaxNavPanoSize()||this.zoomingActive){var i=this.getActiveRenderTargetDescriptor(r.panoId);this.isRenderTargetDescriptorValid(i)&&this.uploadTile(r,r.forceUpload,"updateUploadQueue")}}},Jl.prototype.updateDirection=function(t){this.direction=t||this.direction;for(var e=0;e<this.activePanos.length;e++){var n=this.activePanos[e],r=this.getUploadQueueForPano(n.id);xl.sortPanoTiles(r,n,this.direction)}},Jl.prototype.uploadTile=function(t,e,r){var i=t.panoId,o=t.image,a=t.tileSize,s=t.panoSize,l=t.tileIndex,c=t.totalTiles,u=t.tileX,h=t.tileY;"2048-1024"===_e.getRenderSet()&&(a*=2,s*=2);var p=!0;this.getPanoDescriptor(i);var d=this.getPanoLODDescriptor(i,s),f=this.getActiveRenderTargetDescriptor(i),m=f.renderTarget,v=f.size,g=ql.player.model.panos.get(i);if(this.isPanoZoomed(i)){if(!this.zoomRenderTarget)return void n.error("unget zoom render target!")();m=this.zoomRenderTarget,v=ql.qualityManager.getMaxZoomPanoSize()}this.isRenderTargetDescriptorValid(f)||(p=!1);var y=Il.getNode(t.nodeId);if(e||(this.anyUploaded(y)&&(p=!1),this.isTileUploaded(t)&&(p=!1)),p){var _=a/s*v,E=u*a/s*v,T=h*a/s*v;if("off"!==Kt("render_tile")){var x=function(t,e){null===Hl&&(Hl=k.getCore());var n=Hl.sceneRender.renderer,r=Hl.sceneRender.glContext;n.state;var i=new L.Texture(null);i.flipY=!1,i.generateMipmaps=!1;var o=n.properties.get(i),a=r.createTexture();a.name="gl.texture."+e.panoId+".level_"+e.level+".face_"+e.faceTileIndex+".tileX_"+e.tileX+".tileY_"+e.tileY,r.bindTexture(r.TEXTURE_2D,a),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,i.flipY),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,t,0,r.RGBA,r.UNSIGNED_BYTE,null);var s=L.ClampToEdgeWrapping;return i.wrapS=s,i.wrapT=s,r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),i.magFilter=L.LinearFilter,i.minFilter=L.LinearFilter,r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),o.__webglTexture=a,r.bindTexture(r.TEXTURE_2D,null),i}(a,t);!function(t,e,n,r){null===Hl&&(Hl=k.getCore()),Hl.sceneRender.textureMap.push(e);var i=Hl.sceneRender.renderer,o=Hl.sceneRender.glContext,a=i.properties.get(e).__webglTexture,s=Fl(e.wrapS),l=Fl(e.wrapT),c=Fl(e.minFilter),u=Fl(e.magFilter);o.bindTexture(o.TEXTURE_2D,a),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,e.unpackAlignment),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o[s]),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o[l]),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o[c]),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o[u]),o.texSubImage2D(o.TEXTURE_2D,0,n,r,o.RGBA,o.UNSIGNED_BYTE,t),o.bindTexture(o.TEXTURE_2D,null),t=null}(o,x,0,0),function(t,e,n,r,i,o,a,s,l,c,u,h,p){null===Hl&&(Hl=k.getCore()),null===jl&&(jl=new L.Scene),null===Yl&&((Yl=new L.OrthographicCamera(-.5,.5,.5,-.5,-1,1)).position.z=1),null===Xl&&(Xl=new L.PlaneBufferGeometry(1,1)),null===Zl&&(Zl=new L.ShaderMaterial({uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:Ko,fragmentShader:Jo,side:L.FrontSide,depthWrite:!1,depthTest:!1}));var d=Hl.sceneRender.renderer,f=Hl.sceneRender.glContext,m=p.cubeFace,v=new L.Mesh(Xl,Zl);v.name="tile.plane."+p.panoId+".level_"+p.level+".face_"+p.faceTileIndex+".tileX_"+p.tileX+".tileY_"+p.tileY,jl.add(v);var g=Xl.getAttribute("position"),y=g.array,_=l/e.width-.5,E=c/e.height-.5,T=u/e.width,x=h/e.height;y[0]=_,y[1]=E+x,y[2]=0,y[3]=_+T,y[4]=E+x,y[5]=0,y[6]=_,y[7]=E,y[8]=0,y[9]=_+T,y[10]=E,y[11]=0,g.needsUpdate=!0,Zl.transparent=!1,Zl.uniforms.tDiffuse.value=t,Zl.blending=L.NoBlending,Zl.uniforms.alpha.value=1,Zl.needUpdate=!0,d.autoClear=!1,d.setRenderTarget(e,m),d.render(jl,Yl),d.setRenderTarget(null),d.autoClear=!0,v.geometry.dispose(),jl.remove(v);var b=d.properties.get(t);f.deleteTexture(b.__webglTexture),d.properties.remove(t)}(x,m,0,0,0,0,0,0,E,T,_,_,t)}d.uploadCount++,g.onTileRendered(i,s,l,c),d.uploadCount===c&&g.onPanoRendered(i,s,c);var b=Il.getNode(t.nodeId);this.setUploaded(t,!0),this.addCoverageForNode(b)}else this.setUploaded(t,!1);t.uploadAttempted||d.uploadAttempts++,t.uploadAttempted=!0,d.uploadAttempts===c&&g.onUploadAttemptedForAllTiles(i,s,c)},Jl.prototype.linkTileAndNode=function(t,e,r){if(e){var i=e.id;t.nodeId=i,e.tile_pano_id=t.panoId,e.tile_face=t.face,e.tile_X=t.tileX,e.tile_Y=t.tileY,this.tilesInfoOfNodeId.set(i,t)}else n.error("unget node:",e)()},Jl.prototype.linkAllTilesAndNodes=function(t){for(var e=this,n=function(n){e.getTileTree(t.id,n).breadthFirst({callback:function(r,i,o){!function(n,r,i,o){var a=e.getTileDirectoryEntry(t.id,n,i,o,"link all tiles and quadtree nodes");e.linkTileAndNode(a,r,"link.all.tiles.and.nodes")}(n,r,i,o)}})},r=0;r<dl.FACES_PER_PANO;++r)n(r)},Jl.prototype.anyUploaded=function(t){if(!t)return!1;var e=this.tilesInfoOfNodeId.get(t.id);if(e&&this.isTileUploaded(e))return!0;if(t.children.length>0)for(var n=0;n<t.children.length;++n){var r=t.children[n];if(this.anyUploaded(r))return!0}return!1},Jl.prototype.setNodeCovered=function(t,e){var n=this.tilesInfoOfNodeId.get(t.id);this.isPanoZoomed(n.panoId)?t.zoomCovered=e:t.covered=e},Jl.prototype.isNodeCovered=function(t){if(t){var e=this.tilesInfoOfNodeId.get(t.id);return this.isPanoZoomed(e.panoId)?t.zoomCovered:t.covered}return!1},Jl.prototype.addCoverageForNode=function(t){if(this.setNodeCovered(t,!0),null!==t.pid&&t.covered){var e=Il.getNode(t.pid);this.nodeSubcovered(e)&&this.addCoverageForNode(e)}},Jl.prototype.nodeSubcovered=function(t){if(!t.children)return!1;for(var e=0;e<t.children.length;++e)if(!t.children[e]||!this.isNodeCovered(t.children[e]))return!1;return!0},Jl.prototype.getPanoDescriptor=function(t){var e=this.panoDescriptors[t];return void 0===e&&(e=Object.create(null),this.panoDescriptors[t]=e),e},Jl.prototype.resetPanoLODDescriptors=function(t){var e=this.getPanoLODDescriptors(t);for(var n in e)if(e[n]){var r=e[n];r.uploadCount=0,r.uploadAttempts=0}},Jl.prototype.getPanoLODDescriptor=function(t,e){var n=this.getPanoLODDescriptors(t),r=n[e];return r||(r={uploadCount:0,uploadAttempts:0},n[e]=r),r},Jl.prototype.getPanoLODDescriptors=function(t){var e=this.panoLODDescriptors[t];return e||(e=Object.create(null),this.panoLODDescriptors[t]=e),e},Jl.prototype.getTileDirectoryEntry=function(t,e,n,r,i){var o=this.tileDirectory[t];o||(o=Object.create(null),this.tileDirectory[t]=o);var a=t+".face_"+e+".tile_level."+n+".tile_index."+r,s=o[a];return s||((s=Object.create(null)).downloaded=!1,s.uploaded=!1,s.zoomUploaded=!1,s._key=t+":"+e+":"+n+":"+r,s._tileKey=a,o[a]=s,s)},Jl.prototype.updateZoomedPanoFromBase=function(t){if(!0!==this.zoomPanoRenderingDisabled){var e=this.getActiveRenderTargetDescriptor(t.id);if(e&&e.renderTarget){ql.qualityManager.getMaxZoomPanoSize();var n=e.renderTarget;e.size,function(t,e,n,r,i,o){var a=Hl.sceneRender.renderer,s=null,l=new L.Euler;!1===kl&&(Wl=new L.Scene,(Vl=new L.OrthographicCamera(-1,1,1,-1,0,200)).position.set(0,0,0),Gl=new L.ShaderMaterial({uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:Ul,fragmentShader:Bl,depthWrite:!1,depthTest:!1,side:L.BackSide}),s=new L.BoxGeometry(2,2,2),zl=new L.Mesh(s,Gl),Wl.add(zl),kl=!0);for(var c=0;c<6;c+=1)dl.getCubeOrientationForCubeFace(c,l),zl.rotation.copy(l),Gl.uniforms.tDiffuse.value=t,Gl.blending=L.NoBlending,Gl.transparent=!1,Gl.uniforms.alpha.value=.2,Gl.needUpdate=!0,a.autoClear=!1,a.setRenderTarget(e,c),a.render(Wl,Vl),a.setRenderTarget(null),a.autoClear=!0}(n.texture,this.zoomRenderTarget),this.copyBaseRenderStatusToZoomed(t.id)}}},Jl.prototype.getActivePanoCount=function(){return this.activePanos.length},Jl.prototype.clearAllQueuedUploadsForPano=function(t){this.clearAllUploadQueues(t,0)},Jl.prototype.setZoomingActive=function(t,e,n){if(this.name,!0===t){if(!0===this.zoomPanoRenderingDisabled)return;if(this.zoomPanoId===e.id)return;this.zoomingActive=!0,this.zoomPanoId=e.id,this.updateZoomedPanoFromBase(e)}!1===t&&(this.zoomingActive=!1,this.zoomPanoId=null)},Jl.prototype.onTileDownloaded=function(t){var e=Il.getLevelCountForSize(dl.TILE_SIZE,t.panoSize,"onTileDownloaded"),n=this.getTileDirectoryEntry(t.panoId,t.face,e,t.faceTileIndex,"on tile downloaded");if(n.downloaded=!0,n.tileSize=t.tileSize,n.panoSize=t.panoSize,n.panoId=t.panoId,n.nodeId=null,n.tileX=t.tileX,n.tileY=t.tileY,n.totalTiles=t.totalTiles,n.tileIndex=t.tileIndex,n.faceTileIndex=t.faceTileIndex,n.face=t.face,n.cubeFace=qo(t.face),n.image=t.image,n.direction=(new L.Vector3).copy(t.direction),n.level=e,this.isPanoActive(n.panoId)){var r=this.getTileTree(n.panoId,n.face).getSubNode(n.panoSize,n.tileX,n.tileY);this.linkTileAndNode(n,r,"on.tile.download"),this.queueTileUpload(n,!0)}},Jl.prototype.buildDescriptor=function(t){var e=this.generatorDescriptor();return e.inUse=!0,e.size=t,this.addDescriptor(e),e},Jl.prototype.generatorDescriptor=function(){return{renderTarget:null,inUse:!1,size:-1,pano:null}},Jl.prototype.addDescriptor=function(t){this.descriptorList.push(t)},Jl.prototype.enableDescriptor=function(t){for(var e=0;e<this.descriptorList.length;e++){var n=this.descriptorList[e];if(!n.inUse&&n.size===t)return n.inUse=!0,n}return null},Jl.prototype.disableDescriptor=function(t){for(var e=0,n=this.descriptorList.length;e<n;++e){var r=this.descriptorList[e];if(r.renderTarget===t){r.inUse=!1;break}}},Jl.prototype.clearTileTrees=function(){var t=this;Object.keys(this.tileTrees).forEach((function(e){t.tileTrees[e].forEach((function(t){t.destory()})),delete t.tileTrees[e]}))},Jl.prototype.clearUploadInterval=function(){this.uploadInterval&&(clearTimeout(this.uploadInterval),this.uploadInterval=null)},Jl.prototype.clear=function(){this.descriptorList=[],this.activePanos=[],this.needActivePanos=[],this.activeRenderTargetDescriptors={},this.panoDescriptors=Object.create(null),this.panoLODDescriptors=Object.create(null),this.tileDirectory=Object.create(null),this.uploadQueues=Object.create(null),this.clearTileTrees(),this.tilesInfoOfNodeId.clear(),this.zoomRenderTarget&&(this.zoomRenderTarget.dispose(),this.zoomRenderTarget=null),F.setItem(this.name+".clear",!0)()};var $l=a((function(t){
/**
	   * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
	   * Released under the Apache License, Version 2.0
	   * see: https://github.com/dcodeIO/long.js for details
	   */
!function(e,n){t&&t.exports?t.exports=n():(e.dcodeIO=e.dcodeIO||{}).Long=n()}(o,(function(){function t(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var n={},r={};function i(t,e){var i,o,s;return e?(s=0<=(t>>>=0)&&t<256)&&(o=r[t])?o:(i=a(t,(0|t)<0?-1:0,!0),s&&(r[t]=i),i):(s=-128<=(t|=0)&&t<128)&&(o=n[t])?o:(i=a(t,t<0?-1:0,!1),s&&(n[t]=i),i)}function o(t,e){if(isNaN(t)||!isFinite(t))return e?m:f;if(e){if(t<0)return m;if(t>=h)return E}else{if(t<=-p)return T;if(t+1>=p)return _}return t<0?o(-t,e).neg():a(t%u|0,t/u|0,e)}function a(e,n,r){return new t(e,n,r)}t.fromInt=i,t.fromNumber=o,t.fromBits=a;var s=Math.pow;function l(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return f;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(t.substring(1),e,n).neg();for(var i=o(s(n,8)),a=f,c=0;c<t.length;c+=8){var u=Math.min(8,t.length-c),h=parseInt(t.substring(c,c+u),n);if(u<8){var p=o(s(n,u));a=a.mul(p).add(o(h))}else a=(a=a.mul(i)).add(o(h))}return a.unsigned=e,a}function c(e){return e instanceof t?e:"number"==typeof e?o(e):"string"==typeof e?l(e):a(e.low,e.high,e.unsigned)}t.fromString=l,t.fromValue=c;var u=4294967296,h=u*u,p=h/2,d=i(1<<24),f=i(0);t.ZERO=f;var m=i(0,!0);t.UZERO=m;var v=i(1);t.ONE=v;var g=i(1,!0);t.UONE=g;var y=i(-1);t.NEG_ONE=y;var _=a(-1,2147483647,!1);t.MAX_VALUE=_;var E=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=E;var T=a(0,-2147483648,!1);t.MIN_VALUE=T;var x=t.prototype;return x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*u+(this.low>>>0):this.high*u+(this.low>>>0)},x.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var e=o(t),n=this.div(e),r=n.mul(e).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var i=o(s(t,6),this.unsigned),a=this,l="";;){var c=a.div(i),u=(a.sub(c.mul(i)).toInt()>>>0).toString(t);if((a=c).isZero())return u+l;for(;u.length<6;)u="0"+u;l=""+u+l}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},x.isZero=function(){return 0===this.high&&0===this.low},x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1==(1&this.low)},x.isEven=function(){return 0==(1&this.low)},x.equals=function(t){return e(t)||(t=c(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},x.eq=x.equals,x.notEquals=function(t){return!this.eq(t)},x.neq=x.notEquals,x.lessThan=function(t){return this.comp(t)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(t){return this.comp(t)<=0},x.lte=x.lessThanOrEqual,x.greaterThan=function(t){return this.comp(t)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(t){return this.comp(t)>=0},x.gte=x.greaterThanOrEqual,x.compare=function(t){if(e(t)||(t=c(t)),this.eq(t))return 0;var n=this.isNegative(),r=t.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(v)},x.neg=x.negate,x.add=function(t){e(t)||(t=c(t));var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=t.high>>>16,l=65535&t.high,u=t.low>>>16,h=0,p=0,d=0,f=0;return d+=(f+=o+(65535&t.low))>>>16,p+=(d+=i+u)>>>16,h+=(p+=r+l)>>>16,h+=n+s,a((d&=65535)<<16|(f&=65535),(h&=65535)<<16|(p&=65535),this.unsigned)},x.subtract=function(t){return e(t)||(t=c(t)),this.add(t.neg())},x.sub=x.subtract,x.multiply=function(t){if(this.isZero())return f;if(e(t)||(t=c(t)),t.isZero())return f;if(this.eq(T))return t.isOdd()?T:f;if(t.eq(T))return this.isOdd()?T:f;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(d)&&t.lt(d))return o(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,i=this.low>>>16,s=65535&this.low,l=t.high>>>16,u=65535&t.high,h=t.low>>>16,p=65535&t.low,m=0,v=0,g=0,y=0;return g+=(y+=s*p)>>>16,v+=(g+=i*p)>>>16,g&=65535,v+=(g+=s*h)>>>16,m+=(v+=r*p)>>>16,v&=65535,m+=(v+=i*h)>>>16,v&=65535,m+=(v+=s*u)>>>16,m+=n*p+r*h+i*u+s*l,a((g&=65535)<<16|(y&=65535),(m&=65535)<<16|(v&=65535),this.unsigned)},x.mul=x.multiply,x.divide=function(t){if(e(t)||(t=c(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?m:f;var n,r,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return m;if(t.gt(this.shru(1)))return g;i=m}else{if(this.eq(T))return t.eq(v)||t.eq(y)?T:t.eq(T)?v:(n=this.shr(1).div(t).shl(1)).eq(f)?t.isNegative()?v:y:(r=this.sub(t.mul(n)),i=n.add(r.div(t)));if(t.eq(T))return this.unsigned?m:f;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=f}for(r=this;r.gte(t);){n=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),l=a<=48?1:s(2,a-48),u=o(n),h=u.mul(t);h.isNegative()||h.gt(r);)h=(u=o(n-=l,this.unsigned)).mul(t);u.isZero()&&(u=v),i=i.add(u),r=r.sub(h)}return i},x.div=x.divide,x.modulo=function(t){return e(t)||(t=c(t)),this.sub(this.div(t).mul(t))},x.mod=x.modulo,x.not=function(){return a(~this.low,~this.high,this.unsigned)},x.and=function(t){return e(t)||(t=c(t)),a(this.low&t.low,this.high&t.high,this.unsigned)},x.or=function(t){return e(t)||(t=c(t)),a(this.low|t.low,this.high|t.high,this.unsigned)},x.xor=function(t){return e(t)||(t=c(t)),a(this.low^t.low,this.high^t.high,this.unsigned)},x.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):a(0,this.low<<t-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):a(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0==(t&=63))return this;var n=this.high;return t<32?a(this.low>>>t|n<<32-t,n>>>t,this.unsigned):a(32===t?n:n>>>t-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},x.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},x.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t}))})),tc=a((function(t){
/**
	   * @license bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>
	   * Backing buffer: ArrayBuffer, Accessor: Uint8Array
	   * Released under the Apache License, Version 2.0
	   * see: https://github.com/dcodeIO/bytebuffer.js for details
	   */
!function(e,n){t&&t.exports?t.exports=function(){var t;try{t=$l}catch(t){}return n(t)}():(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=n(e.dcodeIO.Long)}(o,(function(t){var e=function(t,n,i){if(void 0===t&&(t=e.DEFAULT_CAPACITY),void 0===n&&(n=e.DEFAULT_ENDIAN),void 0===i&&(i=e.DEFAULT_NOASSERT),!i){if((t|=0)<0)throw RangeError("Illegal capacity");n=!!n,i=!!i}this.buffer=0===t?r:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=n,this.noAssert=i};e.VERSION="5.0.1",e.LITTLE_ENDIAN=!0,e.BIG_ENDIAN=!1,e.DEFAULT_CAPACITY=16,e.DEFAULT_ENDIAN=e.BIG_ENDIAN,e.DEFAULT_NOASSERT=!1,e.Long=t||null;var n=e.prototype;n.__isByteBuffer__,Object.defineProperty(n,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var r=new ArrayBuffer(0),i=String.fromCharCode;function o(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function a(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+i.apply(String,t);t.length+arguments.length>1024&&(e.push(i.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}}function s(t,e,n,r,i){var o,a,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,h=n?i-1:0,p=n?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=s;u>0;o=256*o+t[e+h],h+=p,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=r;u>0;a=256*a+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),o-=c}return(d?-1:1)*a*Math.pow(2,o-r)}function l(t,e,n,r,i,o){var a,s,l,c=8*o-i-1,u=(1<<c)-1,h=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(e*l-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+d]=255&s,d+=f,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;t[n+d]=255&a,d+=f,a/=256,c-=8);t[n+d-f]|=128*m}e.accessor=function(){return Uint8Array},e.allocate=function(t,n,r){return new e(t,n,r)},e.concat=function(t,n,r,i){"boolean"!=typeof n&&"string"==typeof n||(i=r,r=n,n=void 0);for(var o,a=0,s=0,l=t.length;s<l;++s)e.isByteBuffer(t[s])||(t[s]=e.wrap(t[s],n)),(o=t[s].limit-t[s].offset)>0&&(a+=o);if(0===a)return new e(0,r,i);var c,u=new e(a,r,i);for(s=0;s<l;)(o=(c=t[s++]).limit-c.offset)<=0||(u.view.set(c.view.subarray(c.offset,c.limit),u.offset),u.offset+=o);return u.limit=u.offset,u.offset=0,u},e.isByteBuffer=function(t){return!0===(t&&t.__isByteBuffer__)},e.type=function(){return ArrayBuffer},e.wrap=function(t,r,i,o){if("string"!=typeof r&&(o=i,i=r,r=void 0),"string"==typeof t)switch(void 0===r&&(r="utf8"),r){case"base64":return e.fromBase64(t,i);case"hex":return e.fromHex(t,i);case"binary":return e.fromBinary(t,i);case"utf8":return e.fromUTF8(t,i);case"debug":return e.fromDebug(t,i);default:throw Error("Unsupported encoding: "+r)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var a;if(e.isByteBuffer(t))return(a=n.clone.call(t)).markedOffset=-1,a;if(t instanceof Uint8Array)a=new e(0,i,o),t.length>0&&(a.buffer=t.buffer,a.offset=t.byteOffset,a.limit=t.byteOffset+t.byteLength,a.view=new Uint8Array(t.buffer));else if(t instanceof ArrayBuffer)a=new e(0,i,o),t.byteLength>0&&(a.buffer=t,a.offset=0,a.limit=t.byteLength,a.view=t.byteLength>0?new Uint8Array(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");(a=new e(t.length,i,o)).limit=t.length;for(var s=0;s<t.length;++s)a.view[s]=t[s]}return a},n.writeBitSet=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if(!(t instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var r,i=e,o=t.length,a=o>>3,s=0;for(e+=this.writeVarint32(o,e);a--;)r=1&!!t[s++]|(1&!!t[s++])<<1|(1&!!t[s++])<<2|(1&!!t[s++])<<3|(1&!!t[s++])<<4|(1&!!t[s++])<<5|(1&!!t[s++])<<6|(1&!!t[s++])<<7,this.writeByte(r,e++);if(s<o){var l=0;for(r=0;s<o;)r|=(1&!!t[s++])<<l++;this.writeByte(r,e++)}return n?(this.offset=e,this):e-i},n.readBitSet=function(t){var e=void 0===t;e&&(t=this.offset);var n,r=this.readVarint32(t),i=r.value,o=i>>3,a=0,s=[];for(t+=r.length;o--;)n=this.readByte(t++),s[a++]=!!(1&n),s[a++]=!!(2&n),s[a++]=!!(4&n),s[a++]=!!(8&n),s[a++]=!!(16&n),s[a++]=!!(32&n),s[a++]=!!(64&n),s[a++]=!!(128&n);if(a<i){var l=0;for(n=this.readByte(t++);a<i;)s[a++]=!!(n>>l++&1)}return e&&(this.offset=t),s},n.readBytes=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+t+") <= "+this.buffer.byteLength)}var r=this.slice(e,e+t);return n&&(this.offset+=t),r},n.writeBytes=n.append,n.writeInt8=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=1,this.view[e]=t,n&&(this.offset+=1),this},n.writeByte=n.writeInt8,n.readInt8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=this.view[t];return 128==(128&n)&&(n=-(255-n+1)),e&&(this.offset+=1),n},n.readByte=n.readInt8,n.writeUint8=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=1,this.view[e]=t,n&&(this.offset+=1),this},n.writeUInt8=n.writeUint8,n.readUint8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n=this.view[t];return e&&(this.offset+=1),n},n.readUInt8=n.readUint8,n.writeInt16=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),n&&(this.offset+=2),this},n.writeShort=n.writeInt16,n.readInt16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var n=0;return this.littleEndian?(n=this.view[t],n|=this.view[t+1]<<8):(n=this.view[t]<<8,n|=this.view[t+1]),32768==(32768&n)&&(n=-(65535-n+1)),e&&(this.offset+=2),n},n.readShort=n.readInt16,n.writeUint16=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),n&&(this.offset+=2),this},n.writeUInt16=n.writeUint16,n.readUint16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var n=0;return this.littleEndian?(n=this.view[t],n|=this.view[t+1]<<8):(n=this.view[t]<<8,n|=this.view[t+1]),e&&(this.offset+=2),n},n.readUInt16=n.readUint16,n.writeInt32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),n&&(this.offset+=4),this},n.writeInt=n.writeInt32,n.readInt32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=0;return this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0):(n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),n|=0,e&&(this.offset+=4),n},n.readInt=n.readInt32,n.writeUint32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),n&&(this.offset+=4),this},n.writeUInt32=n.writeUint32,n.readUint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=0;return this.littleEndian?(n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0):(n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0),e&&(this.offset+=4),n},n.readUInt32=n.readUint32,t&&(n.writeInt64=function(e,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),n+=8;var i=this.buffer.byteLength;n>i&&this.resize((i*=2)>n?i:n),n-=8;var o=e.low,a=e.high;return this.littleEndian?(this.view[n+3]=o>>>24&255,this.view[n+2]=o>>>16&255,this.view[n+1]=o>>>8&255,this.view[n]=255&o,n+=4,this.view[n+3]=a>>>24&255,this.view[n+2]=a>>>16&255,this.view[n+1]=a>>>8&255,this.view[n]=255&a):(this.view[n]=a>>>24&255,this.view[n+1]=a>>>16&255,this.view[n+2]=a>>>8&255,this.view[n+3]=255&a,n+=4,this.view[n]=o>>>24&255,this.view[n+1]=o>>>16&255,this.view[n+2]=o>>>8&255,this.view[n+3]=255&o),r&&(this.offset+=8),this},n.writeLong=n.writeInt64,n.readInt64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,i=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var o=new t(r,i,!1);return n&&(this.offset+=8),o},n.readLong=n.readInt64,n.writeUint64=function(e,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),n+=8;var i=this.buffer.byteLength;n>i&&this.resize((i*=2)>n?i:n),n-=8;var o=e.low,a=e.high;return this.littleEndian?(this.view[n+3]=o>>>24&255,this.view[n+2]=o>>>16&255,this.view[n+1]=o>>>8&255,this.view[n]=255&o,n+=4,this.view[n+3]=a>>>24&255,this.view[n+2]=a>>>16&255,this.view[n+1]=a>>>8&255,this.view[n]=255&a):(this.view[n]=a>>>24&255,this.view[n+1]=a>>>16&255,this.view[n+2]=a>>>8&255,this.view[n+3]=255&a,n+=4,this.view[n]=o>>>24&255,this.view[n+1]=o>>>16&255,this.view[n+2]=o>>>8&255,this.view[n+3]=255&o),r&&(this.offset+=8),this},n.writeUInt64=n.writeUint64,n.readUint64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,i=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var o=new t(r,i,!0);return n&&(this.offset+=8),o},n.readUInt64=n.readUint64),n.writeFloat32=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=4,l(this.view,t,e,this.littleEndian,23,4),n&&(this.offset+=4),this},n.writeFloat=n.writeFloat32,n.readFloat32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var n=s(this.view,t,this.littleEndian,23,4);return e&&(this.offset+=4),n},n.readFloat=n.readFloat32,n.writeFloat64=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var r=this.buffer.byteLength;return e>r&&this.resize((r*=2)>e?r:e),e-=8,l(this.view,t,e,this.littleEndian,52,8),n&&(this.offset+=8),this},n.writeDouble=n.writeFloat64,n.readFloat64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var n=s(this.view,t,this.littleEndian,52,8);return e&&(this.offset+=8),n},n.readDouble=n.readFloat64,e.MAX_VARINT32_BYTES=5,e.calculateVarint32=function(t){return(t>>>=0)<128?1:t<16384?2:t<1<<21?3:t<1<<28?4:5},e.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},e.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},n.writeVarint32=function(t,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var i,o=e.calculateVarint32(t);n+=o;var a=this.buffer.byteLength;for(n>a&&this.resize((a*=2)>n?a:n),n-=o,t>>>=0;t>=128;)i=127&t|128,this.view[n++]=i,t>>>=7;return this.view[n++]=t,r?(this.offset=n,this):o},n.writeVarint32ZigZag=function(t,n){return this.writeVarint32(e.zigZagEncode32(t),n)},n.readVarint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,r=0,i=0;do{if(!this.noAssert&&t>this.limit){var o=Error("Truncated");throw o.truncated=!0,o}n=this.view[t++],r<5&&(i|=(127&n)<<7*r),++r}while(0!=(128&n));return i|=0,e?(this.offset=t,i):{value:i,length:r}},n.readVarint32ZigZag=function(t){var n=this.readVarint32(t);return"object"==typeof n?n.value=e.zigZagDecode32(n.value):n=e.zigZagDecode32(n),n},t&&(e.MAX_VARINT64_BYTES=10,e.calculateVarint64=function(e){"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e));var n=e.toInt()>>>0,r=e.shiftRightUnsigned(28).toInt()>>>0,i=e.shiftRightUnsigned(56).toInt()>>>0;return 0==i?0==r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10},e.zigZagEncode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},e.zigZagDecode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(t.ONE).toSigned().negate()).toSigned()},n.writeVarint64=function(n,r){var i=void 0===r;if(i&&(r=this.offset),!this.noAssert){if("number"==typeof n)n=t.fromNumber(n);else if("string"==typeof n)n=t.fromString(n);else if(!(n&&n instanceof t))throw TypeError("Illegal value: "+n+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof n?n=t.fromNumber(n,!1):"string"==typeof n?n=t.fromString(n,!1):!1!==n.unsigned&&(n=n.toSigned());var o=e.calculateVarint64(n),a=n.toInt()>>>0,s=n.shiftRightUnsigned(28).toInt()>>>0,l=n.shiftRightUnsigned(56).toInt()>>>0;r+=o;var c=this.buffer.byteLength;switch(r>c&&this.resize((c*=2)>r?c:r),r-=o,o){case 10:this.view[r+9]=l>>>7&1;case 9:this.view[r+8]=9!==o?128|l:127&l;case 8:this.view[r+7]=8!==o?s>>>21|128:s>>>21&127;case 7:this.view[r+6]=7!==o?s>>>14|128:s>>>14&127;case 6:this.view[r+5]=6!==o?s>>>7|128:s>>>7&127;case 5:this.view[r+4]=5!==o?128|s:127&s;case 4:this.view[r+3]=4!==o?a>>>21|128:a>>>21&127;case 3:this.view[r+2]=3!==o?a>>>14|128:a>>>14&127;case 2:this.view[r+1]=2!==o?a>>>7|128:a>>>7&127;case 1:this.view[r]=1!==o?128|a:127&a}return i?(this.offset+=o,this):o},n.writeVarint64ZigZag=function(t,n){return this.writeVarint64(e.zigZagEncode64(t),n)},n.readVarint64=function(e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,i=0,o=0,a=0,s=0;if(i=127&(s=this.view[e++]),128&s&&(i|=(127&(s=this.view[e++]))<<7,(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[e++]))<<14,(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[e++]))<<21,(128&s||this.noAssert&&void 0===s)&&(o=127&(s=this.view[e++]),(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<7,(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<14,(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[e++]))<<21,(128&s||this.noAssert&&void 0===s)&&(a=127&(s=this.view[e++]),(128&s||this.noAssert&&void 0===s)&&(a|=(127&(s=this.view[e++]))<<7,128&s||this.noAssert&&void 0===s))))))))))throw Error("Buffer overrun");var l=t.fromBits(i|o<<28,o>>>4|a<<24,!1);return n?(this.offset=e,l):{value:l,length:e-r}},n.readVarint64ZigZag=function(n){var r=this.readVarint64(n);return r&&r.value instanceof t?r.value=e.zigZagDecode64(r.value):r=e.zigZagDecode64(r),r}),n.writeCString=function(t,e){var n=void 0===e;n&&(e=this.offset);var r,i=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(r=0;r<i;++r)if(0===t.charCodeAt(r))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}i=u.calculateUTF16asUTF8(o(t))[1],e+=i+1;var a=this.buffer.byteLength;return e>a&&this.resize((a*=2)>e?a:e),e-=i+1,u.encodeUTF16toUTF8(o(t),function(t){this.view[e++]=t}.bind(this)),this.view[e++]=0,n?(this.offset=e,this):i},n.readCString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var n,r=t,i=-1;return u.decodeUTF8toUTF16(function(){if(0===i)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return 0===(i=this.view[t++])?null:i}.bind(this),n=a(),!0),e?(this.offset=t,n()):{string:n(),length:t-r}},n.writeIString=function(t,e){var n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var r,i=e;r=u.calculateUTF16asUTF8(o(t),this.noAssert)[1],e+=4+r;var a=this.buffer.byteLength;if(e>a&&this.resize((a*=2)>e?a:e),e-=4+r,this.littleEndian?(this.view[e+3]=r>>>24&255,this.view[e+2]=r>>>16&255,this.view[e+1]=r>>>8&255,this.view[e]=255&r):(this.view[e]=r>>>24&255,this.view[e+1]=r>>>16&255,this.view[e+2]=r>>>8&255,this.view[e+3]=255&r),e+=4,u.encodeUTF16toUTF8(o(t),function(t){this.view[e++]=t}.bind(this)),e!==i+4+r)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+4+r));return n?(this.offset=e,this):e-i},n.readIString=function(t){var n=void 0===t;if(n&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=t,i=this.readUint32(t),o=this.readUTF8String(i,e.METRICS_BYTES,t+=4);return t+=o.length,n?(this.offset=t,o.string):{string:o.string,length:t-r}},e.METRICS_CHARS="c",e.METRICS_BYTES="b",n.writeUTF8String=function(t,e){var n,r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var i=e;n=u.calculateUTF16asUTF8(o(t))[1],e+=n;var a=this.buffer.byteLength;return e>a&&this.resize((a*=2)>e?a:e),e-=n,u.encodeUTF16toUTF8(o(t),function(t){this.view[e++]=t}.bind(this)),r?(this.offset=e,this):e-i},n.writeString=n.writeUTF8String,e.calculateUTF8Chars=function(t){return u.calculateUTF16asUTF8(o(t))[0]},e.calculateUTF8Bytes=function(t){return u.calculateUTF16asUTF8(o(t))[1]},e.calculateString=e.calculateUTF8Bytes,n.readUTF8String=function(t,n,r){"number"==typeof n&&(r=n,n=void 0);var i=void 0===r;if(i&&(r=this.offset),void 0===n&&(n=e.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,s=0,l=r;if(n===e.METRICS_CHARS){if(o=a(),u.decodeUTF8(function(){return s<t&&r<this.limit?this.view[r++]:null}.bind(this),(function(t){++s,u.UTF8toUTF16(t,o)})),s!==t)throw RangeError("Illegal range: Truncated data, "+s+" == "+t);return i?(this.offset=r,o()):{string:o(),length:r-l}}if(n===e.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+t+") <= "+this.buffer.byteLength)}var c=r+t;if(u.decodeUTF8toUTF16(function(){return r<c?this.view[r++]:null}.bind(this),o=a(),this.noAssert),r!==c)throw RangeError("Illegal range: Truncated data, "+r+" == "+c);return i?(this.offset=r,o()):{string:o(),length:r-l}}throw TypeError("Unsupported metrics: "+n)},n.readString=n.readUTF8String,n.writeVString=function(t,n){var r=void 0===n;if(r&&(n=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof n||n%1!=0)throw TypeError("Illegal offset: "+n+" (not an integer)");if((n>>>=0)<0||n+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+n+" (+0) <= "+this.buffer.byteLength)}var i,a,s=n;i=u.calculateUTF16asUTF8(o(t),this.noAssert)[1],a=e.calculateVarint32(i),n+=a+i;var l=this.buffer.byteLength;if(n>l&&this.resize((l*=2)>n?l:n),n-=a+i,n+=this.writeVarint32(i,n),u.encodeUTF16toUTF8(o(t),function(t){this.view[n++]=t}.bind(this)),n!==s+i+a)throw RangeError("Illegal range: Truncated data, "+n+" == "+(n+i+a));return r?(this.offset=n,this):n-s},n.readVString=function(t){var n=void 0===t;if(n&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=t,i=this.readVarint32(t),o=this.readUTF8String(i.value,e.METRICS_BYTES,t+=i.length);return t+=o.length,n?(this.offset=t,o.string):{string:o.string,length:t-r}},n.append=function(t,n,r){"number"!=typeof n&&"string"==typeof n||(r=n,n=void 0);var i=void 0===r;if(i&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,n));var o=t.limit-t.offset;if(o<=0)return this;r+=o;var a=this.buffer.byteLength;return r>a&&this.resize((a*=2)>r?a:r),r-=o,this.view.set(t.view.subarray(t.offset,t.limit),r),t.offset+=o,i&&(this.offset+=o),this},n.appendTo=function(t,e){return t.append(this,e),this},n.assert=function(t){return this.noAssert=!t,this},n.capacity=function(){return this.buffer.byteLength},n.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},n.clone=function(t){var n=new e(0,this.littleEndian,this.noAssert);return t?(n.buffer=new ArrayBuffer(this.buffer.byteLength),n.view=new Uint8Array(n.buffer)):(n.buffer=this.buffer,n.view=this.view),n.offset=this.offset,n.markedOffset=this.markedOffset,n.limit=this.limit,n},n.compact=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var n=e-t;if(0===n)return this.buffer=r,this.view=null,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var i=new ArrayBuffer(n),o=new Uint8Array(i);return o.set(this.view.subarray(t,e)),this.buffer=i,this.view=o,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=n,this},n.copy=function(t,n){if(void 0===t&&(t=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,t<0||t>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+n+" <= "+this.buffer.byteLength)}if(t===n)return new e(0,this.littleEndian,this.noAssert);var r=n-t,i=new e(r,this.littleEndian,this.noAssert);return i.offset=0,i.limit=r,i.markedOffset>=0&&(i.markedOffset-=t),this.copyTo(i,0,t,n),i},n.copyTo=function(t,n,r,i){var o,a;if(!this.noAssert&&!e.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(n=(a=void 0===n)?t.offset:0|n,r=(o=void 0===r)?this.offset:0|r,i=void 0===i?this.limit:0|i,n<0||n>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+n+" <= "+t.buffer.byteLength);if(r<0||i>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var s=i-r;return 0===s?t:(t.ensureCapacity(n+s),t.view.set(this.view.subarray(r,i),n),o&&(this.offset+=s),a&&(t.offset+=s),this)},n.ensureCapacity=function(t){var e=this.buffer.byteLength;return e<t?this.resize((e*=2)>t?e:t):this},n.fill=function(t,e,n){var r=void 0===e;if(r&&(e=this.offset),"string"==typeof t&&t.length>0&&(t=t.charCodeAt(0)),void 0===e&&(e=this.offset),void 0===n&&(n=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal end: Not an integer");if(n>>>=0,e<0||e>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+n+" <= "+this.buffer.byteLength)}if(e>=n)return this;for(;e<n;)this.view[e++]=t;return r&&(this.offset=e),this},n.flip=function(){return this.limit=this.offset,this.offset=0,this},n.mark=function(t){if(t=void 0===t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},n.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},n.LE=function(t){return this.littleEndian=void 0===t||!!t,this},n.BE=function(t){return this.littleEndian=void 0!==t&&!t,this},n.prepend=function(t,n,r){"number"!=typeof n&&"string"==typeof n||(r=n,n=void 0);var i=void 0===r;if(i&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}t instanceof e||(t=e.wrap(t,n));var o=t.limit-t.offset;if(o<=0)return this;var a=o-r;if(a>0){var s=new ArrayBuffer(this.buffer.byteLength+a),l=new Uint8Array(s);l.set(this.view.subarray(r,this.buffer.byteLength),o),this.buffer=s,this.view=l,this.offset+=a,this.markedOffset>=0&&(this.markedOffset+=a),this.limit+=a,r+=a}else new Uint8Array(this.buffer);return this.view.set(t.view.subarray(t.offset,t.limit),r-o),t.offset=t.limit,i&&(this.offset-=o),this},n.prependTo=function(t,e){return t.prepend(this,e),this},n.printDebug=function(t){"function"!=typeof t&&(t=void 0),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},n.remaining=function(){return this.limit-this.offset},n.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},n.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if((t|=0)<0)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var e=new ArrayBuffer(t),n=new Uint8Array(e);n.set(this.view),this.buffer=e,this.view=n}return this},n.reverse=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e||Array.prototype.reverse.call(this.view.subarray(t,e)),this},n.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(e<0||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},n.slice=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n=this.clone();return n.offset=t,n.limit=e,n},n.toBuffer=function(t){var e=this.offset,n=this.limit;if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof n||n%1!=0)throw TypeError("Illegal limit: Not an integer");if(n>>>=0,e<0||e>n||n>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+n+" <= "+this.buffer.byteLength)}if(!t&&0===e&&n===this.buffer.byteLength)return this.buffer;if(e===n)return r;var i=new ArrayBuffer(n-e);return new Uint8Array(i).set(new Uint8Array(this.buffer).subarray(e,n),0),i},n.toArrayBuffer=n.toBuffer,n.toString=function(t,e,n){if(void 0===t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(n=e=t="utf8"),t){case"utf8":return this.toUTF8(e,n);case"base64":return this.toBase64(e,n);case"hex":return this.toHex(e,n);case"binary":return this.toBinary(e,n);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var c=function(){for(var t={},e=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],n=[],r=0,i=e.length;r<i;++r)n[e[r]]=r;return t.encode=function(t,n){for(var r,i;null!==(r=t());)n(e[r>>2&63]),i=(3&r)<<4,null!==(r=t())?(n(e[63&((i|=r>>4&15)|r>>4&15)]),i=(15&r)<<2,null!==(r=t())?(n(e[63&(i|r>>6&3)]),n(e[63&r])):(n(e[63&i]),n(61))):(n(e[63&i]),n(61),n(61))},t.decode=function(t,e){var r,i,o;function a(t){throw Error("Illegal character code: "+t)}for(;null!==(r=t());)if(void 0===(i=n[r])&&a(r),null!==(r=t())&&(void 0===(o=n[r])&&a(r),e(i<<2>>>0|(48&o)>>4),null!==(r=t()))){if(void 0===(i=n[r])){if(61===r)break;a(r)}if(e((15&o)<<4>>>0|(60&i)>>2),null!==(r=t())){if(void 0===(o=n[r])){if(61===r)break;a(r)}e((3&i)<<6>>>0|o)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},t}();n.toBase64=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),e|=0,(t|=0)<0||e>this.capacity||t>e)throw RangeError("begin, end");var n;return c.encode(function(){return t<e?this.view[t++]:null}.bind(this),n=a()),n()},e.fromBase64=function(t,n){if("string"!=typeof t)throw TypeError("str");var r=new e(t.length/4*3,n),i=0;return c.decode(o(t),(function(t){r.view[i++]=t})),r.limit=i,r},e.btoa=function(t){return e.fromBinary(t).toBase64()},e.atob=function(t){return e.fromBase64(t).toBinary()},n.toBinary=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),e|=0,(t|=0)<0||e>this.capacity()||t>e)throw RangeError("begin, end");if(t===e)return"";for(var n=[],r=[];t<e;)n.push(this.view[t++]),n.length>=1024&&(r.push(String.fromCharCode.apply(String,n)),n=[]);return r.join("")+String.fromCharCode.apply(String,n)},e.fromBinary=function(t,n){if("string"!=typeof t)throw TypeError("str");for(var r,i=0,o=t.length,a=new e(o,n);i<o;){if((r=t.charCodeAt(i))>255)throw RangeError("illegal char code: "+r);a.view[i++]=r}return a.limit=o,a},n.toDebug=function(t){for(var e,n=-1,r=this.buffer.byteLength,i="",o="",a="";n<r;){if(-1!==n&&(i+=(e=this.view[n])<16?"0"+e.toString(16).toUpperCase():e.toString(16).toUpperCase(),t&&(o+=e>32&&e<127?String.fromCharCode(e):".")),++n,t&&n>0&&n%16==0&&n!==r){for(;i.length<51;)i+=" ";a+=i+o+"\n",i=o=""}n===this.offset&&n===this.limit?i+=n===this.markedOffset?"!":"|":n===this.offset?i+=n===this.markedOffset?"[":"<":n===this.limit?i+=n===this.markedOffset?"]":">":i+=n===this.markedOffset?"'":t||0!==n&&n!==r?" ":""}if(t&&" "!==i){for(;i.length<51;)i+=" ";a+=i+o+"\n"}return t?a:i},e.fromDebug=function(t,n,r){for(var i,o,a=t.length,s=new e((a+1)/3|0,n,r),l=0,c=0,u=!1,h=!1,p=!1,d=!1,f=!1;l<a;){switch(i=t.charAt(l++)){case"!":if(!r){if(h||p||d){f=!0;break}h=p=d=!0}s.offset=s.markedOffset=s.limit=c,u=!1;break;case"|":if(!r){if(h||d){f=!0;break}h=d=!0}s.offset=s.limit=c,u=!1;break;case"[":if(!r){if(h||p){f=!0;break}h=p=!0}s.offset=s.markedOffset=c,u=!1;break;case"<":if(!r){if(h){f=!0;break}h=!0}s.offset=c,u=!1;break;case"]":if(!r){if(d||p){f=!0;break}d=p=!0}s.limit=s.markedOffset=c,u=!1;break;case">":if(!r){if(d){f=!0;break}d=!0}s.limit=c,u=!1;break;case"'":if(!r){if(p){f=!0;break}p=!0}s.markedOffset=c,u=!1;break;case" ":u=!1;break;default:if(!r&&u){f=!0;break}if(o=parseInt(i+t.charAt(l++),16),!r&&(isNaN(o)||o<0||o>255))throw TypeError("Illegal str: Not a debug encoded string");s.view[c++]=o,u=!0}if(f)throw TypeError("Illegal str: Invalid symbol at "+l)}if(!r){if(!h||!d)throw TypeError("Illegal str: Missing offset or limit");if(c<s.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+c+" < "+a)}return s},n.toHex=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var n,r=new Array(e-t);t<e;)(n=this.view[t++])<16?r.push("0",n.toString(16)):r.push(n.toString(16));return r.join("")},e.fromHex=function(t,n,r){if(!r){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var i,o=t.length,a=new e(o/2|0,n),s=0,l=0;s<o;s+=2){if(i=parseInt(t.substring(s,s+2),16),!r&&(!isFinite(i)||i<0||i>255))throw TypeError("Illegal str: Contains non-hex characters");a.view[l++]=i}return a.limit=l,a};var u=function(){var t={MAX_CODEPOINT:1114111,encodeUTF8:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<128?e(127&n):n<2048?(e(n>>6&31|192),e(63&n|128)):n<65536?(e(n>>12&15|224),e(n>>6&63|128),e(63&n|128)):(e(n>>18&7|240),e(n>>12&63|128),e(n>>6&63|128),e(63&n|128)),n=null},decodeUTF8:function(t,e){for(var n,r,i,o,a=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(n=t());)if(0==(128&n))e(n);else if(192==(224&n))null===(r=t())&&a([n,r]),e((31&n)<<6|63&r);else if(224==(240&n))(null===(r=t())||null===(i=t()))&&a([n,r,i]),e((15&n)<<12|(63&r)<<6|63&i);else{if(240!=(248&n))throw RangeError("Illegal starting byte: "+n);(null===(r=t())||null===(i=t())||null===(o=t()))&&a([n,r,i,o]),e((7&n)<<18|(63&r)<<12|(63&i)<<6|63&o)}},UTF16toUTF8:function(t,e){for(var n,r=null;null!==(n=null!==r?r:t());)n>=55296&&n<=57343&&null!==(r=t())&&r>=56320&&r<=57343?(e(1024*(n-55296)+r-56320+65536),r=null):e(n);null!==r&&e(r)},UTF8toUTF16:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<=65535?e(n):(e(55296+((n-=65536)>>10)),e(n%1024+56320)),n=null},encodeUTF16toUTF8:function(e,n){t.UTF16toUTF8(e,(function(e){t.encodeUTF8(e,n)}))},decodeUTF8toUTF16:function(e,n){t.decodeUTF8(e,(function(e){t.UTF8toUTF16(e,n)}))},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(t){for(var e,n=0;null!==(e=t());)n+=e<128?1:e<2048?2:e<65536?3:4;return n},calculateUTF16asUTF8:function(e){var n=0,r=0;return t.UTF16toUTF8(e,(function(t){++n,r+=t<128?1:t<2048?2:t<65536?3:4})),[n,r]}};return t}();return n.toUTF8=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var n;try{u.decodeUTF8toUTF16(function(){return t<e?this.view[t++]:null}.bind(this),n=a())}catch(n){if(t!==e)throw RangeError("Illegal range: Truncated data, "+t+" != "+e)}return n()},e.fromUTF8=function(t,n,r){if(!r&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var i=new e(u.calculateUTF16asUTF8(o(t),!0)[1],n,r),a=0;return u.encodeUTF16toUTF8(o(t),(function(t){i.view[a++]=t})),i.limit=a,i},e}))})),ec={};function nc(t,e){for(var n=0,r=t.length-1;r>=0;r--){var i=t[r];"."===i?t.splice(r,1):".."===i?(t.splice(r,1),n++):n&&(t.splice(r,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}var rc=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ic=function(t){return rc.exec(t).slice(1)};function oc(){for(var t=arguments,e="",n=!1,r=arguments.length-1;r>=-1&&!n;r--){var i=r>=0?t[r]:"/";if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(e=i+"/"+e,n="/"===i.charAt(0))}return(n?"/":"")+(e=nc(cc(e.split("/"),(function(t){return!!t})),!n).join("/"))||"."}function ac(t){var e=sc(t),n="/"===uc(t,-1);return(t=nc(cc(t.split("/"),(function(t){return!!t})),!e).join("/"))||e||(t="."),t&&n&&(t+="/"),(e?"/":"")+t}function sc(t){return"/"===t.charAt(0)}var lc={extname:function(t){return ic(t)[3]},basename:function(t,e){var n=ic(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},dirname:function(t){var e=ic(t),n=e[0],r=e[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},sep:"/",delimiter:":",relative:function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=oc(t).substr(1),e=oc(e).substr(1);for(var r=n(t.split("/")),i=n(e.split("/")),o=Math.min(r.length,i.length),a=o,s=0;s<o;s++)if(r[s]!==i[s]){a=s;break}var l=[];for(s=a;s<r.length;s++)l.push("..");return(l=l.concat(i.slice(a))).join("/")},join:function(){var t=Array.prototype.slice.call(arguments,0);return ac(cc(t,(function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t})).join("/"))},isAbsolute:sc,normalize:ac,resolve:oc};function cc(t,e){if(t.filter)return t.filter(e);for(var n=[],r=0;r<t.length;r++)e(t[r],r,t)&&n.push(t[r]);return n}var uc="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)},hc=a((function(t){
/**
	   * @license protobuf.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
	   * Released under the Apache License, Version 2.0
	   * see: https://github.com/dcodeIO/protobuf.js for details
	   */
!function(e,n){t&&t.exports?t.exports=n(tc):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=n(e.dcodeIO.ByteBuffer)}(o,(function(t,e){var n,r={};return r.ByteBuffer=t,r.Long=t.Long||null,r.VERSION="5.0.3",r.WIRE_TYPES={},r.WIRE_TYPES.VARINT=0,r.WIRE_TYPES.BITS64=1,r.WIRE_TYPES.LDELIM=2,r.WIRE_TYPES.STARTGROUP=3,r.WIRE_TYPES.ENDGROUP=4,r.WIRE_TYPES.BITS32=5,r.PACKABLE_WIRE_TYPES=[r.WIRE_TYPES.VARINT,r.WIRE_TYPES.BITS64,r.WIRE_TYPES.BITS32],r.TYPES={int32:{name:"int32",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.ZERO:void 0},uint64:{name:"uint64",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.UZERO:void 0},sint64:{name:"sint64",wireType:r.WIRE_TYPES.VARINT,defaultValue:r.Long?r.Long.ZERO:void 0},bool:{name:"bool",wireType:r.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:r.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:r.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:r.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:r.WIRE_TYPES.BITS64,defaultValue:r.Long?r.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:r.WIRE_TYPES.BITS64,defaultValue:r.Long?r.Long.ZERO:void 0},float:{name:"float",wireType:r.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:r.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:r.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:r.WIRE_TYPES.STARTGROUP,defaultValue:null}},r.MAP_KEY_TYPES=[r.TYPES.int32,r.TYPES.sint32,r.TYPES.sfixed32,r.TYPES.uint32,r.TYPES.fixed32,r.TYPES.int64,r.TYPES.sint64,r.TYPES.sfixed64,r.TYPES.uint64,r.TYPES.fixed64,r.TYPES.bool,r.TYPES.string,r.TYPES.bytes],r.ID_MIN=1,r.ID_MAX=536870911,r.convertFieldsToCamelCase=!1,r.populateAccessors=!0,r.populateDefaults=!0,r.Util=((n={}).IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),n.XHR=function(){for(var t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],e=null,n=0;n<t.length;n++){try{e=t[n]()}catch(t){continue}break}if(!e)throw Error("XMLHttpRequest is not supported");return e},n.fetch=function(t,e){if(e&&"function"!=typeof e&&(e=null),n.IS_NODE){var r=ec;if(e)r.readFile(t,(function(t,n){e(t?null:""+n)}));else try{return r.readFileSync(t)}catch(t){return null}}else{var i=n.XHR();if(i.open("GET",t,!!e),i.setRequestHeader("Accept","text/plain"),"function"==typeof i.overrideMimeType&&i.overrideMimeType("text/plain"),!e)return i.send(null),200==i.status||0==i.status&&"string"==typeof i.responseText?i.responseText:null;if(i.onreadystatechange=function(){4==i.readyState&&(200==i.status||0==i.status&&"string"==typeof i.responseText?e(i.responseText):e(null))},4==i.readyState)return;i.send(null)}},n.toCamelCase=function(t){return t.replace(/_([a-zA-Z])/g,(function(t,e){return e.toUpperCase()}))},n),r.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,FQTYPEREF:/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},r.DotProto=function(t,e){var n={},r=function(t){this.source=t+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},i=r.prototype;i._readString=function(){var t='"'===this._stringOpen?e.STRING_DQ:e.STRING_SQ;t.lastIndex=this.index-1;var n=t.exec(this.source);if(!n)throw Error("unterminated string");return this.index=t.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,n[1]},i.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var t,n,r;do{for(t=!1;e.WHITESPACE.test(r=this.source.charAt(this.index));)if("\n"===r&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,t=!0}else{if("*"!==(r=this.source.charAt(this.index)))return"/";do{if("\n"===r&&++this.line,++this.index===this.source.length)return null;n=r,r=this.source.charAt(this.index)}while("*"!==n||"/"!==r);++this.index,t=!0}}while(t);if(this.index===this.source.length)return null;var i=this.index;if(e.DELIM.lastIndex=0,!e.DELIM.test(this.source.charAt(i++)))for(;i<this.source.length&&!e.DELIM.test(this.source.charAt(i));)++i;var o=this.source.substring(this.index,this.index=i);return'"'!==o&&"'"!==o||(this._stringOpen=o),o},i.peek=function(){if(0===this.stack.length){var t=this.next();if(null===t)return null;this.stack.push(t)}return this.stack[0]},i.skip=function(t){var e=this.next();if(e!==t)throw Error("illegal '"+e+"', '"+t+"' expected")},i.omit=function(t){return this.peek()===t&&(this.next(),!0)},i.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},n.Tokenizer=r;var o=function(t){this.tn=new r(t),this.proto3=!1},a=o.prototype;function s(t,n){var r=-1,i=1;if("-"==t.charAt(0)&&(i=-1,t=t.substring(1)),e.NUMBER_DEC.test(t))r=parseInt(t);else if(e.NUMBER_HEX.test(t))r=parseInt(t.substring(2),16);else{if(!e.NUMBER_OCT.test(t))throw Error("illegal id value: "+(i<0?"-":"")+t);r=parseInt(t.substring(1),8)}if(r=i*r|0,!n&&r<0)throw Error("illegal id value: "+(i<0?"-":"")+t);return r}function l(t){var n=1;if("-"==t.charAt(0)&&(n=-1,t=t.substring(1)),e.NUMBER_DEC.test(t))return n*parseInt(t,10);if(e.NUMBER_HEX.test(t))return n*parseInt(t.substring(2),16);if(e.NUMBER_OCT.test(t))return n*parseInt(t.substring(1),8);if("inf"===t)return n*(1/0);if("nan"===t)return NaN;if(e.NUMBER_FLT.test(t))return n*parseFloat(t);throw Error("illegal number value: "+(n<0?"-":"")+t)}function c(t,e,n){void 0===t[e]?t[e]=n:(Array.isArray(t[e])||(t[e]=[t[e]]),t[e].push(n))}return a.parse=function(){var t,n,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},i=!0;try{for(;t=this.tn.next();)switch(t){case"package":if(!i||null!==r.package)throw Error("unexpected 'package'");if(t=this.tn.next(),!e.TYPEREF.test(t))throw Error("illegal package name: "+t);this.tn.skip(";"),r.package=t;break;case"import":if(!i)throw Error("unexpected 'import'");("public"===(t=this.tn.peek())||(n="weak"===t))&&this.tn.next(),t=this._readString(),this.tn.skip(";"),n||r.imports.push(t);break;case"syntax":if(!i)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),i=!1;break;case"enum":this._parseEnum(r),i=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+t+"'")}}catch(t){throw t.message="Parse error at line "+this.tn.line+": "+t.message,t}return delete r.name,r},o.parse=function(t){return new o(t).parse()},a._readString=function(){var t,e,n="";do{if("'"!==(e=this.tn.next())&&'"'!==e)throw Error("illegal string delimiter: "+e);n+=this.tn.next(),this.tn.skip(e),t=this.tn.peek()}while('"'===t||'"'===t);return n},a._readValue=function(t){var n=this.tn.peek();if('"'===n||"'"===n)return this._readString();if(this.tn.next(),e.NUMBER.test(n))return l(n);if(e.BOOL.test(n))return"true"===n.toLowerCase();if(t&&e.TYPEREF.test(n))return n;throw Error("illegal value: "+n)},a._parseOption=function(t,n){var r=this.tn.next(),i=!1;if("("===r&&(i=!0,r=this.tn.next()),!e.TYPEREF.test(r))throw Error("illegal option name: "+r);var o=r;i&&(this.tn.skip(")"),o="("+o+")",r=this.tn.peek(),e.FQTYPEREF.test(r)&&(o+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(t,o),n||this.tn.skip(";")},a._parseOptionValue=function(t,n){var r=this.tn.peek();if("{"!==r)c(t.options,n,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!e.NAME.test(r))throw Error("illegal option name: "+n+"."+r);this.tn.omit(":")?c(t.options,n+"."+r,this._readValue(!0)):this._parseOptionValue(t,n+"."+r)}},a._parseService=function(t){var n=this.tn.next();if(!e.NAME.test(n))throw Error("illegal service name at line "+this.tn.line+": "+n);var r={name:n,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(n=this.tn.next());)if("option"===n)this._parseOption(r);else{if("rpc"!==n)throw Error("illegal service token: "+n);this._parseServiceRPC(r)}this.tn.omit(";"),t.services.push(r)},a._parseServiceRPC=function(t){var n=this.tn.next();if(!e.NAME.test(n))throw Error("illegal rpc service method name: "+n);var r=n,i={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(n=this.tn.next()).toLowerCase()&&(i.request_stream=!0,n=this.tn.next()),!e.TYPEREF.test(n))throw Error("illegal rpc service request type: "+n);if(i.request=n,this.tn.skip(")"),"returns"!==(n=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+n);if(this.tn.skip("("),"stream"===(n=this.tn.next()).toLowerCase()&&(i.response_stream=!0,n=this.tn.next()),i.response=n,this.tn.skip(")"),"{"===(n=this.tn.peek())){for(this.tn.next();"}"!==(n=this.tn.next());){if("option"!==n)throw Error("illegal rpc service token: "+n);this._parseOption(i)}this.tn.omit(";")}else this.tn.skip(";");void 0===t.rpc&&(t.rpc={}),t.rpc[r]=i},a._parseMessage=function(t,n){var r=!!n,i=this.tn.next(),o={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!e.NAME.test(i))throw Error("illegal "+(r?"group":"message")+" name: "+i);for(o.name=i,r&&(this.tn.skip("="),n.id=s(this.tn.next()),o.isGroup=!0),"["===(i=this.tn.peek())&&n&&this._parseFieldOptions(n),this.tn.skip("{");"}"!==(i=this.tn.next());)if(e.RULE.test(i))this._parseMessageField(o,i);else if("oneof"===i)this._parseMessageOneOf(o);else if("enum"===i)this._parseEnum(o);else if("message"===i)this._parseMessage(o);else if("option"===i)this._parseOption(o);else if("service"===i)this._parseService(o);else if("extensions"===i)o.hasOwnProperty("extensions")?o.extensions=o.extensions.concat(this._parseExtensionRanges()):o.extensions=this._parseExtensionRanges();else if("reserved"===i)this._parseIgnored();else if("extend"===i)this._parseExtend(o);else{if(!e.TYPEREF.test(i))throw Error("illegal message token: "+i);if(!this.proto3)throw Error("illegal field rule: "+i);this._parseMessageField(o,"optional",i)}return this.tn.omit(";"),t.messages.push(o),o},a._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},a._parseMessageField=function(t,n,r){if(!e.RULE.test(n))throw Error("illegal message field rule: "+n);var i,o={rule:n,type:"",name:"",options:{},id:0};if("map"===n){if(r)throw Error("illegal type: "+r);if(this.tn.skip("<"),i=this.tn.next(),!e.TYPE.test(i)&&!e.TYPEREF.test(i))throw Error("illegal message field type: "+i);if(o.keytype=i,this.tn.skip(","),i=this.tn.next(),!e.TYPE.test(i)&&!e.TYPEREF.test(i))throw Error("illegal message field: "+i);if(o.type=i,this.tn.skip(">"),i=this.tn.next(),!e.NAME.test(i))throw Error("illegal message field name: "+i);o.name=i,this.tn.skip("="),o.id=s(this.tn.next()),"["===(i=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}else if("group"===(r=void 0!==r?r:this.tn.next())){var a=this._parseMessage(t,o);if(!/^[A-Z]/.test(a.name))throw Error("illegal group name: "+a.name);o.type=a.name,o.name=a.name.toLowerCase(),this.tn.omit(";")}else{if(!e.TYPE.test(r)&&!e.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(o.type=r,i=this.tn.next(),!e.NAME.test(i))throw Error("illegal message field name: "+i);o.name=i,this.tn.skip("="),o.id=s(this.tn.next()),"["===(i=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}return t.fields.push(o),o},a._parseMessageOneOf=function(t){var n=this.tn.next();if(!e.NAME.test(n))throw Error("illegal oneof name: "+n);var r,i=n,o=[];for(this.tn.skip("{");"}"!==(n=this.tn.next());)(r=this._parseMessageField(t,"optional",n)).oneof=i,o.push(r.id);this.tn.omit(";"),t.oneofs[i]=o},a._parseFieldOptions=function(t){this.tn.skip("[");for(var e=!0;"]"!==this.tn.peek();)e||this.tn.skip(","),this._parseOption(t,!0),e=!1;this.tn.next()},a._parseEnum=function(t){var n={name:"",values:[],options:{}},r=this.tn.next();if(!e.NAME.test(r))throw Error("illegal name: "+r);for(n.name=r,this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(n);else{if(!e.NAME.test(r))throw Error("illegal name: "+r);this.tn.skip("=");var i={name:r,id:s(this.tn.next(),!0)};"["===(r=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),n.values.push(i)}this.tn.omit(";"),t.enums.push(n)},a._parseExtensionRanges=function(){var e,n,r,i=[];do{for(n=[];;){switch(e=this.tn.next()){case"min":r=t.ID_MIN;break;case"max":r=t.ID_MAX;break;default:r=l(e)}if(n.push(r),2===n.length)break;if("to"!==this.tn.peek()){n.push(r);break}this.tn.next()}i.push(n)}while(this.tn.omit(","));return this.tn.skip(";"),i},a._parseExtend=function(t){var n=this.tn.next();if(!e.TYPEREF.test(n))throw Error("illegal extend reference: "+n);var r={ref:n,fields:[]};for(this.tn.skip("{");"}"!==(n=this.tn.next());)if(e.RULE.test(n))this._parseMessageField(r,n);else{if(!e.TYPEREF.test(n))throw Error("illegal extend token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(r,"optional",n)}return this.tn.omit(";"),t.messages.push(r),r},a.toString=function(){return"Parser at line "+this.tn.line},n.Parser=o,n}(r,r.Lang),r.Reflect=function(e){var n={},r=function(t,e,n){this.builder=t,this.parent=e,this.name=n,this.className},i=r.prototype;i.fqn=function(){for(var t=this.name,e=this;null!=(e=e.parent);)t=e.name+"."+t;return t},i.toString=function(t){return(t?this.className+" ":"")+this.fqn()},i.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},n.T=r;var o=function(t,e,n,i,o){r.call(this,t,e,n),this.className="Namespace",this.children=[],this.options=i||{},this.syntax=o||"proto2"},a=o.prototype=Object.create(r.prototype);a.getChildren=function(t){if(null==(t=t||null))return this.children.slice();for(var e=[],n=0,r=this.children.length;n<r;++n)this.children[n]instanceof t&&e.push(this.children[n]);return e},a.addChild=function(t){var e;if(e=this.getChild(t.name))if(e instanceof u.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName))e.name=e.originalName;else{if(!(t instanceof u.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+t.name);t.name=t.originalName}this.children.push(t)},a.getChild=function(t){for(var e="number"==typeof t?"id":"name",n=0,r=this.children.length;n<r;++n)if(this.children[n][e]===t)return this.children[n];return null},a.resolve=function(t,e){var r,i="string"==typeof t?t.split("."):t,o=this,a=0;if(""===i[a]){for(;null!==o.parent;)o=o.parent;a++}do{do{if(!(o instanceof n.Namespace)){o=null;break}if(!(r=o.getChild(i[a]))||!(r instanceof n.T)||e&&!(r instanceof n.Namespace)){o=null;break}o=r,a++}while(a<i.length);if(null!=o)break;if(null!==this.parent)return this.parent.resolve(t,e)}while(null!=o);return o},a.qn=function(t){var e=[],r=t;do{e.unshift(r.name),r=r.parent}while(null!==r);for(var i=1;i<=e.length;i++){var o=e.slice(e.length-i);if(t===this.resolve(o,t instanceof n.Namespace))return o.join(".")}return t.fqn()},a.build=function(){for(var t,e={},n=this.children,r=0,i=n.length;r<i;++r)(t=n[r])instanceof o&&(e[t.name]=t.build());return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt()}),e},a.buildOpt=function(){for(var t={},e=Object.keys(this.options),n=0,r=e.length;n<r;++n){var i=e[n],o=this.options[e[n]];t[i]=o}return t},a.getOption=function(t){return void 0===t?this.options:void 0!==this.options[t]?this.options[t]:null},n.Namespace=o;var s=function(t,n,r,i,o){if(this.type=t,this.resolvedType=n,this.isMapKey=r,this.syntax=i,this.name=o,r&&e.MAP_KEY_TYPES.indexOf(t)<0)throw Error("Invalid map key type: "+t.name)},l=s.prototype;function c(t,n){if(t&&"number"==typeof t.low&&"number"==typeof t.high&&"boolean"==typeof t.unsigned&&t.low==t.low&&t.high==t.high)return new e.Long(t.low,t.high,void 0===n?t.unsigned:n);if("string"==typeof t)return e.Long.fromString(t,n||!1,10);if("number"==typeof t)return e.Long.fromNumber(t,n||!1);throw Error("not convertible to Long")}s.defaultFieldValue=function(n){if("string"==typeof n&&(n=e.TYPES[n]),void 0===n.defaultValue)throw Error("default value for type "+n.name+" is not supported");return n==e.TYPES.bytes?new t(0):n.defaultValue},l.toString=function(){return(this.name||"")+(this.isMapKey?"map":"value")+" element"},l.verifyValue=function(n){var r=this;function i(t,e){throw Error("Illegal value for "+r.toString(!0)+" of type "+r.type.name+": "+t+" ("+e+")")}switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:return("number"!=typeof n||n==n&&n%1!=0)&&i(typeof n,"not an integer"),n>4294967295?0|n:n;case e.TYPES.uint32:case e.TYPES.fixed32:return("number"!=typeof n||n==n&&n%1!=0)&&i(typeof n,"not an integer"),n<0?n>>>0:n;case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:if(e.Long)try{return c(n,!1)}catch(t){i(typeof n,t.message)}else i(typeof n,"requires Long.js");case e.TYPES.uint64:case e.TYPES.fixed64:if(e.Long)try{return c(n,!0)}catch(t){i(typeof n,t.message)}else i(typeof n,"requires Long.js");case e.TYPES.bool:return"boolean"!=typeof n&&i(typeof n,"not a boolean"),n;case e.TYPES.float:case e.TYPES.double:return"number"!=typeof n&&i(typeof n,"not a number"),n;case e.TYPES.string:return"string"==typeof n||n&&n instanceof String||i(typeof n,"not a string"),""+n;case e.TYPES.bytes:return t.isByteBuffer(n)?n:t.wrap(n,"base64");case e.TYPES.enum:var o=this.resolvedType.getChildren(e.Reflect.Enum.Value);for(s=0;s<o.length;s++){if(o[s].name==n)return o[s].id;if(o[s].id==n)return o[s].id}if("proto3"===this.syntax)return("number"!=typeof n||n==n&&n%1!=0)&&i(typeof n,"not an integer"),(n>4294967295||n<0)&&i(typeof n,"not in range for uint32"),n;i(n,"not a valid enum value");case e.TYPES.group:case e.TYPES.message:if(n&&"object"==typeof n||i(typeof n,"object expected"),n instanceof this.resolvedType.clazz)return n;if(n instanceof e.Builder.Message){var a={};for(var s in n)n.hasOwnProperty(s)&&(a[s]=n[s]);n=a}return new this.resolvedType.clazz(n)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+n+" (undefined type "+this.type+")")},l.calculateLength=function(n,r){if(null===r)return 0;var i;switch(this.type){case e.TYPES.int32:return r<0?t.calculateVarint64(r):t.calculateVarint32(r);case e.TYPES.uint32:return t.calculateVarint32(r);case e.TYPES.sint32:return t.calculateVarint32(t.zigZagEncode32(r));case e.TYPES.fixed32:case e.TYPES.sfixed32:case e.TYPES.float:return 4;case e.TYPES.int64:case e.TYPES.uint64:return t.calculateVarint64(r);case e.TYPES.sint64:return t.calculateVarint64(t.zigZagEncode64(r));case e.TYPES.fixed64:case e.TYPES.sfixed64:return 8;case e.TYPES.bool:return 1;case e.TYPES.enum:return t.calculateVarint32(r);case e.TYPES.double:return 8;case e.TYPES.string:return i=t.calculateUTF8Bytes(r),t.calculateVarint32(i)+i;case e.TYPES.bytes:if(r.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");return t.calculateVarint32(r.remaining())+r.remaining();case e.TYPES.message:return i=this.resolvedType.calculate(r),t.calculateVarint32(i)+i;case e.TYPES.group:return(i=this.resolvedType.calculate(r))+t.calculateVarint32(n<<3|e.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")},l.encodeValue=function(n,r,i){if(null===r)return i;switch(this.type){case e.TYPES.int32:r<0?i.writeVarint64(r):i.writeVarint32(r);break;case e.TYPES.uint32:i.writeVarint32(r);break;case e.TYPES.sint32:i.writeVarint32ZigZag(r);break;case e.TYPES.fixed32:i.writeUint32(r);break;case e.TYPES.sfixed32:i.writeInt32(r);break;case e.TYPES.int64:case e.TYPES.uint64:i.writeVarint64(r);break;case e.TYPES.sint64:i.writeVarint64ZigZag(r);break;case e.TYPES.fixed64:i.writeUint64(r);break;case e.TYPES.sfixed64:i.writeInt64(r);break;case e.TYPES.bool:"string"==typeof r?i.writeVarint32("false"===r.toLowerCase()?0:!!r):i.writeVarint32(r?1:0);break;case e.TYPES.enum:i.writeVarint32(r);break;case e.TYPES.float:i.writeFloat32(r);break;case e.TYPES.double:i.writeFloat64(r);break;case e.TYPES.string:i.writeVString(r);break;case e.TYPES.bytes:if(r.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");var o=r.offset;i.writeVarint32(r.remaining()),i.append(r),r.offset=o;break;case e.TYPES.message:var a=(new t).LE();this.resolvedType.encode(r,a),i.writeVarint32(a.offset),i.append(a.flip());break;case e.TYPES.group:this.resolvedType.encode(r,i),i.writeVarint32(n<<3|e.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")}return i},l.decode=function(t,n,r){if(n!=this.type.wireType)throw Error("Unexpected wire type for element");var i,o;switch(this.type){case e.TYPES.int32:return 0|t.readVarint32();case e.TYPES.uint32:return t.readVarint32()>>>0;case e.TYPES.sint32:return 0|t.readVarint32ZigZag();case e.TYPES.fixed32:return t.readUint32()>>>0;case e.TYPES.sfixed32:return 0|t.readInt32();case e.TYPES.int64:return t.readVarint64();case e.TYPES.uint64:return t.readVarint64().toUnsigned();case e.TYPES.sint64:return t.readVarint64ZigZag();case e.TYPES.fixed64:return t.readUint64();case e.TYPES.sfixed64:return t.readInt64();case e.TYPES.bool:return!!t.readVarint32();case e.TYPES.enum:return t.readVarint32();case e.TYPES.float:return t.readFloat();case e.TYPES.double:return t.readDouble();case e.TYPES.string:return t.readVString();case e.TYPES.bytes:if(o=t.readVarint32(),t.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+t.remaining());return(i=t.clone()).limit=i.offset+o,t.offset+=o,i;case e.TYPES.message:return o=t.readVarint32(),this.resolvedType.decode(t,o);case e.TYPES.group:return this.resolvedType.decode(t,-1,r)}throw Error("[INTERNAL] Illegal decode type")},l.valueFromString=function(n){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:case e.TYPES.uint32:case e.TYPES.fixed32:return this.verifyValue(parseInt(n));case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:case e.TYPES.uint64:case e.TYPES.fixed64:return this.verifyValue(n);case e.TYPES.bool:return"true"===n;case e.TYPES.string:return this.verifyValue(n);case e.TYPES.bytes:return t.fromBinary(n)}},l.valueToString=function(t){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===e.TYPES.bytes?t.toString("binary"):t.toString()},n.Element=s;var u=function(t,e,n,r,i,a){o.call(this,t,e,n,r,a),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!i,this._fields=null,this._fieldsById=null,this._fieldsByName=null},h=u.prototype=Object.create(o.prototype);function p(t,n){var r=n.readVarint32(),i=7&r,o=r>>>3;switch(i){case e.WIRE_TYPES.VARINT:do{r=n.readUint8()}while(128==(128&r));break;case e.WIRE_TYPES.BITS64:n.offset+=8;break;case e.WIRE_TYPES.LDELIM:r=n.readVarint32(),n.offset+=r;break;case e.WIRE_TYPES.STARTGROUP:p(o,n);break;case e.WIRE_TYPES.ENDGROUP:if(o===t)return!1;throw Error("Illegal GROUPEND after unknown group: "+o+" ("+t+" expected)");case e.WIRE_TYPES.BITS32:n.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+t+": "+i)}return!0}h.build=function(n){if(this.clazz&&!n)return this.clazz;var r=function(e,n){var r=n.getChildren(e.Reflect.Message.Field),i=n.getChildren(e.Reflect.Message.OneOf),o=function(a,s){var l,c=arguments;e.Builder.Message.call(this);for(var u=0,h=i.length;u<h;++u)this[i[u].name]=null;for(u=0,h=r.length;u<h;++u){var p=r[u];this[p.name]=p.repeated?[]:p.map?new e.Map(p):null,!p.required&&"proto3"!==n.syntax||null===p.defaultValue||(this[p.name]=p.defaultValue)}if(arguments.length>0)if(1!==arguments.length||null===a||"object"!=typeof a||!("function"!=typeof a.encode||a instanceof o)||Array.isArray(a)||a instanceof e.Map||t.isByteBuffer(a)||a instanceof ArrayBuffer||e.Long&&a instanceof e.Long)for(u=0,h=arguments.length;u<h;++u)void 0!==(l=c[u])&&this.$set(r[u].name,l);else this.$set(a)},a=o.prototype=Object.create(e.Builder.Message.prototype);a.add=function(t,r,i){var o=n._fieldsByName[t];if(!i){if(!o)throw Error(this+"#"+t+" is undefined");if(!(o instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+o.toString(!0));if(!o.repeated)throw Error(this+"#"+t+" is not a repeated field");r=o.verifyValue(r,!0)}return null===this[t]&&(this[t]=[]),this[t].push(r),this},a.$add=a.add,a.set=function(t,r,i){if(t&&"object"==typeof t){for(var o in i=r,t)t.hasOwnProperty(o)&&void 0!==(r=t[o])&&void 0===n._oneofsByName[o]&&this.$set(o,r,i);return this}var a=n._fieldsByName[t];if(i)this[t]=r;else{if(!a)throw Error(this+"#"+t+" is not a field: undefined");if(!(a instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+a.toString(!0));this[a.name]=r=a.verifyValue(r)}if(a&&a.oneof){var s=this[a.oneof.name];null!==r?(null!==s&&s!==a.name&&(this[s]=null),this[a.oneof.name]=a.name):s===t&&(this[a.oneof.name]=null)}return this},a.$set=a.set,a.get=function(t,r){if(r)return this[t];var i=n._fieldsByName[t];if(!(i&&i instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: undefined");if(!(i instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+i.toString(!0));return this[i.name]},a.$get=a.get;for(var s=0;s<r.length;s++){var l=r[s];l instanceof e.Reflect.Message.ExtensionField||n.builder.options.populateAccessors&&function(t){var e=t.originalName.replace(/(_[a-zA-Z])/g,(function(t){return t.toUpperCase().replace("_","")}));e=e.substring(0,1).toUpperCase()+e.substring(1);var r=t.originalName.replace(/([A-Z])/g,(function(t){return"_"+t})),i=function(e,n){return this[t.name]=n?e:t.verifyValue(e),this},o=function(){return this[t.name]};null===n.getChild("set"+e)&&(a["set"+e]=i),null===n.getChild("set_"+r)&&(a["set_"+r]=i),null===n.getChild("get"+e)&&(a["get"+e]=o),null===n.getChild("get_"+r)&&(a["get_"+r]=o)}(l)}function c(n,r,i,o){if(null===n||"object"!=typeof n){if(o&&o instanceof e.Reflect.Enum){var a=e.Reflect.Enum.getName(o.object,n);if(null!==a)return a}return n}if(t.isByteBuffer(n))return r?n.toBase64():n.toBuffer();if(e.Long.isLong(n))return i?n.toString():e.Long.fromValue(n);var s;if(Array.isArray(n))return s=[],n.forEach((function(t,e){s[e]=c(t,r,i,o)})),s;if(s={},n instanceof e.Map){for(var l=n.entries(),u=l.next();!u.done;u=l.next())s[n.keyElem.valueToString(u.value[0])]=c(u.value[1],r,i,n.valueElem.resolvedType);return s}var h=n.$type,p=void 0;for(var d in n)n.hasOwnProperty(d)&&(h&&(p=h.getChild(d))?s[d]=c(n[d],r,i,p.resolvedType):s[d]=c(n[d],r,i));return s}return a.encode=function(e,r){"boolean"==typeof e&&(r=e,e=void 0);var i=!1;e||(e=new t,i=!0);var o=e.littleEndian;try{return n.encode(this,e.LE(),r),(i?e.flip():e).LE(o)}catch(t){throw e.LE(o),t}},o.encode=function(t,e,n){return new o(t).encode(e,n)},a.calculate=function(){return n.calculate(this)},a.encodeDelimited=function(e,r){var i=!1;e||(e=new t,i=!0);var o=(new t).LE();return n.encode(this,o,r).flip(),e.writeVarint32(o.remaining()),e.append(o),i?e.flip():e},a.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toArrayBuffer()),t}},a.toArrayBuffer=a.encodeAB,a.encodeNB=function(){try{return this.encode().toBuffer()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toBuffer()),t}},a.toBuffer=a.encodeNB,a.encode64=function(){try{return this.encode().toBase64()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toBase64()),t}},a.toBase64=a.encode64,a.encodeHex=function(){try{return this.encode().toHex()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toHex()),t}},a.toHex=a.encodeHex,a.toRaw=function(t,e){return c(this,!!t,!!e,this.$type)},a.encodeJSON=function(){return JSON.stringify(c(this,!0,!0,this.$type))},o.decode=function(e,r,i){"string"==typeof r&&(i=r,r=-1),"string"==typeof e?e=t.wrap(e,i||"base64"):t.isByteBuffer(e)||(e=t.wrap(e));var o=e.littleEndian;try{var a=n.decode(e.LE(),r);return e.LE(o),a}catch(t){throw e.LE(o),t}},o.decodeDelimited=function(e,r){if("string"==typeof e?e=t.wrap(e,r||"base64"):t.isByteBuffer(e)||(e=t.wrap(e)),e.remaining()<1)return null;var i=e.offset,o=e.readVarint32();if(e.remaining()<o)return e.offset=i,null;try{var a=n.decode(e.slice(e.offset,e.offset+o).LE());return e.offset+=o,a}catch(t){throw e.offset+=o,t}},o.decode64=function(t){return o.decode(t,"base64")},o.decodeHex=function(t){return o.decode(t,"hex")},o.decodeJSON=function(t){return new o(JSON.parse(t))},a.toString=function(){return n.toString()},Object.defineProperty&&(Object.defineProperty(o,"$options",{value:n.buildOpt()}),Object.defineProperty(a,"$options",{value:o.$options}),Object.defineProperty(o,"$type",{value:n}),Object.defineProperty(a,"$type",{value:n})),o}(e,this);this._fields=[],this._fieldsById={},this._fieldsByName={},this._oneofsByName={};for(var i,o=0,a=this.children.length;o<a;o++)if((i=this.children[o])instanceof v||i instanceof u||i instanceof _){if(r.hasOwnProperty(i.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+i.toString(!0)+" cannot override static property '"+i.name+"'");r[i.name]=i.build()}else if(i instanceof u.Field)i.build(),this._fields.push(i),this._fieldsById[i.id]=i,this._fieldsByName[i.name]=i;else if(i instanceof u.OneOf)this._oneofsByName[i.name]=i;else if(!(i instanceof u.OneOf||i instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[o].toString(!0));return this.clazz=r},h.encode=function(t,e,n){for(var r,i,o=null,a=0,s=this._fields.length;a<s;++a)i=t[(r=this._fields[a]).name],r.required&&null===i?null===o&&(o=r):r.encode(n?i:r.verifyValue(i),e,t);if(null!==o){var l=Error("Missing at least one required field for "+this.toString(!0)+": "+o);throw l.encoded=e,l}return e},h.calculate=function(t){for(var e,n,r=0,i=0,o=this._fields.length;i<o;++i){if(n=t[(e=this._fields[i]).name],e.required&&null===n)throw Error("Missing at least one required field for "+this.toString(!0)+": "+e);r+=e.calculate(n,t)}return r},h.decode=function(t,n,r){"number"!=typeof n&&(n=-1);for(var i,o,a,s,l=t.offset,c=new this.clazz;t.offset<l+n||-1===n&&t.remaining()>0;){if(a=(i=t.readVarint32())>>>3,(o=7&i)===e.WIRE_TYPES.ENDGROUP){if(a!==r)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+a+" ("+(r?r+" expected":"not a group")+")");break}if(s=this._fieldsById[a]){if(s.repeated&&!s.options.packed)c[s.name].push(s.decode(o,t));else if(s.map){var u=s.decode(o,t);c[s.name].set(u[0],u[1])}else if(c[s.name]=s.decode(o,t),s.oneof){var h=c[s.oneof.name];null!==h&&h!==s.name&&(c[h]=null),c[s.oneof.name]=s.name}}else switch(o){case e.WIRE_TYPES.VARINT:t.readVarint32();break;case e.WIRE_TYPES.BITS32:t.offset+=4;break;case e.WIRE_TYPES.BITS64:t.offset+=8;break;case e.WIRE_TYPES.LDELIM:var d=t.readVarint32();t.offset+=d;break;case e.WIRE_TYPES.STARTGROUP:for(;p(a,t););break;default:throw Error("Illegal wire type for unknown field "+a+" in "+this.toString(!0)+"#decode: "+o)}}for(var f=0,m=this._fields.length;f<m;++f)if(null===c[(s=this._fields[f]).name])if("proto3"===this.syntax)c[s.name]=s.defaultValue;else{if(s.required){var v=Error("Missing at least one required field for "+this.toString(!0)+": "+s.name);throw v.decoded=c,v}e.populateDefaults&&null!==s.defaultValue&&(c[s.name]=s.defaultValue)}return c},n.Message=u;var d=function(t,n,i,o,a,s,l,c,h,p){r.call(this,t,n,s),this.className="Message.Field",this.required="required"===i,this.repeated="repeated"===i,this.map="map"===i,this.keyType=o||null,this.type=a,this.resolvedType=null,this.id=l,this.options=c||{},this.defaultValue=null,this.oneof=h||null,this.syntax=p||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof u.ExtensionField||(this.name=e.Util.toCamelCase(this.name))},f=d.prototype=Object.create(r.prototype);f.build=function(){this.element=new s(this.type,this.resolvedType,!1,this.syntax,this.name),this.map&&(this.keyElement=new s(this.keyType,void 0,!0,this.syntax,this.name)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=s.defaultFieldValue(this.type)},f.verifyValue=function(t,n){n=n||!1;var r,i=this;function o(t,e){throw Error("Illegal value for "+i.toString(!0)+" of type "+i.type.name+": "+t+" ("+e+")")}if(null===t)return this.required&&o(typeof t,"required"),"proto3"===this.syntax&&this.type!==e.TYPES.message&&o(typeof t,"proto3 field without field presence cannot be null"),null;if(this.repeated&&!n){Array.isArray(t)||(t=[t]);var a=[];for(r=0;r<t.length;r++)a.push(this.element.verifyValue(t[r]));return a}return this.map&&!n?t instanceof e.Map?t:(t instanceof Object||o(typeof t,"expected ProtoBuf.Map or raw object for map field"),new e.Map(this,t)):(!this.repeated&&Array.isArray(t)&&o(typeof t,"no array expected"),this.element.verifyValue(t))},f.hasWirePresence=function(t,n){if("proto3"!==this.syntax)return null!==t;if(this.oneof&&n[this.oneof.name]===this.name)return!0;switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:case e.TYPES.uint32:case e.TYPES.fixed32:return 0!==t;case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:case e.TYPES.uint64:case e.TYPES.fixed64:return 0!==t.low||0!==t.high;case e.TYPES.bool:return t;case e.TYPES.float:case e.TYPES.double:return 0!==t;case e.TYPES.string:return t.length>0;case e.TYPES.bytes:return t.remaining()>0;case e.TYPES.enum:return 0!==t;case e.TYPES.message:return null!==t;default:return!0}},f.encode=function(n,r,i){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===n||this.repeated&&0==n.length)return r;try{var o;if(this.repeated)if(this.options.packed&&e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){r.writeVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),r.ensureCapacity(r.offset+=1);var a=r.offset;for(o=0;o<n.length;o++)this.element.encodeValue(this.id,n[o],r);var s=r.offset-a,l=t.calculateVarint32(s);if(l>1){var c=r.slice(a,r.offset);a+=l-1,r.offset=a,r.append(c)}r.writeVarint32(s,a-l)}else for(o=0;o<n.length;o++)r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,n[o],r);else this.map?n.forEach((function(n,i,o){var a=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,i)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,n);r.writeVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),r.writeVarint32(a),r.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,i,r),r.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,n,r)}),this):this.hasWirePresence(n,i)&&(r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,n,r))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+n+" ("+t+")")}return r},f.calculate=function(n,r){if(n=this.verifyValue(n),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===n||this.repeated&&0==n.length)return 0;var i=0;try{var o,a;if(this.repeated)if(this.options.packed&&e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(i+=t.calculateVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),a=0,o=0;o<n.length;o++)a+=this.element.calculateLength(this.id,n[o]);i+=t.calculateVarint32(a),i+=a}else for(o=0;o<n.length;o++)i+=t.calculateVarint32(this.id<<3|this.type.wireType),i+=this.element.calculateLength(this.id,n[o]);else this.map?n.forEach((function(n,r,o){var a=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,n);i+=t.calculateVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),i+=t.calculateVarint32(a),i+=a}),this):this.hasWirePresence(n,r)&&(i+=t.calculateVarint32(this.id<<3|this.type.wireType),i+=this.element.calculateLength(this.id,n))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+n+" ("+t+")")}return i},f.decode=function(t,n,r){var i,o;if(!(!this.map&&t==this.type.wireType||!r&&this.repeated&&this.options.packed&&t==e.WIRE_TYPES.LDELIM||this.map&&t==e.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+t+" ("+this.type.wireType+" expected)");if(t==e.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!r){o=n.readVarint32(),o=n.offset+o;for(var a=[];n.offset<o;)a.push(this.decode(this.type.wireType,n,!0));return a}if(this.map){var l=s.defaultFieldValue(this.keyType);if(i=s.defaultFieldValue(this.type),o=n.readVarint32(),n.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+n.remaining());var c=n.clone();for(c.limit=c.offset+o,n.offset+=o;c.remaining()>0;){var u=c.readVarint32();t=7&u;var h=u>>>3;if(1===h)l=this.keyElement.decode(c,t,h);else{if(2!==h)throw Error("Unexpected tag in map field key/value submessage");i=this.element.decode(c,t,h)}}return[l,i]}return this.element.decode(n,t,this.id)},n.Message.Field=d;var m=function(t,e,n,r,i,o,a){d.call(this,t,e,n,null,r,i,o,a),this.extension};m.prototype=Object.create(d.prototype),n.Message.ExtensionField=m,n.Message.OneOf=function(t,e,n){r.call(this,t,e,n),this.fields=[]};var v=function(t,e,n,r,i){o.call(this,t,e,n,r,i),this.className="Enum",this.object=null};v.getName=function(t,e){for(var n,r=Object.keys(t),i=0;i<r.length;++i)if(t[n=r[i]]===e)return n;return null},(v.prototype=Object.create(o.prototype)).build=function(t){if(this.object&&!t)return this.object;for(var n=new e.Builder.Enum,r=this.getChildren(v.Value),i=0,o=r.length;i<o;++i)n[r[i].name]=r[i].id;return Object.defineProperty&&Object.defineProperty(n,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=n},n.Enum=v;var g=function(t,e,n,i){r.call(this,t,e,n),this.className="Enum.Value",this.id=i};g.prototype=Object.create(r.prototype),n.Enum.Value=g;var y=function(t,e,n,i){r.call(this,t,e,n),this.field=i};y.prototype=Object.create(r.prototype),n.Extension=y;var _=function(t,e,n,r){o.call(this,t,e,n,r),this.className="Service",this.clazz=null};(_.prototype=Object.create(o.prototype)).build=function(n){return this.clazz&&!n?this.clazz:this.clazz=function(e,n){for(var r=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(t,e,n){setTimeout(n.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},i=r.prototype=Object.create(e.Builder.Service.prototype),o=n.getChildren(e.Reflect.Service.RPCMethod),a=0;a<o.length;a++)!function(e){i[e.name]=function(r,i){try{try{r=e.resolvedRequestType.clazz.decode(t.wrap(r))}catch(t){if(!(t instanceof TypeError))throw t}if(null===r||"object"!=typeof r)throw Error("Illegal arguments");r instanceof e.resolvedRequestType.clazz||(r=new e.resolvedRequestType.clazz(r)),this.rpcImpl(e.fqn(),r,(function(t,r){if(t)i(t);else{null===r&&(r="");try{r=e.resolvedResponseType.clazz.decode(r)}catch(t){}r&&r instanceof e.resolvedResponseType.clazz?i(null,r):i(Error("Illegal response type received in service method "+n.name+"#"+e.name))}}))}catch(t){setTimeout(i.bind(this,t),0)}},r[e.name]=function(t,n,i){new r(t)[e.name](n,i)},Object.defineProperty&&(Object.defineProperty(r[e.name],"$options",{value:e.buildOpt()}),Object.defineProperty(i[e.name],"$options",{value:r[e.name].$options}))}(o[a]);return Object.defineProperty&&(Object.defineProperty(r,"$options",{value:n.buildOpt()}),Object.defineProperty(i,"$options",{value:r.$options}),Object.defineProperty(r,"$type",{value:n}),Object.defineProperty(i,"$type",{value:n})),r}(e,this)},n.Service=_;var E=function(t,e,n,i){r.call(this,t,e,n),this.className="Service.Method",this.options=i||{}};(E.prototype=Object.create(r.prototype)).buildOpt=a.buildOpt,n.Service.Method=E;var T=function(t,e,n,r,i,o,a,s){E.call(this,t,e,n,s),this.className="Service.RPCMethod",this.requestName=r,this.responseName=i,this.requestStream=o,this.responseStream=a,this.resolvedRequestType=null,this.resolvedResponseType=null};return T.prototype=Object.create(E.prototype),n.Service.RPCMethod=T,n}(r),r.Builder=function(t,e,n){var r=function(t){this.ns=new n.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=t||{}},i=r.prototype;return r.isMessage=function(t){return"string"==typeof t.name&&void 0===t.values&&void 0===t.rpc},r.isMessageField=function(t){return"string"==typeof t.rule&&"string"==typeof t.name&&"string"==typeof t.type&&void 0!==t.id},r.isEnum=function(t){return"string"==typeof t.name&&!(void 0===t.values||!Array.isArray(t.values)||0===t.values.length)},r.isService=function(t){return!("string"!=typeof t.name||"object"!=typeof t.rpc||!t.rpc)},r.isExtend=function(t){return"string"==typeof t.ref},i.reset=function(){return this.ptr=this.ns,this},i.define=function(t){if("string"!=typeof t||!e.TYPEREF.test(t))throw Error("illegal namespace: "+t);return t.split(".").forEach((function(t){var e=this.ptr.getChild(t);null===e&&this.ptr.addChild(e=new n.Namespace(this,this.ptr,t)),this.ptr=e}),this),this},i.create=function(e){if(!e)return this;if(Array.isArray(e)){if(0===e.length)return this;e=e.slice()}else e=[e];for(var i=[e];i.length>0;){if(e=i.pop(),!Array.isArray(e))throw Error("not a valid namespace: "+JSON.stringify(e));for(;e.length>0;){var o=e.shift();if(r.isMessage(o)){var a=new n.Message(this,this.ptr,o.name,o.options,o.isGroup,o.syntax),s={};o.oneofs&&Object.keys(o.oneofs).forEach((function(t){a.addChild(s[t]=new n.Message.OneOf(this,a,t))}),this),o.fields&&o.fields.forEach((function(t){if(null!==a.getChild(0|t.id))throw Error("duplicate or invalid field id in "+a.name+": "+t.id);if(t.options&&"object"!=typeof t.options)throw Error("illegal field options in "+a.name+"#"+t.name);var e=null;if("string"==typeof t.oneof&&!(e=s[t.oneof]))throw Error("illegal oneof in "+a.name+"#"+t.name+": "+t.oneof);t=new n.Message.Field(this,a,t.rule,t.keytype,t.type,t.name,t.id,t.options,e,o.syntax),e&&e.fields.push(t),a.addChild(t)}),this);var l=[];if(o.enums&&o.enums.forEach((function(t){l.push(t)})),o.messages&&o.messages.forEach((function(t){l.push(t)})),o.services&&o.services.forEach((function(t){l.push(t)})),o.extensions&&("number"==typeof o.extensions[0]?a.extensions=[o.extensions]:a.extensions=o.extensions),this.ptr.addChild(a),l.length>0){i.push(e),e=l,l=null,this.ptr=a,a=null;continue}l=null}else if(r.isEnum(o))a=new n.Enum(this,this.ptr,o.name,o.options,o.syntax),o.values.forEach((function(t){a.addChild(new n.Enum.Value(this,a,t.name,t.id))}),this),this.ptr.addChild(a);else if(r.isService(o))a=new n.Service(this,this.ptr,o.name,o.options),Object.keys(o.rpc).forEach((function(t){var e=o.rpc[t];a.addChild(new n.Service.RPCMethod(this,a,t,e.request,e.response,!!e.request_stream,!!e.response_stream,e.options))}),this),this.ptr.addChild(a);else{if(!r.isExtend(o))throw Error("not a valid definition: "+JSON.stringify(o));if(a=this.ptr.resolve(o.ref,!0))o.fields.forEach((function(e){if(null!==a.getChild(0|e.id))throw Error("duplicate extended field id in "+a.name+": "+e.id);if(a.extensions){var r=!1;if(a.extensions.forEach((function(t){e.id>=t[0]&&e.id<=t[1]&&(r=!0)})),!r)throw Error("illegal extended field id in "+a.name+": "+e.id+" (not within valid ranges)")}var i=e.name;this.options.convertFieldsToCamelCase&&(i=t.Util.toCamelCase(i));var o=new n.Message.ExtensionField(this,a,e.rule,e.type,this.ptr.fqn()+"."+i,e.id,e.options),s=new n.Extension(this,this.ptr,e.name,o);o.extension=s,this.ptr.addChild(s),a.addChild(o)}),this);else if(!/\.?google\.protobuf\./.test(o.ref))throw Error("extended message "+o.ref+" is not defined")}o=null,a=null}e=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},i.import=function(e,n){var r="/";if("string"==typeof n){if(t.Util.IS_NODE&&(n=lc.resolve(n)),!0===this.files[n])return this.reset();this.files[n]=!0}else if("object"==typeof n){var i,o=n.root;if(t.Util.IS_NODE&&(o=lc.resolve(o)),(o.indexOf("\\")>=0||n.file.indexOf("\\")>=0)&&(r="\\"),i=t.Util.IS_NODE?lc.join(o,n.file):o+r+n.file,!0===this.files[i])return this.reset();this.files[i]=!0}if(e.imports&&e.imports.length>0){var a,s=!1;"object"==typeof n?(this.importRoot=n.root,s=!0,a=this.importRoot,n=n.file,(a.indexOf("\\")>=0||n.indexOf("\\")>=0)&&(r="\\")):"string"==typeof n?this.importRoot?a=this.importRoot:n.indexOf("/")>=0?""===(a=n.replace(/\/[^\/]*$/,""))&&(a="/"):n.indexOf("\\")>=0?(a=n.replace(/\\[^\\]*$/,""),r="\\"):a=".":a=null;for(var l=0;l<e.imports.length;l++)if("string"==typeof e.imports[l]){if(!a)throw Error("cannot determine import root");var c=e.imports[l];if("google/protobuf/descriptor.proto"===c)continue;if(c=t.Util.IS_NODE?lc.join(a,c):a+r+c,!0===this.files[c])continue;/\.proto$/i.test(c)&&!t.DotProto&&(c=c.replace(/\.proto$/,".json"));var u=t.Util.fetch(c);if(null===u)throw Error("failed to import '"+c+"' in '"+n+"': file not found");/\.json$/i.test(c)?this.import(JSON.parse(u+""),c):this.import(t.DotProto.Parser.parse(u),c)}else n?/\.(\w+)$/.test(n)?this.import(e.imports[l],n.replace(/^(.+)\.(\w+)$/,(function(t,e,n){return e+"_import"+l+"."+n}))):this.import(e.imports[l],n+"_import"+l):this.import(e.imports[l]);s&&(this.importRoot=null)}e.package&&this.define(e.package),e.syntax&&function t(e){e.messages&&e.messages.forEach((function(n){n.syntax=e.syntax,t(n)})),e.enums&&e.enums.forEach((function(t){t.syntax=e.syntax}))}(e);var h=this.ptr;return e.options&&Object.keys(e.options).forEach((function(t){h.options[t]=e.options[t]})),e.messages&&(this.create(e.messages),this.ptr=h),e.enums&&(this.create(e.enums),this.ptr=h),e.services&&(this.create(e.services),this.ptr=h),e.extends&&this.create(e.extends),this.reset()},i.resolveAll=function(){var r;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof n.Namespace)this.ptr.children.forEach((function(t){this.ptr=t,this.resolveAll()}),this);else if(this.ptr instanceof n.Message.Field){if(e.TYPE.test(this.ptr.type))this.ptr.type=t.TYPES[this.ptr.type];else{if(!e.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(r=(this.ptr instanceof n.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=r,r instanceof n.Enum){if(this.ptr.type=t.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==r.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(r instanceof n.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=r.isGroup?t.TYPES.group:t.TYPES.message}}if(this.ptr.map){if(!e.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=t.TYPES[this.ptr.keyType]}"proto3"===this.ptr.syntax&&this.ptr.repeated&&void 0===this.ptr.options.packed&&-1!==t.PACKABLE_WIRE_TYPES.indexOf(this.ptr.type.wireType)&&(this.ptr.options.packed=!0)}else if(this.ptr instanceof t.Reflect.Service.Method){if(!(this.ptr instanceof t.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((r=this.ptr.parent.resolve(this.ptr.requestName,!0))&&r instanceof t.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=r,!((r=this.ptr.parent.resolve(this.ptr.responseName,!0))&&r instanceof t.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=r}else if(!(this.ptr instanceof t.Reflect.Message.OneOf||this.ptr instanceof t.Reflect.Extension||this.ptr instanceof t.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},i.build=function(t){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!t)return this.result;for(var e="string"==typeof t?t.split("."):t,n=this.result,r=0;r<e.length;r++){if(!n[e[r]]){n=null;break}n=n[e[r]]}return n},i.lookup=function(t,e){return t?this.ns.resolve(t,e):this.ns},i.toString=function(){return"Builder"},r.Message=function(){},r.Enum=function(){},r.Service=function(){},r}(r,r.Lang,r.Reflect),r.Map=function(t,e){var n=function(t,n){if(!t.map)throw Error("field is not a map");if(this.field=t,this.keyElem=new e.Element(t.keyType,null,!0,t.syntax),this.valueElem=new e.Element(t.type,t.resolvedType,!1,t.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),n)for(var r=Object.keys(n),i=0;i<r.length;i++){var o=this.keyElem.valueFromString(r[i]),a=this.valueElem.verifyValue(n[r[i]]);this.map[this.keyElem.valueToString(o)]={key:o,value:a}}},r=n.prototype;function i(t){var e=0;return{next:function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}}return r.clear=function(){this.map={}},r.delete=function(t){var e=this.keyElem.valueToString(this.keyElem.verifyValue(t)),n=e in this.map;return delete this.map[e],n},r.entries=function(){for(var t,e=[],n=Object.keys(this.map),r=0;r<n.length;r++)e.push([(t=this.map[n[r]]).key,t.value]);return i(e)},r.keys=function(){for(var t=[],e=Object.keys(this.map),n=0;n<e.length;n++)t.push(this.map[e[n]].key);return i(t)},r.values=function(){for(var t=[],e=Object.keys(this.map),n=0;n<e.length;n++)t.push(this.map[e[n]].value);return i(t)},r.forEach=function(t,e){for(var n,r=Object.keys(this.map),i=0;i<r.length;i++)t.call(e,(n=this.map[r[i]]).value,n.key,this)},r.set=function(t,e){var n=this.keyElem.verifyValue(t),r=this.valueElem.verifyValue(e);return this.map[this.keyElem.valueToString(n)]={key:n,value:r},this},r.get=function(t){var e=this.keyElem.valueToString(this.keyElem.verifyValue(t));if(e in this.map)return this.map[e].value},r.has=function(t){return this.keyElem.valueToString(this.keyElem.verifyValue(t))in this.map},n}(0,r.Reflect),r.loadProto=function(t,e,n){return("string"==typeof e||e&&"string"==typeof e.file&&"string"==typeof e.root)&&(n=e,e=void 0),r.loadJson(r.DotProto.Parser.parse(t),e,n)},r.protoFromString=r.loadProto,r.loadProtoFile=function(t,e,n){if(e&&"object"==typeof e?(n=e,e=null):e&&"function"==typeof e||(e=null),e)return r.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,(function(i){if(null!==i)try{e(null,r.loadProto(i,n,t))}catch(t){e(t)}else e(Error("Failed to fetch file"))}));var i=r.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===i?null:r.loadProto(i,n,t)},r.protoFromFile=r.loadProtoFile,r.newBuilder=function(t){return void 0===(t=t||{}).convertFieldsToCamelCase&&(t.convertFieldsToCamelCase=r.convertFieldsToCamelCase),void 0===t.populateAccessors&&(t.populateAccessors=r.populateAccessors),new r.Builder(t)},r.loadJson=function(t,e,n){return("string"==typeof e||e&&"string"==typeof e.file&&"string"==typeof e.root)&&(n=e,e=null),e&&"object"==typeof e||(e=r.newBuilder()),"string"==typeof t&&(t=JSON.parse(t)),e.import(t,n),e.resolveAll(),e},r.loadJsonFile=function(t,e,n){if(e&&"object"==typeof e?(n=e,e=null):e&&"function"==typeof e||(e=null),e)return r.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,(function(i){if(null!==i)try{e(null,r.loadJson(JSON.parse(i),n,t))}catch(t){e(t)}else e(Error("Failed to fetch file"))}));var i=r.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===i?null:r.loadJson(JSON.parse(i),n,t)},r}))})),pc=window,dc=[],fc="undefined"!=typeof Uint8Array?Uint8Array:Array,mc=!1;function vc(t){var e,n,r,i,o,a;mc||function(){mc=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)dc[t.charCodeAt(e)]=e;dc["-".charCodeAt(0)]=62,dc["_".charCodeAt(0)]=63}();var s=t.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[s-2]?2:"="===t[s-1]?1:0,a=new fc(3*s/4-o),r=o>0?s-4:s;var l=0;for(e=0,n=0;e<r;e+=4,n+=3)i=dc[t.charCodeAt(e)]<<18|dc[t.charCodeAt(e+1)]<<12|dc[t.charCodeAt(e+2)]<<6|dc[t.charCodeAt(e+3)],a[l++]=i>>16&255,a[l++]=i>>8&255,a[l++]=255&i;return 2===o?(i=dc[t.charCodeAt(e)]<<2|dc[t.charCodeAt(e+1)]>>4,a[l++]=255&i):1===o&&(i=dc[t.charCodeAt(e)]<<10|dc[t.charCodeAt(e+1)]<<4|dc[t.charCodeAt(e+2)]>>2,a[l++]=i>>8&255,a[l++]=255&i),a}function gc(t,e,n,r,i){var o,a,s=8*i-r-1,l=(1<<s)-1,c=l>>1,u=-7,h=n?i-1:0,p=n?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=s;u>0;o=256*o+t[e+h],h+=p,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=r;u>0;a=256*a+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),o-=c}return(d?-1:1)*a*Math.pow(2,o-r)}function yc(t,e,n,r,i,o){var a,s,l,c=8*o-i-1,u=(1<<c)-1,h=u>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(e*l-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+d]=255&s,d+=f,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;t[n+d]=255&a,d+=f,a/=256,c-=8);t[n+d-f]|=128*m}var _c={}.toString,Ec=Array.isArray||function(t){return"[object Array]"==_c.call(t)};function Tc(){return bc.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function xc(t,e){if(Tc()<e)throw new RangeError("Invalid typed array length");return bc.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=bc.prototype:(null===t&&(t=new bc(e)),t.length=e),t}function bc(t,e,n){if(!(bc.TYPED_ARRAY_SUPPORT||this instanceof bc))return new bc(t,e);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return Sc(this,t)}return Mc(this,t,e)}function Mc(t,e,n,r){if("string"==typeof e)return function(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!bc.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|wc(e,n),i=(t=xc(t,r)).write(e,n);return i!==r&&(t=t.slice(0,i)),t}(t,e,n)}function Ac(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function Sc(t,e){if(Ac(e),t=xc(t,e<0?0:0|checked(e)),!bc.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function Oc(t){return!(null==t||!t._isBuffer)}function wc(t,e){if(Oc(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Yc(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Xc(t).length;default:if(r)return Yc(t).length;e=(""+e).toLowerCase(),r=!0}}function Lc(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=bc.from(e,r)),Oc(e))return 0===e.length?-1:Dc(t,e,n,r,i);if("number"==typeof e)return e&=255,bc.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):Dc(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function Dc(t,e,n,r,i){var o,a=1,s=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,s/=2,l/=2,n/=2}function c(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var u=-1;for(o=n;o<s;o++)if(c(t,o)===c(e,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(n+l>s&&(n=s-l),o=n;o>=0;o--){for(var h=!0,p=0;p<l;p++)if(c(t,o+p)!==c(e,p)){h=!1;break}if(h)return o}return-1}function Cc(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[n+a]=s}return a}function Pc(t,e,n,r){return Zc(Yc(e,t.length-n),t,n,r)}function Nc(t,e,n,r){return Zc(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function Rc(t,e,n,r){return Nc(t,e,n,r)}function Ic(t,e,n,r){return Zc(Xc(e),t,n,r)}function Uc(t,e,n,r){return Zc(function(t,e){for(var n,r,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)n=t.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function Bc(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,a,s,l,c=t[i],u=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(u=c);break;case 2:128==(192&(o=t[i+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&(l=(15&c)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=h}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}function Fc(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function Hc(t,e,n,r,i,o){if(!Oc(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function kc(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function zc(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function Gc(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Wc(t,e,n,r,i){return i||Gc(t,0,n,4),yc(t,e,n,r,23,4),n+4}function Vc(t,e,n,r,i){return i||Gc(t,0,n,8),yc(t,e,n,r,52,8),n+8}bc.TYPED_ARRAY_SUPPORT=void 0===pc.TYPED_ARRAY_SUPPORT||pc.TYPED_ARRAY_SUPPORT,Tc(),bc.poolSize=8192,bc._augment=function(t){return t.__proto__=bc.prototype,t},bc.from=function(t,e,n){return Mc(null,t,e)},bc.TYPED_ARRAY_SUPPORT&&(bc.prototype.__proto__=Uint8Array.prototype,bc.__proto__=Uint8Array),bc.alloc=function(t,e,n){return function(t,e,n,r){return Ac(e),e<=0?xc(t,e):void 0!==n?"string"==typeof r?xc(t,e).fill(n,r):xc(t,e).fill(n):xc(t,e)}(null,t,e,n)},bc.allocUnsafe=function(t){return Sc(null,t)},bc.allocUnsafeSlow=function(t){return Sc(null,t)},bc.isBuffer=function(t){return null!=t&&(!!t._isBuffer||qc(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&qc(t.slice(0,0))}(t))},bc.compare=function(t,e){if(!Oc(t)||!Oc(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},bc.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},bc.concat=function(t,e){if(!Ec(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return bc.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=bc.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!Oc(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},bc.byteLength=wc,bc.prototype._isBuffer=!0,bc.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?Bc(this,0,t):slowToString.apply(this,arguments)},bc.prototype.equals=function(t){if(!Oc(t))throw new TypeError("Argument must be a Buffer");return this===t||0===bc.compare(this,t)},bc.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},bc.prototype.compare=function(t,e,n,r,i){if(!Oc(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(e>>>=0),s=Math.min(o,a),l=this.slice(r,i),c=t.slice(e,n),u=0;u<s;++u)if(l[u]!==c[u]){o=l[u],a=c[u];break}return o<a?-1:a<o?1:0},bc.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},bc.prototype.indexOf=function(t,e,n){return Lc(this,t,e,n,!0)},bc.prototype.lastIndexOf=function(t,e,n){return Lc(this,t,e,n,!1)},bc.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return Cc(this,t,e,n);case"utf8":case"utf-8":return Pc(this,t,e,n);case"ascii":return Nc(this,t,e,n);case"latin1":case"binary":return Rc(this,t,e,n);case"base64":return Ic(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Uc(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},bc.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),bc.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=bc.prototype;else{var i=e-t;n=new bc(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},bc.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||Fc(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},bc.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||Fc(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},bc.prototype.readUInt8=function(t,e){return e||Fc(t,1,this.length),this[t]},bc.prototype.readUInt16LE=function(t,e){return e||Fc(t,2,this.length),this[t]|this[t+1]<<8},bc.prototype.readUInt16BE=function(t,e){return e||Fc(t,2,this.length),this[t]<<8|this[t+1]},bc.prototype.readUInt32LE=function(t,e){return e||Fc(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},bc.prototype.readUInt32BE=function(t,e){return e||Fc(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},bc.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||Fc(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},bc.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||Fc(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},bc.prototype.readInt8=function(t,e){return e||Fc(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},bc.prototype.readInt16LE=function(t,e){e||Fc(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},bc.prototype.readInt16BE=function(t,e){e||Fc(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},bc.prototype.readInt32LE=function(t,e){return e||Fc(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},bc.prototype.readInt32BE=function(t,e){return e||Fc(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},bc.prototype.readFloatLE=function(t,e){return e||Fc(t,4,this.length),gc(this,t,!0,23,4)},bc.prototype.readFloatBE=function(t,e){return e||Fc(t,4,this.length),gc(this,t,!1,23,4)},bc.prototype.readDoubleLE=function(t,e){return e||Fc(t,8,this.length),gc(this,t,!0,52,8)},bc.prototype.readDoubleBE=function(t,e){return e||Fc(t,8,this.length),gc(this,t,!1,52,8)},bc.prototype.writeUIntLE=function(t,e,n,r){t=+t,e|=0,n|=0,r||Hc(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},bc.prototype.writeUIntBE=function(t,e,n,r){t=+t,e|=0,n|=0,r||Hc(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},bc.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,1,255,0),bc.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},bc.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,2,65535,0),bc.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):kc(this,t,e,!0),e+2},bc.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,2,65535,0),bc.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):kc(this,t,e,!1),e+2},bc.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,4,4294967295,0),bc.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):zc(this,t,e,!0),e+4},bc.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,4,4294967295,0),bc.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):zc(this,t,e,!1),e+4},bc.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);Hc(this,t,e,n,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<n&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},bc.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);Hc(this,t,e,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},bc.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,1,127,-128),bc.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},bc.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,2,32767,-32768),bc.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):kc(this,t,e,!0),e+2},bc.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,2,32767,-32768),bc.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):kc(this,t,e,!1),e+2},bc.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,4,2147483647,-2147483648),bc.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):zc(this,t,e,!0),e+4},bc.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||Hc(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),bc.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):zc(this,t,e,!1),e+4},bc.prototype.writeFloatLE=function(t,e,n){return Wc(this,t,e,!0,n)},bc.prototype.writeFloatBE=function(t,e,n){return Wc(this,t,e,!1,n)},bc.prototype.writeDoubleLE=function(t,e,n){return Vc(this,t,e,!0,n)},bc.prototype.writeDoubleBE=function(t,e,n){return Vc(this,t,e,!1,n)};var jc=/[^+\/0-9A-Za-z-_]/g;function Yc(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],a=0;a<r;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function Xc(t){return vc(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(jc,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Zc(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function qc(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var Qc={uniforms:{map:{type:"t",value:null},modelAlpha:{type:"f",value:1},opacity:{type:"f",value:1},progress:{type:"f",value:1},blackout:{type:"i",value:0},pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new L.Vector3},pano0Matrix:{type:"m4",value:new L.Matrix4},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new L.Vector3},pano1Matrix:{type:"m4",value:new L.Matrix4},measureMode:{value:!1},measurePointer:{type:"v2",value:new L.Vector2}},vertexShader:"\n\n  precision highp float;\n  precision highp int;\n\n  uniform mat4 modelMatrix;\n  uniform mat4 modelViewMatrix;\n  uniform mat4 projectionMatrix;\n  uniform mat4 viewMatrix;\n  uniform mat3 normalMatrix;\n  uniform vec3 cameraPosition;\n\n  attribute vec3 position;\n  attribute vec3 normal;\n  attribute vec2 uv;\n\n\n\n  uniform vec3 pano0Position;\n  uniform mat4 pano0Matrix;\n  uniform vec3 pano1Position;\n  uniform mat4 pano1Matrix;\n\n  varying vec2 vUv;\n  varying vec3 vWorldPosition0;\n  varying vec3 vWorldPosition1;\n\n  void main() {\n\n    vUv = uv;\n\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n    vec3 positionLocalToPanoCenter0 = worldPosition.xyz - pano0Position;\n\n    vWorldPosition0 = (vec4(positionLocalToPanoCenter0, 1.0) * pano0Matrix).xyz;\n    vWorldPosition0.x *= -1.0;\n\n    vec3 positionLocalToPanoCenter1 = worldPosition.xyz - pano1Position;\n\n    vWorldPosition1 = (vec4(positionLocalToPanoCenter1, 1.0) * pano1Matrix).xyz;\n\n    vWorldPosition1.x *= -1.0;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n  }\n",fragmentShader:"\n\n  precision highp float;\n  precision highp int;\n\n  uniform mat4 viewMatrix;\n  uniform vec3 cameraPosition;\n\n\n\n  uniform sampler2D map;\n  uniform float modelAlpha;\n  uniform float opacity;\n  uniform float progress;\n  uniform int blackout;\n  uniform vec3 pano0Position;\n  uniform samplerCube pano0Map;\n  uniform vec3 pano1Position;\n  uniform samplerCube pano1Map;\n  uniform int isEditVersion;\n  uniform bool measureMode;\n  uniform vec2 measurePointer;\n\n  varying vec2 vUv;\n  varying vec3 vWorldPosition0;\n  varying vec3 vWorldPosition1;\n\n  void main() {\n\n    const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);\n    const vec4 GREEN = vec4(0.0, 1.0, 0.0, 1.0);\n    const vec4 BLUE = vec4(0.0, 0.0, 1.0, 1.0);\n\n    const vec4 BLACK = vec4(0.0, 0.0, 0.0, 1.0);\n    const vec4 WHITE = vec4(1.0, 1.0, 1.0, 1.0);\n    const vec4 GREY  = vec4(0.5, 0.5, 0.5, 1.0);\n\n    float whiteness = 1.0;\n\n    vec4 colorFromPanos;\n\n    vec4 colorFromPano0 = textureCube( pano0Map, vWorldPosition0.xyz); // 掉帧，6_2k 性能瓶颈\n    vec4 colorFromPano1 = textureCube( pano1Map, vWorldPosition1.xyz); // 掉帧，6_2k 性能瓶颈\n\n    if (blackout == 0) {\n      colorFromPanos = mix(colorFromPano0, colorFromPano1, progress);\n    } else if (blackout == 1) {\n      colorFromPanos = mix(colorFromPano0, BLACK, min(1.0, progress * 2.0));\n      colorFromPanos = mix(colorFromPanos, colorFromPano1, max(0.0, progress * 2.0 - 1.0));\n    } else if (blackout == 2) {\n      colorFromPanos = mix(colorFromPano0, BLACK, progress);\n    } else if (blackout == 3) {\n      colorFromPanos = mix(BLACK, colorFromPano1, max(0.0, progress * 2.0 - 1.0));\n    }\n\n    vec4 colorFromTexture = texture2D( map, vUv );\n\n    // colorFromPanos = mix(colorFromPanos, colorFromTexture, modelAlpha); // origin\n\n    if (measureMode && distance(measurePointer, gl_FragCoord.xy) < 80.0) {\n      colorFromPanos = mix(colorFromPanos, colorFromTexture, 1.0);\n      // colorFromPanos = mix(colorFromPanos, colorFromTexture, modelAlpha);\n      // whiteness = 1.0 - smoothstep(0.1, 0.2, opacity);\n      // colorFromPanos = mix(colorFromPanos, GREY, whiteness);\n    } else {\n      colorFromPanos = mix(colorFromPanos, colorFromTexture, modelAlpha);\n      // colorFromPanos = mix(colorFromPanos, WHITE, 0.0);\n    }\n\n    whiteness = 1.0 - smoothstep(0.1, 0.2, opacity); // origin\n\n    colorFromPanos = mix(colorFromPanos, GREY, whiteness); // origin\n\n    gl_FragColor = vec4(colorFromPanos.rgb, opacity);\n\n  }\n"},Kc=function(t){function e(e){t.call(this),this.name=""+e.name,this.fragmentShader=Qc.fragmentShader,this.vertexShader=Qc.vertexShader,this.uniforms=L.UniformsUtils.clone(Qc.uniforms),this.side=e.side}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setProjectedPanos=function(t,e,n,r){void 0===n&&(n=!0),this.name;var i=_e.getRenderMode(),o=_e.getRenderSet();n&&(this.uniforms.progress.value=0),this.uniforms.pano0Map.value&&(this.uniforms.pano0Map.value.dispose(),this.uniforms.pano0Map.value=null),this.uniforms.pano1Map.value&&(this.uniforms.pano1Map.value.dispose(),this.uniforms.pano1Map.value=null),t.ensureSkyboxReadyForRender(),"lod"===i&&(this.uniforms.pano0Map.value=t.getSkyboxTexture("set.project.panos")),"6cube"===i&&"512"===o&&(this.uniforms.pano0Map.value=t.getSkyboxTexture()),"6cube"===i&&"1024"===o&&(this.uniforms.pano0Map.value=t.getSkyboxTexture()),"6cube"===i&&"2048"===o&&(this.uniforms.pano0Map.value=t.getSkyboxTexture()),this.uniforms.pano0Position.value.copy(t.position),this.uniforms.pano0Matrix.value.copy(t.poseMatrix),e.ensureSkyboxReadyForRender(),"lod"===i&&(this.uniforms.pano1Map.value=e.getSkyboxTexture()),"6cube"===i&&"512"===o&&(this.uniforms.pano1Map.value=e.getSkyboxTexture()),"6cube"===i&&"1024"===o&&(this.uniforms.pano1Map.value=e.getSkyboxTexture()),"6cube"===i&&"2048"===o&&(this.uniforms.pano1Map.value=e.getSkyboxTexture()),this.uniforms.pano1Position.value.copy(e.position),this.uniforms.pano1Matrix.value.copy(e.poseMatrix)},e.prototype.setOpacity=function(t){this.name,t!==this.getOpacity()&&(this.transparent=1!==t,this.uniforms.opacity.value=t)},e.prototype.getOpacity=function(){return this.uniforms.opacity.value},e.prototype.setTransparent=function(t){this.transparent=t},e.prototype.setMap=function(t){this.uniforms.map.value=t},e.prototype.setAlpha=function(t){this.uniforms.modelAlpha.value=t},e.prototype.setProgress=function(t){this.uniforms.progress.value=t},e.prototype.destroy=function(){this.uniforms.map.value&&this.uniforms.map.value.dispose(),this.uniforms.pano0Map.value&&this.uniforms.pano0Map.value.dispose(),this.uniforms.pano1Map.value&&this.uniforms.pano1Map.value.dispose(),this.dispose(),F.setItem(this.name+" destroy",!0)()},e}(L.RawShaderMaterial),Jc={uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},brightness:{type:"f",value:0}},vertexShader:"\n\n  precision highp float;\n  precision highp int;\n\n  uniform mat4 modelMatrix;\n  uniform mat4 modelViewMatrix;\n  uniform mat4 projectionMatrix;\n  uniform mat4 viewMatrix;\n  uniform mat3 normalMatrix;\n  uniform vec3 cameraPosition;\n\n  attribute vec3 position;\n  attribute vec3 normal;\n  attribute vec2 uv;\n\n\n\n  varying vec2 vUv;\n\n  void main() {\n\n    vUv = uv;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n  }\n\n",fragmentShader:"\n\n  precision highp float;\n  precision highp int;\n\n  uniform mat4 viewMatrix;\n  uniform vec3 cameraPosition;\n\n\n\n  uniform sampler2D map;\n  uniform float opacity;\n  uniform float brightness;\n\n  varying vec2 vUv;\n\n  vec4 white = vec4(0.5, 0.5, 0.5, 1.0);\n  vec4 colorRed = vec4(1.0, 0.0, 0.0, 1.0);\n  vec4 colorGreen = vec4(0.0, 1.0, 0.0, 1.0);\n\n  void main() {\n\n    vec4 colorFromTexture = texture2D( map, vUv );\n\n    float whiteness = 1.0 - smoothstep(0.1, 0.2, opacity);\n\n    colorFromTexture = mix(colorFromTexture, white, whiteness);\n    // colorFromTexture = mix(colorRed, colorGreen, 0.5);\n\n    gl_FragColor = vec4(colorFromTexture.rgb, opacity);\n\n  }\n\n"},$c=function(t){function e(){t.call(this),this.fragmentShader=Jc.fragmentShader,this.vertexShader=Jc.vertexShader,this.uniforms=L.UniformsUtils.clone(Jc.uniforms),this.side=L.FrontSide,this.transparent=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setOpacity=function(t){this.name,t!==this.getOpacity()&&(this.transparent=1!==t,this.uniforms.opacity.value=t)},e.prototype.setMap=function(t){this.uniforms.map.value=t},e.prototype.getOpacity=function(){return this.uniforms.opacity.value},e.prototype.destroy=function(){this.uniforms.map.value.dispose(),this.dispose(),n.debug(this.name+" destroy")(),F.setItem(this.name+" destroy",!0)()},e}(L.RawShaderMaterial),tu=function(t){function e(){t.call(this),this.transparent=!1,this.side=L.FrontSide,this.color=new L.Color(16777215)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setOpacity=function(t){this.transparent=t>=0&&t<1,this.opacity=t},e.prototype.setMap=function(t){this.map=t,this.needsUpdate=!0},e.prototype.getOpacity=function(){return this.opacity},e}(L.MeshPhongMaterial),eu=function(t){function e(e){t.call(this),this.matrixAutoUpdate=!1,this.name=e.name||"chunk",this.flooridx=null,this.geometry=e.geometry,this.materialInside=new Kc({name:"chunk.inside.material",side:L.FrontSide}),this.defaultMaterialOutside=new $c,this.phongMaterialOutside=new tu,this.layers.set(ve.CHUNK),this.material=this.materialInside,this.materialOutside=Ce.Base.dollhouse_use_light_material?this.phongMaterialOutside:this.defaultMaterialOutside,this.setUserData("type",e.type),this.setUserData("mesh_texture_name",e.texture_name),this.init()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){this.addBoxHelper()},e.prototype.hide=function(){this.visible=!1},e.prototype.show=function(){this.visible=!0},e.prototype.setMaterialMap=function(t){this.materialInside.setMap(t),this.materialOutside.setMap(t),this.phongMaterialOutside.setMap(t)},e.prototype.setMode=function(t){var e;switch(t){case G.DOLLHOUSE:(e=this.materialOutside).side=L.FrontSide,e.setOpacity(this.material.getOpacity()),this.material=e;break;case G.PANORAMA:(e=this.materialInside).side=L.FrontSide,e.setOpacity(this.material.getOpacity()),this.material=e;break;case G.FLOORPLAN:(e=this.materialOutside).side=L.FrontSide,e.setOpacity(this.material.getOpacity()),this.material=e;break;case G.TRANSITIONING:(e=this.materialInside).side=L.FrontSide,e.setOpacity(this.material.getOpacity()),this.material=e}},e.prototype.setAlpha=function(t){this.materialInside.setAlpha(t)},e.prototype.setProgress=function(t){this.materialInside.setProgress(t)},e.prototype.setOpacity=function(t,e){this.name,this.material.setOpacity(t)},e.prototype.getOpacity=function(){return this.material.getOpacity()},e.prototype.setUserData=function(t,e){this.userData[t]=e},e.prototype.getUserData=function(t){return this.userData[t]},e.prototype.addBoxHelper=function(){var t=k.getCore(),e=new L.BoxHelper(this,16776960);e.visible=!1,this.boxHelper=e,t.sceneRender.chunksBoxHelper.add(e)},e.prototype.showBoxHelper=function(){this.boxHelper.visible=!0},e.prototype.hideBoxHelper=function(){this.boxHelper.visible=!1},e.prototype.getBoxWpVertices=function(){for(var t=this.boxHelper.geometry.getAttribute("position").array,e=[],n=0;n<t.length;n+=3){var r=new L.Vector3(t[n],t[n+1],t[n+2]);r=this.boxHelper.localToWorld(r.clone()),e.push(r)}return e},e.prototype.createPlaneColliders=function(){var t=k.getCore(),e=new L.MeshPhongMaterial({color:13421772,side:L.DoubleSide,transparent:!0}),n=this.getBoxWpVertices();[[1,5,0,4],[2,6,3,7],[0,4,3,7],[4,5,7,6],[5,1,6,2],[1,0,2,3]].forEach((function(r){var i,o=new L.BufferGeometry,a=n[r[0]],s=n[r[1]],l=n[r[2]],c=n[r[3]],u=[a.x,a.y,a.z],h=[s.x,s.y,s.z],p=[l.x,l.y,l.z],d=[c.x,c.y,c.z];i=u.concat(p,h,p,d,h),o.setAttribute("position",new L.BufferAttribute(new Float32Array(i),3)),o.computeVertexNormals();var f=new L.Mesh(o,e);t.sceneRender.chunksBoxPlaneCollider.add(f)}))},e.prototype.enableLightMaterial=function(){this.materialOutside=this.phongMaterialOutside,this.material=this.materialOutside},e.prototype.disableLightMaterial=function(){this.materialOutside=this.defaultMaterialOutside,this.material=this.materialOutside},e.prototype.enableReceiveShadow=function(){this.receiveShadow=!0},e.prototype.disableReceiveShadow=function(){this.receiveShadow=!1},e.prototype.cleareCache=function(){var t=this.name+" clear cache";this.isClearCache?n.error(t+" failure, clean cache!")():(this.isClearCache=!0,this.materialInside.uniforms.map.value&&this.materialInside.uniforms.map.value.dispose(),this.defaultMaterialOutside.uniforms.map.value&&this.defaultMaterialOutside.uniforms.map.value.dispose(),this.phongMaterialOutside.map&&this.phongMaterialOutside.map.dispose(),this.materialInside.dispose(),this.defaultMaterialOutside.dispose(),this.phongMaterialOutside.dispose(),this.geometry.dispose())},e.prototype.getFaceCount=function(){return this.geometry.getIndex().count/3},e.prototype.clear=function(){},e.prototype.destroy=function(){var t="chunk:"+this.name+" destroy";this.cleareCache(),F.setItem(""+t,!0)()},e}(L.Mesh),nu=bc.from(ye.BUFFER_FROM,"base64"),ru=L.FileLoader||L.XHRLoader,iu=new hs("<decode.buffer.data>"),ou=new hs("<conver.binay.mesh.to.chunk>"),au=new hs("<download.model.nest>"),su=null,lu=null;function cu(t){null===su&&(su=k.getCore()),this.name="NestLoader",this.modelId=t;var e=hc.loadProto(nu);this.decoder=e.build("meshes")}cu.prototype={load:function(t,e){var r=this;void 0===e&&(e=function(){}),n.info(this.name+" download model.nest")(),lu=t.model_nest_url,t.model_texture_url;var i=new ru;i.setResponseType("arraybuffer"),au.start(),i.load(lu,(function(t){au.end(),su.startModeManager.control&&(su.startModeManager.control.stopRotation(),su.startModeManager.control.disable()),su.lifeCycle.progress(ui[su.adapterManager.getEntryMode()][hi.MODEL_NEST_LOADED]),r.parse(t,e)}),(function(t){}),(function(t){n.error(r.name+".load",t)()}))},parse:function(t,e){n.info(this.name+" parse")();var r=this.readProtobuf(t);n.debug("binary.mesh",r)(),t=null,r?(su.lifeCycle.progress(ui[su.adapterManager.getEntryMode()][hi.PARSE_MODEL_COMPLETE]),this.converBinaryMeshToChunk(r,e)):n.error("parse binary mesh failure, reason: unget binary mesh")()},readProtobuf:function(t){var e;return iu.start(),e=this.decoder.decode(t),iu.end(),e},converBinaryMeshToChunk:function(t,e){var r=this;if(0!==t.block_model.length){var i=new L.Matrix4;i.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),ou.start();var o=t.block_model.map((function(t,e){var o=new L.BufferGeometry;if(0<t.vertices.xyz.length){var a=new Float32Array(t.vertices.xyz,0,3);t.vertices.xyz=[];var s=new L.BufferAttribute(a,3);a=null,"118"==L.REVISION&&o.setAttribute("position",s),"130"==L.REVISION&&o.setAttribute("position",s),s=null}if(0<t.vertices.uv.length){var l=new Float32Array(t.vertices.uv,0,2);t.vertices.uv=[];var c=new L.BufferAttribute(l,2);"118"==L.REVISION&&o.setAttribute("uv",c),"130"==L.REVISION&&o.setAttribute("uv",c),c=null}if(0<t.faces.faces.length){var u=new Uint32Array(t.faces.faces,0,1);t.faces.faces=[],o.setIndex(new L.BufferAttribute(u,1)),u=[]}"118"==L.REVISION&&o.applyMatrix4(i),"130"==L.REVISION&&o.applyMatrix4(i),o.computeVertexNormals(),o.computeBoundingBox(),o.computeBoundingSphere();var h=su.modelManager.getModel(r.modelId);if(void 0!==h.data.building.blocks[e]){var p=h.data.building.blocks[e].type;return new eu({geometry:o,texture_name:t.txtname,name:t.block_name,type:p})}n.error("build chunk failure, reason: invalid index<"+e+">!")()}));ou.end(),su.lifeCycle.progress(ui[su.adapterManager.getEntryMode()][hi.BUILD_CHUNK_COMPLETE]),e(o)}else n.error("conver binaru mesh to chunk failure, reason: binary_mesh.block_model is empty!")()}};var uu=Object.create(null);uu.load=function(t,e){void 0===e&&(e=function(){});var n=t.model_id;new cu(n).load({model_id:n,model_nest_url:t.model_nest_url,model_texture_url:""+t.model_texture_url},(function(t){e(t)}))};var hu=Object.create(null),pu=null,du=new hs("<download.model.texture>");function fu(t){void 0===t&&(t=function(){}),null===pu&&((pu=k.getCore()).modelTextureMap=hu);var e=k.getModel(),n=e.modelid,r=e.chunks,i=e.chunksTextureUrl;if(void 0===hu[n])hu[n]=Object.create(null);else if(i.length===Object.keys(hu[n]).length)return r.forEach((function(t,e){var r=t.getUserData("mesh_texture_name"),i=hu[n][r];t.setMaterialMap(i)})),void t();i.forEach((function(e){du.start();var o=e.url,a=e.name;Oe(o+="?x-oss-process=image/resize,w_"+pu.adapterManager.getModelTextureSize()+",m_lfit",(function(e){e.name=n+"->"+a,hu[n][a]=e,Object.keys(hu[n]).length===i.length&&(du.end(),r.forEach((function(t){var e=t.getUserData("mesh_texture_name"),r=hu[n][e];t.setMaterialMap(r)})),t())}))}))}new hs("<add.chunk.texture>");var mu=[],vu=[],gu=function(t){this.modelId=t};gu.prototype.getChunksFaceCount=function(){var t=k.getCore().modelManager.getModel(this.modelId).chunks,e=0;n.time("get.chunks.face.count")();for(var r=0,i=t.length;r<i;++r)e+=t[r].getFaceCount();return n.timeEnd("get.chunks.face.count")(),e},gu.prototype.getCollidersFaceCount=function(){var t=k.getCore().modelManager.getModel(this.modelId).colliders,e=0;n.time("get.colliders.face.count")();for(var r=0,i=t.length;r<i;++r)e+=t[r].getFaceCount();return n.timeEnd("get.colliders.face.count")(),e},gu.prototype.getChunksSize=function(){var t=k.getCore().modelManager.getModel(this.modelId).chunks,e=new Map;return t.forEach((function(t){var n=t.geometry.boundingBox.getSize(new L.Vector3);e.set(t.name,n)})),e},gu.prototype.getCollidersSize=function(){var t=k.getCore().modelManager.getModel(this.modelId).colliders,e=new Map;return t.forEach((function(t){var n=t.geometry.boundingBox.getSize(new L.Vector3),r=t.name,i=t.userData.chunk_name;void 0===e.get(i)&&e.set(i,new Map),e.get(i).set(r,n)})),e},gu.prototype.showWireFrame=function(t){for(var e={},n=function(n){var r=t[n],i=void 0;An(r),function t(){i=Math.random(),e["_"+i]&&t(),e["_"+i]=1}(),Mn(r,16777215*i*10)},r=0;r<t.length;++r)n(r)},gu.prototype.hideWireframe=function(t){for(var e=0;e<t.length;++e)An(t[e])},gu.prototype.showFloorBoxHelper=function(t,e){k.getCore().modelManager.getModel(this.modelId).floors.get(t).showBoxHelper(e)},gu.prototype.hideFloorBoxHelper=function(t){k.getCore().modelManager.getModel(this.modelId).floors.get(t).hideBoxHelper()},gu.prototype.showCollidersBoxHelper=function(){var t=k.getCore();t.modelManager.getModel(this.modelId).colliders.forEach((function(e){var n=new L.BoxHelper(e,16776960);mu.push(n),t.sceneRender.add(n)}))},gu.prototype.hideCollidersBoxHelper=function(){var t=k.getCore();mu.forEach((function(e){t.sceneRender.remove(e,"hideCollidersBoxHelper")})),mu=[]},gu.prototype.showChunksBoxHelper=function(){var t=k.getCore();t.modelManager.getModel(this.modelId).chunks.forEach((function(e){var n=new L.BoxHelper(e,16776960);vu.push(n),t.sceneRender.add(n)}))},gu.prototype.hideChunksBoxHelper=function(){var t=k.getCore();vu.forEach((function(e){t.sceneRender.remove(e,"hideChunksBoxHelper")})),vu=[]},gu.prototype.createColliderMask=function(t,e){void 0===t&&(t=.4);for(var n=k.getCore().player.model.colliders,r=[],i=new L.MeshBasicMaterial({color:0,side:L.FrontSide,transparent:!0,opacity:t,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1}),o=0,a=n.length;o<a;++o){var s=n[o],l=(new L.Geometry).fromBufferGeometry(s.geometry);r.push(l)}for(var c=0,u=r.length;c<u;++c){for(var h=r[c],p=h.vertices,d=h.faces,f=new L.Geometry,m=0,v=d.length;m<v;++m){var g=d[m];g.normal;var y=p[g.a].clone(),_=p[g.b].clone(),E=p[g.c].clone();f.vertices.push(y,_,E),f.faces.push(g)}f.computeFaceNormals(),f.computeVertexNormals(),new L.Mesh(f,i)}},gu.prototype.exportChunkObj=function(){var t=this,e=k.getCore().modelManager.getModel(this.modelId).chunks,n=new L.OBJExporter;e.forEach((function(e){var r=n.parse(e),i=new Blob([r],{type:"text/plain"}),o=URL.createObjectURL(i),a=e.name+".obj";i=null;var s=document.createElement("a");s.id=a,s.style.cssText="\n        position: absolute;\n        top: "+20*t.exportCount+"px;\n        left: 0;\n        z-index: 1000;\n        color: #00f;\n      ",s.innerText=a,s.href=o,o=null,s.download=a,document.body.appendChild(s),t.exportCount++}))};var yu=null,_u=null,Eu=function(t){function e(e,n){var r=this;t.call(this),this.name="model.skybox."+e,yu=n.getSize?n.getSize(new L.Vector3):n.size(),_u=n.getCenter?n.getCenter(new L.Vector3):n.center(),this.geometry=new L.BoxBufferGeometry(yu.x,yu.y,yu.z),this.material=new Kc({name:"model.skybox.material",side:L.BackSide}),this.material.depthWrite=!1,this.progressAnimation=null,this.opacityAnimation=null,this.fadeInAnimation=null,this.fadeOutAnimation=null,this.fadeInCompleteCallback=[],this.fadeOutCompleteCallback=[],this.layers.set(ve.MODEL_SKYBOX),this.defaultOpacity=0,this.setPosition(_u),this.setOpacity(this.defaultOpacity,"init"),this.setAlpha(0),Object.defineProperties(this,{opacity:{get:function(){return r.material.uniforms.opacity.value}},onFadeInComplete:{set:function(t){r.fadeInCompleteCallback.push(t)}},onFadeOutComplete:{set:function(t){r.fadeOutCompleteCallback.push(t)}}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hide=function(t){this.visible=!1},e.prototype.show=function(t){this.visible=!0},e.prototype.setPosition=function(t){this.position.copy(t)},e.prototype.setPositionScalar=function(t){this.position.multiplyScalar(t)},e.prototype.setOpacity=function(t,e){this.name,this.material.uniforms.opacity&&(this.material.uniforms.opacity.value=t,1===t?this.material.setTransparent(!1):this.material.setTransparent(!0))},e.prototype.setAlpha=function(t){this.material.uniforms.modelAlpha.value=t},e.prototype.setProgress=function(t,e){void 0===e&&(e=function(){}),this.material.uniforms.progress&&(this.material.uniforms.progress.value=t,e())},e.prototype.setScale=function(){},e.prototype.setScaleScalar=function(t){this.scale.multiplyScalar(t)},e.prototype.getOpacity=function(){return this.material.uniforms.opacity.value},e.prototype.runProgressAnimation=function(t,e){var n=this;void 0===e&&(e=function(){}),this.progressAnimation||(this.progressAnimation=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Quadratic.InOut)),this.progressAnimation.duration(t).onUpdate((function(t){n.setProgress(t.value)})).onComplete((function(t){n.progressAnimation.stop(),e()})).start()},e.prototype.runOpacityAnimation=function(t,e,n,r,i){var o=this;void 0===i&&(i=function(){}),this.opacityAnimation||(this.opacityAnimation=new Nn.Tween({value:t}).to({value:e}).easing(Nn.Easing.Linear.None)),this.opacityAnimation.duration(n).delay(r).onUpdate((function(t){o.setOpacity(t.value)})).onComplete((function(t){o.opacityAnimation.stop(),i()})).start()},e.prototype.fadeIn=function(t){var e=this;void 0===t&&(t={});var r=this.name+" fade in";if(null===this.fadeInAnimation)if(null===this.fadeOutAnimation){var i=this.defaultOpacity;void 0!==t.origin_opacity&&(i=t.origin_opacity);var o=t.duration||500,a=t.complete||function(){};this.fadeInAnimation=new Nn.Tween({opacity:i}).to({opacity:1}).easing(Nn.Easing.Quadratic.In).duration(o).onStart((function(t){n.time(r)()})).onUpdate((function(t){e.setOpacity(t.opacity)})).onComplete((function(t){e.fadeInAnimation.stop()})).onStop((function(t){n.timeEnd(r)(),e.fadeInAnimation=null,e.fadeInCompleteCallback.forEach((function(t){return t()})),e.fadeInCompleteCallback=[],a()})).start()}else n.warn(r+" failure, reason: fade out animation not complete! ")();else n.warn(r+" failure, reason: fade in animation not complete! ")()},e.prototype.fadeOut=function(t){var e=this;void 0===t&&(t={});var r=this.name+" fade out";if(null===this.fadeInAnimation)if(null===this.fadeOutAnimation){var i=this.defaultOpacity,o=t.duration||500;this.fadeOutAnimation=new Nn.Tween({opacity:1}).to({opacity:i}).easing(Nn.Easing.Linear.None).duration(o).onStart((function(t){})).onUpdate((function(t){e.setOpacity(t.opacity)})).onComplete((function(t){e.fadeOutAnimation.stop()})).onStop((function(t){e.fadeOutAnimation=null,e.fadeOutCompleteCallback.forEach((function(t){return t()})),e.fadeOutCompleteCallback=[]})).start()}else n.warn(r+" failure, reason: fade out animation not complete! ")();else n.warn(r+" failure, reason: fade in animation not complete! ")()},e.prototype.clearCache=function(){var t=this.name+" clear cache";this.isClearCache?n.error(t+" failure, clean cache!")():(this.isClearCache=!0,this.material.uniforms.map.value&&this.material.uniforms.map.value.dispose(),this.material.uniforms.pano0Map.value&&this.material.uniforms.pano0Map.value.dispose(),this.material.uniforms.pano1Map.value&&this.material.uniforms.pano1Map.value.dispose(),this.material.dispose(),this.geometry.dispose())},e.prototype.clear=function(){},e.prototype.destroy=function(){var t=this.name+" destroy";this.clearCache(),this.clear(),F.setItem(""+t,!0)()},e}(L.Mesh),Tu=L,xu=Tu.BufferAttribute,bu=Tu.Vector3,Mu=Tu.Vector2,Au=Tu.Plane,Su=Tu.Line3,Ou=Tu.Triangle,wu=Tu.Sphere,Lu=Tu.Matrix4,Du=Tu.Box3,Cu=Tu.BackSide,Pu=Tu.DoubleSide,Nu=Tu.FrontSide,Ru=Tu.Object3D,Iu=Tu.Mesh,Uu=Tu.BufferGeometry,Bu=Tu.Group,Fu=Tu.LineBasicMaterial,Hu=Tu.MeshBasicMaterial,ku=Tu.REVISION,zu=Tu.Ray,Gu=Tu.RGBAFormat,Wu=Tu.RGFormat,Vu=Tu.RedFormat,ju=Tu.RGBAIntegerFormat,Yu=Tu.RGIntegerFormat,Xu=Tu.RedIntegerFormat,Zu=Tu.DataTexture,qu=Tu.NearestFilter,Qu=Tu.IntType,Ku=Tu.UnsignedIntType,Ju=Tu.FloatType,$u=Tu.UnsignedByteType,th=Tu.UnsignedShortType,eh=Tu.ByteType,nh=Tu.ShortType,rh=Tu.Vector4,ih=Tu.Matrix3,oh=Math.pow(2,-24),ah=Symbol("SKIP_GENERATION");function sh(t){return t.index?t.index.count:t.attributes.position.count}function lh(t){return sh(t)/3}function ch(t,e){return void 0===e&&(e=ArrayBuffer),t>65535?new Uint32Array(new e(4*t)):new Uint16Array(new e(2*t))}function uh(t,e){var n=lh(t),r=e||t.drawRange,i=r.start/3,o=(r.start+r.count)/3,a=Math.max(0,i),s=Math.min(n,o)-a;return[{offset:Math.floor(a),count:Math.floor(s)}]}function hh(t,e){if(!t.groups||!t.groups.length)return uh(t,e);var n=[],r=new Set,i=e||t.drawRange,o=i.start/3,a=(i.start+i.count)/3;for(var s of t.groups){var l=s.start/3,c=(s.start+s.count)/3;r.add(Math.max(o,l)),r.add(Math.min(a,c))}for(var u=Array.from(r.values()).sort((function(t,e){return t-e})),h=0;h<u.length-1;h++){var p=u[h],d=u[h+1];n.push({offset:Math.floor(p),count:Math.floor(d-p)})}return n}function ph(t,e,n,r,i){for(var o=1/0,a=1/0,s=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,p=1/0,d=1/0,f=-1/0,m=-1/0,v=-1/0,g=6*e,y=6*(e+n);g<y;g+=6){var _=t[g+0],E=t[g+1],T=_-E,x=_+E;T<o&&(o=T),x>l&&(l=x),_<h&&(h=_),_>f&&(f=_);var b=t[g+2],M=t[g+3],A=b-M,S=b+M;A<a&&(a=A),S>c&&(c=S),b<p&&(p=b),b>m&&(m=b);var O=t[g+4],w=t[g+5],L=O-w,D=O+w;L<s&&(s=L),D>u&&(u=D),O<d&&(d=O),O>v&&(v=O)}r[0]=o,r[1]=a,r[2]=s,r[3]=l,r[4]=c,r[5]=u,i[0]=h,i[1]=p,i[2]=d,i[3]=f,i[4]=m,i[5]=v}function dh(t,e,n){return n.min.x=e[t],n.min.y=e[t+1],n.min.z=e[t+2],n.max.x=e[t+3],n.max.y=e[t+4],n.max.z=e[t+5],n}function fh(t){for(var e=-1,n=-1/0,r=0;r<3;r++){var i=t[r+3]-t[r];i>n&&(n=i,e=r)}return e}function mh(t,e){e.set(t)}function vh(t,e,n){for(var r,i,o=0;o<3;o++){var a=o+3;r=t[o],i=e[o],n[o]=r<i?r:i,r=t[a],i=e[a],n[a]=r>i?r:i}}function gh(t,e,n){for(var r=0;r<3;r++){var i=e[t+2*r],o=e[t+2*r+1],a=i-o,s=i+o;a<n[r]&&(n[r]=a),s>n[r+3]&&(n[r+3]=s)}}function yh(t){var e=t[3]-t[0],n=t[4]-t[1],r=t[5]-t[2];return 2*(e*n+n*r+r*e)}var _h,Eh,Th,xh,bh=function(t,e){return t.candidate-e.candidate},Mh=new Array(32).fill().map((function(){return{count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}})),Ah=new Float32Array(6),Sh=function(){this.boundingData=new Float32Array(6)};function Oh(t,e,n,r,i,o){for(var a=r,s=r+i-1,l=o.pos,c=2*o.axis;;){for(;a<=s&&n[6*a+c]<l;)a++;for(;a<=s&&n[6*s+c]>=l;)s--;if(!(a<s))return a;for(var u=0;u<3;u++){var h=e[3*a+u];e[3*a+u]=e[3*s+u],e[3*s+u]=h}for(var p=0;p<6;p++){var d=n[6*a+p];n[6*a+p]=n[6*s+p],n[6*s+p]=d}a++,s--}}function wh(t,e,n,r,i,o){for(var a=r,s=r+i-1,l=o.pos,c=2*o.axis;;){for(;a<=s&&n[6*a+c]<l;)a++;for(;a<=s&&n[6*s+c]>=l;)s--;if(!(a<s))return a;var u=t[a];t[a]=t[s],t[s]=u;for(var h=0;h<6;h++){var p=n[6*a+h];n[6*a+h]=n[6*s+h],n[6*s+h]=p}a++,s--}}function Lh(t,e){return 65535===e[t+15]}function Dh(t,e){return e[t+6]}function Ch(t,e){return e[t+14]}function Ph(t){return t+8}function Nh(t,e){return e[t+6]}function Rh(t,e){return e[t+7]}var Ih=Math.pow(2,32);function Uh(t,e,n){return _h=new Float32Array(n),Eh=new Uint32Array(n),Th=new Uint16Array(n),xh=new Uint8Array(n),function t(e,n){for(var r=e/4,i=e/2,o=("count"in n),a=n.boundingData,s=0;s<6;s++)_h[r+s]=a[s];if(o){if(n.buffer){var l=n.buffer;xh.set(new Uint8Array(l),e);for(var c=e,u=e+l.byteLength;c<u;c+=32)Lh(c/2,Th)||(Eh[c/4+6]+=r);return e+l.byteLength}var h=n.offset,p=n.count;return Eh[r+6]=h,Th[i+14]=p,Th[i+15]=65535,e+32}var d,f=n.left,m=n.right,v=n.splitAxis;if((d=t(e+32,f))/4>Ih)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return Eh[r+6]=d/4,d=t(d,m),Eh[r+7]=v,d}(t,e)}function Bh(t,e,n,r,i){var o=i.maxDepth,a=(i.verbose,i.maxLeafTris),s=i.strategy,l=i.onProgress,c=i.indirect,u=t._indirectBuffer,h=t.geometry,p=h.index?h.index.array:null,d=c?wh:Oh,f=lh(h),m=new Float32Array(6),v=!1,g=new Sh;return ph(e,n,r,g.boundingData,m),function t(n,r,i,l,c){if(void 0===l&&(l=null),void 0===c&&(c=0),!v&&c>=o&&(v=!0),i<=a||c>=o)return y(r+i),n.offset=r,n.count=i,n;var h=function(t,e,n,r,i,o){var a=-1,s=0;if(0===o)-1!==(a=fh(e))&&(s=(e[a]+e[a+3])/2);else if(1===o)-1!==(a=fh(t))&&(s=function(t,e,n,r){for(var i=0,o=e,a=e+n;o<a;o++)i+=t[6*o+2*r];return i/n}(n,r,i,a));else if(2===o)for(var l=yh(t),c=1.25*i,u=6*r,h=6*(r+i),p=0;p<3;p++){var d=e[p],f=(e[p+3]-d)/32;if(i<8){var m=[].concat(Mh);m.length=i;for(var v=0,g=u;g<h;g+=6,v++){var y=m[v];y.candidate=n[g+2*p],y.count=0;for(var _=y.bounds,E=y.leftCacheBounds,T=y.rightCacheBounds,x=0;x<3;x++)T[x]=1/0,T[x+3]=-1/0,E[x]=1/0,E[x+3]=-1/0,_[x]=1/0,_[x+3]=-1/0;gh(g,n,_)}m.sort(bh);for(var b=i,M=0;M<b;M++)for(var A=m[M];M+1<b&&m[M+1].candidate===A.candidate;)m.splice(M+1,1),b--;for(var S=u;S<h;S+=6)for(var O=n[S+2*p],w=0;w<b;w++){var L=m[w];O>=L.candidate?gh(S,n,L.rightCacheBounds):(gh(S,n,L.leftCacheBounds),L.count++)}for(var D=0;D<b;D++){var C=m[D],P=C.count,N=i-C.count,R=C.leftCacheBounds,I=C.rightCacheBounds,U=0;0!==P&&(U=yh(R)/l);var B=0;0!==N&&(B=yh(I)/l);var F=1+1.25*(U*P+B*N);F<c&&(a=p,c=F,s=C.candidate)}}else{for(var H=0;H<32;H++){var k=Mh[H];k.count=0,k.candidate=d+f+H*f;for(var z=k.bounds,G=0;G<3;G++)z[G]=1/0,z[G+3]=-1/0}for(var W=u;W<h;W+=6){var V=~~((n[W+2*p]-d)/f);V>=32&&(V=31);var j=Mh[V];j.count++,gh(W,n,j.bounds)}var Y=Mh[31];mh(Y.bounds,Y.rightCacheBounds);for(var X=30;X>=0;X--){var Z=Mh[X],q=Mh[X+1];vh(Z.bounds,q.rightCacheBounds,Z.rightCacheBounds)}for(var Q=0,K=0;K<31;K++){var J=Mh[K],$=J.count,tt=J.bounds,et=Mh[K+1].rightCacheBounds;0!==$&&(0===Q?mh(tt,Ah):vh(tt,Ah,Ah));var nt=0,rt=0;0!==(Q+=$)&&(nt=yh(Ah)/l);var it=i-Q;0!==it&&(rt=yh(et)/l);var ot=1+1.25*(nt*Q+rt*it);ot<c&&(a=p,c=ot,s=J.candidate)}}}return{axis:a,pos:s}}(n.boundingData,l,e,r,i,s);if(-1===h.axis)return y(r+i),n.offset=r,n.count=i,n;var f=d(u,p,e,r,i,h);if(f===r||f===r+i)y(r+i),n.offset=r,n.count=i;else{n.splitAxis=h.axis;var g=new Sh,_=r,E=f-r;n.left=g,ph(e,_,E,g.boundingData,m),t(g,_,E,m,c+1);var T=new Sh,x=f,b=i-E;n.right=T,ph(e,x,b,T.boundingData,m),t(T,x,b,m,c+1)}return n}(g,n,r,m),g;function y(t){l&&l(t/f)}}function Fh(t,e){var n=t.geometry;e.indirect&&(t._indirectBuffer=function(t,e){for(var n=(t.index?t.index.count:t.attributes.position.count)/3,r=n>Math.pow(2,16),i=r?4:2,o=e?new SharedArrayBuffer(n*i):new ArrayBuffer(n*i),a=r?new Uint32Array(o):new Uint16Array(o),s=0,l=a.length;s<l;s++)a[s]=s;return a}(n,e.useSharedArrayBuffer),function(t,e){var n=lh(t),r=hh(t,e).sort((function(t,e){return t.offset-e.offset})),i=r[r.length-1];i.count=Math.min(n-i.offset,i.count);var o=0;return r.forEach((function(t){var e=t.count;return o+=e})),n!==o}(n,e.range)&&e.verbose),t._indirectBuffer||function(t,e){if(!t.index){var n=t.attributes.position.count,r=ch(n,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);t.setIndex(new xu(r,1));for(var i=0;i<n;i++)r[i]=i}}(n,e);var r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=function(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=null);var i,o=t.attributes.position,a=t.index?t.index.array:null,s=lh(t),l=o.normalized;null===e?(i=new Float32Array(6*s*4),n=0,r=s):(i=e,n=n||0,r=r||s);var c=o.array,u=o.offset||0,h=3;o.isInterleavedBufferAttribute&&(h=o.data.stride);for(var p=["getX","getY","getZ"],d=n;d<n+r;d++){var f=3*d,m=6*d,v=f+0,g=f+1,y=f+2;a&&(v=a[v],g=a[g],y=a[y]),l||(v=v*h+u,g=g*h+u,y=y*h+u);for(var _=0;_<3;_++){var E=void 0,T=void 0,x=void 0;l?(E=o[p[_]](v),T=o[p[_]](g),x=o[p[_]](y)):(E=c[v+_],T=c[g+_],x=c[y+_]);var b=E;T<b&&(b=T),x<b&&(b=x);var M=E;T>M&&(M=T),x>M&&(M=x);var A=(M-b)/2,S=2*_;i[m+S+0]=b+A,i[m+S+1]=A+(Math.abs(b)+A)*oh}}return i}(n),o=e.indirect?uh(n,e.range):hh(n,e.range);t._roots=o.map((function(n){var o=Bh(t,i,n.offset,n.count,e),a=function t(e){return"count"in e?1:1+t(e.left)+t(e.right)}(o),s=new r(32*a);return Uh(0,o,s),s}))}var Hh,kh=function(){this.min=1/0,this.max=-1/0};kh.prototype.setFromPointsField=function(t,e){for(var n=1/0,r=-1/0,i=0,o=t.length;i<o;i++){var a=t[i][e];n=a<n?a:n,r=a>r?a:r}this.min=n,this.max=r},kh.prototype.setFromPoints=function(t,e){for(var n=1/0,r=-1/0,i=0,o=e.length;i<o;i++){var a=e[i],s=t.dot(a);n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r},kh.prototype.isSeparated=function(t){return this.min>t.max||t.min>this.max},kh.prototype.setFromBox=(Hh=new bu,function(t,e){for(var n=e.min,r=e.max,i=1/0,o=-1/0,a=0;a<=1;a++)for(var s=0;s<=1;s++)for(var l=0;l<=1;l++){Hh.x=n.x*a+r.x*(1-a),Hh.y=n.y*s+r.y*(1-s),Hh.z=n.z*l+r.z*(1-l);var c=t.dot(Hh);i=Math.min(c,i),o=Math.max(c,o)}this.min=i,this.max=o}),new kh;var zh,Gh,Wh,Vh,jh,Yh,Xh,Zh=(jh=new bu,Yh=new bu,Xh=new bu,function(t,e,n){var r=t.start,i=jh,o=e.start,a=Yh;Xh.subVectors(r,o),jh.subVectors(t.end,t.start),Yh.subVectors(e.end,e.start);var s,l,c=Xh.dot(a),u=a.dot(i),h=a.dot(a),p=Xh.dot(i),d=i.dot(i)*h-u*u;l=(c+(s=0!==d?(c*u-p*h)/d:0)*u)/h,n.x=s,n.y=l}),qh=function(){var t=new Mu,e=new bu,n=new bu;return function(r,i,o,a){Zh(r,i,t);var s,l,c=t.x,u=t.y;if(c>=0&&c<=1&&u>=0&&u<=1)return r.at(c,o),void i.at(u,a);if(c>=0&&c<=1)return u<0?i.at(0,a):i.at(1,a),void r.closestPointToPoint(a,!0,o);if(u>=0&&u<=1)return c<0?r.at(0,o):r.at(1,o),void i.closestPointToPoint(o,!0,a);s=c<0?r.start:r.end,l=u<0?i.start:i.end;var h=e,p=n;return r.closestPointToPoint(l,!0,e),i.closestPointToPoint(s,!0,n),h.distanceToSquared(l)<=p.distanceToSquared(s)?(o.copy(h),void a.copy(l)):(o.copy(s),void a.copy(p))}}(),Qh=(zh=new bu,Gh=new bu,Wh=new Au,Vh=new Su,function(t,e){var n=t.radius,r=t.center,i=e.a,o=e.b,a=e.c;if(Vh.start=i,Vh.end=o,Vh.closestPointToPoint(r,!0,zh).distanceTo(r)<=n)return!0;if(Vh.start=i,Vh.end=a,Vh.closestPointToPoint(r,!0,zh).distanceTo(r)<=n)return!0;if(Vh.start=o,Vh.end=a,Vh.closestPointToPoint(r,!0,zh).distanceTo(r)<=n)return!0;var s=e.getPlane(Wh);if(Math.abs(s.distanceToPoint(r))<=n){var l=s.projectPoint(r,Gh);if(e.containsPoint(l))return!0}return!1});function Kh(t){return Math.abs(t)<1e-15}var Jh,$h,tp,ep,np=function(t){function e(){for(var e=arguments,n=[],r=arguments.length;r--;)n[r]=e[r];t.apply(this,n),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((function(){return new bu})),this.satBounds=new Array(4).fill().map((function(){return new kh})),this.points=[this.a,this.b,this.c],this.sphere=new wu,this.plane=new Au,this.needsUpdate=!0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.intersectsSphere=function(t){return Qh(t,this)},e.prototype.update=function(){var t=this.a,e=this.b,n=this.c,r=this.points,i=this.satAxes,o=this.satBounds,a=i[0],s=o[0];this.getNormal(a),s.setFromPoints(a,r);var l=i[1],c=o[1];l.subVectors(t,e),c.setFromPoints(l,r);var u=i[2],h=o[2];u.subVectors(e,n),h.setFromPoints(u,r);var p=i[3],d=o[3];p.subVectors(n,t),d.setFromPoints(p,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1},e}(Ou);np.prototype.closestPointToSegment=($h=new bu,tp=new bu,ep=new Su,function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null);for(var r,i=t.start,o=t.end,a=this.points,s=1/0,l=0;l<3;l++){var c=(l+1)%3;ep.start.copy(a[l]),ep.end.copy(a[c]),qh(ep,t,$h,tp),(r=$h.distanceToSquared(tp))<s&&(s=r,e&&e.copy($h),n&&n.copy(tp))}return this.closestPointToPoint(i,$h),(r=i.distanceToSquared($h))<s&&(s=r,e&&e.copy($h),n&&n.copy(i)),this.closestPointToPoint(o,$h),(r=o.distanceToSquared($h))<s&&(s=r,e&&e.copy($h),n&&n.copy(o)),Math.sqrt(s)}),np.prototype.intersectsTriangle=function(){var t=new np,e=new Array(3),n=new Array(3),r=new kh,i=new kh,o=new bu,a=new bu,s=new bu,l=new bu,c=new bu,u=new Su,h=new Su,p=new Su,d=new bu;function f(t,e,n){for(var r=t.points,i=0,o=-1,s=0;s<3;s++){var l=u.start,c=u.end;l.copy(r[s]),c.copy(r[(s+1)%3]),u.delta(a);var h=Kh(e.distanceToPoint(l));if(Kh(e.normal.dot(a))&&h){n.copy(u),i=2;break}var p=e.intersectLine(u,d);if(!p&&h&&d.copy(l),(p||h)&&!Kh(d.distanceTo(c))){if(i<=1)(1===i?n.start:n.end).copy(d),h&&(o=i);else if(i>=2){(1===o?n.start:n.end).copy(d),i=2;break}if(2==++i&&-1===o)break}}return i}return function(a,u,d){void 0===u&&(u=null),void 0===d&&(d=!1),this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(t.copy(a),t.update(),a=t);var m=this.plane,v=a.plane;if(Math.abs(m.normal.dot(v.normal))>1-1e-10){var g=this.satBounds,y=this.satAxes;n[0]=a.a,n[1]=a.b,n[2]=a.c;for(var _=0;_<4;_++){var E=g[_],T=y[_];if(r.setFromPoints(T,n),E.isSeparated(r))return!1}var x=a.satBounds,b=a.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(var M=0;M<4;M++){var A=x[M],S=b[M];if(r.setFromPoints(S,e),A.isSeparated(r))return!1}for(var O=0;O<4;O++)for(var w=y[O],L=0;L<4;L++){var D=b[L];if(o.crossVectors(w,D),r.setFromPoints(o,e),i.setFromPoints(o,n),r.isSeparated(i))return!1}return u&&(u.start.set(0,0,0),u.end.set(0,0,0)),!0}var C=f(this,v,h);if(1===C&&a.containsPoint(h.end))return u&&(u.start.copy(h.end),u.end.copy(h.end)),!0;if(2!==C)return!1;var P=f(a,m,p);if(1===P&&this.containsPoint(p.end))return u&&(u.start.copy(p.end),u.end.copy(p.end)),!0;if(2!==P)return!1;if(h.delta(s),p.delta(l),s.dot(l)<0){var N=p.start;p.start=p.end,p.end=N}var R=h.start.dot(s),I=h.end.dot(s),U=p.start.dot(s),B=p.end.dot(s);return(R===B||U===I||I<U!=R<B)&&(u&&(c.subVectors(h.start,p.start),c.dot(s)>0?u.start.copy(h.start):u.start.copy(p.start),c.subVectors(h.end,p.end),c.dot(s)<0?u.end.copy(h.end):u.end.copy(p.end)),!0)}}(),np.prototype.distanceToPoint=(Jh=new bu,function(t){return this.closestPointToPoint(t,Jh),t.distanceTo(Jh)}),np.prototype.distanceToTriangle=function(){var t=new bu,e=new bu,n=["a","b","c"],r=new Su,i=new Su;return function(o,a,s){void 0===a&&(a=null),void 0===s&&(s=null);var l=a||s?r:null;if(this.intersectsTriangle(o,l))return(a||s)&&(a&&l.getCenter(a),s&&l.getCenter(s)),0;for(var c=1/0,u=0;u<3;u++){var h=void 0,p=n[u],d=o[p];this.closestPointToPoint(d,t),(h=d.distanceToSquared(t))<c&&(c=h,a&&a.copy(t),s&&s.copy(d));var f=this[p];o.closestPointToPoint(f,t),(h=f.distanceToSquared(t))<c&&(c=h,a&&a.copy(f),s&&s.copy(t))}for(var m=0;m<3;m++){var v=n[m],g=n[(m+1)%3];r.set(this[v],this[g]);for(var y=0;y<3;y++){var _=n[y],E=n[(y+1)%3];i.set(o[_],o[E]),qh(r,i,t,e);var T=t.distanceToSquared(e);T<c&&(c=T,a&&a.copy(t),s&&s.copy(e))}}return Math.sqrt(c)}}();var rp,ip,op,ap,sp,lp,cp=function(t,e,n){this.isOrientedBox=!0,this.min=new bu,this.max=new bu,this.matrix=new Lu,this.invMatrix=new Lu,this.points=new Array(8).fill().map((function(){return new bu})),this.satAxes=new Array(3).fill().map((function(){return new bu})),this.satBounds=new Array(3).fill().map((function(){return new kh})),this.alignedSatBounds=new Array(3).fill().map((function(){return new kh})),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)};cp.prototype.set=function(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0},cp.prototype.copy=function(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0},cp.prototype.update=function(){for(var t=this.matrix,e=this.min,n=this.max,r=this.points,i=0;i<=1;i++)for(var o=0;o<=1;o++)for(var a=0;a<=1;a++){var s=r[1*i|2*o|4*a];s.x=i?n.x:e.x,s.y=o?n.y:e.y,s.z=a?n.z:e.z,s.applyMatrix4(t)}for(var l=this.satBounds,c=this.satAxes,u=r[0],h=0;h<3;h++){var p=c[h],d=l[h],f=r[1<<h];p.subVectors(u,f),d.setFromPoints(p,r)}var m=this.alignedSatBounds;m[0].setFromPointsField(r,"x"),m[1].setFromPointsField(r,"y"),m[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},cp.prototype.intersectsBox=(lp=new kh,function(t){this.needsUpdate&&this.update();var e=t.min,n=t.max,r=this.satBounds,i=this.satAxes,o=this.alignedSatBounds;if(lp.min=e.x,lp.max=n.x,o[0].isSeparated(lp))return!1;if(lp.min=e.y,lp.max=n.y,o[1].isSeparated(lp))return!1;if(lp.min=e.z,lp.max=n.z,o[2].isSeparated(lp))return!1;for(var a=0;a<3;a++){var s=i[a],l=r[a];if(lp.setFromBox(s,t),l.isSeparated(lp))return!1}return!0}),cp.prototype.intersectsTriangle=(rp=new np,ip=new Array(3),op=new kh,ap=new kh,sp=new bu,function(t){this.needsUpdate&&this.update(),t.isExtendedTriangle?t.needsUpdate&&t.update():(rp.copy(t),rp.update(),t=rp);var e=this.satBounds,n=this.satAxes;ip[0]=t.a,ip[1]=t.b,ip[2]=t.c;for(var r=0;r<3;r++){var i=e[r],o=n[r];if(op.setFromPoints(o,ip),i.isSeparated(op))return!1}for(var a=t.satBounds,s=t.satAxes,l=this.points,c=0;c<3;c++){var u=a[c],h=s[c];if(op.setFromPoints(h,l),u.isSeparated(op))return!1}for(var p=0;p<3;p++)for(var d=n[p],f=0;f<4;f++){var m=s[f];if(sp.crossVectors(d,m),op.setFromPoints(sp,ip),ap.setFromPoints(sp,l),op.isSeparated(ap))return!1}return!0}),cp.prototype.closestPointToPoint=function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},cp.prototype.distanceToPoint=function(){var t=new bu;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),cp.prototype.distanceToBox=function(){var t=["x","y","z"],e=new Array(12).fill().map((function(){return new Su})),n=new Array(12).fill().map((function(){return new Su})),r=new bu,i=new bu;return function(o,a,s,l){if(void 0===a&&(a=0),void 0===s&&(s=null),void 0===l&&(l=null),this.needsUpdate&&this.update(),this.intersectsBox(o))return(s||l)&&(o.getCenter(i),this.closestPointToPoint(i,r),o.closestPointToPoint(r,i),s&&s.copy(r),l&&l.copy(i)),0;for(var c=a*a,u=o.min,h=o.max,p=this.points,d=1/0,f=0;f<8;f++){var m=p[f];i.copy(m).clamp(u,h);var v=m.distanceToSquared(i);if(v<d&&(d=v,s&&s.copy(m),l&&l.copy(i),v<c))return Math.sqrt(v)}for(var g=0,y=0;y<3;y++)for(var _=0;_<=1;_++)for(var E=0;E<=1;E++){var T=(y+1)%3,x=(y+2)%3,b=1<<y|_<<T|E<<x,M=p[_<<T|E<<x],A=p[b];e[g].set(M,A);var S=t[y],O=t[T],w=t[x],L=n[g],D=L.start,C=L.end;D[S]=u[S],D[O]=_?u[O]:h[O],D[w]=E?u[w]:h[O],C[S]=h[S],C[O]=_?u[O]:h[O],C[w]=E?u[w]:h[O],g++}for(var P=0;P<=1;P++)for(var N=0;N<=1;N++)for(var R=0;R<=1;R++){i.x=P?h.x:u.x,i.y=N?h.y:u.y,i.z=R?h.z:u.z,this.closestPointToPoint(i,r);var I=i.distanceToSquared(r);if(I<d&&(d=I,s&&s.copy(r),l&&l.copy(i),I<c))return Math.sqrt(I)}for(var U=0;U<12;U++)for(var B=e[U],F=0;F<12;F++){var H=n[F];qh(B,H,r,i);var k=r.distanceToSquared(i);if(k<d&&(d=k,s&&s.copy(r),l&&l.copy(i),k<c))return Math.sqrt(k)}return Math.sqrt(d)}}();var up=function(t){this._getNewPrimitive=t,this._primitives=[]};up.prototype.getPrimitive=function(){var t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()},up.prototype.releasePrimitive=function(t){this._primitives.push(t)};var hp,pp,dp=new(function(t){function e(){t.call(this,(function(){return new np}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(up)),fp=new function(){var t=this;this.float32Array=null,this.uint16Array=null,this.uint32Array=null;var e=[],n=null;this.setBuffer=function(r){n&&e.push(n),n=r,t.float32Array=new Float32Array(r),t.uint16Array=new Uint16Array(r),t.uint32Array=new Uint32Array(r)},this.clearBuffer=function(){n=null,t.float32Array=null,t.uint16Array=null,t.uint32Array=null,0!==e.length&&t.setBuffer(e.pop())}},mp=[],vp=new up((function(){return new Du}));function gp(t,e,n,r,i,o){hp=vp.getPrimitive(),pp=vp.getPrimitive(),mp.push(hp,pp),fp.setBuffer(t._roots[e]);var a=function t(e,n,r,i,o,a,s){void 0===o&&(o=null),void 0===a&&(a=0),void 0===s&&(s=0);var l=fp.float32Array,c=fp.uint16Array,u=fp.uint32Array,h=2*e;if(Lh(h,c)){var p=Dh(e,u),d=Ch(h,c);return dh(e,l,hp),i(p,d,!1,s,a+e,hp)}{var f,m,v,g,y=Ph(e),_=Nh(e,u),E=y,T=_;if(o&&(g=pp,dh(E,l,v=hp),dh(T,l,g),f=o(v),(m=o(g))<f)){E=_,T=y;var x=f;f=m,m=x,v=g}v||dh(E,l,v=hp);var b,M=Lh(2*E,c),A=r(v,M,f,s+1,a+E);if(2===A){var S=N(E),O=R(E);b=i(S,O-S,!0,s+1,a+E,v)}else b=A&&t(E,n,r,i,o,a,s+1);if(b)return!0;dh(T,l,g=pp);var w,L=Lh(2*T,c),D=r(g,L,m,s+1,a+T);if(2===D){var C=N(T),P=R(T);w=i(C,P-C,!0,s+1,a+T,g)}else w=D&&t(T,n,r,i,o,a,s+1);return!!w;function N(t){for(var e=fp.uint16Array,n=fp.uint32Array,r=2*t;!Lh(r,e);)r=2*(t=Ph(t));return Dh(t,n)}function R(t){for(var e=fp.uint16Array,n=fp.uint32Array,r=2*t;!Lh(r,e);)r=2*(t=Nh(t,n));return Dh(t,n)+Ch(r,e)}}}(0,t.geometry,n,r,i,o);fp.clearBuffer(),vp.releasePrimitive(hp),vp.releasePrimitive(pp),mp.pop(),mp.pop();var s=mp.length;return s>0&&(pp=mp[s-1],hp=mp[s-2]),a}var yp=new bu,_p=new bu,Ep=new bu,Tp=new bu,xp=new bu,bp=new Mu,Mp=new Mu,Ap=new Mu,Sp=new bu,Op=new bu,wp=new bu,Lp=new bu;function Dp(t,e,n,r,i,o,a,s,l,c,u){Ep.fromBufferAttribute(e,o),Tp.fromBufferAttribute(e,a),xp.fromBufferAttribute(e,s);var h=function(t,e,n,r,i,o,a,s){if(null===(o===Cu?t.intersectTriangle(r,n,e,!0,i):t.intersectTriangle(e,n,r,o!==Pu,i)))return null;var l=t.origin.distanceTo(i);return l<a||l>s?null:{distance:l,point:i.clone()}}(t,Ep,Tp,xp,Lp,l,c,u);if(h){r&&(bp.fromBufferAttribute(r,o),Mp.fromBufferAttribute(r,a),Ap.fromBufferAttribute(r,s),h.uv=Ou.getInterpolation(Lp,Ep,Tp,xp,bp,Mp,Ap,new Mu)),i&&(bp.fromBufferAttribute(i,o),Mp.fromBufferAttribute(i,a),Ap.fromBufferAttribute(i,s),h.uv1=Ou.getInterpolation(Lp,Ep,Tp,xp,bp,Mp,Ap,new Mu)),n&&(Sp.fromBufferAttribute(n,o),Op.fromBufferAttribute(n,a),wp.fromBufferAttribute(n,s),h.normal=Ou.getInterpolation(Lp,Ep,Tp,xp,Sp,Op,wp,new bu),h.normal.dot(t.direction)>0&&h.normal.multiplyScalar(-1));var p={a:o,b:a,c:s,normal:new bu,materialIndex:0};Ou.getNormal(Ep,Tp,xp,p.normal),h.face=p,h.faceIndex=o}return h}function Cp(t,e,n,r,i,o,a){var s=3*r,l=s+0,c=s+1,u=s+2,h=t.index;t.index&&(l=h.getX(l),c=h.getX(c),u=h.getX(u));var p=t.attributes,d=Dp(n,p.position,p.normal,p.uv,p.uv1,l,c,u,e,o,a);return d?(d.faceIndex=r,i&&i.push(d),d):null}function Pp(t,e,n,r){var i=t.a,o=t.b,a=t.c,s=e,l=e+1,c=e+2;n&&(s=n.getX(s),l=n.getX(l),c=n.getX(c)),i.x=r.getX(s),i.y=r.getY(s),i.z=r.getZ(s),o.x=r.getX(l),o.y=r.getY(l),o.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}var Np=new bu,Rp=new bu,Ip=new bu,Up=new Mu,Bp=new Mu,Fp=new Mu;function Hp(t,e,n,r,i,o,a){for(var s=n.geometry,l=s.index,c=s.attributes.position,u=t,h=e+t;u<h;u++){var p;if(Pp(a,3*(p=u),l,c),a.needsUpdate=!0,r(a,p,i,o))return!0}return!1}function kp(t,e){void 0===e&&(e=null),e&&Array.isArray(e)&&(e=new Set(e));for(var n,r,i,o,a=t.geometry,s=a.index?a.index.array:null,l=a.attributes.position,c=0,u=t._roots,h=0,p=u.length;h<p;h++)n=u[h],r=new Uint32Array(n),i=new Uint16Array(n),o=new Float32Array(n),d(0,c),c+=n.byteLength;function d(t,n,a){void 0===a&&(a=!1);var c=2*t;if(65535===i[c+15]){for(var u=r[t+6],h=1/0,p=1/0,f=1/0,m=-1/0,v=-1/0,g=-1/0,y=3*u,_=3*(u+i[c+14]);y<_;y++){var E=s[y],T=l.getX(E),x=l.getY(E),b=l.getZ(E);T<h&&(h=T),T>m&&(m=T),x<p&&(p=x),x>v&&(v=x),b<f&&(f=b),b>g&&(g=b)}return(o[t+0]!==h||o[t+1]!==p||o[t+2]!==f||o[t+3]!==m||o[t+4]!==v||o[t+5]!==g)&&(o[t+0]=h,o[t+1]=p,o[t+2]=f,o[t+3]=m,o[t+4]=v,o[t+5]=g,!0)}var M=t+8,A=r[t+6],S=M+n,O=A+n,w=a,L=!1,D=!1;e?w||(L=e.has(S),D=e.has(O),w=!L&&!D):(L=!0,D=!0);var C=w||D,P=!1;(w||L)&&(P=d(M,n,w));var N=!1;C&&(N=d(A,n,w));var R=P||N;if(R)for(var I=0;I<3;I++){var U=M+I,B=A+I,F=o[U],H=o[U+3],k=o[B],z=o[B+3];o[t+I]=F<k?F:k,o[t+I+3]=H>z?H:z}return R}}function zp(t,e,n,r,i){var o,a,s,l,c,u,h=1/n.direction.x,p=1/n.direction.y,d=1/n.direction.z,f=n.origin.x,m=n.origin.y,v=n.origin.z,g=e[t],y=e[t+3],_=e[t+1],E=e[t+3+1],T=e[t+2],x=e[t+3+2];return h>=0?(o=(g-f)*h,a=(y-f)*h):(o=(y-f)*h,a=(g-f)*h),p>=0?(s=(_-m)*p,l=(E-m)*p):(s=(E-m)*p,l=(_-m)*p),!(o>l||s>a)&&((s>o||isNaN(o))&&(o=s),(l<a||isNaN(a))&&(a=l),d>=0?(c=(T-v)*d,u=(x-v)*d):(c=(x-v)*d,u=(T-v)*d),!(o>u||c>a)&&((c>o||o!=o)&&(o=c),(u<a||a!=a)&&(a=u),o<=i&&a>=r))}function Gp(t,e,n,r,i,o,a){for(var s=n.geometry,l=s.index,c=s.attributes.position,u=t,h=e+t;u<h;u++){var p;if(Pp(a,3*(p=n.resolveTriangleIndex(u)),l,c),a.needsUpdate=!0,r(a,p,i,o))return!0}return!1}function Wp(t,e,n,r,i,o,a){fp.setBuffer(t._roots[e]),function t(e,n,r,i,o,a,s){var l=fp.float32Array,c=fp.uint16Array,u=fp.uint32Array,h=2*e;if(Lh(h,c)){var p=Dh(e,u),d=Ch(h,c);!function(t,e,n,r,i,o,a,s){var l=t.geometry;t._indirectBuffer;for(var c=r,u=r+i;c<u;c++)Cp(l,e,n,c,o,a,s)}(n,r,i,p,d,o,a,s)}else{var f=Ph(e);zp(f,l,i,a,s)&&t(f,n,r,i,o,a,s);var m=Nh(e,u);zp(m,l,i,a,s)&&t(m,n,r,i,o,a,s)}}(0,t,n,r,i,o,a),fp.clearBuffer()}var Vp=["x","y","z"];function jp(t,e,n,r,i,o){fp.setBuffer(t._roots[e]);var a=function t(e,n,r,i,o,a){var s=fp.float32Array,l=fp.uint16Array,c=fp.uint32Array,u=2*e;if(Lh(u,l)){var h=Dh(e,c),p=Ch(u,l);return function(t,e,n,r,i,o,a){var s=t.geometry;t._indirectBuffer;for(var l=1/0,c=null,u=r,h=r+i;u<h;u++){var p;(p=Cp(s,e,n,u,null,o,a))&&p.distance<l&&(c=p,l=p.distance)}return c}(n,r,i,h,p,o,a)}var d,f,m=Rh(e,c),v=Vp[m],g=i.direction[v]>=0;g?(d=Ph(e),f=Nh(e,c)):(d=Nh(e,c),f=Ph(e));var y=zp(d,s,i,o,a)?t(d,n,r,i,o,a):null;if(y){var _=y.point[v];if(g?_<=s[f+m]:_>=s[f+m+3])return y}var E=zp(f,s,i,o,a)?t(f,n,r,i,o,a):null;return y&&E?y.distance<=E.distance?y:E:y||E||null}(0,t,n,r,i,o);return fp.clearBuffer(),a}var Yp=new Du,Xp=new np,Zp=new np,qp=new Lu,Qp=new cp,Kp=new cp;function Jp(t,e,n,r){fp.setBuffer(t._roots[e]);var i=function t(e,n,r,i,o){void 0===o&&(o=null);var a=fp.float32Array,s=fp.uint16Array,l=fp.uint32Array,c=2*e;if(null===o&&(r.boundingBox||r.computeBoundingBox(),Qp.set(r.boundingBox.min,r.boundingBox.max,i),o=Qp),!Lh(c,s)){var u=e+8,h=l[e+6];return dh(u,a,Yp),!(!o.intersectsBox(Yp)||!t(u,n,r,i,o))||(dh(h,a,Yp),!(!o.intersectsBox(Yp)||!t(h,n,r,i,o)))}var p=n.geometry,d=p.index,f=p.attributes.position,m=r.index,v=r.attributes.position,g=Dh(e,l),y=Ch(c,s);if(qp.copy(i).invert(),r.boundsTree)return dh(e,a,Kp),Kp.matrix.copy(qp),Kp.needsUpdate=!0,r.boundsTree.shapecast({intersectsBounds:function(t){return Kp.intersectsBox(t)},intersectsTriangle:function(t){t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(var e=3*g,n=3*(y+g);e<n;e+=3)if(Pp(Zp,e,d,f),Zp.needsUpdate=!0,t.intersectsTriangle(Zp))return!0;return!1}});for(var _=3*g,E=3*(y+g);_<E;_+=3){Pp(Xp,_,d,f),Xp.a.applyMatrix4(qp),Xp.b.applyMatrix4(qp),Xp.c.applyMatrix4(qp),Xp.needsUpdate=!0;for(var T=0,x=m.count;T<x;T+=3)if(Pp(Zp,T,m,v),Zp.needsUpdate=!0,Xp.intersectsTriangle(Zp))return!0}}(0,t,n,r);return fp.clearBuffer(),i}var $p=new Lu,td=new cp,ed=new cp,nd=new bu,rd=new bu,id=new bu,od=new bu;function ad(t,e,n,r,i,o,a){void 0===r&&(r={}),void 0===i&&(i={}),void 0===o&&(o=0),void 0===a&&(a=1/0),e.boundingBox||e.computeBoundingBox(),td.set(e.boundingBox.min,e.boundingBox.max,n),td.needsUpdate=!0;var s=t.geometry,l=s.attributes.position,c=s.index,u=e.attributes.position,h=e.index,p=dp.getPrimitive(),d=dp.getPrimitive(),f=nd,m=rd,v=null,g=null;i&&(v=id,g=od);var y=1/0,_=null,E=null;return $p.copy(n).invert(),ed.matrix.copy($p),t.shapecast({boundsTraverseOrder:function(t){return td.distanceToBox(t)},intersectsBounds:function(t,e,n){return n<y&&n<a&&(e&&(ed.min.copy(t.min),ed.max.copy(t.max),ed.needsUpdate=!0),!0)},intersectsRange:function(t,r){if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:function(t){return ed.distanceToBox(t)},intersectsBounds:function(t,e,n){return n<y&&n<a},intersectsRange:function(e,i){for(var a=e,s=e+i;a<s;a++){Pp(d,3*a,h,u),d.a.applyMatrix4(n),d.b.applyMatrix4(n),d.c.applyMatrix4(n),d.needsUpdate=!0;for(var T=t,x=t+r;T<x;T++){Pp(p,3*T,c,l),p.needsUpdate=!0;var b=p.distanceToTriangle(d,f,v);if(b<y&&(m.copy(f),g&&g.copy(v),y=b,_=T,E=a),b<o)return!0}}}});for(var i=0,s=lh(e);i<s;i++){Pp(d,3*i,h,u),d.a.applyMatrix4(n),d.b.applyMatrix4(n),d.c.applyMatrix4(n),d.needsUpdate=!0;for(var T=t,x=t+r;T<x;T++){Pp(p,3*T,c,l),p.needsUpdate=!0;var b=p.distanceToTriangle(d,f,v);if(b<y&&(m.copy(f),g&&g.copy(v),y=b,_=T,E=i),b<o)return!0}}}}),dp.releasePrimitive(p),dp.releasePrimitive(d),y===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=y,r.faceIndex=_,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4($p),m.applyMatrix4($p),i.distance=m.sub(i.point).length(),i.faceIndex=E),r)}function sd(t,e){void 0===e&&(e=null),e&&Array.isArray(e)&&(e=new Set(e));for(var n,r,i,o,a=t.geometry,s=a.index?a.index.array:null,l=a.attributes.position,c=0,u=t._roots,h=0,p=u.length;h<p;h++)n=u[h],r=new Uint32Array(n),i=new Uint16Array(n),o=new Float32Array(n),d(0,c),c+=n.byteLength;function d(n,a,c){void 0===c&&(c=!1);var u=2*n;if(65535===i[u+15]){for(var h=r[n+6],p=1/0,f=1/0,m=1/0,v=-1/0,g=-1/0,y=-1/0,_=h,E=h+i[u+14];_<E;_++)for(var T=3*t.resolveTriangleIndex(_),x=0;x<3;x++){var b=T+x;b=s?s[b]:b;var M=l.getX(b),A=l.getY(b),S=l.getZ(b);M<p&&(p=M),M>v&&(v=M),A<f&&(f=A),A>g&&(g=A),S<m&&(m=S),S>y&&(y=S)}return(o[n+0]!==p||o[n+1]!==f||o[n+2]!==m||o[n+3]!==v||o[n+4]!==g||o[n+5]!==y)&&(o[n+0]=p,o[n+1]=f,o[n+2]=m,o[n+3]=v,o[n+4]=g,o[n+5]=y,!0)}var O=n+8,w=r[n+6],L=O+a,D=w+a,C=c,P=!1,N=!1;e?C||(P=e.has(L),N=e.has(D),C=!P&&!N):(P=!0,N=!0);var R=C||N,I=!1;(C||P)&&(I=d(O,a,C));var U=!1;R&&(U=d(w,a,C));var B=I||U;if(B)for(var F=0;F<3;F++){var H=O+F,k=w+F,z=o[H],G=o[H+3],W=o[k],V=o[k+3];o[n+F]=z<W?z:W,o[n+F+3]=G>V?G:V}return B}}function ld(t,e,n,r,i,o,a){fp.setBuffer(t._roots[e]),function t(e,n,r,i,o,a,s){var l=fp.float32Array,c=fp.uint16Array,u=fp.uint32Array,h=2*e;if(Lh(h,c)){var p=Dh(e,u),d=Ch(h,c);!function(t,e,n,r,i,o,a,s){for(var l=t.geometry,c=t._indirectBuffer,u=r,h=r+i;u<h;u++)Cp(l,e,n,c?c[u]:u,o,a,s)}(n,r,i,p,d,o,a,s)}else{var f=Ph(e);zp(f,l,i,a,s)&&t(f,n,r,i,o,a,s);var m=Nh(e,u);zp(m,l,i,a,s)&&t(m,n,r,i,o,a,s)}}(0,t,n,r,i,o,a),fp.clearBuffer()}var cd=["x","y","z"];function ud(t,e,n,r,i,o){fp.setBuffer(t._roots[e]);var a=function t(e,n,r,i,o,a){var s=fp.float32Array,l=fp.uint16Array,c=fp.uint32Array,u=2*e;if(Lh(u,l)){var h=Dh(e,c),p=Ch(u,l);return function(t,e,n,r,i,o,a){for(var s=t.geometry,l=t._indirectBuffer,c=1/0,u=null,h=r,p=r+i;h<p;h++){var d;(d=Cp(s,e,n,l?l[h]:h,null,o,a))&&d.distance<c&&(u=d,c=d.distance)}return u}(n,r,i,h,p,o,a)}var d,f,m=Rh(e,c),v=cd[m],g=i.direction[v]>=0;g?(d=Ph(e),f=Nh(e,c)):(d=Nh(e,c),f=Ph(e));var y=zp(d,s,i,o,a)?t(d,n,r,i,o,a):null;if(y){var _=y.point[v];if(g?_<=s[f+m]:_>=s[f+m+3])return y}var E=zp(f,s,i,o,a)?t(f,n,r,i,o,a):null;return y&&E?y.distance<=E.distance?y:E:y||E||null}(0,t,n,r,i,o);return fp.clearBuffer(),a}var hd=new Du,pd=new np,dd=new np,fd=new Lu,md=new cp,vd=new cp;function gd(t,e,n,r){fp.setBuffer(t._roots[e]);var i=function t(e,n,r,i,o){void 0===o&&(o=null);var a=fp.float32Array,s=fp.uint16Array,l=fp.uint32Array,c=2*e;if(null===o&&(r.boundingBox||r.computeBoundingBox(),md.set(r.boundingBox.min,r.boundingBox.max,i),o=md),!Lh(c,s)){var u=e+8,h=l[e+6];return dh(u,a,hd),!(!o.intersectsBox(hd)||!t(u,n,r,i,o))||(dh(h,a,hd),!(!o.intersectsBox(hd)||!t(h,n,r,i,o)))}var p=n.geometry,d=p.index,f=p.attributes.position,m=r.index,v=r.attributes.position,g=Dh(e,l),y=Ch(c,s);if(fd.copy(i).invert(),r.boundsTree)return dh(e,a,vd),vd.matrix.copy(fd),vd.needsUpdate=!0,r.boundsTree.shapecast({intersectsBounds:function(t){return vd.intersectsBox(t)},intersectsTriangle:function(t){t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(var e=g,r=y+g;e<r;e++)if(Pp(dd,3*n.resolveTriangleIndex(e),d,f),dd.needsUpdate=!0,t.intersectsTriangle(dd))return!0;return!1}});for(var _=g,E=y+g;_<E;_++){var T=n.resolveTriangleIndex(_);Pp(pd,3*T,d,f),pd.a.applyMatrix4(fd),pd.b.applyMatrix4(fd),pd.c.applyMatrix4(fd),pd.needsUpdate=!0;for(var x=0,b=m.count;x<b;x+=3)if(Pp(dd,x,m,v),dd.needsUpdate=!0,pd.intersectsTriangle(dd))return!0}}(0,t,n,r);return fp.clearBuffer(),i}var yd=new Lu,_d=new cp,Ed=new cp,Td=new bu,xd=new bu,bd=new bu,Md=new bu;function Ad(t,e,n,r,i,o,a){void 0===r&&(r={}),void 0===i&&(i={}),void 0===o&&(o=0),void 0===a&&(a=1/0),e.boundingBox||e.computeBoundingBox(),_d.set(e.boundingBox.min,e.boundingBox.max,n),_d.needsUpdate=!0;var s=t.geometry,l=s.attributes.position,c=s.index,u=e.attributes.position,h=e.index,p=dp.getPrimitive(),d=dp.getPrimitive(),f=Td,m=xd,v=null,g=null;i&&(v=bd,g=Md);var y=1/0,_=null,E=null;return yd.copy(n).invert(),Ed.matrix.copy(yd),t.shapecast({boundsTraverseOrder:function(t){return _d.distanceToBox(t)},intersectsBounds:function(t,e,n){return n<y&&n<a&&(e&&(Ed.min.copy(t.min),Ed.max.copy(t.max),Ed.needsUpdate=!0),!0)},intersectsRange:function(r,i){if(e.boundsTree){var s=e.boundsTree;return s.shapecast({boundsTraverseOrder:function(t){return Ed.distanceToBox(t)},intersectsBounds:function(t,e,n){return n<y&&n<a},intersectsRange:function(e,a){for(var T=e,x=e+a;T<x;T++){var b=s.resolveTriangleIndex(T);Pp(d,3*b,h,u),d.a.applyMatrix4(n),d.b.applyMatrix4(n),d.c.applyMatrix4(n),d.needsUpdate=!0;for(var M=r,A=r+i;M<A;M++){var S=t.resolveTriangleIndex(M);Pp(p,3*S,c,l),p.needsUpdate=!0;var O=p.distanceToTriangle(d,f,v);if(O<y&&(m.copy(f),g&&g.copy(v),y=O,_=M,E=T),O<o)return!0}}}})}for(var T=0,x=lh(e);T<x;T++){Pp(d,3*T,h,u),d.a.applyMatrix4(n),d.b.applyMatrix4(n),d.c.applyMatrix4(n),d.needsUpdate=!0;for(var b=r,M=r+i;b<M;b++){var A=t.resolveTriangleIndex(b);Pp(p,3*A,c,l),p.needsUpdate=!0;var S=p.distanceToTriangle(d,f,v);if(S<y&&(m.copy(f),g&&g.copy(v),y=S,_=b,E=T),S<o)return!0}}}}),dp.releasePrimitive(p),dp.releasePrimitive(d),y===1/0?null:(r.point?r.point.copy(m):r.point=m.clone(),r.distance=y,r.faceIndex=_,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(yd),m.applyMatrix4(yd),i.distance=m.sub(i.point).length(),i.faceIndex=E),r)}function Sd(){return"undefined"!=typeof SharedArrayBuffer}var Od=new fp.constructor,wd=new fp.constructor,Ld=new up((function(){return new Du})),Dd=new Du,Cd=new Du,Pd=new Du,Nd=new Du,Rd=!1;function Id(t,e,n,r,i,o,a,s,l,c,u){var h,p;void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=null),void 0===u&&(u=!1),u?(h=wd,p=Od):(h=Od,p=wd);var d=h.float32Array,f=h.uint32Array,m=h.uint16Array,v=p.float32Array,g=p.uint32Array,y=p.uint16Array,_=2*e,E=Lh(2*t,m),T=Lh(_,y),x=!1;if(T&&E)x=u?i(Dh(e,g),Ch(2*e,y),Dh(t,f),Ch(2*t,m),l,a+e,s,o+t):i(Dh(t,f),Ch(2*t,m),Dh(e,g),Ch(2*e,y),s,o+t,l,a+e);else if(T){var b=Ld.getPrimitive();dh(e,v,b),b.applyMatrix4(n);var M=Ph(t),A=Nh(t,f);dh(M,d,Dd),dh(A,d,Cd);var S=b.intersectsBox(Dd),O=b.intersectsBox(Cd);x=S&&Id(e,M,r,n,i,a,o,l,s+1,b,!u)||O&&Id(e,A,r,n,i,a,o,l,s+1,b,!u),Ld.releasePrimitive(b)}else{var w=Ph(e),L=Nh(e,g);dh(w,v,Pd),dh(L,v,Nd);var D=c.intersectsBox(Pd),C=c.intersectsBox(Nd);if(D&&C)x=Id(t,w,n,r,i,o,a,s,l+1,c,u)||Id(t,L,n,r,i,o,a,s,l+1,c,u);else if(D)if(E)x=Id(t,w,n,r,i,o,a,s,l+1,c,u);else{var P=Ld.getPrimitive();P.copy(Pd).applyMatrix4(n);var N=Ph(t),R=Nh(t,f);dh(N,d,Dd),dh(R,d,Cd);var I=P.intersectsBox(Dd),U=P.intersectsBox(Cd);x=I&&Id(w,N,r,n,i,a,o,l,s+1,P,!u)||U&&Id(w,R,r,n,i,a,o,l,s+1,P,!u),Ld.releasePrimitive(P)}else if(C)if(E)x=Id(t,L,n,r,i,o,a,s,l+1,c,u);else{var B=Ld.getPrimitive();B.copy(Nd).applyMatrix4(n);var F=Ph(t),H=Nh(t,f);dh(F,d,Dd),dh(H,d,Cd);var k=B.intersectsBox(Dd),z=B.intersectsBox(Cd);x=k&&Id(L,F,r,n,i,a,o,l,s+1,B,!u)||z&&Id(L,H,r,n,i,a,o,l,s+1,B,!u),Ld.releasePrimitive(B)}}return x}var Ud=new cp,Bd=new Du,Fd={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null},Hd=function(t,e){var n,r=this;if(void 0===e&&(e={}),!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign(Object.assign({},Fd,((n={})[ah]=!1,n)),e)).useSharedArrayBuffer&&!Sd())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[ah]||(Fh(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Du))),this.resolveTriangleIndex=e.indirect?function(t){return r._indirectBuffer[t]}:function(t){return t}},kd={indirect:{configurable:!0}};Hd.serialize=function(t,e){void 0===e&&(e={}),e=Object.assign({},{cloneBuffers:!0},e);var n=t.geometry,r=t._roots,i=t._indirectBuffer,o=n.getIndex();return e.cloneBuffers?{roots:r.map((function(t){return t.slice()})),index:o?o.array.slice():null,indirectBuffer:i?i.slice():null}:{roots:r,index:o?o.array:null,indirectBuffer:i}},Hd.deserialize=function(t,e,n){var r;void 0===n&&(n={}),n=Object.assign({},{setIndex:!0,indirect:Boolean(t.indirectBuffer)},n);var i=t.index,o=t.roots,a=t.indirectBuffer,s=new Hd(e,Object.assign({},n,((r={})[ah]=!0,r)));if(s._roots=o,s._indirectBuffer=a||null,n.setIndex){var l=e.getIndex();if(null===l){var c=new xu(t.index,1,!1);e.setIndex(c)}else l.array!==i&&(l.array.set(i),l.needsUpdate=!0)}return s},kd.indirect.get=function(){return!!this._indirectBuffer},Hd.prototype.refit=function(t){return void 0===t&&(t=null),(this.indirect?sd:kp)(this,t)},Hd.prototype.traverse=function(t,e){void 0===e&&(e=0);var n=this._roots[e],r=new Uint32Array(n),i=new Uint16Array(n);!function e(o,a){void 0===a&&(a=0);var s=2*o,l=65535===i[s+15];if(l){var c=r[o+6],u=i[s+14];t(a,l,new Float32Array(n,4*o,6),c,u)}else{var h=o+8,p=r[o+6],d=r[o+7];t(a,l,new Float32Array(n,4*o,6),d)||(e(h,a+1),e(p,a+1))}}(0)},Hd.prototype.raycast=function(t,e,n,r){void 0===e&&(e=Nu),void 0===n&&(n=0),void 0===r&&(r=1/0);for(var i=this._roots,o=this.geometry,a=[],s=e.isMaterial,l=Array.isArray(e),c=o.groups,u=s?e.side:e,h=this.indirect?ld:Wp,p=0,d=i.length;p<d;p++){var f=l?e[c[p].materialIndex].side:u,m=a.length;if(h(this,p,f,t,a,n,r),l)for(var v=c[p].materialIndex,g=m,y=a.length;g<y;g++)a[g].face.materialIndex=v}return a},Hd.prototype.raycastFirst=function(t,e,n,r){void 0===e&&(e=Nu),void 0===n&&(n=0),void 0===r&&(r=1/0);for(var i=this._roots,o=this.geometry,a=e.isMaterial,s=Array.isArray(e),l=null,c=o.groups,u=a?e.side:e,h=this.indirect?ud:jp,p=0,d=i.length;p<d;p++){var f=h(this,p,s?e[c[p].materialIndex].side:u,t,n,r);null!=f&&(null==l||f.distance<l.distance)&&(l=f,s&&(f.face.materialIndex=c[p].materialIndex))}return l},Hd.prototype.intersectsGeometry=function(t,e){for(var n=!1,r=this._roots,i=this.indirect?gd:Jp,o=0,a=r.length;o<a&&!(n=i(this,o,t,e));o++);return n},Hd.prototype.shapecast=function(t){var e=this,n=dp.getPrimitive(),r=this.indirect?Gp:Hp,i=t.boundsTraverseOrder,o=t.intersectsBounds,a=t.intersectsRange,s=t.intersectsTriangle;if(a&&s){var l=a;a=function(t,i,o,a,c){return!!l(t,i,o,a,c)||r(t,i,e,s,o,a,n)}}else a||(a=s?function(t,i,o,a){return r(t,i,e,s,o,a,n)}:function(t,e,n){return n});for(var c=!1,u=0,h=this._roots,p=0,d=h.length;p<d;p++){var f=h[p];if(c=gp(this,p,o,a,i,u))break;u+=f.byteLength}return dp.releasePrimitive(n),c},Hd.prototype.bvhcast=function(t,e,n){var r=this,i=n.intersectsRanges,o=n.intersectsTriangles,a=dp.getPrimitive(),s=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?function(t){var e=r.resolveTriangleIndex(t);Pp(a,3*e,s,l)}:function(t){Pp(a,3*t,s,l)},u=dp.getPrimitive(),h=t.geometry.index,p=t.geometry.attributes.position,d=t.indirect?function(e){var n=t.resolveTriangleIndex(e);Pp(u,3*n,h,p)}:function(t){Pp(u,3*t,h,p)};if(o){var f=function(t,n,r,i,s,l,h,p){for(var f=r,m=r+i;f<m;f++){d(f),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(var v=t,g=t+n;v<g;v++)if(c(v),a.needsUpdate=!0,o(a,u,v,f,s,l,h,p))return!0}return!1};if(i){var m=i;i=function(t,e,n,r,i,o,a,s){return!!m(t,e,n,r,i,o,a,s)||f(t,e,n,r,i,o,a,s)}}else i=f}return function(t,e,n,r){if(Rd)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Rd=!0;for(var i,o=t._roots,a=e._roots,s=0,l=0,c=(new Lu).copy(n).invert(),u=0,h=o.length;u<h;u++){Od.setBuffer(o[u]),l=0;var p=Ld.getPrimitive();dh(0,Od.float32Array,p),p.applyMatrix4(c);for(var d=0,f=a.length;d<f&&(wd.setBuffer(a[d]),i=Id(0,0,n,c,r,s,l,0,0,p),wd.clearBuffer(),l+=a[d].length,!i);d++);if(Ld.releasePrimitive(p),Od.clearBuffer(),s+=o[u].length,i)break}return Rd=!1,i}(this,t,e,i)},Hd.prototype.intersectsBox=function(t,e){return Ud.set(t.min,t.max,e),Ud.needsUpdate=!0,this.shapecast({intersectsBounds:function(t){return Ud.intersectsBox(t)},intersectsTriangle:function(t){return Ud.intersectsTriangle(t)}})},Hd.prototype.intersectsSphere=function(t){return this.shapecast({intersectsBounds:function(e){return t.intersectsBox(e)},intersectsTriangle:function(e){return e.intersectsSphere(t)}})},Hd.prototype.closestPointToGeometry=function(t,e,n,r,i,o){return void 0===n&&(n={}),void 0===r&&(r={}),void 0===i&&(i=0),void 0===o&&(o=1/0),(this.indirect?Ad:ad)(this,t,e,n,r,i,o)},Hd.prototype.closestPointToPoint=function(t,e,n,r){return void 0===e&&(e={}),void 0===n&&(n=0),void 0===r&&(r=1/0),function(t,e,n,r,i){void 0===n&&(n={}),void 0===r&&(r=0),void 0===i&&(i=1/0);var o=r*r,a=i*i,s=1/0,l=null;if(t.shapecast({boundsTraverseOrder:function(t){return yp.copy(e).clamp(t.min,t.max),yp.distanceToSquared(e)},intersectsBounds:function(t,e,n){return n<s&&n<a},intersectsTriangle:function(t,n){t.closestPointToPoint(e,yp);var r=e.distanceToSquared(yp);return r<s&&(_p.copy(yp),s=r,l=n),r<o}}),s===1/0)return null;var c=Math.sqrt(s);return n.point?n.point.copy(_p):n.point=_p.clone(),n.distance=c,n.faceIndex=l,n}(this,t,e,n,r)},Hd.prototype.getBoundingBox=function(t){return t.makeEmpty(),this._roots.forEach((function(e){dh(0,new Float32Array(e),Bd),t.union(Bd)})),t},Object.defineProperties(Hd.prototype,kd);var zd=new Du,Gd=new Lu,Wd=function(t){function e(e,n,r,i){void 0===r&&(r=10),void 0===i&&(i=0),t.call(this),this.material=n,this.geometry=new Uu,this.name="MeshBVHRootHelper",this.depth=r,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={isMesh:{configurable:!0},isLineSegments:{configurable:!0},isLine:{configurable:!0}};return n.isMesh.get=function(){return!this.displayEdges},n.isLineSegments.get=function(){return this.displayEdges},n.isLine.get=function(){return this.displayEdges},e.prototype.getVertexPosition=function(){for(var t,e=arguments,n=[],r=arguments.length;r--;)n[r]=e[r];return(t=Iu.prototype.getVertexPosition).call.apply(t,[this].concat(n))},e.prototype.raycast=function(){},e.prototype.update=function(){var t=this.geometry,e=this.bvh,n=this._group;if(t.dispose(),this.visible=!1,e){var r=this.depth-1,i=this.displayParents,o=0;e.traverse((function(t,e){if(t>=r||e)return o++,!0;i&&o++}),n);var a,s,l=0,c=new Float32Array(24*o);e.traverse((function(t,e,n){var o=t>=r||e;if(o||i){dh(0,n,zd);for(var a=zd.min,s=zd.max,u=-1;u<=1;u+=2)for(var h=u<0?a.x:s.x,p=-1;p<=1;p+=2)for(var d=p<0?a.y:s.y,f=-1;f<=1;f+=2){var m=f<0?a.z:s.z;c[l+0]=h,c[l+1]=d,c[l+2]=m,l+=3}return o}}),n),s=this.displayEdges?new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),a=c.length>65535?new Uint32Array(s.length*o):new Uint16Array(s.length*o);for(var u=s.length,h=0;h<o;h++)for(var p=8*h,d=h*u,f=0;f<u;f++)a[d+f]=p+s[f];t.setIndex(new xu(a,1,!1)),t.setAttribute("position",new xu(c,3,!1)),this.visible=!0}},Object.defineProperties(e.prototype,n),e}(Ru),Vd=function(t){function e(e,n,r){void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=10),e instanceof Hd&&(r=n||10,n=e,e=null),"number"==typeof n&&(r=n,n=null),t.call(this),this.name="MeshBVHHelper",this.depth=r,this.mesh=e,this.bvh=n,this.displayParents=!1,this.displayEdges=!0,this.objectIndex=0,this._roots=[];var i=new Fu({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),o=new Hu({color:65416,transparent:!0,opacity:.3,depthWrite:!1});o.color=i.color,this.edgeMaterial=i,this.meshMaterial=o,this.update()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={color:{configurable:!0},opacity:{configurable:!0}};return n.color.get=function(){return this.edgeMaterial.color},n.opacity.get=function(){return this.edgeMaterial.opacity},n.opacity.set=function(t){this.edgeMaterial.opacity=t,this.meshMaterial.opacity=t},e.prototype.update=function(){var t=this.mesh,e=this.bvh||t.geometry.boundsTree||null;if(t.isBatchedMesh&&t.boundsTrees&&!e){var n=t._drawInfo[this.objectIndex];n&&(e=t.boundsTrees[n.geometryIndex]||e)}for(var r=e?e._roots.length:0;this._roots.length>r;){var i=this._roots.pop();i.geometry.dispose(),this.remove(i)}for(var o=0;o<r;o++){var a=this.depth,s=this.edgeMaterial,l=this.meshMaterial,c=this.displayParents,u=this.displayEdges;if(o>=this._roots.length){var h=new Wd(e,s,a,o);this.add(h),this._roots.push(h)}var p=this._roots[o];p.bvh=e,p.depth=a,p.displayParents=c,p.displayEdges=u,p.material=u?s:l,p.update()}},e.prototype.updateMatrixWorld=function(){for(var e=arguments,n=[],r=arguments.length;r--;)n[r]=e[r];var i=this.mesh,o=this.parent;null!==i&&(i.updateWorldMatrix(!0,!1),o?this.matrix.copy(o.matrixWorld).invert().multiply(i.matrixWorld):this.matrix.copy(i.matrixWorld),(i.isInstancedMesh||i.isBatchedMesh)&&(i.getMatrixAt(this.objectIndex,Gd),this.matrix.multiply(Gd)),this.matrix.decompose(this.position,this.quaternion,this.scale)),t.prototype.updateMatrixWorld.apply(this,n)},e.prototype.copy=function(t){this.depth=t.depth,this.mesh=t.mesh,this.bvh=t.bvh,this.opacity=t.opacity,this.color.copy(t.color)},e.prototype.clone=function(){return new e(this.mesh,this.bvh,this.depth)},e.prototype.dispose=function(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();for(var t=this.children,e=0,n=t.length;e<n;e++)t[e].geometry.dispose()},Object.defineProperties(e.prototype,n),e}(Bu),jd=new Du,Yd=new Du,Xd=new bu;function Zd(t){switch(typeof t){case"number":return 8;case"string":return 2*t.length;case"boolean":return 4;default:return 0}}function qd(t,e,n){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(n.ray.origin),t.object=e,t)}var Qd=L.BatchedMesh||null,Kd=parseInt(ku)>=166,Jd=new zu,$d=new bu,tf=new Lu,ef=Iu.prototype.raycast,nf=null!==Qd?Qd.prototype.raycast:null,rf=new bu,of=new Iu,af=[];function sf(t,e){if(this.boundsTrees){var n=this.boundsTrees,r=this._drawInfo,i=this._drawRanges,o=this.matrixWorld;of.material=this.material,of.geometry=this.geometry;var a=of.geometry.boundsTree,s=of.geometry.drawRange;null===of.geometry.boundingSphere&&(of.geometry.boundingSphere=new wu);for(var l=0,c=r.length;l<c;l++)if(this.getVisibleAt(l)){var u=r[l].geometryIndex;if(of.geometry.boundsTree=n[u],this.getMatrixAt(l,of.matrixWorld).premultiply(o),!of.geometry.boundsTree){this.getBoundingBoxAt(u,of.geometry.boundingBox),this.getBoundingSphereAt(u,of.geometry.boundingSphere);var h=i[u];of.geometry.setDrawRange(h.start,h.count)}of.raycast(t,af);for(var p=0,d=af.length;p<d;p++){var f=af[p];f.object=this,f.batchId=l,e.push(f)}af.length=0}of.geometry.boundsTree=a,of.geometry.drawRange=s,of.material=null,of.geometry=null}else nf.call(this,t,e)}function lf(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;tf.copy(this.matrixWorld).invert(),Jd.copy(t.ray).applyMatrix4(tf),rf.setFromMatrixScale(this.matrixWorld),$d.copy(Jd.direction).multiply(rf);var n=$d.length(),r=t.near/n,i=t.far/n,o=this.geometry.boundsTree;if(!0===t.firstHitOnly){var a=qd(o.raycastFirst(Jd,this.material,r,i),this,t);a&&e.push(a)}else for(var s=o.raycast(Jd,this.material,r,i),l=0,c=s.length;l<c;l++){var u=qd(s[l],this,t);u&&e.push(u)}}else ef.call(this,t,e)}function cf(t){switch(t){case 1:return Xu;case 2:return Yu;case 3:case 4:return ju}}var uf=function(t){function e(){t.call(this),this.minFilter=qu,this.magFilter=qu,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.updateFrom=function(t){var e=this.overrideItemSize,n=t.itemSize,r=t.count;if(null!==e){if(n*r%e!=0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");t.itemSize=e,t.count=r*n/e}var i,o,a,s,l=t.itemSize,c=t.count,u=t.normalized,h=t.array.constructor,p=h.BYTES_PER_ELEMENT,d=this._forcedType,f=l;if(null===d)switch(h){case Float32Array:d=Ju;break;case Uint8Array:case Uint16Array:case Uint32Array:d=Ku;break;case Int8Array:case Int16Array:case Int32Array:d=Qu}var m=function(t){switch(t){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw new Error}(l);switch(d){case Ju:a=1,o=function(t){switch(t){case 1:return Vu;case 2:return Wu;case 3:case 4:return Gu}}(l),u&&1===p?(s=h,m+="8",h===Uint8Array?i=$u:(i=eh,m+="_SNORM")):(s=Float32Array,m+="32F",i=Ju);break;case Qu:m+=8*p+"I",a=u?Math.pow(2,8*h.BYTES_PER_ELEMENT-1):1,o=cf(l),1===p?(s=Int8Array,i=eh):2===p?(s=Int16Array,i=nh):(s=Int32Array,i=Qu);break;case Ku:m+=8*p+"UI",a=u?Math.pow(2,8*h.BYTES_PER_ELEMENT-1):1,o=cf(l),1===p?(s=Uint8Array,i=$u):2===p?(s=Uint16Array,i=th):(s=Uint32Array,i=Ku)}3!==f||o!==Gu&&o!==ju||(f=4);var v=Math.ceil(Math.sqrt(c))||1,g=new s(f*v*v),y=t.normalized;t.normalized=!1;for(var _=0;_<c;_++){var E=f*_;g[E]=t.getX(_)/a,l>=2&&(g[E+1]=t.getY(_)/a),l>=3&&(g[E+2]=t.getZ(_)/a,4===f&&(g[E+3]=1)),l>=4&&(g[E+3]=t.getW(_)/a)}t.normalized=y,this.internalFormat=m,this.format=o,this.type=i,this.image.width=v,this.image.height=v,this.image.data=g,this.needsUpdate=!0,this.dispose(),t.itemSize=n,t.count=r},e}(Zu),hf=function(t){function e(){t.call(this),this._forcedType=Ku}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(uf),pf=function(t){function e(){t.call(this),this._forcedType=Qu}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(uf),df=function(t){function e(){t.call(this),this._forcedType=Ju}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(uf),ff=function(){this.index=new hf,this.position=new df,this.bvhBounds=new Zu,this.bvhContents=new Zu,this._cachedIndexAttr=null,this.index.overrideItemSize=3};ff.prototype.updateFrom=function(t){var e=t.geometry;if(function(t,e,n){var r=t._roots;if(1!==r.length)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");for(var i=r[0],o=new Uint16Array(i),a=new Uint32Array(i),s=new Float32Array(i),l=i.byteLength/32,c=2*Math.ceil(Math.sqrt(l/2)),u=new Float32Array(4*c*c),h=Math.ceil(Math.sqrt(l)),p=new Uint32Array(2*h*h),d=0;d<l;d++){for(var f=32*d/4,m=2*f,v=f,g=0;g<3;g++)u[8*d+0+g]=s[v+0+g],u[8*d+4+g]=s[v+3+g];if(Lh(m,o)){var y=Ch(m,o),_=Dh(f,a),E=4294901760|y;p[2*d+0]=E,p[2*d+1]=_}else{var T=4*Nh(f,a)/32,x=Rh(f,a);p[2*d+0]=x,p[2*d+1]=T}}e.image.data=u,e.image.width=c,e.image.height=c,e.format=Gu,e.type=Ju,e.internalFormat="RGBA32F",e.minFilter=qu,e.magFilter=qu,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),n.image.data=p,n.image.width=h,n.image.height=h,n.format=Yu,n.type=Ku,n.internalFormat="RG32UI",n.minFilter=qu,n.magFilter=qu,n.generateMipmaps=!1,n.needsUpdate=!0,n.dispose()}(t,this.bvhBounds,this.bvhContents),this.position.updateFrom(e.attributes.position),t.indirect){var n=t._indirectBuffer;if(null===this._cachedIndexAttr||this._cachedIndexAttr.count!==n.length)if(e.index)this._cachedIndexAttr=e.index.clone();else{var r=ch(sh(e));this._cachedIndexAttr=new xu(r,1,!1)}!function(t,e,n){for(var r=n.array,i=t.index?t.index.array:null,o=0,a=e.length;o<a;o++)for(var s=3*o,l=3*e[o],c=0;c<3;c++)r[s+c]=i?i[l+c]:l+c}(e,n,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(e.index)},ff.prototype.dispose=function(){var t=this.index,e=this.position,n=this.bvhBounds,r=this.bvhContents;t&&t.dispose(),e&&e.dispose(),n&&n.dispose(),r&&r.dispose()};var mf=new bu,vf=new bu,gf=new bu,yf=new rh,_f=new bu,Ef=new bu,Tf=new rh,xf=new rh,bf=new Lu,Mf=new Lu;function Af(t,e){if(t||e){var n=t.count===e.count,r=t.normalized===e.normalized,i=t.array.constructor===e.array.constructor,o=t.itemSize===e.itemSize;if(!(n&&r&&i&&o))throw new Error}}function Sf(t,e){void 0===e&&(e=null);var n=t.array.constructor,r=t.normalized,i=t.itemSize,o=null===e?t.count:e;return new xu(new n(i*o),i,r)}function Of(t,e,n){if(void 0===n&&(n=0),t.isInterleavedBufferAttribute)for(var r=t.itemSize,i=0,o=t.count;i<o;i++){var a=i+n;e.setX(a,t.getX(i)),r>=2&&e.setY(a,t.getY(i)),r>=3&&e.setZ(a,t.getZ(i)),r>=4&&e.setW(a,t.getW(i))}else{var s=e.array,l=s.constructor,c=s.BYTES_PER_ELEMENT*t.itemSize*n;new l(s.buffer,c,t.array.length).set(t.array)}}function wf(t,e,n){for(var r=t.elements,i=e.elements,o=0,a=i.length;o<a;o++)r[o]+=i[o]*n}function Lf(t,e,n){var r=t.skeleton,i=t.geometry,o=r.bones,a=r.boneInverses;Tf.fromBufferAttribute(i.attributes.skinIndex,e),xf.fromBufferAttribute(i.attributes.skinWeight,e),bf.elements.fill(0);for(var s=0;s<4;s++){var l=xf.getComponent(s);if(0!==l){var c=Tf.getComponent(s);Mf.multiplyMatrices(o[c].matrixWorld,a[c]),wf(bf,Mf,l)}}return bf.multiply(t.bindMatrix).premultiply(t.bindMatrixInverse),n.transformDirection(bf),n}function Df(t,e,n,r,i){_f.set(0,0,0);for(var o=0,a=t.length;o<a;o++){var s=e[o],l=t[o];0!==s&&(Ef.fromBufferAttribute(l,r),n?_f.addScaledVector(Ef,s):_f.addScaledVector(Ef.sub(i),s))}i.add(_f)}var Cf=function(t){this.matrixWorld=new Lu,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=t,this.update()};Cf.prototype.update=function(){var t=this.mesh,e=t.geometry,n=t.skeleton,r=(e.index?e.index.count:e.attributes.position.count)/3;if(this.matrixWorld.copy(t.matrixWorld),this.geometryHash=e.attributes.position.version,this.primitiveCount=r,n){n.boneTexture||n.computeBoneTexture(),n.update();var i=n.boneMatrices;this.boneMatrices&&this.boneMatrices.length===i.length?this.boneMatrices.set(i):this.boneMatrices=i.slice()}else this.boneMatrices=null},Cf.prototype.didChange=function(){var t=this.mesh,e=t.geometry,n=(e.index?e.index.count:e.attributes.position.count)/3;return!(this.matrixWorld.equals(t.matrixWorld)&&this.geometryHash===e.attributes.position.version&&function(t,e){if(null===t||null===e)return t===e;if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}(t.skeleton&&t.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===n)};var Pf=function(t){Array.isArray(t)||(t=[t]);var e=[];t.forEach((function(t){t.traverseVisible((function(t){t.isMesh&&e.push(t)}))})),this.meshes=e,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(e.length).fill().map((function(){return new Uu})),this._diffMap=new WeakMap};Pf.prototype.getMaterials=function(){var t=[];return this.meshes.forEach((function(e){Array.isArray(e.material)?t.push.apply(t,e.material):t.push(e.material)})),t},Pf.prototype.generate=function(t){void 0===t&&(t=new Uu);for(var e=[],n=this.meshes,r=this.useGroups,i=this._intermediateGeometry,o=this._diffMap,a=0,s=n.length;a<s;a++){var l=n[a],c=i[a],u=o.get(l);!u||u.didChange(l)?(this._convertToStaticGeometry(l,c),e.push(!1),u?u.update():o.set(l,new Cf(l))):e.push(!0)}if(0===i.length){t.setIndex(null);var h=t.attributes;for(var p in h)t.deleteAttribute(p);for(var d in this.attributes)t.setAttribute(this.attributes[d],new xu(new Float32Array(0),4,!1))}else!function(t,e,n){void 0===e&&(e={useGroups:!1,updateIndex:!1,skipAttributes:[]}),void 0===n&&(n=new Uu);var r=null!==t[0].index,i=e.useGroups;void 0===i&&(i=!1);var o=e.updateIndex;void 0===o&&(o=!1);var a=e.skipAttributes;void 0===a&&(a=[]);var s=new Set(Object.keys(t[0].attributes)),l={},c=0;n.clearGroups();for(var u=0;u<t.length;++u){var h=t[u],p=0;if(r!==(null!==h.index))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(var d in h.attributes){if(!s.has(d))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+d+'" attribute exists among all geometries, or in none of them.');void 0===l[d]&&(l[d]=[]),l[d].push(h.attributes[d]),p++}if(p!==s.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(i){var f=void 0;if(r)f=h.index.count;else{if(void 0===h.attributes.position)throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");f=h.attributes.position.count}n.addGroup(c,f,u),c+=f}}if(r){var m=!1;if(!n.index){for(var v=0,g=0;g<t.length;++g)v+=t[g].index.count;n.setIndex(new xu(new Uint32Array(v),1,!1)),m=!0}if(o||m)for(var y=n.index,_=0,E=0,T=0;T<t.length;++T){var x=t[T],b=x.index;if(!0!==a[T])for(var M=0;M<b.count;++M)y.setX(_,b.getX(M)+E),_++;E+=x.attributes.position.count}}for(var A in l){var S=l[A];if(!(A in n.attributes)){var O=0;for(var w in S)O+=S[w].count;n.setAttribute(A,Sf(l[A][0],O))}for(var L=n.attributes[A],D=0,C=0,P=S.length;C<P;C++){var N=S[C];!0!==a[C]&&Of(N,L,D),D+=N.count}}}(i,{useGroups:r,skipAttributes:e},t);for(var f in t.attributes)t.attributes[f].needsUpdate=!0;return t},Pf.prototype._convertToStaticGeometry=function(t,e){void 0===e&&(e=new Uu);var n=t.geometry,r=this.applyWorldTransforms,i=this.attributes.includes("normal"),o=this.attributes.includes("tangent"),a=n.attributes,s=e.attributes;!e.index&&n.index&&(e.index=n.index.clone()),s.position||e.setAttribute("position",Sf(a.position)),i&&!s.normal&&a.normal&&e.setAttribute("normal",Sf(a.normal)),o&&!s.tangent&&a.tangent&&e.setAttribute("tangent",Sf(a.tangent)),Af(n.index,e.index),Af(a.position,s.position),i&&Af(a.normal,s.normal),o&&Af(a.tangent,s.tangent);var l=a.position,c=i?a.normal:null,u=o?a.tangent:null,h=n.morphAttributes.position,p=n.morphAttributes.normal,d=n.morphAttributes.tangent,f=n.morphTargetsRelative,m=t.morphTargetInfluences,v=new ih;v.getNormalMatrix(t.matrixWorld),n.index&&e.index.array.set(n.index.array);for(var g=0,y=a.position.count;g<y;g++)mf.fromBufferAttribute(l,g),c&&vf.fromBufferAttribute(c,g),u&&(yf.fromBufferAttribute(u,g),gf.fromBufferAttribute(u,g)),m&&(h&&Df(h,m,f,g,mf),p&&Df(p,m,f,g,vf),d&&Df(d,m,f,g,gf)),t.isSkinnedMesh&&(t.applyBoneTransform(g,mf),c&&Lf(t,g,vf),u&&Lf(t,g,gf)),r&&mf.applyMatrix4(t.matrixWorld),s.position.setXYZ(g,mf.x,mf.y,mf.z),c&&(r&&vf.applyNormalMatrix(v),s.normal.setXYZ(g,vf.x,vf.y,vf.z)),u&&(r&&gf.transformDirection(t.matrixWorld),s.tangent.setXYZW(g,gf.x,gf.y,gf.z,yf.w));for(var _ in this.attributes){var E=this.attributes[_];"position"!==E&&"tangent"!==E&&"normal"!==E&&E in a&&(s[E]||e.setAttribute(E,Sf(a[E])),Af(a[E],s[E]),Of(a[E],s[E]))}return t.matrixWorld.determinant()<0&&function(t){var e=t.index,n=t.attributes;if(e)for(var r=0,i=e.count;r<i;r+=3){var o=e.getX(r),a=e.getX(r+2);e.setX(r,a),e.setX(r+2,o)}else for(var s in n)for(var l=n[s],c=l.itemSize,u=0,h=l.count;u<h;u+=3)for(var p=0;p<c;p++){var d=l.getComponent(u,p),f=l.getComponent(u+2,p);l.setComponent(u,p,f),l.setComponent(u+2,p,d)}}(e),e};var Nf="\n\n// A stack of uint32 indices can can store the indices for\n// a perfectly balanced tree with a depth up to 31. Lower stack\n// depth gets higher performance.\n//\n// However not all trees are balanced. Best value to set this to\n// is the trees max depth.\n#ifndef BVH_STACK_DEPTH\n#define BVH_STACK_DEPTH 60\n#endif\n\n#ifndef INFINITY\n#define INFINITY 1e20\n#endif\n\n// Utilities\nuvec4 uTexelFetch1D( usampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nivec4 iTexelFetch1D( isampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 texelFetch1D( sampler2D tex, uint index ) {\n\n\tuint width = uint( textureSize( tex, 0 ).x );\n\tuvec2 uv;\n\tuv.x = index % width;\n\tuv.y = index / width;\n\n\treturn texelFetch( tex, ivec2( uv ), 0 );\n\n}\n\nvec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {\n\n\treturn\n\t\tbarycoord.x * texelFetch1D( tex, faceIndices.x ) +\n\t\tbarycoord.y * texelFetch1D( tex, faceIndices.y ) +\n\t\tbarycoord.z * texelFetch1D( tex, faceIndices.z );\n\n}\n\nvoid ndcToCameraRay(\n\tvec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,\n\tout vec3 rayOrigin, out vec3 rayDirection\n) {\n\n\t// get camera look direction and near plane for camera clipping\n\tvec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );\n\tvec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );\n\tfloat near = abs( nearVector.z / nearVector.w );\n\n\t// get the camera direction and position from camera matrices\n\tvec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );\n\tdirection /= direction.w;\n\tdirection = cameraWorld * direction - origin;\n\n\t// slide the origin along the ray until it sits at the near clip plane position\n\torigin.xyz += direction.xyz * near / dot( direction, lookDirection );\n\n\trayOrigin = origin.xyz;\n\trayDirection = direction.xyz;\n\n}\n",Rf="\n\nfloat dot2( vec3 v ) {\n\n\treturn dot( v, v );\n\n}\n\n// https://www.shadertoy.com/view/ttfGWl\nvec3 closestPointToTriangle( vec3 p, vec3 v0, vec3 v1, vec3 v2, out vec3 barycoord ) {\n\n    vec3 v10 = v1 - v0;\n    vec3 v21 = v2 - v1;\n    vec3 v02 = v0 - v2;\n\n\tvec3 p0 = p - v0;\n\tvec3 p1 = p - v1;\n\tvec3 p2 = p - v2;\n\n    vec3 nor = cross( v10, v02 );\n\n    // method 2, in barycentric space\n    vec3  q = cross( nor, p0 );\n    float d = 1.0 / dot2( nor );\n    float u = d * dot( q, v02 );\n    float v = d * dot( q, v10 );\n    float w = 1.0 - u - v;\n\n\tif( u < 0.0 ) {\n\n\t\tw = clamp( dot( p2, v02 ) / dot2( v02 ), 0.0, 1.0 );\n\t\tu = 0.0;\n\t\tv = 1.0 - w;\n\n\t} else if( v < 0.0 ) {\n\n\t\tu = clamp( dot( p0, v10 ) / dot2( v10 ), 0.0, 1.0 );\n\t\tv = 0.0;\n\t\tw = 1.0 - u;\n\n\t} else if( w < 0.0 ) {\n\n\t\tv = clamp( dot( p1, v21 ) / dot2( v21 ), 0.0, 1.0 );\n\t\tw = 0.0;\n\t\tu = 1.0-v;\n\n\t}\n\n\tbarycoord = vec3( u, v, w );\n    return u * v1 + v * v2 + w * v0;\n\n}\n\nfloat distanceToTriangles(\n\t// geometry info and triangle range\n\tsampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,\n\n\t// point and cut off range\n\tvec3 point, float closestDistanceSquared,\n\n\t// outputs\n\tinout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord, inout float side, inout vec3 outPoint\n) {\n\n\tbool found = false;\n\tvec3 localBarycoord;\n\tfor ( uint i = offset, l = offset + count; i < l; i ++ ) {\n\n\t\tuvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;\n\t\tvec3 a = texelFetch1D( positionAttr, indices.x ).rgb;\n\t\tvec3 b = texelFetch1D( positionAttr, indices.y ).rgb;\n\t\tvec3 c = texelFetch1D( positionAttr, indices.z ).rgb;\n\n\t\t// get the closest point and barycoord\n\t\tvec3 closestPoint = closestPointToTriangle( point, a, b, c, localBarycoord );\n\t\tvec3 delta = point - closestPoint;\n\t\tfloat sqDist = dot2( delta );\n\t\tif ( sqDist < closestDistanceSquared ) {\n\n\t\t\t// set the output results\n\t\t\tclosestDistanceSquared = sqDist;\n\t\t\tfaceIndices = uvec4( indices.xyz, i );\n\t\t\tfaceNormal = normalize( cross( a - b, b - c ) );\n\t\t\tbarycoord = localBarycoord;\n\t\t\toutPoint = closestPoint;\n\t\t\tside = sign( dot( faceNormal, delta ) );\n\n\t\t}\n\n\t}\n\n\treturn closestDistanceSquared;\n\n}\n\nfloat distanceSqToBounds( vec3 point, vec3 boundsMin, vec3 boundsMax ) {\n\n\tvec3 clampedPoint = clamp( point, boundsMin, boundsMax );\n\tvec3 delta = point - clampedPoint;\n\treturn dot( delta, delta );\n\n}\n\nfloat distanceSqToBVHNodeBoundsPoint( vec3 point, sampler2D bvhBounds, uint currNodeIndex ) {\n\n\tuint cni2 = currNodeIndex * 2u;\n\tvec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;\n\tvec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;\n\treturn distanceSqToBounds( point, boundsMin, boundsMax );\n\n}\n\n// use a macro to hide the fact that we need to expand the struct into separate fields\n#define\tbvhClosestPointToPoint(\t\tbvh,\t\tpoint, faceIndices, faceNormal, barycoord, side, outPoint\t)\t_bvhClosestPointToPoint(\t\tbvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,\t\tpoint, faceIndices, faceNormal, barycoord, side, outPoint\t)\n\nfloat _bvhClosestPointToPoint(\n\t// bvh info\n\tsampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,\n\n\t// point to check\n\tvec3 point,\n\n\t// output variables\n\tinout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout vec3 outPoint\n ) {\n\n\t// stack needs to be twice as long as the deepest tree we expect because\n\t// we push both the left and right child onto the stack every traversal\n\tint ptr = 0;\n\tuint stack[ BVH_STACK_DEPTH ];\n\tstack[ 0 ] = 0u;\n\n\tfloat closestDistanceSquared = pow( 100000.0, 2.0 );\n\tbool found = false;\n\twhile ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {\n\n\t\tuint currNodeIndex = stack[ ptr ];\n\t\tptr --;\n\n\t\t// check if we intersect the current bounds\n\t\tfloat boundsHitDistance = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, currNodeIndex );\n\t\tif ( boundsHitDistance > closestDistanceSquared ) {\n\n\t\t\tcontinue;\n\n\t\t}\n\n\t\tuvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;\n\t\tbool isLeaf = bool( boundsInfo.x & 0xffff0000u );\n\t\tif ( isLeaf ) {\n\n\t\t\tuint count = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint offset = boundsInfo.y;\n\t\t\tclosestDistanceSquared = distanceToTriangles(\n\t\t\t\tbvh_position, bvh_index, offset, count, point, closestDistanceSquared,\n\n\t\t\t\t// outputs\n\t\t\t\tfaceIndices, faceNormal, barycoord, side, outPoint\n\t\t\t);\n\n\t\t} else {\n\n\t\t\tuint leftIndex = currNodeIndex + 1u;\n\t\t\tuint splitAxis = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint rightIndex = boundsInfo.y;\n\t\t\tbool leftToRight = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, leftIndex ) < distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, rightIndex );//rayDirection[ splitAxis ] >= 0.0;\n\t\t\tuint c1 = leftToRight ? leftIndex : rightIndex;\n\t\t\tuint c2 = leftToRight ? rightIndex : leftIndex;\n\n\t\t\t// set c2 in the stack so we traverse it later. We need to keep track of a pointer in\n\t\t\t// the stack while we traverse. The second pointer added is the one that will be\n\t\t\t// traversed first\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c2;\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c1;\n\n\t\t}\n\n\t}\n\n\treturn sqrt( closestDistanceSquared );\n\n}\n",If="\n\n#ifndef TRI_INTERSECT_EPSILON\n#define TRI_INTERSECT_EPSILON 1e-5\n#endif\n\n// Raycasting\nbool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {\n\n\t// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/\n\t// https://tavianator.com/2011/ray_box.html\n\tvec3 invDir = 1.0 / rayDirection;\n\n\t// find intersection distances for each plane\n\tvec3 tMinPlane = invDir * ( boundsMin - rayOrigin );\n\tvec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );\n\n\t// get the min and max distances from each intersection\n\tvec3 tMinHit = min( tMaxPlane, tMinPlane );\n\tvec3 tMaxHit = max( tMaxPlane, tMinPlane );\n\n\t// get the furthest hit distance\n\tvec2 t = max( tMinHit.xx, tMinHit.yz );\n\tfloat t0 = max( t.x, t.y );\n\n\t// get the minimum hit distance\n\tt = min( tMaxHit.xx, tMaxHit.yz );\n\tfloat t1 = min( t.x, t.y );\n\n\t// set distance to 0.0 if the ray starts inside the box\n\tdist = max( t0, 0.0 );\n\n\treturn t1 >= dist;\n\n}\n\nbool intersectsTriangle(\n\tvec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,\n\tout vec3 barycoord, out vec3 norm, out float dist, out float side\n) {\n\n\t// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d\n\tvec3 edge1 = b - a;\n\tvec3 edge2 = c - a;\n\tnorm = cross( edge1, edge2 );\n\n\tfloat det = - dot( rayDirection, norm );\n\tfloat invdet = 1.0 / det;\n\n\tvec3 AO = rayOrigin - a;\n\tvec3 DAO = cross( AO, rayDirection );\n\n\tvec4 uvt;\n\tuvt.x = dot( edge2, DAO ) * invdet;\n\tuvt.y = - dot( edge1, DAO ) * invdet;\n\tuvt.z = dot( AO, norm ) * invdet;\n\tuvt.w = 1.0 - uvt.x - uvt.y;\n\n\t// set the hit information\n\tbarycoord = uvt.wxy; // arranged in A, B, C order\n\tdist = uvt.z;\n\tside = sign( det );\n\tnorm = side * normalize( norm );\n\n\t// add an epsilon to avoid misses between triangles\n\tuvt += vec4( TRI_INTERSECT_EPSILON );\n\n\treturn all( greaterThanEqual( uvt, vec4( 0.0 ) ) );\n\n}\n\nbool intersectTriangles(\n\t// geometry info and triangle range\n\tsampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,\n\n\t// ray\n\tvec3 rayOrigin, vec3 rayDirection,\n\n\t// outputs\n\tinout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout float dist\n) {\n\n\tbool found = false;\n\tvec3 localBarycoord, localNormal;\n\tfloat localDist, localSide;\n\tfor ( uint i = offset, l = offset + count; i < l; i ++ ) {\n\n\t\tuvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;\n\t\tvec3 a = texelFetch1D( positionAttr, indices.x ).rgb;\n\t\tvec3 b = texelFetch1D( positionAttr, indices.y ).rgb;\n\t\tvec3 c = texelFetch1D( positionAttr, indices.z ).rgb;\n\n\t\tif (\n\t\t\tintersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )\n\t\t\t&& localDist < minDistance\n\t\t) {\n\n\t\t\tfound = true;\n\t\t\tminDistance = localDist;\n\n\t\t\tfaceIndices = uvec4( indices.xyz, i );\n\t\t\tfaceNormal = localNormal;\n\n\t\t\tside = localSide;\n\t\t\tbarycoord = localBarycoord;\n\t\t\tdist = localDist;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n\nbool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {\n\n\tuint cni2 = currNodeIndex * 2u;\n\tvec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;\n\tvec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;\n\treturn intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );\n\n}\n\n// use a macro to hide the fact that we need to expand the struct into separate fields\n#define\tbvhIntersectFirstHit(\t\tbvh,\t\trayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\t)\t_bvhIntersectFirstHit(\t\tbvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,\t\trayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\t)\n\nbool _bvhIntersectFirstHit(\n\t// bvh info\n\tsampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,\n\n\t// ray\n\tvec3 rayOrigin, vec3 rayDirection,\n\n\t// output variables split into separate variables due to output precision\n\tinout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,\n\tinout float side, inout float dist\n) {\n\n\t// stack needs to be twice as long as the deepest tree we expect because\n\t// we push both the left and right child onto the stack every traversal\n\tint ptr = 0;\n\tuint stack[ BVH_STACK_DEPTH ];\n\tstack[ 0 ] = 0u;\n\n\tfloat triangleDistance = INFINITY;\n\tbool found = false;\n\twhile ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {\n\n\t\tuint currNodeIndex = stack[ ptr ];\n\t\tptr --;\n\n\t\t// check if we intersect the current bounds\n\t\tfloat boundsHitDistance;\n\t\tif (\n\t\t\t! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )\n\t\t\t|| boundsHitDistance > triangleDistance\n\t\t) {\n\n\t\t\tcontinue;\n\n\t\t}\n\n\t\tuvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;\n\t\tbool isLeaf = bool( boundsInfo.x & 0xffff0000u );\n\n\t\tif ( isLeaf ) {\n\n\t\t\tuint count = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint offset = boundsInfo.y;\n\n\t\t\tfound = intersectTriangles(\n\t\t\t\tbvh_position, bvh_index, offset, count,\n\t\t\t\trayOrigin, rayDirection, triangleDistance,\n\t\t\t\tfaceIndices, faceNormal, barycoord, side, dist\n\t\t\t) || found;\n\n\t\t} else {\n\n\t\t\tuint leftIndex = currNodeIndex + 1u;\n\t\t\tuint splitAxis = boundsInfo.x & 0x0000ffffu;\n\t\t\tuint rightIndex = boundsInfo.y;\n\n\t\t\tbool leftToRight = rayDirection[ splitAxis ] >= 0.0;\n\t\t\tuint c1 = leftToRight ? leftIndex : rightIndex;\n\t\t\tuint c2 = leftToRight ? rightIndex : leftIndex;\n\n\t\t\t// set c2 in the stack so we traverse it later. We need to keep track of a pointer in\n\t\t\t// the stack while we traverse. The second pointer added is the one that will be\n\t\t\t// traversed first\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c2;\n\n\t\t\tptr ++;\n\t\t\tstack[ ptr ] = c1;\n\n\t\t}\n\n\t}\n\n\treturn found;\n\n}\n",Uf="\nstruct BVH {\n\n\tusampler2D index;\n\tsampler2D position;\n\n\tsampler2D bvhBounds;\n\tusampler2D bvhContents;\n\n};\n",Bf={AVERAGE:1,BVHShaderGLSL:Object.freeze({__proto__:null,bvh_distance_functions:Rf,bvh_ray_functions:If,bvh_struct_definitions:Uf,common_functions:Nf}),CENTER:0,CONTAINED:2,ExtendedTriangle:np,FloatVertexAttributeTexture:df,INTERSECTED:1,IntVertexAttributeTexture:pf,MeshBVH:Hd,MeshBVHHelper:Vd,MeshBVHUniformStruct:ff,NOT_INTERSECTED:0,OrientedBox:cp,SAH:2,StaticGeometryGenerator:Pf,UIntVertexAttributeTexture:hf,VertexAttributeTexture:uf,acceleratedRaycast:function(t,e){this.isBatchedMesh?sf.call(this,t,e):lf.call(this,t,e)},computeBatchedBoundsTree:function(t,e){if(void 0===t&&(t=-1),void 0===e&&(e={}),!Kd)throw new Error("BatchedMesh: Three r166+ is required to compute bounds trees.");e.indirect,e=Object.assign({},e,{indirect:!1,range:null});var n=this._drawRanges,r=this._geometryCount;this.boundsTrees||(this.boundsTrees=new Array(r).fill(null));for(var i=this.boundsTrees;i.length<r;)i.push(null);if(t<0){for(var o=0;o<r;o++)e.range=n[o],i[o]=new Hd(this.geometry,e);return i}return t<n.length&&(e.range=n[t],i[t]=new Hd(this.geometry,e)),i[t]||null},computeBoundsTree:function(t){return void 0===t&&(t={}),this.boundsTree=new Hd(this,t),this.boundsTree},disposeBatchedBoundsTree:function(t){void 0===t&&(t=-1),t<0?this.boundsTrees.fill(null):t<this.boundsTree.length&&(this.boundsTrees[t]=null)},disposeBoundsTree:function(){this.boundsTree=null},estimateMemoryInBytes:function(t){for(var e=new Set,n=[t],r=0;n.length;){var i=n.pop();if(!e.has(i))for(var o in e.add(i),i)if(Object.hasOwn(i,o)){r+=Zd(o);var a=i[o];!a||"object"!=typeof a&&"function"!=typeof a?r+=Zd(a):/(Uint|Int|Float)(8|16|32)Array/.test(a.constructor.name)||Sd()&&a instanceof SharedArrayBuffer||a instanceof ArrayBuffer?r+=a.byteLength:n.push(a)}}return r},getBVHExtremes:function(t){return t._roots.map((function(e,n){return function(t,e){var n={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return t.traverse((function(t,e,r,i,o){var a=r[3]-r[0],s=r[4]-r[1],l=r[5]-r[2],c=2*(a*s+s*l+l*a);n.nodeCount++,e?(n.leafNodeCount++,n.depth.min=Math.min(t,n.depth.min),n.depth.max=Math.max(t,n.depth.max),n.tris.min=Math.min(o,n.tris.min),n.tris.max=Math.max(o,n.tris.max),n.surfaceAreaScore+=1.25*c*o):(n.splits[i]++,n.surfaceAreaScore+=1*c)}),e),n.tris.min===1/0&&(n.tris.min=0,n.tris.max=0),n.depth.min===1/0&&(n.depth.min=0,n.depth.max=0),n}(t,n)}))},getJSONStructure:function(t){var e=[];return t.traverse((function(t,n,r,i,o){var a={bounds:dh(0,r,new Du)};n?(a.count=o,a.offset=i):(a.left=null,a.right=null),e[t]=a;var s=e[t-1];s&&(null===s.left?s.left=a:s.right=a)})),e[0]},getTriangleHitPointInfo:function(t,e,n,r){var i=e.getIndex().array,o=e.getAttribute("position"),a=e.getAttribute("uv"),s=i[3*n],l=i[3*n+1],c=i[3*n+2];Np.fromBufferAttribute(o,s),Rp.fromBufferAttribute(o,l),Ip.fromBufferAttribute(o,c);for(var u=0,h=e.groups,p=3*n,d=0,f=h.length;d<f;d++){var m=h[d],v=m.start,g=m.count;if(p>=v&&p<v+g){u=m.materialIndex;break}}var y=null;return a&&(Up.fromBufferAttribute(a,s),Bp.fromBufferAttribute(a,l),Fp.fromBufferAttribute(a,c),y=r&&r.uv?r.uv:new Mu,Ou.getInterpolation(t,Np,Rp,Ip,Up,Bp,Fp,y)),r?(r.face||(r.face={}),r.face.a=s,r.face.b=l,r.face.c=c,r.face.materialIndex=u,r.face.normal||(r.face.normal=new bu),Ou.getNormal(Np,Rp,Ip,r.face.normal),y&&(r.uv=y),r):{face:{a:s,b:l,c:c,materialIndex:u,normal:Ou.getNormal(Np,Rp,Ip,new bu)},uv:y}},shaderDistanceFunction:Rf,shaderIntersectFunction:"\n\t"+Nf+"\n\t"+If+"\n",shaderStructs:Uf,validateBounds:function(t){var e=t.geometry,n=[],r=e.index,i=e.getAttribute("position"),o=!0;return t.traverse((function(e,a,s,l,c){var u={depth:e,isLeaf:a,boundingData:s,offset:l,count:c};n[e]=u,dh(0,s,jd);var h=n[e-1];if(a)for(var p=l,d=l+c;p<d;p++){var f=t.resolveTriangleIndex(p),m=3*f,v=3*f+1,g=3*f+2;r&&(m=r.getX(m),v=r.getX(v),g=r.getX(g));var y=void 0;Xd.fromBufferAttribute(i,m),y=jd.containsPoint(Xd),Xd.fromBufferAttribute(i,v),y=y&&jd.containsPoint(Xd),Xd.fromBufferAttribute(i,g),y=y&&jd.containsPoint(Xd),o=o&&y}if(h){dh(0,s,Yd);var _=Yd.containsBox(jd);o=o&&_}})),o}},Ff=new L.MeshBasicMaterial({transparent:!0,polygonOffset:!0,color:0,opacity:.6,polygonOffsetFactor:-1,polygonOffsetUnits:-1}),Hf=[[1,5,0,4],[2,6,3,7],[0,4,3,7],[4,5,7,6],[5,1,6,2],[1,0,2,3]],kf=function(t){function e(e){t.call(this),this.matrixAutoUpdate=!1,this.name=""+e.name,this.layers.set(ve.COLLIDER),this.geometry=e.geometry,this.material=Ff,this.colliderPlanes=[],this.setUserData("type","chunk.collider"),this.setUserData("floor_index",e.floor),this.setUserData("chunk_type",e.chunk_type),this.setUserData("chunk_name",e.chunk_name),this.init()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){},e.prototype.hide=function(){this.visible=!1},e.prototype.show=function(){this.visible=!0},e.prototype.setUserData=function(t,e){this.userData[t]=e},e.prototype.setOpacity=function(t){this.material.opacity=t},e.prototype.showBoxHelper=function(t){var e=k.getCore();this.boxHelper&&(e.sceneRender.remove(this.boxHelper),this.box3Helper=null),this.boxHelper=new L.BoxHelper(this,t),e.sceneRender.add(this.boxHelper)},e.prototype.hideBoxHelper=function(){var t=k.getCore();this.boxHelper&&(t.sceneRender.remove(this.boxHelper),this.boxHelper=null)},e.prototype.showBox3Helper=function(t){var e=k.getCore();this.box3Helper&&(e.sceneRender.remove(this.box3Helper),this.box3Helper=null);var n=(new L.Box3).copy(this.geometry.boundingBox).applyMatrix4(this.matrixWorld);this.box3Helper=new L.Box3Helper(n,t),e.sceneRender.add(this.box3Helper)},e.prototype.showBvhHelper=function(){var t=k.getCore(),e=this.userData.bvh;this.bvhHelper&&(t.sceneRender.remove(this.bvhHelper),this.bvhHelper=null),e&&(this.bvhHelper=new Bf.MeshBVHHelper(this.clone(),e),t.sceneRender.add(this.bvhHelper))},e.prototype.getFaceCount=function(){return L.BufferGeometryUtils.mergeVertices(this.geometry).getIndex().count/3},e.prototype.getBoxCenter=function(){return this.geometry.boundingBox.getCenter(new L.Vector3)},e.prototype.getBoxWpVertices=function(){var t=this.boxHelper.geometry.getAttribute("position").array,e=[];this.getBoxCenter();for(var n=0;n<t.length;n+=3){var r=new L.Vector3(t[n],t[n+1],t[n+2]);e.push(r)}return e},e.prototype.buildColliderPlane=function(){var t=this,e=new L.MeshBasicMaterial({transparent:!0,side:L.DoubleSide,color:13421772,opacity:.5}),n=this.getBoxWpVertices();Hf.forEach((function(r,i){var o,a=new L.BufferGeometry,s=n[r[0]],l=n[r[1]],c=n[r[2]],u=n[r[3]],h=[s.x,s.y,s.z],p=[l.x,l.y,l.z],d=[c.x,c.y,c.z],f=[u.x,u.y,u.z];o=h.concat(d,p,d,f,p),a.setAttribute("position",new L.BufferAttribute(new Float32Array(o),3));var m=new L.Mesh(a,e);m.name="collider.plane."+i,m.visible=!1,t.colliderPlanes.push(m),t.add(m)}))},e.prototype.clearCache=function(){var t=this.name+" clear cache";this.isClearCache?n.error(t+" failure, clean cache!")():(this.isClearCache=!0,this.material.dispose(),this.geometry.dispose())},e.prototype.clear=function(){},e.prototype.destroy=function(){var t=this.name+" destroy";this.clearCache(),this.clear(),F.setItem("collider:"+t,!0)()},e}(L.Mesh),zf=function(t,e,n){void 0===t&&(t=3),this.name="collider.builder",this.modelId=n,this.floorIndex=e,this.chunksize=t,this.chunks=Object.create(null),this.boundingBoxes=Object.create(null)};zf.prototype.add=function(t,e){this.name;var n,r,i,o,a,s,l,c,u=t.geometry,h=t.name,p=t.userData.type,d=new L.Vector3;n=u.getAttribute("position").array;for(var f=0,m=(r=u.getIndex().array).length;f<m;f+=3){var v=3*r[f+0],g=3*r[f+1],y=3*r[f+2];i=(n[v]+n[g]+n[y])/3,o=(n[v+1]+n[g+1]+n[y+1])/3,a=(n[v+2]+n[g+2]+n[y+2])/3,(s=Math.floor(i/this.chunksize)+"."+Math.floor(o/this.chunksize)+"."+Math.floor(a/this.chunksize))in this.chunks?(c=this.chunks[s].vertices,l=this.boundingBoxes[s]):(this.chunks[s]=Object.create(null),this.chunks[s].type=p,this.chunks[s].name=h,c=this.chunks[s].vertices=[],l=this.boundingBoxes[s]=new L.Box3),c.push(n[v],n[v+1],n[v+2],n[g],n[g+1],n[g+2],n[y],n[y+1],n[y+2]),l.expandByPoint(d.set(n[v],n[v+1],n[v+2])),l.expandByPoint(d.set(n[g],n[g+1],n[g+2])),l.expandByPoint(d.set(n[y],n[y+1],n[y+2]))}},zf.prototype.build=function(){this.name;var t=k.getCore().modelManager.getModel(this.modelId),e=new L.Object3D;for(var n in e.name="collider",this.chunks){var r=this.chunks[n],i=new L.BufferGeometry,o=new Float32Array(r.vertices),a=new L.BufferAttribute(o,3);"118"==L.REVISION&&i.setAttribute("position",a),"130"==L.REVISION&&i.setAttribute("position",a),i.boundingBox=this.boundingBoxes[n];var s=new kf({name:n,geometry:i,floor:this.floorIndex,chunk_type:r.type,chunk_name:r.name});if(100<=s.getFaceCount()){var l=i.clone().applyMatrix4(t.poseMatrix),c=new Bf.MeshBVH(l,{strategy:0,maxDepth:32});s.userData.bvh=c,l.dispose()}e.add(s),this.chunks[n]=[]}return e};var Gf=null,Wf=null,Vf=function(t){function e(e,n){t.call(this),Gf=k.getCore(),this.matrixAutoUpdate=!1,this.name="floor_"+n,this.modelId=e,this.floorIndex=1*n,this.panos=[],this.chunks=[],this.markers=[],this.collider=null,this.planeCollider=new L.Group,this.planeCollider.name="plane.collider",this.planeCollider.visible=!1,this.center=null,this.size=null,this.boundingBox=new L.Box3,this.conservativeBoundingBox=new L.Box3,this.enabled=!0,this.colliderBuilder=new zf(9,n,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.enter=function(t,e){this.name,Gf.modelManager.getModel(this.modelId).setFloor(this,t)},e.prototype.hide=function(){this.visible=!1},e.prototype.show=function(){this.visible=!0},e.prototype.enable=function(){var t=this.name+" enable";!0!==this.enabled?(this.enabled=!0,Gf.modelManager.getModel(this.modelId).onFloorEnabled()):n.warn(t+" failure, reason: already enabled!")()},e.prototype.disable=function(){var t=this.name+" enable";!1!==this.enabled?(this.enabled=!1,Gf.modelManager.getModel(this.modelId).onFloorDisabled()):n.warn(t+" failure, reason: already disabled!")()},e.prototype.setOpacity=function(t,e){var n=this.name+" set opacity";this.chunks.forEach((function(e){return e.setOpacity(t,n)}))},e.prototype.containsPoint=function(t){return this.collider.children.some((function(e){return e.geometry.boundingBox||e.geometry.computeBoundingBox(),e.geometry.boundingBox.containsPoint(t)}))},e.prototype.containsPoint2=function(t){return this.boundingBox.containsPoint(t)},e.prototype.distanceToPoint=function(t){var e=null,n=1/0;return this.collider.children.forEach((function(r){r.geometry.boundingBox||r.geometry.computeBoundingBox();var i=r.geometry.boundingBox.distanceToPoint(t);(!e||n>i)&&(n=i,e=r)})),n},e.prototype.addChunk=function(t){this.name;var e=Gf.modelManager.getModel(this.modelId);if(this.add(t),this.chunks.push(t),"surrounding_model"!==t.userData.type){var r=(new L.Box3).copy(t.geometry.boundingBox);r.applyMatrix4(e.poseMatrix),this.boundingBox.union(r)}this.boundingBox.getSize?this.size=this.boundingBox.getSize(new L.Vector3):this.size=this.boundingBox.size(),Wf&&Wf[this.modelId]["f_"+this.floorIndex]?n.error("collider builder already add "+t.name+"!")():this.colliderBuilder.add(t,this.floorIndex)},e.prototype.addPano=function(t){var e=this.name+" add pano failure";if(t){this.panos.push(t);var r=t.marker;r?this.markers.push(r):n.error(this.name+" add pano marker failure, reason: invalid pano.marker")()}else n.error(e+", reason: invalid pano")()},e.prototype.build=function(t){n.info("%c"+this.name+" build","color:#0f0;")(),(Wf=t)&&Wf[this.modelId]["f_"+this.floorIndex]?this.collider=Wf[this.modelId]["f_"+this.floorIndex]:this.collider=this.colliderBuilder.build(),this.add(this.collider),this.add(this.planeCollider),this.boundingBox.getCenter?this.center=this.boundingBox.getCenter(new L.Vector3):this.center=this.boundingBox.center(),this.box3=new L.Box3,this.box3.setFromCenterAndSize(this.center,this.size),this.conservativeBoundingBox.copy(this.boundingBox),this.colliderBuilder=null,this.addBoxHelper(),this.createPlaneColliders()},e.prototype.dealtConfigData=function(t){n.debug(this.name+".dealtConfigData",t)()},e.prototype.computedBorder=function(){_n(this.center,this.boundingBox.min,255,"min"),_n(this.center,this.boundingBox.max,65280,"max")},e.prototype.addBoxHelper=function(){this.boxHelper=new L.Box3Helper(this.box3,16776960),this.boxHelper.name=this.name+".box3.helper",this.boxHelper.visible=!1,Gf.sceneRender.add(this.boxHelper)},e.prototype.removeBoxHelper=function(){Gf.sceneRender.remove(this.boxHelper),this.boxHelper.material.dispose(),this.boxHelper.geometry.dispose(),this.boxHelper=null},e.prototype.showBoxHelper=function(){this.boxHelper.visible=!0},e.prototype.hideBoxHelper=function(){this.boxHelper.visible=!1},e.prototype.getBoxTopWpVertices=function(){var t=this.getBoxWpVertices();return t.sort((function(t,e){return t.y-e.y})),[t[7],t[6],t[5],t[4]]},e.prototype.getBoxBottomWpVertices=function(){var t=this.getBoxWpVertices();return t.sort((function(t,e){return t.y-e.y})),[t[3],t[2],t[1],t[0]]},e.prototype.getBoxWpVertices=function(){this.boxHelper.updateMatrixWorld();for(var t=this.boxHelper.geometry.getAttribute("position").array,e=[],n=0;n<t.length;n+=3){var r=new L.Vector3(t[n],t[n+1],t[n+2]);r=this.boxHelper.localToWorld(r.clone()),e.push(r)}return e},e.prototype.createPlaneColliders=function(){var t=this,e=new L.MeshBasicMaterial({transparent:!0,color:13421772,side:L.DoubleSide,opacity:.5}),n=this.getBoxWpVertices();[[1,5,0,4],[2,6,3,7],[0,4,3,7],[4,5,7,6],[5,1,6,2],[1,0,2,3]].forEach((function(r,i){var o,a=new L.BufferGeometry,s=n[r[0]],l=n[r[1]],c=n[r[2]],u=n[r[3]],h=[s.x,s.y,s.z],p=[l.x,l.y,l.z],d=[c.x,c.y,c.z],f=[u.x,u.y,u.z];o=h.concat(d,p,d,f,p),a.setAttribute("position",new L.BufferAttribute(new Float32Array(o),3)),a.computeVertexNormals();var m=new L.Mesh(a,e);m.name="plane.collider."+i,t.planeCollider.add(m)}))},e.prototype.computeIntersectWithinPlaneCollider=function(t,e){var n=new L.Raycaster;n.set(t,e);var r=n.intersectObjects(this.planeCollider.children);if(r.length>0){var i=r[0];return{point:i.point,distance:i.distance}}},e.prototype.getValidColliders=function(){return this.collider.children},e.prototype.removeChunks=function(){var t=this.name+" remove chunks";F.setItem(""+t,!0)();for(var e=0,n=this.chunks.length;e<n;++e){var r=this.chunks[e];this.remove(r),r.destroy()}},e.prototype.removeCollider=function(){for(var t=this.collider.children.length-1;t>=0;--t){var e=this.collider.children[t];this.collider.remove(e),e.destroy()}this.remove(this.collider)},e.prototype.destroy=function(){var t=this.name+" destroy";F.setItem(""+t,!0)(),this.removeChunks(),this.removeCollider(),this.removeBoxHelper()},e}(L.Object3D),jf=function(){var t=this;this.list=[],this.index={},Object.defineProperty(this,"length",{get:function(){return t.list.length}})};jf.prototype.forEach=function(t){this.list.forEach(t)},jf.prototype.add=function(t){this.list.push(t),this.index[this.getIndex(t)]=t},jf.prototype.getIndex=function(t){},jf.prototype.extend=function(t){for(var e=0,n=t.length;e<n;e++)this.add(t[e])},jf.prototype.get=function(t){return this.index[t]},jf.prototype.first=function(){return this.list[0]},jf.prototype.last=function(){return this.list[this.list.length-1]},jf.prototype.reIndex=function(){var t=this;this.index={},this.forEach((function(e){t.index[t.getIndex(e)]=e}))},jf.prototype.filter=function(t){var e=this.list.filter(t);return this.reIndex(),e},jf.prototype.reduce=function(t,e){return this.list.reduce(t,e)},jf.prototype.sort=function(t){return this.list.sort(t)},jf.prototype.indexOf=function(t){for(var e=0;e<this.list.length;++e)if(this.list[e]===t)return e;return-1},jf.prototype.getLength=function(){return this.list.length};var Yf=null,Xf=function(t){function e(e){t.call(this),Yf=k.getCore(),this.name="FloorCollection",this.modelId=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.add=function(e){n.debug("%c"+this.name+" add","color:cyan;",e)(),t.prototype.add.call(this,e),Yf.modelManager.getModel(this.modelId).add(e)},e.prototype.getIndex=function(t){return t.floorIndex},e.prototype.build=function(){this.list.forEach((function(t){t.build()}))},e.prototype.size=function(){return this.length},e.prototype.sort=function(){t.prototype.sort.call(this,(function(t,e){return t.floorIndex-e.floorIndex}))},e.prototype.nextFloor=function(t,e){return this.index[t.floorIndex+e]||null},e.prototype.getFloorAtPoint=function(t){for(var e=null,n=1/0,r=0;r<this.list.length;r++){var i=this.list[r],o=i.distanceToPoint(t);(null===e||n>o)&&(n=o,e=i)}return e},e.prototype.getOrMakeFloor=function(t){var e=this.index[t];if(!e){var n=new Vf(this.modelId,t);this.add(n),e=n}return e},e.prototype.hide=function(){this.list.forEach((function(t){t.hide()}))},e.prototype.show=function(){this.list.forEach((function(t){t.show()}))},e.prototype.parseFloor=function(t){var e=t.match(/block_([0-9]+)/);if(e&&0<e.length>0){var n=parseInt(e[1],10);return this.getFloorIdx(n)}return 0},e.prototype.getFloorIdx=function(t){for(var e=Yf.modelManager.getModel(this.modelId).data.building.blocks,n=e.length||0,r=0;r<n;++r){var i=e[r];if(t===1*i.blockidx)return i.flooridx}return 0},e.prototype.getOtherFloors=function(){},e}(jf),Zf=function(t){function e(e){t.call(this),this.name="PanoramaCollection",this.neighbourMap=Object.create(null),this.map=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getIndex=function(t){return t.id},e.prototype.find=function(t,e){var n=Et(this.list,t);if(0<n.length)return e&&e.forEach((function(t){n=_t(n,t)})),n[0]},e.prototype.sortByScore=function(t,e){var n=Et(this.list,t);return n.length>0?n=n.map((function(t){return{pano:t,score:e.reduce((function(e,n){return e+n(t)}),0)}})).sort((function(t,e){return e.score-t.score})):null},e.prototype.findRankedByScore=function(t,e,n,r){r&&(r.candidates=null,r.pano=null),t||(t=0);var i=this.sortByScore(e,n);return i&&0!==i.length&&t<i.length?(r&&(r.candidates=i,r.pano=i[t].pano),i[t].pano):null},e.prototype.getNeighbours=function(t){if(t)return this.neighbourMap[t.id];n.error("get neighbour failure, reason: invalid pano")()},e.prototype.setNeighbour=function(t,e,n){return this.neighbourMap[t.id]||(this.neighbourMap[t.id]=Object.create(null)),this.neighbourMap[e.id]||(this.neighbourMap[e.id]=Object.create(null)),this.neighbourMap[t.id][e.id]=n,this.neighbourMap[e.id][t.id]=n,this.neighbourMap[t.id]},e.prototype.update=function(t){this.forEach((function(e){e.update(t)}))},e}(jf),qf={alignmentType:0,enable:!1,visible:!0,straight_pano:!1,locationid:"",floor:0,neighbours:[],neighbours_visible:[],position:{x:0,y:0,z:0},quaternion:{x:0,y:0,z:0,w:1},spot:{x:0,y:0,z:0},scale:1,pic:""},Qf=function(t){this.rawData=t};Qf.prototype.getSweepData=function(){var t=this.rawData.map((function(t,e){var n=JSON.parse(JSON.stringify(qf));return n.alignmentType=t.type,n.enable=t.enable,n.visible=t.visible,n.straight_pano=t.straight_pano,n.locationid=t.location_id,n.floor=t.flooridx,n.neighbours=t.neighbour,n.neighbours_visible=t.neighbour_visible,n.position.x=t.viewpoint.x,n.position.y=t.viewpoint.y,n.position.z=t.viewpoint.z,n.quaternion.x=t.rotation.x,n.quaternion.y=t.rotation.y,n.quaternion.z=t.rotation.z,n.quaternion.w=t.rotation.w,n.spot.x=t.spot.x,n.spot.y=t.spot.y,n.spot.z=t.spot.z,n.scale=t.scale||1,n.pic=t.pic||"",n}));return t.map((function(t,e){if(!0===t.straight_pano){var n=new L.Euler;n.setFromQuaternion((new L.Quaternion).copy(t.quaternion),"YZX",!1),n.x=0,n.z=0;var r=(new L.Quaternion).setFromEuler(n,!1);t.quaternion.x=r.x,t.quaternion.y=r.y,t.quaternion.z=r.z,t.quaternion.w=r.w}return t.position=(new L.Vector3).copy(t.position),t.spot=(new L.Vector3).copy(t.spot),t.quaternion=(new L.Quaternion).copy(t.quaternion),t})),t.forEach((function(e,n){e.neighbours=e.neighbours.map((function(e){if(t[e])return t[e].locationid;alert("exist invalid waypoint, vps: "+e)})),e.neighbours_visible=e.neighbours_visible.map((function(e){if(t[e])return t[e].locationid;alert("exist invalid waypoint, neighbours_visible: "+e)}))})),t};var Kf=function(t){function e(e,n){t.call(this),k.getCore(),this.name="control.plane."+e,this.geometry=new L.PlaneGeometry(n,n),this.material=new L.MeshBasicMaterial({transparent:!0,depthWrite:!1,side:L.DoubleSide,color:255,opacity:.1})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e}(L.Mesh),Jf={};Jf[G.DOLLHOUSE]=1,Jf[G.PANORAMA]=0,Jf[G.FLOORPLAN]=1;var $f=null,tm=new hs("<add.chunk>"),em=function(t){function e(e){t.call(this),k.carrayModel(this),this.name="model-"+e.basic.model_id,this.matrixAutoUpdate=!1,this.data=e,this.modelid=e.basic.model_id,this.points=e.waypoints,this.sweepDatas=null,this.supportedModes=Object.create(null),this.supportedModes[G.PANORAMA]=!0,this.supportedModes[G.DOLLHOUSE]=!0,this.supportedModes[G.FLOORPLAN]=!0,this.supportedModes[G.TRANSITIONING]=!0,this.mode=G.DOLLHOUSE,this.size=null,this.center=null,this.boundingBox=new L.Box3,this.currentFloor=null,this.prevFloor=null,this.allFloorsVisible=!0,this.projectedPano0=null,this.projectedPano1=null,this.chunks=[],this.chunksMap=new Map,this.colliders=[],this.validColliders=[],this.validCollidersBox=[],this.panosNormal=[],this.floors=new Xf(this.modelid),this.panos=new Zf(this),this.disabledPanos=Object.create(null),this.skybox=null,this.chunksTextureUrl=[],this.chunksTextureUrlSign=Object.create(null),this.trickTools=new gu(this.modelid),this.destroyed=!1,this.controlPlanes=[],this.raycaster=new L.Raycaster,this.setUserData("type","model"),Object.defineProperties(this,{AlphaMap:{get:function(){return Jf}}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){$f=k.getCore(),this.initPose(),this.collectSweepPointsData(),this.createPanos()},e.prototype.initPose=function(){this.poseMatrix=new L.Matrix4,this.data.pose_matrix&&(this.poseMatrix.elements=this.data.pose_matrix),this.posePosition=new L.Vector3,this.poseQuaternion=new L.Quaternion,this.poseScale=new L.Vector3,this.poseMatrix.decompose(this.posePosition,this.poseQuaternion,this.poseScale),this.applyMatrix4(this.poseMatrix),this.matrixWorldNeedsUpdate=!0},e.prototype.load=function(t){var e=this;void 0===t&&(t=function(){}),n.info(this.name+" load")(),this.loadMesh((function(){e.loadMeshTextures((function(){e.build((function(){t()}))}))}))},e.prototype.setUserData=function(t,e){this.userData[t]=e},e.prototype.getUserData=function(t){return this.userData[t]},e.prototype.setProjectedPanos=function(t,e,r,i){n.info("%c"+this.name+" set projected panos, pano0: "+t.id+", pano1: "+e.id+", progress: "+r+", cmd: "+i,"color:cyan;")(),this.projectedPano0=t,this.projectedPano1=e,this.skybox&&this.skybox.material.setProjectedPanos(t,e,r,"skybox"),this.chunks.forEach((function(n){n.materialInside.setProjectedPanos(t,e,r,n.name)}))},e.prototype.updateProjectedPanos=function(){this.projectedPano0&&this.projectedPano1&&this.setProjectedPanos(this.projectedPano0,this.projectedPano1,!1,"update")},e.prototype.loadMesh=function(t){var e=this;void 0===t&&(t=function(){}),n.info("%cmodel load mesh","color:cyan;")(),uu.load({model_id:this.modelid,model_nest_url:this.data.basic.model_nest_url,model_texture_url:this.data.basic.model_texture_url},(function(n){e.chunks=n,tm.start(),e.addChunk((function(){tm.end(),e.floors.sort(),t(e)}))}))},e.prototype.addChunk=function(t){var e=this;this.name,this.chunks.forEach((function(t){!function(t){e.chunksMap.set(t.name,t);var n=1*e.floors.parseFloor(t.name);t.flooridx=n,e.floors.getOrMakeFloor(n).addChunk(t);var r=e.data.basic.model_texture_url,i=t.getUserData("mesh_texture_name"),o=""+r+i;1!==e.chunksTextureUrlSign[i]&&(e.chunksTextureUrl.push({name:i,url:o}),e.chunksTextureUrlSign[i]=1)}(t)})),t()},e.prototype.loadMeshTextures=function(t){void 0===t&&(t=function(){}),n.info(this.name+" load mesh textures")(),fu((function(){t()}))},e.prototype.collectSweepPointsData=function(){n.info(this.name+" sweep points data")();var t=new Qf(this.points);this.sweepDatas=t.getSweepData()},e.prototype.getSweepPointBottomPosition=function(t){var e=Ot(this.sweepDatas,"locationid",t);return e?e.spot:null},e.prototype.getSweepPointTopPosition=function(t){var e=Ot(this.sweepDatas,"locationid",t);return e?e.position:null},e.prototype.getSweepPointPosition=function(t){var e=Ot(this.sweepDatas,"locationid",t),n=Object.create(null);return e?(n.bottom=e.spot,n.top=e.position,n):null},e.prototype.createPanos=function(){var t=this;n.info("%ccreate panos","color:cyan;")();var e=[];this.sweepDatas.forEach((function(n){n.origin_position=(new L.Vector3).copy(n.position),n.origin_quaternion=(new L.Quaternion).copy(n.quaternion),n.origin_spot=(new L.Vector3).copy(n.spot),n.position=(new L.Vector3).copy(n.position).applyMatrix4(t.poseMatrix),n.spot=(new L.Vector3).copy(n.spot).applyMatrix4(t.poseMatrix),n.quaternion=(new L.Quaternion).multiplyQuaternions(t.poseQuaternion,n.quaternion);var r=new Vi(n,t.modelid);t.panosNormal.push(r),e.push(r),n.enable||(t.disabledPanos[n.locationid]=r)})),this.panos.extend(e);for(var r=function(r){var i=e[r];i.neighbourUUIDs.forEach((function(e){var r=t.panos.get(e);r?t.panos.setNeighbour(i,r,!0):n.error("set neighbour failure, reason: invalid "+e)()})),i.neighbourPanos=t.panos.getNeighbours(i)||t.panos.setNeighbour(i,i,!0)},i=0;i<e.length;++i)r(i)},e.prototype.build=function(t){var e=this;void 0===t&&(t=function(){}),this.floors.build(),this.panosNormal.forEach((function(t){t.build()})),this.floors.forEach((function(t){e.boundingBox.union(t.boundingBox),t.show()})),this.boundingBox.getSize?this.size=this.boundingBox.getSize(new L.Vector3):this.size=this.boundingBox.size(),this.boundingBox.getCenter?this.center=this.boundingBox.getCenter(new L.Vector3):this.center=this.boundingBox.center(),this.createSkybox(),this.createControlPlane(),this.colliders=this.floors.reduce((function(t,e){return t.concat(e.collider.children)}),[]),this.updateValidColliders(),t()},e.prototype.onPanoEnter=function(t){var e=this.floors.get(t.floorIndex);e?this.currentFloor?e.floorIndex!==this.currentFloor.floorIndex&&this.setFloor(e):this.setFloor(e):n.error("on.pano.enter.failure, reason: invalid pano.floorIndex")()},e.prototype.onPanoExit=function(t){},e.prototype.createSkybox=function(){!0!==$f.pure3D&&(this.skybox=new Eu(this.modelid,this.boundingBox),this.skybox.matrixWorldNeedsUpdate=!0,$f.sceneRender.add(this.skybox))},e.prototype.createControlPlane=function(){var t=2*$f.sceneRender.camera.far,e=new Kf("XY",t),n=new Kf("XZ",t),r=new Kf("ZY",t);e.hide(),n.hide(),r.hide(),e.position.copy(this.center),n.position.copy(this.center),r.position.copy(this.center),e.rotateX(0),n.rotateX(Math.PI/2),r.rotateY(Math.PI/2),this.controlPlanes.push(e),this.controlPlanes.push(n),this.controlPlanes.push(r),this.add(e),this.add(n),this.add(r)},e.prototype.removeSkybox=function(){$f.sceneRender.remove(this.skybox,this.name+".skybox"),this.skybox.destroy(),this.skybox=null},e.prototype.removeControlPlane=function(){var t=this;this.controlPlanes.forEach((function(e){e.geometry.dispose(),e.material.dispose(),$f.sceneRender.remove(e,t.name+".control.plane")})),this.controlPlanes=[]},e.prototype.removeFloors=function(){var t=this;this.floors.forEach((function(e){t.remove(e),e.destroy()})),this.floors=null},e.prototype.removePanos=function(){this.panos.forEach((function(t){t.clear()}))},e.prototype.setFloor=function(t,e){this.currentFloor=t,this.prevFloor=null,Ht.modelStateEngine.state[li.modelEvents.Events.SWITCH_FLOOR_COMPLETE].data={prev_mode:e,current_mode:this.mode,current_floor:t.floorIndex},Ht.modelStateEngine.state[li.modelEvents.Events.SWITCH_FLOOR_COMPLETE].state=!0},e.prototype.switchFloor=function(t){var e=this.floors.get(t).panos,n=$f.player.currentPano,r=Object.create(null),i=[];e.forEach((function(t){if(t.enable){var e=n.position.distanceTo(t.position);r["distance_"+e]=t,i.push(e)}}));var o=Math.min.apply(Math,i),a=r["distance_"+o];a.currentQuaternion=n.currentQuaternion,ro(a,(function(){}))},e.prototype.enableFloor=function(t){this.floors.get(t).enable()},e.prototype.disableFloor=function(t){this.floors.get(t).disable()},e.prototype.setFloorOpacity=function(t,e){this.floors.get(t).setOpacity(e,this.name+" set floor opacity")},e.prototype.setOpacity=function(t){var e=this;this.floors.forEach((function(n){return n.setOpacity(t,e.name+" set opacity")}))},e.prototype.setChunksMaterialSide=function(t){n.info(this.name+" set chunks material side",t)(),this.chunks.forEach((function(e){e.material.side=t}))},e.prototype.setMode=function(t,e){switch(t){case G.TRANSITIONING:this.mode===G.PANORAMA&&(this.prevFloor=this.currentFloor,this.currentFloor=null)}this.mode=t,this.chunks.forEach((function(e){e.setMode(t)})),this.panos.forEach((function(e){e.setMode(t)}))},e.prototype.setAlpha=function(t){0>t||1<t?n.error("model setAlpha "+t+" invalid, not in [0, 1]")():this.chunks.forEach((function(e){e.setAlpha(t)}))},e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e.prototype.onFloorEnabled=function(){this.updateValidColliders()},e.prototype.onFloorDisabled=function(){this.updateValidColliders()},e.prototype.runChunksProgressAnimation=function(t,e){var n=this;void 0===e&&(e=function(){}),this.chunksProgressAnimation||(this.chunksProgressAnimation=new Nn.Tween({value:0}).to({value:1}).easing(Nn.Easing.Quadratic.InOut)),this.chunksProgressAnimation.duration(t).onUpdate((function(t){var e=t.value;n.setChunkProgress(e)})).onComplete((function(t){n.chunksProgressAnimation.stop(),e()})).start()},e.prototype.setChunkProgress=function(t,e){void 0===e&&(e=function(){}),this.chunks.forEach((function(e){e.setProgress(t)})),e()},e.prototype.runAlphaAnimation=function(t,e,n,r){var i=this;void 0===r&&(r=function(){});var o={value:t},a={value:e},s=new Nn.Tween(o).to(a,n).easing(Nn.Easing.Linear.None).delay(0).onUpdate((function(t){var e=t.value;i.setAlpha(e)})).onComplete((function(t){r(),s.stop()})).onStop((function(t){s=null})).start()},e.prototype.updateValidColliders=function(){var t=[],e=[];this.floors.forEach((function(e){!0===e.enabled&&(t=t.concat(e.collider.children))})),this.validColliders=t,this.validColliders.forEach((function(t){e.push(t.geometry.boundingBox)})),this.validCollidersBox=e},e.prototype.getValidColliders=function(){return this.validColliders},e.prototype.getValidCollidersBox=function(){return this.validCollidersBox},e.prototype.getValidCollidersBvh=function(){},e.prototype.getIntersectWithinControlPlane=function(){var t=this,e=$f.player.pointer,n=$f.player.control.camera;this.raycaster.setFromCamera(e,n);var r=this.raycaster.intersectObjects(this.controlPlanes),i=[];return r.forEach((function(e){var n=e.point,r=n.distanceTo(t.center);i.push({point:n,distance:r})})),i.sort((function(t,e){return t.distance-e.distance})),i[0].point},e.prototype.clear=function(){this.chunksTextureUrlSign=Object.create(null),this.disabledPanos=Object.create(null),this.chunksTextureUrl=[],this.chunks=[],this.colliders=[],this.panosNormal=[],this.points=[],this.validColliders=[],this.chunksMap.clear(),this.sweepDatas=null,this.projectedPano0=null,this.projectedPano1=null,this.currentFloor=null,this.panos=null},e.prototype.destroy=function(t){var e=this.name+" destroy";n.error("%c"+e+", cmd:"+t,"color:#f00;")(),this.destroyed=!0,F.setItem(""+e,!0)(),this.removeControlPlane(),this.removeSkybox(),this.removeFloors(),this.removePanos(),this.clear()},e}(L.Object3D),nm=null,rm=function(){nm=k.getCore(),this.name="ModelManager",this.modelMap=new Map};rm.prototype.init=function(){},rm.prototype.createModel=function(t){return new em(t)},rm.prototype.addModel=function(t){n.info(this.name+" add model")();var e=t.modelid;this.modelMap.set(e,t)},rm.prototype.getModel=function(t){return this.modelMap.get(t)},rm.prototype.removeModel=function(t){this.modelMap.delete(t)},rm.prototype.switchModel=function(t){if(!0!==Ht.modelStateEngine.state[li.modelEvents.Events.DISABLE_SWITCH_MODEL].state)if(!0!==Ht.modelStateEngine.state[li.modelEvents.Events.SWITCH_MODEL].state){Ht.modelStateEngine.state[li.modelEvents.Events.SWITCH_MODEL].state=!0;var e=t.data;nm.lifeCycle.onSwitchScene(e)}else n.warn("switch model failure, reason: switch model not complete!")();else n.warn("switch model failure, reason: disable switch model!")()},rm.prototype.clear=function(){F.setItem(this.name+".clear",!0)()};var im=null,om=null,am=new L.Vector3,sm=new L.Vector3;new L.Quaternion,new L.Quaternion;var lm=new L.Vector3;new L.Quaternion;var cm,um=70,hm=function(){},pm=function(){},dm={lon:0,lat:0},fm={lon:0,lat:0},mm=new L.Vector3,vm=new L.Vector3,gm=new Nn.Tween({value:0,fov:90,deg:0,lon:dm.lon,lat:dm.lat}).to({value:1,fov:um,deg:-180,lon:fm.lon,lat:fm.lat}).duration(2500).delay(0).easing(Nn.Easing.Quadratic.InOut).onStart((function(t){hm()})).onUpdate((function(t){om.setFov(t.fov),lm.copy(am).lerp(sm,t.value),om.setPosition(lm),im.player.control.updateCamera(t.lon,t.lat)})).onComplete((function(t){gm.stop(),pm()})),ym=function(t){im=k.getCore(),om=im.player.cameras.panorama,um=t.fov,am.copy(t.origin_position),sm.copy(t.target_position),hm=t.start,pm=t.complete,mm.copy(t.origin_lookat_target),vm.copy(t.target_lookat_target),dm=ke(mm,am),fm=ke(vm,sm),gm._valuesEnd.fov=um,gm._valuesStart.lon=dm.lon,gm._valuesStart.lat=dm.lat,gm._valuesEnd.lon=fm.lon,gm._valuesEnd.lat=fm.lat,gm.start()},_m=function(t){function e(e,n){var r=this;t.call(this),this.name="pure.pano.cube."+e,this.geometry=new L.BoxBufferGeometry(1,1,1),this.material=new L.MeshBasicMaterial({side:L.DoubleSide,transparent:!0,opacity:1}),we(n,(function(t){r.material.envMap=t,r.material.needsUpdate=!0}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(L.Mesh),Em=function(t){function e(e){t.call(this),k.getCore(),k.carrayModel(this),this.name="pure.pano."+e,this.panoId=e,this.geometry=new L.SphereBufferGeometry(100,128,64),this.geometry.scale(1,1,-1),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.material=new L.MeshBasicMaterial({transparent:!0,side:L.FrontSide}),this.setUserData("type","purepano"),this.isActiveAnimation=!1,this.entry_anima="fadein",this.entry_quaternion=new L.Quaternion,this.defaultOpacity=0,this.addCollider2()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e.prototype.setUserData=function(t,e){this.userData[t]=e},e.prototype.getUserData=function(t){return this.userData[t]},e.prototype.scaleScalar=function(t){this.scale.multiplyScalar(t)},e.prototype.setOpacity=function(t){this.material.opacity=t},e.prototype.setPosition=function(t){this.position.copy(t)},e.prototype.getPosition=function(){return this.position.clone()},e.prototype.addWireFrame=function(){Mn(this,16711680)},e.prototype.addCollider1=function(){var t=new L.CylinderBufferGeometry(4,4,100,32);t.scale(1,1,-1);var e=new L.MeshBasicMaterial({color:16776960,transparent:!0,opacity:.4}),n=new L.Mesh(t,e);n.position.copy(this.position),this.collider=n,this.add(n),Mn(n,16711680)},e.prototype.addCollider2=function(){var t=new L.SphereBufferGeometry(100,16,8);t.scale(1,1,-1),t.computeBoundingBox(),t.computeBoundingSphere();var e=new L.MeshBasicMaterial({color:16776960,transparent:!0,opacity:.1}),n=new L.Mesh(t,e);n.position.copy(this.position),n.visible=!1,this.collider=n},e.prototype.showCollider=function(){this.collider.visible=!0,this.add(this.collider),Mn(this.collider,16711680)},e.prototype.hideCollider=function(){this.collider.geometry.dispose(),this.collider.material.dispose(),this.collider.visible=!1,this.remove(this.collider)},e.prototype.getValidColliders=function(){return[this.collider]},e.prototype.setCubeRT=function(t){this.material.envMap=t.texture,this.material.needsUpdate=!0},e.prototype.fadeIn=function(){var t=this,e=this.name+" fade in";if(!0!==this.isActiveAnimation){this.isActiveAnimation=!0;var r=this.defaultOpacity,i=new Nn.Tween({opacity:r}).to({opacity:1}).duration(300).easing(Nn.Easing.Linear.None).onStart((function(r){n.time(""+e)(),t.onFadeInStart&&t.onFadeInStart()})).onUpdate((function(e){t.setOpacity(e.opacity)})).onComplete((function(e){i.stop(),t.onFadeInComplete&&t.onFadeInComplete()})).onStop((function(r){n.timeEnd(""+e)(),i=null,t.isActiveAnimation=!1})).start()}},e.prototype.fadeOut=function(){var t=this;if(!0!==this.isActiveAnimation){this.isActiveAnimation=!0;var e=this.defaultOpacity,n=new Nn.Tween({opacity:1}).to({opacity:e}).duration(500).easing(Nn.Easing.Linear.None).onStart((function(t){})).onUpdate((function(e){t.setOpacity(e.opacity)})).onComplete((function(e){n.stop(),t.onFadeOutComplete&&t.onFadeOutComplete()})).onStop((function(e){n=null,t.isActiveAnimation=!1})).start()}},e.prototype.clearCache=function(){this.material.envMap&&this.material.envMap.dispose(),this.material.dispose(),this.geometry.dispose()},e.prototype.clear=function(){this.material.envMap=null},e.prototype.destroy=function(t){var e=this.name+" destroy";this.destroyed=!0,this.clearCache(),this.clear(),F.setItem(""+e,!0)},e}(L.Mesh),Tm=null,xm=function(t){function e(e){t.call(this),null===Tm&&(Tm=e),this.name="picker.flag",this.geometry=new L.SphereBufferGeometry(.8,16,16),this.material=new L.MeshBasicMaterial({color:65280})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.followMoving=function(t){this.position.copy(t),Tm.onFollowFlag(this)},e.prototype.putDown=function(){Tm.newFlag=null,Tm.addFlag(this)},e}(L.Mesh),bm=null,Mm=function(){bm=k.getCore(),this.name="purepano.area.picker",this.flags=[],this.newFlag=null};Mm.prototype.init=function(){},Mm.prototype.start=function(){this.createFlag()},Mm.prototype.end=function(){},Mm.prototype.cancel=function(){},Mm.prototype.createFlag=function(){this.newFlag=new xm(this),bm.sceneRender.add(this.newFlag)},Mm.prototype.addFlag=function(t){this.flags.push(t),this.createFlag()},Mm.prototype.onIntersectWithinModel=function(t){this.newFlag&&this.newFlag.followMoving(t.point)},Mm.prototype.link=function(t,e){},Mm.prototype.onFollowFlag=function(t){this.flags.length>0&&this.flags[this.flags.length-1]};var Am=new L.Vector3(1,0,0),Sm=new L.Vector3(0,1,0),Om=Object.create(null);j.set("TileUtils",Om),Om.TILE_SIZE=512,Om.FACES=6,Om.DIRECTIONAL_FOV=60,Om.TileFaceMap={R:2,L:4,D:5,U:0,B:1,F:3},Om.FaceDirection={R:new L.Vector3(1,0,0),L:new L.Vector3(-1,0,0),D:new L.Vector3(0,-1,0),U:new L.Vector3(0,1,0),B:new L.Vector3(0,0,-1),F:new L.Vector3(0,0,1)},Om.CubeMapIndex=[Om.TileFaceMap.R,Om.TileFaceMap.L,Om.TileFaceMap.D,Om.TileFaceMap.U,Om.TileFaceMap.B,Om.TileFaceMap.F],Om.TileLocation={center:0,upper_left:1,upper_right:2,lower_right:3,lower_left:4},Om.TileFaceDirection=((cm={})["face_"+Om.CubeMapIndex[0]]=Om.FaceDirection.R,cm["face_"+Om.CubeMapIndex[1]]=Om.FaceDirection.L,cm["face_"+Om.CubeMapIndex[2]]=Om.FaceDirection.D,cm["face_"+Om.CubeMapIndex[3]]=Om.FaceDirection.U,cm["face_"+Om.CubeMapIndex[4]]=Om.FaceDirection.B,cm["face_"+Om.CubeMapIndex[5]]=Om.FaceDirection.F,cm);var wm=["center","upper_left","upper_right","lower_right","lower_left"],Lm={_0:{axis:Am,angle:Math.PI/2},_1:{axis:Sm,angle:0},_2:{axis:Sm,angle:-Math.PI/2},_3:{axis:Sm,angle:-Math.PI},_4:{axis:Sm,angle:Math.PI/2},_5:{axis:Am,angle:-Math.PI/2}};Om.getTileVector=function(t,e,n,r,i,o,a){void 0===o&&(o=0);var s=t/e,l=e/t*2,c=l/2,u=r/s*2-1+c,h=(s-1-i)/s*2-1+c;switch(a){case Om.TileLocation.upper_left:u-=c,h+=c,u+=o*l;break;case Om.TileLocation.upper_right:u+=c,h+=c,h-=o*l;break;case Om.TileLocation.lower_right:u+=c,h-=c,u-=o*l;break;case Om.TileLocation.lower_left:u-=c,h-=c,h+=o*l;break;case Om.TileLocation.center:}return{x:u,y:h}},Om.getTileDirection=function(t,e,n,r,i){var o=j.get("LevelsPanoSize")[t],a=Om.TILE_SIZE,s=Om.getTileVector(o,a,e,n,r,void 0,Om.TileLocation[i]),l=s.x,c=s.y,u=new L.Vector3(l,c,-1),h=Lm["_"+e],p=h.axis,d=h.angle;return u.applyAxisAngle(p,d),Om.computeTileLocationVCameraDirection(u,"face"+e+"_tile_"+n+"_"+r+"_"+i),u},Om.getFaceTileDirectionOfTileLocation=function(t,e,n,r,i){k.getCore().sceneRender.camera;var o=Om.getTileDirection(t,e,n,r,i);return o=o.normalize()},Om.computeTileLocationVCameraDirection=function(t,e){var n=k.getCore().sceneRender.camera.getWorldDirection(new L.Vector3),r=t.angleTo(n);return L.MathUtils.radToDeg(r)},Om.isWithinFov=function(t,e,n,r){for(var i=0;i<wm.length;++i){var o=wm[i],a=Om.getFaceTileDirectionOfTileLocation(t,e,n,r,o),s=Om.computeTileLocationVCameraDirection(a);if(Om.DIRECTIONAL_FOV>=s)return!0}return!1};var Dm=[512,1024,2048,4096];j.set("LevelsPanoSize",Dm);var Cm=["512","1k","2k","4k"];j.set("LevelsTileHeader",Cm);var Pm={_0:{row:[0],col:[0]},_1:{row:[0,1],col:[0,1]},_2:{row:[0,1,2,3],col:[0,1,2,3]},_3:{row:[0,1,2,3,4,5,6,7],col:[0,1,2,3,4,5,6,7]}},Nm=new Map;j.set("RTS",Nm);var Rm=new Map;j.set("TileInfo",Rm);var Im=new Map;j.set("TileInfoKey",Im);var Um=new Map;j.set("TileFaces",Um);var Bm=[];j.set("Levels",Bm);var Fm=[],Hm=null,km=function(){Hm=k.getCore(),j.set("tileRenderer",this),this.name="TileRenderer",this.cubeRenderTarget=null,this.onLevelRendered=Object.create(null)};km.prototype.init=function(){var t=this;this.adapterRenderMode(),this.initTileFace(0),this.initTileFace(1),this.initTileFace(2),this.initTileFace(3),this.initTileFace(4),this.initTileFace(5),this.initTileLevelInfo(0),this.initTileLevelInfo(1),this.initTileLevelInfo(2),this.initTileLevelInfo(3),this.initTileLevelInfo(4),this.initTileLevelInfo(5),this.onLevelRendered.level_0=function(){n.info(t.name+" tile.renderer.level.0.complete!")(),Hm.purepanoManager.activePano.onTextureLoaded()},this.onLevelRendered.level_1=function(){n.info(t.name+" tile.renderer.level.1.complete!")()},this.onLevelRendered.level_2=function(){n.info(t.name+" tile.renderer.level.2.complete!")()},this.onLevelRendered.level_3=function(){n.info(t.name+" tile.renderer.level.3.complete!")()}},km.prototype.adapterRenderMode=function(){var t=this,e=_e.getRenderMode(),n=_e.getRenderSet();if("6cube"===e){Bm.push(0);var r=1*n;this.initCubeRT(r)}if("lod"===e){switch(n){case"1024-512":Bm.push(0,1);break;case"2048-512":Bm.push(0,1,2);break;case"4096-512":Bm.push(0,1,2,3)}var i=Dm[Bm.length-1];this.initCubeRT(i)}Bm.forEach((function(e){t.onLevelRendered["level_"+e]=function(){}}))},km.prototype.initTileFace=function(t){var e=Dm[Bm.length-1],n=new L.Scene,r=new L.OrthographicCamera(-1,1,1,-1,0,1);r.position.z=1;var i=new L.PlaneBufferGeometry(2,2),o=new L.DataTexture(null,e,e);o.flipY=!0;var a=new L.MeshBasicMaterial({transparent:!1,depthTest:!1,depthWrite:!1,side:L.FrontSide,map:o}),s=new L.Mesh(i,a);n.add(s),Um.set(t,{rs:n,rc:r,mt:a,dt:o})},km.prototype.initTileLevelInfo=function(t){Rm.set(t,new Map),Im.set(t,new Map),Bm.forEach((function(e,n){var r=Pm["_"+e],i=r.row,o=r.col;Rm.get(t).set(e,new Map),Im.get(t).set(e,[]);for(var a=0;a<i.length;++a)for(var s=i[a],l=i[a],c=0;c<o.length;++c){var u=o[c],h=o.length-1-u,p=Cm[e]+"_face"+t+"_"+s+"_"+u;Im.get(t).get(e).push(p),Rm.get(t).get(e).set(p,{level:e,tile_face:t,tile_x:s,tile_y:u,p_x:l,p_y:h,downloading:!1,downloaded:!1,uploaded:!1,covered:!1,valid:!0})}}))},km.prototype.initCubeRT=function(t){this.cubeRenderTarget=new L.WebGLCubeRenderTarget(t),this.cubeRenderTarget.viewport.set(0,0,t,t);var e=new L.CubeTexture;this.cubeRenderTarget.texture=e,this.cubeRenderTarget.texture.generateMipmaps=!1,this.cubeRenderTarget.texture.encoding=L.LinearEncoding,this.cubeRenderTarget.texture.format=L.RGBFormat,this.cubeRenderTarget.texture.type=L.UnsignedByteType,this.cubeRenderTarget.texture.minFilter=L.LinearFilter,this.cubeRenderTarget.texture.magFilter=L.LinearFilter},km.prototype.uploadTile=function(t){t.uploaded=!0,Fm.push(t)},km.prototype.copyToFace=function(t,e,n,r,i){var o=Um.get(i).dt;this.copyTextureToFace(t,e,n,r,o)},km.prototype.renderToCube=function(t,e){var n=Um.get(t);Hm.sceneRender.renderer.setRenderTarget(this.cubeRenderTarget,e),Hm.sceneRender.renderer.render(n.rs,n.rc),Hm.sceneRender.renderer.setRenderTarget(null)},km.prototype.renderTile=function(t){var e=t.level,n=t.tile_face;t.tile_x,t.tile_y;var r=t.p_x,i=t.p_y,o=t.tt,a=Dm[Bm.length-(e+1)],s=Om.CubeMapIndex.indexOf(n);this.copyToFace(a,r,i,o,n),this.renderToCube(n,s),t.covered=!0;var l=0;Rm.forEach((function(t){t.get(e).forEach((function(t){!1===t.covered&&(l=1)}))})),0===l&&this.onLevelRendered["level_"+e]()},km.prototype.copyTextureToFace=function(t,e,n,r,i){var o=e*t,a=n*t,s=new L.Vector2(o,a);Hm.sceneRender.renderer.copyTextureToTexture(s,r,i),r.dispose&&r.dispose(),r.image&&(r.image=null)},km.prototype.isCoveredOfFaceLevel=function(t,e){for(var n=Rm.get(t).get(e),r=n.entries(),i=0;i<n.size;++i)if(!1===r.next().value[1].covered)return!1;return!0},km.prototype.isCoveredOfAllFaceLevel=function(t){for(var e=0;e<6;++e)if(!this.isCoveredOfFaceLevel(e,t))return!1;return!0},km.prototype.getPanoSize=function(){var t=_e.getRenderMode(),e=_e.getRenderSet();return"lod"===t?Dm[Bm.length-1]:"6cube"===t?1*e:void 0},km.prototype.onFrameUpdate=function(){if(Fm.length>0){var t=Fm[0];this.renderTile(t),Fm.splice(0,1)}},km.prototype.clearCache=function(){this.cubeRenderTarget.clear(Hm.sceneRender.renderer,!0,!0,!0),this.cubeRenderTarget.dispose()},km.prototype.clear=function(){Nm.clear(),Rm.clear(),Im.clear(),Um.clear(),Bm.length=0,Fm.length=0,this.cubeRenderTarget=null,this.onLevelRendered=Object.create(null)};var zm=null,Gm=null,Wm=function(){zm=k.getCore(),j.set("tileDownloader",this),Gm=j.get("tileRenderer"),this.textureLoader=new L.TextureLoader,this.name="Purepano.TileDownloader",this.downloadTimer=null,this.downloadIntervalDelay=50,this.downloadQueueCount=4,this.refreshDownloadQueueFrameInterval=4,this.currentFrameInterval=0,this.downloadQueue=[],this.forcedDownloadQueue=[],this.stoped=!0,this.trigger2k=_e.get2kPanoTileTrigger(),this.trigger4k=_e.get4kPanoTileTrigger()};Wm.prototype.start=function(){this.stoped=!1,this.isStopedLoadLevelStatus={_1:!1,_2:!1,_3:!1},this.loadLevel0()},Wm.prototype.stop=function(){n.warn(this.name+" stop")(),j.get("TileInfo").forEach((function(t){t.forEach((function(t){t.forEach((function(t){t.valid=!1}))}))})),this.stoped=!0},Wm.prototype.load=function(t,e,n){void 0===n&&(n=function(){});var r=j.get("Levels"),i=j.get("LevelsPanoSize"),o=t.level,a=t.tile_face,s=t.tile_x,l=t.tile_y,c=i[r.length-(o+1)],u=i[r.length-1],h=i[o];t.downloading=!0,u===h?this.textureLoader.load(e,(function(e){e.encoding=L.LinearEncoding,e.format=L.RGBFormat,e.type=L.UnsignedByteType,e.minFilter=L.LinearFilter,e.magFilter=L.LinearFilter,e.generateMipmaps=!1,t.tt=e,t.downloaded=!0,n(e)})):function(t,e){void 0===e&&(e=function(){});var n=t.size,r=t.size,i=t.pic,o=t.text,a=t.font_size,s=t.show_tile_info,l=Se.cloneNode(!1),c=l.getContext("2d");l.width=n,l.height=r,Le(i).then((function(t){c.drawImage(t,0,0,n,r),s&&(c.lineWidth=1,c.strokeStyle="#00ff00",c.strokeRect(1,1,n-2,r-2),c.fillStyle="#00ff00",c.font="normal bold "+a+"px none",c.fillText(""+o,1,a+1));var i=new L.CanvasTexture(l);e(i)}))}({pic:""+e,text:"face"+a+"_"+s+"_"+l,size:c,font_size:64*(r.length-o),show_tile_info:!1},(function(e){e.encoding=L.LinearEncoding,e.format=L.RGBFormat,e.type=L.UnsignedByteType,e.minFilter=L.LinearFilter,e.magFilter=L.LinearFilter,e.generateMipmaps=!1,t.tt=e,t.downloaded=!0,n(e)}))},Wm.prototype.loadLevelOfFace=function(t,e){var n=this;j.get("TileInfo").get(e).get(t).forEach((function(r){if(!1===r.downloading){var i=r.tile_x,o=r.tile_y;Om.isWithinFov(t,e,i,o)&&n.addDownloadQueue(r)}}))},Wm.prototype.addDownloadQueue=function(t){-1===this.downloadQueue.indexOf(t)&&this.downloadQueue.push(t)},Wm.prototype.loadLevel0=function(){for(var t=this,e=j.get("TileInfo"),n=function(n){var r=n,i=t.getTilePic(0,r,0,0),o=e.get(r).get(0),a=t.getTemplateTileName(0,r,0,0),s=o.get(a);t.load(s,i,(function(e){t.upload(s)}))},r=0;r<6;++r)n(r)},Wm.prototype.loadLevel=function(t){if(null===this.downloadTimer)for(var e=t-1,n=0;n<6;++n)Gm.isCoveredOfFaceLevel(n,e)&&this.loadLevelOfFace(t,n)},Wm.prototype.dealtDownloadQueue=function(){var t=this;0<this.downloadQueue.length&&(this.downloadTimer=setInterval((function(){var e=t.downloadQueue.splice(0,t.downloadQueueCount);n.error("downloading list:",e)();var r=function(){var i=e.shift(),o=!0;if(!0===i.downloading&&(n.error(i.tile_pic+" has downloading!!!")(),o=!1),!0===o){var a=t.getTilePic(i.level,i.tile_face,i.tile_x,i.tile_y);t.load(i,a,(function(e){t.upload(i)}))}e.length>0&&r()};0===t.downloadQueue.length&&(clearInterval(t.downloadTimer),t.downloadTimer=null),r()}),this.downloadIntervalDelay))},Wm.prototype.refreshDownloadQueue=function(){if(0<this.downloadQueue.length){if(0!==this.forcedDownloadQueue.length)return void n.error("forced download queue not empty!!!")();this.forcedDownloadQueue=this.downloadQueue.splice(0,this.downloadQueueCount),this.downloadForcedQueue()}},Wm.prototype.downloadForcedQueue=function(){var t=this;this.name;var e=!0,r=this.forcedDownloadQueue.shift();if(!0===r.downloading&&(n.error("tile has downloading!!!",r)(),e=!1),!0===e){var i=r.level,o=r.tile_face,a=r.tile_x,s=r.tile_y,l=this.getTilePic(i,o,a,s);this.load(r,l,(function(e){t.upload(r)}))}0<this.forcedDownloadQueue.length&&this.downloadForcedQueue()},Wm.prototype.stopLoadLevel=function(t){this.isStopedLoadLevelStatus["_"+t]=!0},Wm.prototype.startLoadLevel=function(t){this.isStopedLoadLevelStatus["_"+t]=!1},Wm.prototype.checkLevelCanbedownload=function(t){return-1===j.get("Levels").indexOf(t)?(n.warn("unmatched level<"+t+">, can't be download!!!")(),this.stopLoadLevel(t),!1):1===t||2===t&&zm.player.zoomLevel>=this.trigger2k||3===t&&zm.player.zoomLevel>=this.trigger4k},Wm.prototype.upload=function(t){var e=this.name+" upload failure",r=_e.getModelId();t.valid?t.downloaded?Gm.uploadTile(t):n.error(e+", reason: model<"+r+"> tile"+t.tile_face+"_tile_"+t.tile_x+"_"+t.tile_y+" un downloaded!!!")():n.warn(e+", reason: model<"+r+"> tile"+t.tile_face+"_tile_"+t.tile_x+"_"+t.tile_y+" invalid!!!")()},Wm.prototype.getTemplateTileName=function(t,e,n,r){return j.get("LevelsTileHeader")[t]+"_face"+e+"_"+n+"_"+r},Wm.prototype.getTileName=function(t,e,n,r){var i=j.get("LevelsTileHeader"),o=_e.getRenderMode(),a=_e.getTileName(),s=_e.isSupportAutoCropTile(),l=i[t];if(s){if("lod"===o)return a+"_"+e;if("6cube"===o)return a+"_"+e}else{if("lod"===o)return l+"_face"+e+"_"+n+"_"+r;if("6cube"===o)return a+"_"+e}},Wm.prototype.getTilePic=function(t,e,n,r){j.get("Levels");var i=j.get("LevelsPanoSize"),o=_e.getPurepano6CubeUrl(),a=_e.getRenderMode(),s=_e.getRenderSet(),l=_e.isSupportAutoCropTile(),c=_e.getAutoCropServer(),u=""+o+this.getTileName(t,e,n,r)+".jpg",h="";if(l)switch(c){case"oss":if("lod"===a){var p=i[t],d=n*Om.TILE_SIZE,f=r*Om.TILE_SIZE;h="?x-oss-process=image/resize,m_fixed,limit_0,w_"+p+",h_"+p+"/crop,w_"+Om.TILE_SIZE+",h_"+Om.TILE_SIZE+",x_"+d+",y_"+f}if("6cube"===a){var m=1*s;h="?x-oss-process=image/resize,m_fixed,limit_0,w_"+m+",h_"+m}break;case"minio":if("lod"===a){var v=i[t],g=n*Om.TILE_SIZE,y=r*Om.TILE_SIZE;h="&fit=fill&w="+v+"&h="+v+"&cw="+Om.TILE_SIZE+"&ch="+Om.TILE_SIZE+"&cx="+g+"&cy="+y+"&q=100"}if("6cube"===a){var _=1*s;h="&fit=fill&w="+_+"&h="+_}}return""+u+h},Wm.prototype.onFrameUpdate=function(){this.stoped||Gm.isCoveredOfAllFaceLevel(0)&&(this.currentFrameInterval++,!this.isStopedLoadLevelStatus._1&&this.checkLevelCanbedownload(1)&&this.loadLevel(1),!this.isStopedLoadLevelStatus._2&&this.checkLevelCanbedownload(2)&&this.loadLevel(2),!this.isStopedLoadLevelStatus._3&&this.checkLevelCanbedownload(3)&&this.loadLevel(3),this.refreshDownloadQueueFrameInterval===this.currentFrameInterval&&(this.currentFrameInterval=0,this.refreshDownloadQueue()))};var Vm=null,jm=function(){this.name="PurepanoManager",this.activePano=null,this.tileRenderer=new km,this.tileDownloader=new Wm};jm.prototype.init=function(){n.info(this.name+" init")(),null==Vm&&(Vm=k.getCore()),this.areaPicker=new Mm},jm.prototype.createPanoCube=function(t){new _m(t)},jm.prototype.createPanoSphere=function(t){var e=t.id,n=t.fov,r=new Em(e);return r.setUserData("camera_fov",n),r.setCubeRT(this.tileRenderer.cubeRenderTarget),r},jm.prototype.activePurepano=function(t){this.activePano=t,Vm.player.setModel(t)},jm.prototype.switchPano=function(t){var e=this.name+" switch purepano failure";!0!==Ht.modelStateEngine.state[li.modelEvents.Events.DISABLE_SWITCH_PUREPANO].state?(Ht.modelStateEngine.state[li.modelEvents.Events.SWITCH_PUREPANO_MODEL].state=!0,Vm.lifeCycle.onSwitchScene(t.data)):n.warn(e+", reason: disable switch purepano")()},jm.prototype.enter=function(t,e,r,i){var o=this;void 0===r&&(r=function(){}),void 0===i&&(i=function(){});var a=this.name+" enter";n.info("%c"+a+", type:"+t,"color:#0f0;")();var s=e.geometry.boundingSphere.radius,l=e.entry_anima,c=e.entry_quaternion,u=new L.Vector3(0,s,0),h=new L.Vector3(0,0,0);new L.Quaternion;var p=(new L.Quaternion).copy(c);this.activePurepano(e),this.tileDownloader.start(),e.onTextureLoaded=function(){r(),Vm.sceneRender.add(e),Vm.lifeCycle.onPurepanoLoaded(t);var n=Vm.player.controls[G.PANORAMA];if(!0===n.enabled&&n.disable(a+", on texture loaded"),"fadein"===l&&(n.setPosition(h,a+", on texture loaded, fade.in"),n.lookAtRotation(p,a+", on texture loaded, fade.in"),e.setOpacity(e.defaultOpacity),e.onFadeInStart=function(){Vm.lifeCycle.onPurepanoAnimationStart()},e.onFadeInComplete=function(){Vm.lifeCycle.onPurepanoAnimationComplete(),i()},Bo((function(){e.fadeIn()}),166)),"fisheye"===l){o.tileDownloader.stopLoadLevel(2),o.tileDownloader.stopLoadLevel(3);var s=Vm.player.control.camera;e.setOpacity(e.defaultOpacity),n.setPosition(h,a+", fisheye"),n.lookAtRotation(p,a+", fisheye");var c=s.getLookAtTarget();s.setPosition(u);var d=s.getDirection().clone().negate();Vm.player.control.lookAt(d);var f=s.getLookAtTarget();Vm.player.control.setFov(90,o.name+" entry.mode<"+l+">"),Bo((function(){e.onFadeInComplete=function(){ym({origin_position:u,target_position:h,origin_lookat_target:f,target_lookat_target:c,fov:e.getUserData("camera_fov"),start:function(){Vm.lifeCycle.onPurepanoAnimationStart()},complete:function(){o.tileDownloader.startLoadLevel(2),o.tileDownloader.startLoadLevel(3),n.setPosition(s.getPosition(),a+", fisheye.animation.complete"),n.lookAtRotation(s.getQuaternion(),a+", fisheye.animation.complete"),Vm.lifeCycle.onPurepanoAnimationComplete(),i()}})},e.fadeIn()}),166)}}},jm.prototype.onFrameUpdate=function(){this.tileDownloader&&this.tileDownloader.onFrameUpdate(),this.tileRenderer&&this.tileRenderer.onFrameUpdate()};var Ym=null,Xm=function(){Ym=k.getCore(),this.name="core.event.interaction"};Xm.prototype.init=function(){n.info(this.name+" init")(),lt.core.hook[Y.START_BOOT]=function(){},lt.core.hook[Y.FIRST_PANO_LOADED]=function(){Ym.startModeManager.control&&Ym.startModeManager.control.enable("first.pano.loaded"),Ym.lifeCycle.readyToLoadModel()},lt.core.hook[Y.CORE_LOADED]=function(t){Ym.player.dealtEvents("addEventListener")},lt.core.hook[Y.CORE_RENDER_STAGE_RESIZE]=function(t){xl.updateDirectionalFov(t.width)},lt.core.hook[Y.ENABLE_MAGNIFYING_MODE]=function(){Ym.sceneRender.addMagnifying(),Ym.sceneRender.renderer.setScissorTest(!0)},lt.core.hook[Y.DISABLE_MAGNIFYING_MODE]=function(){var t,e,n;t=Jt(),e=t.clientWidth,n=t.clientHeight,Ym.sceneRender.renderer.clear(),Ym.sceneRender.renderer.setScissorTest(!1),Ym.sceneRender.renderer.setViewport(0,0,e,n)}};var Zm=function(){this.name="model.event.interaction"};Zm.prototype.init=function(){n.info(this.name+" init")(),lt.model.hook[q.SWITCH_MODEL]=function(){Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANORAMA_MODE_COMPLETE].state=!1,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE].state=!1,Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_FLOORPLAN_MODE_COMPLETE].state=!1},lt.model.hook[q.SWITCH_PUREPANO_MODEL]=function(){}};var qm=function(){this.name="action.event.interaction"};qm.prototype.init=function(){n.info(this.name+" init")(),lt.action.hook[X.ACTION_MODE_PANORAMA]=function(){li.modelEvents.EventsDealt.DISABLE_SWITCH_MODEL(),li.modelEvents.EventsDealt.DISABLE_SWITCH_PUREPANO()},lt.action.hook[X.ACTION_MODE_DOLLHOUSE]=function(){li.modelEvents.EventsDealt.DISABLE_SWITCH_MODEL(),li.modelEvents.EventsDealt.DISABLE_SWITCH_PUREPANO()},lt.action.hook[X.ACTION_MODE_FLOORPLAN]=function(){li.modelEvents.EventsDealt.DISABLE_SWITCH_MODEL(),li.modelEvents.EventsDealt.DISABLE_SWITCH_PUREPANO()},lt.action.hook[X.SWITCH_TO_PANO]=function(){li.modelEvents.EventsDealt.DISABLE_SWITCH_MODEL(),li.modelEvents.EventsDealt.DISABLE_SWITCH_PUREPANO()},lt.action.hook[X.SWITCH_TO_PANO_TRANSITION]=function(){},lt.action.hook[X.SWITCH_TO_PANO_COMPLETE]=function(){li.modelEvents.EventsDealt.ENABLE_SWITCH_MODEL(),li.modelEvents.EventsDealt.ENABLE_SWITCH_PUREPANO()},lt.action.hook[X.SWITCH_TO_PANORAMA_MODE_COMPLETE]=function(){li.modelEvents.EventsDealt.ENABLE_SWITCH_MODEL(),li.modelEvents.EventsDealt.ENABLE_SWITCH_PUREPANO()},lt.action.hook[X.SWITCH_TO_DOLLHOUSE_MODE_COMPLETE]=function(){li.modelEvents.EventsDealt.ENABLE_SWITCH_MODEL(),li.modelEvents.EventsDealt.ENABLE_SWITCH_PUREPANO()},lt.action.hook[X.SWITCH_TO_FLOORPLAN_MODE_COMPLETE]=function(){li.modelEvents.EventsDealt.ENABLE_SWITCH_MODEL(),li.modelEvents.EventsDealt.ENABLE_SWITCH_PUREPANO()}};var Qm=null,Km=null,Jm=function(){this.name="webxr.event.interaction"};function $m(){var t=null;if(Km)t=Qm.player.model.panos.get(Km);else{var e=Ht.webxr.state[li.webxrEvents.Events.INTERSECT_POINT].data.point;Qm.player.currentPano,e&&(t=ji((new L.Vector3).subVectors(e,Qm.player.position).normalize()))}return t}function tv(t){Qm.player.updateTargetPano(t),Qm.player.targetPano.free_rotate=!0,Qm.player.switchToTargetPano[""+Qm.player.mode](Qm.player.targetPano,(function(){Qm.player.currentPano.free_rotate=!1}))}Jm.prototype.init=function(){n.info(this.name+" init")(),null===Qm&&(Qm=k.getCore()),lt.webxr.hook[tt.SESSION_START]=function(){!function(){try{if(Qm.player.control.lookAt(Ie.FORWARD),"on"===Kt("show_gui_panel")){var t=Qm.player.control.camera.getPosition(),e=Qm.player.control.camera.getDirection().multiplyScalar(1.4),r=(new L.Vector3).addVectors(t,e);Qm.guiLogManager.showLogPanel(r),Qm.guiLogManager.addLog("global scale: "+Qm.webxrManager.global_scale),Qm.guiLogManager.addLog(">")}if(kt===Qm.player.model.getUserData("type")||zt===Qm.player.model.getUserData("type")){var i=Kt("global_scale")||10;Qm.webxrManager.setGlobalScale(i),Qm.player.model.hide(),Qm.player.model.chunks.forEach((function(t){t.layers.set(ve.DEFAULT)})),Qm.player.model.colliders.forEach((function(t){t.layers.set(ve.DEFAULT)})),Qm.waypointManager.markerMap.forEach((function(t,e){t.layers.set(ve.DEFAULT)})),Qm.player.model.skybox.layers.set(ve.DEFAULT),Qm.webxrManager.changeSwitchPanoModeToFade()}}catch(t){n.error("hook.session.start catch error:",t)()}}()},lt.webxr.hook[tt.SESSION_END]=function(){!function(){try{"on"===Kt("show_gui_panel")&&Qm.guiLogManager.guiLogPanel.position.divideScalar(14),kt!==Qm.player.model.getUserData("type")&&zt!==Qm.player.model.getUserData("type")||(Qm.webxrManager.resetGlobalScale(),Qm.player.model.show(),Qm.player.model.chunks.forEach((function(t){t.layers.set(ve.CHUNK)})),Qm.player.model.colliders.forEach((function(t){t.layers.set(ve.COLLIDER)})),Qm.waypointManager.markerMap.forEach((function(t,e){t.layers.set(ve.MARKER)})),Qm.player.model.skybox.layers.set(ve.MODEL_SKYBOX))}catch(t){n.error("hook.session.end catch error:",t)()}}()},lt.webxr.hook[tt.INTERSECT_POINT]=function(t){!function(t){try{if(!Qm.player)return;if(!Qm.player.model)return;var e=Qm.player.model.getUserData("type"),r=Qm.sceneRender.reticule,i=Qm.player.currentPano.neighbourUUIDs,o=Qm.webxrManager.masterController.getChildByName("ray.line"),a=Ht.webxr.state[li.webxrEvents.Events.INTERSECT_POINT].data,s=a.point,l=a.normal,c=a.distance,u=[];r&&r.follow(l,s),o&&(o.scale.y=c),"on"===Kt("show_intersect_line")&&_n(new L.Vector3,s,255,"webxr.intersect.point.line",Wt===e);for(var h=0,p=i.length;h<p;++h){var d=i[h],f=Qm.player.model.panos.get(d);if(f&&!0===f.enable){var m=f.marker;m.computePointWithinTheRadius(s)&&u.push(m.userData.id)}}Km=0<u.length?u[u.length-1]:null}catch(t){n.error("hook.intersect.point.catch.error:",t)}}()},lt.webxr.hook[tt.RIGHT_GAMEPAD_SELECT_BTN_CLICK]=function(){!function(){var t=Qm.player.model.getUserData("type");if(Wt!==t){var e=$m();e&&tv(e)}}()},lt.webxr.hook[tt.RIGHT_GAMEPAD_SQUEEZE_BTN_DOWN]=function(){Qm.guiLogManager.addLog(tt.RIGHT_GAMEPAD_SQUEEZE_BTN_DOWN)},lt.webxr.hook[tt.RIGHT_GAMEPAD_SQUEEZE_BTN_UP]=function(){Qm.guiLogManager.addLog(tt.RIGHT_GAMEPAD_SQUEEZE_BTN_UP)},lt.webxr.hook[tt.RIGHT_GAMEPAD_A_BTN_CLICK]=function(){Qm.webxrManager.exitVr()},lt.webxr.hook[tt.RIGHT_GAMEPAD_B_BTN_CLICK]=function(){!function(){switch(Qm.webxrManager.switch_mode){case"default":Qm.webxrManager.changeSwitchPanoModeToFade();break;case"fade":Qm.webxrManager.changeSwitchPanoModeToDefault()}}()},lt.webxr.hook[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER]=function(){Qm.webxrManager.masterController&&Qm.player.control.clockwiseRotate2(-22.5)},lt.webxr.hook[tt.RIGHT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER]=function(){Qm.webxrManager.masterController&&Qm.player.control.clockwiseRotate2(22.5)},lt.webxr.hook[tt.LEFT_GAMEPAD_SELECT_BTN_CLICK]=function(){!function(){var t=Qm.player.model.getUserData("type");if(Wt!==t){var e=$m();e&&tv(e)}}()},lt.webxr.hook[tt.LEFT_GAMEPAD_X_BTN_CLICK]=function(){Qm.webxrManager.exitVr()},lt.webxr.hook[tt.LEFT_GAMEPAD_Y_BTN_CLICK]=function(){!function(){switch(Qm.webxrManager.switch_mode){case"default":Qm.webxrManager.changeSwitchPanoModeToFade();break;case"fade":Qm.webxrManager.changeSwitchPanoModeToDefault()}}()},lt.webxr.hook[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_LEFT_TRIGGER]=function(){Qm.webxrManager.masterController&&Qm.player.control.clockwiseRotate2(-22.5)},lt.webxr.hook[tt.LEFT_GAMEPAD_THUMB_BTN_AXES_RIGHT_TRIGGER]=function(){Qm.webxrManager.masterController&&Qm.player.control.clockwiseRotate2(22.5)}};var ev=function(){this.name="raycaster.event.interaction"};ev.prototype.init=function(){n.info(this.name+" init")(),k.getCore(),lt.raycaster.hook[J.INTERSECT_WITHIN_MODEL]=function(t){}},ev.prototype.destroy=function(){};var nv=function(){this.name="interaction.manager",this.core=new Xm,this.model=new Zm,this.action=new qm,this.webxr=new Jm,this.raycaster=new ev};nv.prototype.init=function(){n.info(this.name+" init")(),this.core.init(),this.model.init(),this.action.init(),this.webxr.init(),this.raycaster.init()},nv.prototype.destroy=function(){n.warn(this.name+" destroy")(),this.core=null,this.action=null,this.model=null,this.raycaster=null,this.webxr=null};var rv=function(t){function e(){t.call(this),this.name="WebXRCamera"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setPosition=function(t){this.position.copy(t)},e.prototype.setQuaternion=function(t){this.quaternion.copy(t)},e}(L.Object3D),iv=null,ov=null,av=null,sv=null,lv=new L.Matrix4;new L.Matrix4,new L.Matrix4;var cv=new L.Raycaster;new L.Raycaster,new L.Raycaster;var uv=function(){sv=this,this.name="WebXRManager",this.spaceType="local",this.global_scale=1,this.currentSession=null,this.xrCamera=null,this.xrController=[],this.gamepadConnected=!1,this.leftController=null,this.rightController=null,this.masterController=null};function hv(){var t=new rv;sv.xrCamera=t,t.add(ov.camera),function(){if(av.control){var t=av.control.camera.getPosition();sv.xrCamera.setPosition(t);var e=av.control.camera.getQuaternion();sv.xrCamera.setQuaternion(e)}}(),ov.add(t)}function pv(t){iv.guiLogManager.addLog("controller.0.connected!"),iv.guiLogManager.addLog(">>>"),n.debug("controller 0 connected",t)(),iv.guiLogManager.addLog("controller.0.handedness:"+t.data.handedness),iv.guiLogManager.addLog(">>>");var e=t.target,r=t.data.gamepad;"left"===t.data.handedness?(sv.leftController=e,sv.leftController.name="webxr.left.controller",sv.leftController.userData.gamepad=r):"right"===t.data.handedness&&(sv.rightController=e,sv.rightController.name="webxr.right.controller",sv.rightController.userData.gamepad=r),sv.gamepadConnected=!0}function dv(t){iv.guiLogManager.addLog("controller.1.connected!"),iv.guiLogManager.addLog(">>>"),n.debug("controller 1 connected",t)(),iv.guiLogManager.addLog("controller.1.handedness:"+t.data.handedness),iv.guiLogManager.addLog(">>>");var e=t.target,r=t.data.gamepad;"left"===t.data.handedness?(sv.leftController=e,sv.leftController.name="webxr.left.controller",sv.leftController.userData.gamepad=r):"right"===t.data.handedness&&(sv.rightController=e,sv.rightController.name="webxr.right.controller",sv.rightController.userData.gamepad=r),sv.gamepadConnected=!0}function fv(t){n.debug("controller 0 selectstart",t)()}function mv(t){n.debug("controller 1 selectstart",t)()}function vv(t){sv.selectMasterController(t.target)}function gv(t){sv.selectMasterController(t.target)}function yv(t){var e,r;n.info(sv.name+" session start")(),li.webxrEvents.EventsDealt.SESSION_START(),sv.currentSession=t,sv.currentSession.addEventListener("end",_v),ov.renderer.xr.setSession(sv.currentSession),ov.onFrameUpdateCallback.push(sv.onFrameUpdate),hv(),e=ov.renderer.xr.getController(0),r=ov.renderer.xr.getController(1),sv.xrController[0]=e,sv.xrController[1]=r,e.addEventListener("connected",pv),r.addEventListener("connected",dv),e.addEventListener("selectstart",fv),r.addEventListener("selectstart",mv),e.addEventListener("selectend",vv),r.addEventListener("selectend",gv)}function _v(){iv.guiLogManager.addLog("on.session.ended!"),iv.guiLogManager.addLog(">"),li.webxrEvents.EventsDealt.SESSION_END(),sv.currentSession.removeEventListener("end",_v),sv.xrController[0].removeEventListener("connected",pv),sv.xrController[1].removeEventListener("connected",dv),sv.xrController[0].removeEventListener("selectstart",fv),sv.xrController[1].removeEventListener("selectstart",mv),sv.xrController[0].removeEventListener("selectend",fv),sv.xrController[1].removeEventListener("selectend",mv),sv.xrController=[],sv.leftController=null,sv.rightController=null,sv.masterController=null,sv.gamepadConnected=!1;for(var t=sv.xrCamera.children.length-1;t>=0;--t)sv.xrCamera.remove(sv.xrCamera.children[t]);ov.remove(sv.xrCamera,"scope.xrCamera"),sv.xrCamera=null,sv.currentSession=null,ov.renderer.xr.setSession(null),ov.renderer.xr.dispose(),ov.renderer.xr.enabled=!1}function Ev(){var t=sv.masterController.userData.gamepad;"webxr.right.controller"===sv.masterController.name&&function(t){for(var e=t.axes,n=t.buttons,r=0;r<n.length;++r){var i=n[r];!0===i.pressed?li.webxrEvents.EventsDealt.RIGHT_PAD_BTN_DOWN(r):li.webxrEvents.EventsDealt.RIGHT_PAD_BTN_UP(r),!0===i.touched?li.webxrEvents.EventsDealt.RIGHT_GAMEPAD_BTN_TOUCH_START(r,e):li.webxrEvents.EventsDealt.RIGHT_GAMEPAD_BTN_TOUCH_END(r)}}(t),"webxr.left.controller"===sv.masterController.name&&function(t){for(var e=t.axes,n=t.buttons,r=0;r<n.length;++r){var i=n[r];!0===i.pressed?li.webxrEvents.EventsDealt.LEFT_GAMEPAD_YTN_DOWN(r):li.webxrEvents.EventsDealt.LEFT_GAMEPAD_YTN_UP(r),!0===i.touched?li.webxrEvents.EventsDealt.LEFT_GAMEPAD_YTN_TOUCH_START(r,e):li.webxrEvents.EventsDealt.LEFT_GAMEPAD_YTN_TOUCH_END(r)}}(t)}function Tv(){var t,e,n=iv.player.model,r=n.getUserData("type");if(Wt!==r){var i=n.getValidColliders(),o=(t=i,e=sv.masterController,void 0===t&&(t=[]),lv.identity().extractRotation(e.matrixWorld.clone()),cv.ray.origin.setFromMatrixPosition(e.matrixWorld.clone()),cv.ray.direction.copy(Ie.FORWARD).applyMatrix4(lv),cv.intersectObjects(t));if(o.length>0){var a=o[0],s=a.point,l=a.face.normal,c=a.distance,u=Ht.webxr.state[li.webxrEvents.Events.INTERSECT_POINT].data;if(u){var h=u.point;if(h.x===s.x&&h.y===s.y&&h.z===s.z)return}li.webxrEvents.EventsDealt.INTERSECT_POINT({mode:G.PANORAMA,point:s,normal:l,distance:c})}i=[]}}uv.prototype.init=function(){iv=k.getCore(),ov=k.getSceneRender(),av=k.getPlayer()},uv.prototype.enterVr=function(){var t=this;navigator.xr?Ht.webxr.state[li.webxrEvents.Events.SESSION_START].state?n.error("already enter vr mode!")():ce((function(){ov.renderer.xr.enabled=!0,ov.renderer.xr.setReferenceSpaceType(t.spaceType),n.info("create session")(),navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor"]}).then(yv).catch((function(t){}))}),(function(){n.error("xr not support immersive-vr session!")()})):n.error("browser not support webxr!")()},uv.prototype.exitVr=function(){var t=this.name+" exit vr mode failure";null!==this.currentSession?(iv.guiLogManager.addLog("exit vr"),iv.guiLogManager.addLog(">"),this.currentSession.end().then((function(){})).catch((function(t){}))):n.error(t+", reason: unget current session!")()},uv.prototype.changeSwitchPanoModeToDefault=function(){iv.waypointManager.ids.forEach((function(t){iv.commonEvents.modelEvents.setWaypointSwitchConfig({id:t,switch_mode:"default",config:{max_distance:5}})})),this.switch_mode="default"},uv.prototype.changeSwitchPanoModeToFade=function(){iv.waypointManager.ids.forEach((function(t){iv.commonEvents.modelEvents.setWaypointSwitchConfig({id:t,switch_mode:"fade",config:{in:500,out:500}})})),this.switch_mode="fade"},uv.prototype.setGlobalScale=function(t){if(1===this.global_scale){this.global_scale=t;var e=iv.player.model.chunks||[],r=iv.player.model.colliders||[];e.forEach((function(e){e.geometry.scale(t,t,t),e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere()})),r.forEach((function(e){e.geometry.scale(t,t,t),e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere()})),iv.player.model.size.multiplyScalar(t),iv.player.model.skybox&&(iv.player.model.skybox.setScaleScalar(t),iv.player.model.skybox.setPositionScalar(t)),iv.player.control.camera.setPositionScalar(t),iv.player.model.panos.list.forEach((function(e){e.position.multiplyScalar(t),e.floorPosition.multiplyScalar(t),e.marker.setPositionScalar(t),e.marker.setScalar(t)})),iv.sceneRender.reticule&&iv.sceneRender.reticule.setScale(t),iv.player.model.updateProjectedPanos()}else n.warn("already set global scale!")()},uv.prototype.resetGlobalScale=function(){var t=this.global_scale;this.global_scale=1;var e=1/t,n=iv.player.model.chunks||[],r=iv.player.model.colliders||[];n.forEach((function(t){t.geometry.scale(e,e,e),t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere()})),r.forEach((function(t){t.geometry.scale(e,e,e),t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere()})),iv.player.model.size.divideScalar(t),iv.player.model.skybox&&(iv.player.model.skybox.setScaleScalar(e),iv.player.model.skybox.setPositionScalar(e)),iv.player.control.camera.setPositionScalar(e),iv.player.model.panos.list.forEach((function(n){n.position.divideScalar(t),n.floorPosition.divideScalar(t),n.marker.setPositionScalar(e),n.marker.setScalar(e)})),iv.sceneRender.reticule&&iv.sceneRender.reticule.setScale(1),iv.player.model.updateProjectedPanos()},uv.prototype.selectMasterController=function(t){var e=iv.player.model.getUserData("type");if(this.masterController){if(this.masterController.name===t.name)return void n.warn("select master controller failure, reason: same controller!")();var r=this.masterController.getObjectByName("ray.line");r&&(r.geometry.dispose(),r.material.dispose(),this.masterController.remove(r)),sv.xrCamera.remove(this.masterController),this.masterController=null}if(this.masterController=t,Wt!==e){var i=function(){var t=new L.ConeBufferGeometry(.005,1,16);t.translate(0,.5,0);var e=new L.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.6}),n=new L.Mesh(t,e);return n.name="ray.line",n.rotateX(-Math.PI/2),n}();this.masterController.add(i)}sv.xrCamera.add(this.masterController)},uv.prototype.onFrameUpdate=function(t,e){!0===ov.renderer.xr.isPresenting&&sv.masterController&&(Tv(),Ev())};var xv=function(){this.panel=null};xv.prototype.init=function(){this.createPanel()},xv.prototype.createPanel=function(){var t=Jt();this.panel=document.createElement("textarea"),this.panel.id="zqcore-ui-log-panel",this.panel.style.cssText="\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      width: 200px;\n      height: 200px;\n      background-color: rgba(0, 0, 0, .4);\n      color: red;\n      display: none;\n      font-size: 14px;\n      border: none;\n      outline: none;\n    ",t.appendChild(this.panel)},xv.prototype.showBrowserInfo=function(){this.panel.value+="isPc: "+re()+"\r\n",this.panel.value+="isMobile: "+ie()+"\r\n",this.panel.value+="isIos: "+ae()+"\r\n",this.panel.value+="isAndroid："+oe()+"\r\n",this.panel.value+="isWeixin: "+se()+"\r\n",this.panel.value+="isWindowsWechat: "+le()+"\r\n",this.panel.style.display="block"};var bv=1120,Mv=null,Av=function(){this.name="GUILogManager",this.guiLogPanelDom=null,this.guiLogPanel=null,this.count=0};Av.prototype.showLogPanel=function(t){null===Mv&&(Mv=k.getCore());var e=document.createElement("canvas");this.guiLogPanelCanvas=e,e.width=600,e.height=bv;var n=e.getContext("2d");this.guiLogPanelCtx=n,n.fillStyle="#ffffff",n.fillRect(0,0,600,bv),n.font="14px serif";var r=new L.CanvasTexture(e);r.needsUpdate=!0;var i=new L.SpriteMaterial({transparent:!0,map:r,depthTest:!1});this.guiLogPanel=new L.Sprite(i),this.guiLogPanel.position.copy(t),this.guiLogPanel.scale.y=bv/600,Mv.sceneRender.add(this.guiLogPanel)},Av.prototype.hideLogPanel=function(){this.guiLogPanel&&(Mv.sceneRender.remove(this.guiLogPanel),this.guiLogPanel=null)},Av.prototype.addLog=function(t){null!==this.guiLogPanel&&(bv===14*this.count&&this.clearLog(),this.count+=1,this.guiLogPanelCtx.fillStyle="#000000",this.guiLogPanelCtx.fillText(t,0,14*this.count),this.updateLogPanel())},Av.prototype.clearLog=function(){this.guiLogPanelCtx.clearRect(0,0,600,bv),this.guiLogPanelCtx.fillStyle="#ffffff",this.guiLogPanelCtx.fillRect(0,0,600,bv),this.count=0,this.guiLogPanel.material.map&&(this.guiLogPanel.material.map.dispose(),this.guiLogPanel.material.map=null,this.guiLogPanel.material.needsUpdate=!0)},Av.prototype.updateLogPanel=function(){var t=new L.CanvasTexture(this.guiLogPanelCanvas);this.guiLogPanel.material.map=t,this.guiLogPanel.material.needsUpdate=!0};var Sv=new hs("<compute.neighbour.barrier>"),Ov=null;function wv(t){null===Ov&&(Ov=k.getCore()),Sv.start();var e=t.list,n=Object.create(null),r=Object.create(null),i=Object.create(null),o=!1;"on"===Kt("cwb")&&(o=!0);for(var a=function(a){var s=e[a],l=s.neighbourUUIDs,c=s.neighboursVisible,u=s.position;n[s.id]=[],r[s.id]=[],i[s.id]=[],l.forEach((function(e){var a=t.get(e),l=a.marker.position;i[s.id].push(e);var h=!1;o?h=li.coreEvents.EventsDealt.JUDGE_BARRIER_BETWEEN_THE_POINT(u,l):0!==c.length&&-1===c.indexOf(e)&&(h=!0),!0===h?n[s.id].push(a.id):r[s.id].push(a.id)}))},s=0;s<e.length;++s)a(s);Ov.waypointManager.barrierMap=n,Ov.waypointManager.unbarrierMap=r,Ov.waypointManager.neighbourMap=i,Sv.end()}var Lv=null;function Dv(t,e){null===Lv&&(Lv=k.getCore());var n=Lv.waypointManager.markerMap,r=Lv.waypointManager.unbarrierMap,i=r[t],o=r[e];n.get(t);var a=n.get(e),s=wt(i,o);if(s.length>0){var l=[],c=new Map;s.forEach((function(t,e){var r=n.get(t).position.distanceTo(a.position);l[e]=r,c.set(""+r,t)}));var u=Math.min.apply(Math,l),h=c.get(""+u);return l=[],h}return null}var Cv=null,Pv=[];function Nv(t){var e=Cv.waypointManager.markerMap.get(t);e.show(),e.setOpacity(1,"valid.marker"),e.setScalar(2),e.tempSetColor(65280)}function Rv(t,e,r){null===Cv&&(Cv=k.getCore()),Pv=[];var i=Cv.waypointManager.markerMap,o=Cv.waypointManager.unbarrierMap;i.forEach((function(t,e){t.tempSetColor(16777215),t.setOpacity(0)}));var a=o[t];o[e];var s=i.get(t),l=i.get(e);if(s.show(),s.setScalar(2),s.tempSetColor(16711680),s.setOpacity(1),l.show(),l.setScalar(2),l.tempSetColor(255),l.setOpacity(1),-1!==a.indexOf(e))return Nv(e),Pv.push(e),Pv.unshift(t),Pv;var c=Dv(t,e);if(c)return Pv.push(c),Pv.push(e),Pv.unshift(t),Pv;for(var u=o[e],h=[],p=[],d=0;d<u.length;++d)for(var f=u[d],m=o[f],v=0;v<m.length;++v){var g=m[v];if(-1===h.indexOf(g)){h.push(g);var y=Dv(t,g);y&&(n.error(f,g,y)(),-1===p.indexOf(f)&&p.push(f),-1===p.indexOf(g)&&p.push(g),-1===p.indexOf(y)&&p.push(y))}}p.forEach((function(t,e){Nv(t)}));var _=[],E=new Map;return p.forEach((function(t){var e=i.get(t).position.distanceTo(s.position).toFixed(2);_.push(e),E.set(e,t)})),_.sort((function(t,e){return 1*t-1*e})),_.forEach((function(t){Pv.push(E.get(t))})),Pv.push(e),Pv.unshift(t),Pv}var Iv=null;function Uv(t){null===Iv&&(Iv=k.getCore());for(var e=Iv.player.model.panos,n=new Map,r=0;r<t.length;++r){var i=t[r],o=t[r+1];if(o){var a=e.get(i),s=e.get(o),l=(new L.Vector3).copy(a.position),c=(new L.Vector3).copy(s.position),u=l.distanceTo(c).toFixed(2);n.set(i+"-"+o,u)}}var h=0;return n.forEach((function(t,e){h+=1*t})),{path:t,map:n,total:h.toFixed(2)}}var Bv=null,Fv=new Map,Hv=new Map,kv=new Map,zv=new Map,Gv=null,Wv=null,Vv=[],jv=[];function Yv(t,e){var r=t+"-"+e,i=kv[t];Fv.set(r,[]);var o=wt(Lt(i,Vv),jv);n.debug(""+r,o)(),Vv.push(t),o.forEach((function(n){var i=[t,n,e];-1===i.indexOf(Gv)&&i.unshift(Gv);var o=Uv(i);Fv.get(r).push(o)}))}function Xv(t,e){null===Bv&&(Bv=k.getCore()),Gv=t,Wv=e,Fv=new Map,Hv=new Map,Vv=[],window.pathMap=Fv,window.validPathMap=Hv,window.checkedList=Vv,kv=Bv.waypointManager.unbarrierMap,zv=Bv.waypointManager.markerMap,jv=kv[Wv];var n=zv.get(t),r=zv.get(e);return zv.forEach((function(t){t.setOpacity(.4),t.setScale(2),t.tempSetColor(16777215)})),n.setOpacity(1,111),n.tempSetColor(16711680),r.setOpacity(1,111),r.tempSetColor(255),Yv(t,e),Lt(kv[t],Vv).forEach((function(t){Yv(t,e)})),Fv.forEach((function(t){t.length>0&&t.forEach((function(t){var e=t.path,n=t.total;Hv.set(n,e)}))})),Hv}var Zv=null,qv=0,Qv=[],Kv=[],Jv=null,$v=0;function tg(t,e){return null===Zv&&(Zv=k.getCore()),qv=Zv.data.waypoints.length,Kv=Zv.waypointManager.neighbourMap,Jv=e,Qv=[],$v=0,function t(e){if(1!==$v&&-1===Qv.indexOf(e)){if(Qv.push(e),n.debug(e,Qv.length,qv)(),e===Jv)return n.debug("over")(),void($v=1);var r=Lt(Kv[e],Qv);r.length>0&&r.forEach((function(e){t(e)}))}}(t),Qv}var eg=null,ng=[],rg=function(){eg=k.getCore(),this.name="WaypointManager",this.group=null,this.ids=[],this.markerMap=new Map,this.neighbourMap=new Map,this.barrierMap=null,this.unbarrierMap=null,this.globalScale=1,this.total=0,this.loadedCount=0,this.computeWaypointBarrier=wv,this.computeNeighbourIntersection=Dv,this.computeAstarPath=Rv,this.findNeighbourPath=Xv,this.computePathDistance=Uv,this.getAllRelatedNeighbours=tg};rg.prototype.init=function(){this.total=eg.data.waypoints.length,this.addGroup()},rg.prototype.addGroup=function(){this.group=new L.Group,this.group.name="waypoint.group",eg.sceneRender.add(this.group)},rg.prototype.removeGroup=function(){for(var t=this.name+" remove group",e=this.group.children.length-1;e>=0;--e){var n=this.group.children[e];this.group.remove(n),n.destroy(""+t)}eg.sceneRender.remove(this.group,t),F.setItem(""+t,!0)()},rg.prototype.hideGroup=function(){this.group.visible=!1},rg.prototype.showGroup=function(){this.group.visible=!0},rg.prototype.addMarker=function(t){t.isClearCache=!1;var e=t.userData,n=e.id;this.ids.push(n),this.markerMap.set(n,t),this.group.add(t),this.marker_pic=e.pic,this.marker_scale=e.scale,this.loadedCount++,this.loadedCount===this.total&&this.onAddWaypointComplete()},rg.prototype.onAddWaypointComplete=function(){var t=this;this.marker_pic?Oe(this.marker_pic,(function(e){t.markerMap.forEach((function(t){t.setTexture2(e,!0)}));var n=new Nn.Tween({scale:0}).to({scale:t.marker_scale}).delay(160).duration(160).onUpdate((function(e){t.markerMap.forEach((function(t){return t.setScale(e.scale)}))})).onComplete((function(t){n.stop()})).onStop((function(t){n=null,eg.lifeCycle.onWaypointLoaded()})).start()})):eg.lifeCycle.onWaypointLoaded()},rg.prototype.hide=function(t){this.markerMap.get(t).hide()},rg.prototype.show=function(t){this.markerMap.get(t).show()},rg.prototype.showPath=function(t,e){var n=this;ng.forEach((function(t){eg.sceneRender.remove(t,n.name+" show path")})),t.forEach((function(n,r){var i=t[r],o=t[r+1];if(o){var a=eg.player.model.panos.get(i),s=eg.player.model.panos.get(o),l=yn(a.position,s.position,e,4);ng.push(l),eg.sceneRender.add(l)}}))},rg.prototype.clear=function(){this.group=null,this.ids=[],this.markerMap=new Map,this.neighbourMap=new Map,this.barrierMap=null,this.unbarrierMap=null,this.loadedCount=0,this.total=0},rg.prototype.destroy=function(){this.removeGroup(),this.clear()};var ig={"entry.pano.loaded":{en:Y.FIRST_PANO_LOADED,cb:[]},loaded:{en:Y.CORE_LOADED,cb:[]},"purepano.loaded":{en:Y.PUREPANO_LOADED,cb:[]},"purepano.animation.start":{en:Y.PUREPANO_ANIMATION_START,cb:[]},"purepano.animation.end":{en:Y.PUREPANO_ANIMATION_END,cb:[]},"renderer.resize":{en:Y.CORE_RENDER_STAGE_RESIZE,cb:[]},"frame.update":{en:Y.FRAME_UPDATE,cb:[]}},og=Object.create(null);og.init=function(){delete og.init,og.initConfig=function(t){li.coreEvents.EventsDealt.INIT_CONFIG(t)},og.runStart=function(t){li.coreEvents.EventsDealt.CORE_BOOT(t)},og.showFps=function(){li.renderEvents.showFps()},og.hideFps=function(){li.renderEvents.hideFps()},og.sceneAdd=function(t){li.coreEvents.EventsDealt.CORE_SCENE_ADD(t)},og.sceneRemove=function(t){li.coreEvents.EventsDealt.CORE_SCENE_REMOVE(t)},og.getCurrentMode=function(){return li.coreEvents.EventsDealt.GET_CURRENT_MODE()},og.getCurrentPanoId=function(){return li.coreEvents.EventsDealt.GET_CURRENT_PANO_ID()},og.getRendererStage=function(){return li.coreEvents.EventsDealt.GET_RENDERER_STAGE()},og.getRendererCanvas=function(){return li.coreEvents.EventsDealt.GET_RENDERER_CANVAS()},og.getRendererCanvasBase64OfFullScreen=function(){return li.coreEvents.EventsDealt.GET_RENDERER_CANVAS_BASE64_OF_FULL_SCREEN()},og.getRendererCanvasBase64OfCustomSize=function(t,e,n){return li.coreEvents.EventsDealt.GET_RENDERER_CANCAS_BASE64_OF_CUSTOM_SIZE(t,e,n)},og.getActiveCamera=function(){return li.coreEvents.EventsDealt.GET_ACTIVE_CAMERA()},og.getMousePointer=function(){return li.coreEvents.EventsDealt.GET_MOUSE_POINTER()},og.drawLine=function(t,e,n,r){li.coreEvents.EventsDealt.DRAW_LINE(t,e,n,r)},og.getScene=function(){return li.coreEvents.EventsDealt.GET_SCENE()},og.disableSwitchToPano=function(){li.actionEvents.Methods.DISABLE_SWITCH_PANO()},og.enableSwitchToPano=function(){li.actionEvents.Methods.ENABLE_SWITCH_PANO()},og.disablePanoramaControl=function(){li.coreEvents.EventsDealt.DISABLE_PANORAMA_CONTROL()},og.disableDollhouseControl=function(){li.coreEvents.EventsDealt.DISABLE_DOLLHOUSE_CONTROL()},og.disableDollhouseCameraZoomControl=function(){li.coreEvents.EventsDealt.DISABLE_DOLLHOUSE_CAMERA_ZOOM_CONTROL()},og.disableDollhouseCameraDistanceZoomControl=function(){li.coreEvents.EventsDealt.DISABLE_DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CONTROL()},og.enablePanoramaControl=function(){li.coreEvents.EventsDealt.ENABLE_PANORAMA_CONTROL()},og.enableDollhouseControl=function(){li.coreEvents.EventsDealt.ENABLE_DOLLHOUSE_CONTROL()},og.enableDollhouseCameraZoomControl=function(){li.coreEvents.EventsDealt.ENABLE_DOLLHOUSE_CAMERA_ZOOM_CONTROL()},og.enableDollhouseCameraDistanceZoomControl=function(){li.coreEvents.EventsDealt.ENABLE_DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CONTROL()},og.enableFloorplanControl=function(){li.coreEvents.EventsDealt.ENABLE_FLOORPLAN_CONTROL()},og.enableFloorplanZoomControl=function(){li.coreEvents.EventsDealt.ENABLE_FLOORPLAN_ZOOM_CONTROL()},og.enableFloorplanPanControl=function(){li.coreEvents.EventsDealt.ENABLE_FLOORPLAN_PAN_CONTROL()},og.disableFloorplanControl=function(){li.coreEvents.EventsDealt.DISABLE_FLOORPLAN_CONTROL()},og.disableFloorplanZoomControl=function(){li.coreEvents.EventsDealt.DISABLE_FLOORPLAN_ZOOM_CONTROL()},og.disableFloorplanPanControl=function(){li.coreEvents.EventsDealt.DISABLE_FLOORPLAN_PAN_CONTROL()},og.getMouseIntersectWithinModel=function(){return li.coreEvents.EventsDealt.GET_MOUSE_INTERSECT_WITHIN_MODEL()},og.showSceneAxesHelper=function(){li.coreEvents.EventsDealt.SHOW_SCENE_AXES_HELPER()},og.hideSceneAxesHelper=function(){li.coreEvents.EventsDealt.HIDE_SCENE_AXES_HELPER()},og.getCameraOrientation=function(){return li.coreEvents.EventsDealt.GET_CAMERA_ORIENTATION()},og.getCameraQuaternion=function(){return li.coreEvents.EventsDealt.GET_CAMERA_QUATERNION()},og.getCameraPosition=function(){return li.coreEvents.EventsDealt.GET_CAMERA_POSITION()},og.getCameraWorldMatrix=function(){return li.coreEvents.EventsDealt.GET_CAMERA_WORLD_MATRIX()},og.getCameraWorldMatrixInverse=function(){return li.coreEvents.EventsDealt.GET_CAMERA_WORLD_MATRIX_INVERSE()},og.getCameraProjectionMatrix=function(){return li.coreEvents.EventsDealt.GET_CAMERA_PROJECTION_MATRIX()},og.getCameraProjectionMatrixInverse=function(){return li.coreEvents.EventsDealt.GET_CAMERA_PROJECTION_MATRIX_INVERSE()},og.getDollhouseControlTarget=function(){return li.coreEvents.EventsDealt.GET_DOLLHOUSE_CONTROL_TARGET()},og.getDollhouseViewDefaultPose=function(t){return li.coreEvents.EventsDealt.GET_DOLLHOUSE_VIEW_DEFAULT_POSE(t)},og.getDollhouseViewBackwardPose=function(t){return li.coreEvents.EventsDealt.GET_DOLLHOUSE_VIEW_BACKWARD_POSE(t)},og.getViewMode=function(){return li.coreEvents.EventsDealt.GET_VIEW_MODE()},og.getSyncData=function(){return li.coreEvents.EventsDealt.GET_SYNC_DATA()},og.setSyncData=function(t){li.coreEvents.EventsDealt.SET_SYNC_DATA(t)},og.getWaypointsData=function(){return li.coreEvents.EventsDealt.GET_WAYPOINTS_DATA()},og.getLocationDistance=function(t,e){return li.coreEvents.EventsDealt.GET_LOCATION_DISTANCE(t,e)},og.getCloserLocation=function(t){return li.coreEvents.EventsDealt.GET_CLOSER_LOCATION(t)},og.getCameraLonLat=function(){return li.coreEvents.EventsDealt.GET_CAMERA_LON_LAT()},og.getCoreData=function(){return li.coreEvents.EventsDealt.GET_CORE_DATA()},og.getNeighboursOfVisible=function(t){return li.coreEvents.EventsDealt.GET_NEIGHBOURS_OF_VISIBLE(t)},og.getMarkerPosition=function(t){return li.coreEvents.EventsDealt.GET_MARKER_POSITION(t)},og.judgeBarrierBetweenThePoint=function(t,e){return li.coreEvents.EventsDealt.JUDGE_BARRIER_BETWEEN_THE_POINT_3(t,e)},og.judgeBarrierBetweenThePoint2=function(t,e){return li.coreEvents.EventsDealt.JUDGE_BARRIER_BETWEEN_THE_POINT_2(t,e)},og.judgeBarrierBetweenThePoint3=function(t,e){return li.coreEvents.EventsDealt.JUDGE_BARRIER_BETWEEN_THE_POINT_3(t,e)},og.getIntersectCountBetweenThePoint=function(t,e){return li.coreEvents.EventsDealt.GET_INTERSECT_COUNT_BETWEEN_THE_POINT_3(t,e)},og.getIntersectCountBetweenThePoint2=function(t,e){return li.coreEvents.EventsDealt.GET_INTERSECT_COUNT_BETWEEN_THE_POINT_2(t,e)},og.getIntersectCountBetweenThePoint3=function(t,e){return li.coreEvents.EventsDealt.GET_INTERSECT_COUNT_BETWEEN_THE_POINT_3(t,e)},og.setVerticalScopeOfPanoramaControl=function(t,e){li.coreEvents.EventsDealt.SET_VERTICAL_SCOPE_OF_PANORAMA_CONTROL(t,e)},og.setHorizontalScopeOfPanoramaControl=function(t,e){li.coreEvents.EventsDealt.SET_HORIZONTAL_SCOPE_OF_PANORAMA_CONTROL(t,e)},og.resetVerticalScopeOfPanoramaControl=function(){li.coreEvents.EventsDealt.RESET_VERTICAL_SCOPE_OF_PANORAMA_CONTROL()},og.resetHorizontalScopeOfPanoramaControl=function(){li.coreEvents.EventsDealt.RESET_HORIZONTAL_SCOPE_OF_PANORAMA_CONTROL()},og.cameraRotateOfVertical=function(t){li.coreEvents.EventsDealt.CAMERA_ROTATE_VERTICAL(t)},og.disableZoomControl=function(){li.coreEvents.EventsDealt.DISABLE_ZOOM_CONTTROL()},og.enableZoomControl=function(){li.coreEvents.EventsDealt.ENABLE_ZOOM_CONTTROL()},og.enterVr=function(){li.coreEvents.EventsDealt.ENTER_VR()},og.floorplanCameraRoate=function(t){li.coreEvents.EventsDealt.FLOORPLAN_CAMERA_ROTATE(t)},og.setPanoramaModeZoom=function(t){li.coreEvents.EventsDealt.SET_PANORAMA_MODE_ZOOM(t)},og.setDollhouseModeZoom=function(t){li.coreEvents.EventsDealt.SET_DOLLHOUSE_MODE_ZOOM(t)},og.setFloorplanModeZoom=function(t){li.coreEvents.EventsDealt.SET_FLOORPLAN_MODE_ZOOM(t)},og.setDollhousePolarAngle=function(t){li.coreEvents.EventsDealt.SET_DOLLHOUSE_POLAR_ANGLE(t)},og.setDollhouseControlTarget=function(t){li.coreEvents.EventsDealt.SET_DOLLHOUSE_CONTROL_TARGET(t)},og.enterCustomPanorama=function(t){pe.enterCustomPanorama(t)},og.hideModel=function(){li.coreEvents.EventsDealt.HIDE_MODEL()},og.showModel=function(){li.coreEvents.EventsDealt.SHOW_MODEL()},og.setModelAlpha=function(t){li.coreEvents.EventsDealt.SET_MODEL_ALPHA(t)},og.enableMagnifyingMode=function(){li.coreEvents.EventsDealt.ENABLE_MAGNIFYING_MODE()},og.disableMagnifyingMode=function(){li.coreEvents.EventsDealt.DISABLE_MAGNIFYING_MODE()},og.setMagnifyingPosition=function(t){li.coreEvents.EventsDealt.SET_MAGNIFYING_POSITION(t)},og.getLayers=function(){return li.coreEvents.EventsDealt.GET_LAYERS()},og.getIntersectWithinPointer=function(t,e){return li.raycasterEvents.GET_INTERSECT_WITHIN_POINTER(t,e)},og.hideMagnifyingGlass=function(){li.coreEvents.EventsDealt.HIDE_MAGNIFYING_GLASS()},og.showMagnifyingGlass=function(){li.coreEvents.EventsDealt.SHOW_MAGNIFYING_GLASS()},og.setMagnifyingGlassSize=function(t,e){li.coreEvents.EventsDealt.SET_MAGNIFYING_GLASS_SIZE(t,e)},og.getLoadedTextureMap=function(){return Ae},og.getPanoPoseMatrix=function(t){return li.coreEvents.EventsDealt.GET_PANO_POSE_MATRIX(t)},og.setSceneSkyboxBackground=function(t){li.coreEvents.EventsDealt.SET_SCENE_SKYBOX_BACKGROUND(t)},og.hideSceneSkyboxBackground=function(){li.coreEvents.EventsDealt.HIDE_SCENE_SKYBOX_BACKGROUND()},og.showSceneSkyboxBackground=function(){li.coreEvents.EventsDealt.SHOW_SCENE_SKYBOX_BACKGROUND()},og.stopRender=function(){li.coreEvents.EventsDealt.STOP_RENDER()},og.continueRender=function(){li.coreEvents.EventsDealt.CONTINUE_RENDER()},og.clearRender=function(){li.coreEvents.EventsDealt.CLEAR_RENDER()},og.enableAmbientLight=function(t){li.coreEvents.EventsDealt.ENABLE_AMBIENT_LIGHT(t)},og.enableDirectLight=function(t){li.coreEvents.EventsDealt.ENABLE_DIRECT_LIGHT(t)},og.disableAmbientLight=function(){li.coreEvents.EventsDealt.DISABLE_AMBIENT_LIGHT()},og.disableDirectLight=function(){li.coreEvents.EventsDealt.DISABLE_DIRECT_LIGHT()},og.setAmbientLightColor=function(t){li.coreEvents.EventsDealt.SET_AMBIENT_LIGHT_COLOR(t)},og.setAmbientLightIntensity=function(t){li.coreEvents.EventsDealt.SET_AMBIENT_LIGHT_INTENSITY(t)},og.setDirectLightColor=function(t){li.coreEvents.EventsDealt.SET_DIRECT_LIGHT_COLOR(t)},og.setDirectLightIntensity=function(t){li.coreEvents.EventsDealt.SET_DIRECT_LIGHT_INTENSITY(t)},og.setDirectLightPosition=function(t){li.coreEvents.EventsDealt.SET_DIRECT_LIGHT_POSITION(t)},og.setDirectLightLookAt=function(t){li.coreEvents.EventsDealt.SET_DIRECT_LIGHT_LOOKAT(t)},og.enableSceneFog=function(t){li.coreEvents.EventsDealt.ENABLE_SCENE_FOG(t)},og.disableSceneFog=function(){li.coreEvents.EventsDealt.DISABLE_SCENE_FOG()},og.addEventListener=function(t,e){var r=og.name+" add event listener<"+t+">";ig[t]?ig[t].cb.push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},og.removeEventListener=function(t,e){var r=og.name+" remove event listener<"+t+">";if(ig[t]){var i=ig[t].cb.indexOf(e);-1!==i?ig[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},og.getEventListener=function(){return Object.freeze(ig)},Object.keys(ig).forEach((function(t,e){var n=ig[t];n.en&&(lt.core.hook[n.en]=function(e){ig[t].cb.forEach((function(t){return t(e)}))})})),Object.freeze(og)};var ag={"switch.waypoint.start":{en:X.SWITCH_TO_PANO,cb:[]},"switch.waypoint.transition":{en:X.SWITCH_TO_PANO_TRANSITION,cb:[]},"switch.waypoint.complete":{en:X.SWITCH_TO_PANO_COMPLETE,cb:[]},"panorama.camera.rotate":{en:X.PANORAMA_CAMERA_ROTATE,cb:[]},"dollhouse.camera.rotate":{en:X.DOLLHOUSE_CAMERA_ROTATE,cb:[]},"panorama.camera.rotate.stop":{en:X.PANORAMA_CAMERA_ROTATE_STOP,cb:[]},"dollhouse.camera.rotate.stop":{en:X.DOLLHOUSE_CAMERA_ROTATE_STOP,cb:[]},"panorama.camera.zoom.changed":{en:X.PANORAMA_CAMERA_ZOOM_CHANGED,cb:[]},"dollhouse.camera.zoom.changed":{en:X.DOLLHOUSE_CAMERA_ZOOM_CHANGED,cb:[]},"dollhouse.camera.distance.zoom.changed":{en:X.DOLLHOUSE_CAMERA_DISTANCE_ZOOM_CHANGED,cb:[]},"floorplan.camera.zoom.changed":{en:X.FLOORPLAN_CAMERA_ZOOM_CHANGED,cb:[]},"dollhouse.camera.drag.moving":{en:X.DOLLHOUSE_CAMERA_DRAG_MOVING,cb:[]},"floorplan.camera.drag.moving":{en:X.FLOORPLAN_CAMERA_DRAG_MOVING,cb:[]},"mode.changed":{en:X.MODE_CHANGED,cb:[]}},sg=Object.create(null);sg.init=function(){delete sg.init,sg.flyToDollhouse=function(t){li.actionEvents.Methods.ACTION_MODE_DOLLHOUSE(t)},sg.flyToFloorplan=function(t){li.actionEvents.Methods.ACTION_MODE_FLOORPLAN(t)},sg.switchToPanoramaViewOfFLy=function(t){li.actionEvents.Methods.SWITCH_PANORAMA_VIEW_OF_FLY(t)},sg.switchToPanoramaViewOfFade=function(t){li.actionEvents.Methods.SWITCH_TO_PANORAMA_VIEW_OF_FADE(t)},sg.switchToPano=function(t){li.actionEvents.Methods.ACTION_SWITCH_TO_PANO(t)},sg.cameraLookAt=function(t){li.actionEvents.Methods.ACTION_CAMERA_LOOK_AT(t)},sg.cameraLookAtRotation=function(t){li.actionEvents.Methods.CAMERA_LOOKAT_ROTATION(t)},sg.cameraClockwiseRotate=function(t){li.actionEvents.Methods.CAMERA_CLOCKWISE_ROTATE(t)},sg.cameraAnticlockwiseRotate=function(t){li.actionEvents.Methods.CAMERA_ANTICLOCKWISE_ROTATE(t)},sg.switchToPurePano=function(t){li.actionEvents.Methods.SWITCH_TO_PANO(t)},sg.stopPanoramaControlRotation=function(t){li.actionEvents.Methods.STOP_PANORAMA_CONTROL_ROTATION(t)},sg.disableHitWall=function(){li.actionEvents.Methods.DISABLE_HIT_WALL()},sg.enableHitWall=function(){li.actionEvents.Methods.ENABLE_HIT_WALL()},sg.dollhouseCameraSwitchToPosition=function(t){li.actionEvents.Methods.DOLLHOUSE_CAMERA_SWITCH_TO_POSITION(t)},sg.dollhouseCameraSwitchToQuaternion=function(t){li.actionEvents.Methods.DOLLHOUSE_CAMERA_SWITCH_TO_QUATERNION(t)},sg.dollhouseCameraSwitchPose=function(t){li.actionEvents.Methods.DOLLHOUSE_CAMERA_SWITCH_POSE(t)},sg.flyToModelPanoramaMode=function(t){li.actionEvents.Methods.FLY_TO_MODEL_PANORAMA_MODE(t)},sg.flyToModelDollhouseMode=function(t){li.actionEvents.Methods.FLY_TO_MODEL_DOLLHOUSE_MODE(t)},sg.switchToModelPanoramaModeOfFade=function(t){li.actionEvents.Methods.SWITCH_TO_MODEL_PANORAMA_MODE_OF_FADE(t)},sg.switchToModelPanoramaViewOfFadeFromDollhouseView=function(t){li.actionEvents.Methods.SWITCH_TO_MODEL_PANORAMA_VIEW_OF_FADE_FROM_DOLLHOUSE_VIEW(t)},sg.addEventListener=function(t,e){var r=sg.name+" add event listener<"+t+">";ag[t]?ag[t].cb.push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},sg.removeEventListener=function(t,e){var r=sg.name+" remove event listener<"+t+">";if(ag[t]){var i=ag[t].cb.indexOf(e);-1!==i?ag[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},sg.getEventListener=function(){return Object.freeze(ag)},Object.keys(ag).forEach((function(t,e){var n=ag[t];n.en&&(lt.action.hook[n.en]=function(e){ag[t].cb.forEach((function(t){return t(e)}))})})),Object.freeze(sg)};var lg={"switch.floor.complete":{en:q.SWITCH_FLOOR_COMPLETE,cb:[]},"switch.scene.complete":{en:q.SWITCH_MODEL_COMPLETE,cb:[]},"add.model.complete":{en:q.ADD_MODEL_COMPLETE,cb:[]},"waypoint.hover.in":{en:q.WAYPOINT_HOVER_IN,cb:[]},"waypoint.hover.out":{en:q.WAYPOINT_HOVER_OUT,cb:[]}},cg=Object.create(null);cg.name="ModelApi",cg.init=function(){delete cg.init,cg.getActiveModelId=function(){return li.modelEvents.EventsDealt.GET_ACTIVE_MODEL_ID()},cg.getActiveModelType=function(){return li.modelEvents.EventsDealt.GET_ACTIVE_MODEL_TYPE()},cg.getAllFloorsInfo=function(){return li.modelEvents.EventsDealt.GET_ALL_FLOORS_INFO()},cg.getCurrentFloorInfo=function(){return li.modelEvents.EventsDealt.GET_CURRENT_FLOOR_INFO()},cg.getFloorTopVerticesScreenPosition=function(t){return li.modelEvents.EventsDealt.GET_FLOOR_TOP_VERTICES_SCREEN_POSITION(t)},cg.getFloorCenter=function(t){return li.modelEvents.EventsDealt.GET_FLOOR_CENTER(t)},cg.getFloorSize=function(t){return li.modelEvents.EventsDealt.GET_FLOOR_SIZE(t)},cg.getFloorBox3=function(t){return li.modelEvents.EventsDealt.GET_FLOOR_BOX3(t)},cg.getFloorScreenCenter=function(t){return li.modelEvents.EventsDealt.GET_FLOOR_SCREEN_CENTER(t)},cg.switchFloor=function(t){li.modelEvents.EventsDealt.SWITCH_FLOOR(t)},cg.enableFloor=function(t){li.modelEvents.EventsDealt.ENABLE_FLOOR(t)},cg.disableFloor=function(t){li.modelEvents.EventsDealt.DISABLE_FLOOR(t)},cg.showFloor=function(t){li.modelEvents.EventsDealt.SHOW_FLOOR(t)},cg.hideFloor=function(t){li.modelEvents.EventsDealt.HIDE_FLOOR(t)},cg.setModelOpacity=function(t){li.modelEvents.EventsDealt.SET_MODEL_OPACITY(t)},cg.setFloorOpacity=function(t,e){li.modelEvents.EventsDealt.SET_FLOOR_OPACITY(t,e)},cg.setChunkOpacity=function(t,e){li.modelEvents.EventsDealt.SET_CHUNK_OPACITY(t,e)},cg.switchModel=function(t){li.modelEvents.EventsDealt.SWITCH_MODEL(t)},cg.switchPurepano=function(t){li.modelEvents.EventsDealt.SWITCH_PUREPANO(t)},cg.switchModelVisible=function(t){li.modelEvents.EventsDealt.SWITCH_MODEL_VISIBLE(t)},cg.viewMesh=function(){li.modelEvents.EventsDealt.VIEW_MESH()},cg.unViewMesh=function(){li.modelEvents.EventsDealt.UN_VIEW_MESH()},cg.enablePano=function(t){li.modelEvents.EventsDealt.ENABLE_PANO(t)},cg.disablePano=function(t){li.modelEvents.EventsDealt.DISABLE_PANO(t)},cg.getPanoPosition=function(t){return li.modelEvents.EventsDealt.GET_PANO_POSITION(t)},cg.showWaypoint=function(t,e){li.modelEvents.EventsDealt.SHOW_WAYPOINT(t,e)},cg.hideWaypoint=function(t,e){li.modelEvents.EventsDealt.HIDE_WAYPOINT(t,e)},cg.setWaypointPic=function(t){li.modelEvents.EventsDealt.SET_WAYPOINT_PIC(t)},cg.setAllWaypointPic=function(t){li.modelEvents.EventsDealt.SET_ALL_WAYPOINT_PIC(t)},cg.setWaypointTexture=function(t){li.modelEvents.EventsDealt.SET_WAYPOINT_TEXTURE(t)},cg.resetWaypoint=function(t){li.modelEvents.EventsDealt.RESET_WAYPOINT(t)},cg.setWaypointSwitchConfig=function(t){li.modelEvents.EventsDealt.SET_SINGLE_WAYPOINT_SWITCH_CONFIG(t)},cg.getWaypointPosition=function(t){return li.modelEvents.EventsDealt.GET_WAYPOINT_POSITION(t)},cg.getFacesCount=function(){return li.modelEvents.EventsDealt.GET_MODEL_FACES_COUNT()},cg.getVerticesCount=function(){return li.modelEvents.EventsDealt.GET_MODEL_VERTICES_COUNT()},cg.showColliderMask=function(t){li.modelEvents.EventsDealt.SHOW_COLLIDER_MASK(t)},cg.hideColliderMask=function(){li.modelEvents.EventsDealt.HIDE_COLLIDER_MASK()},cg.getCenter=function(){return li.modelEvents.EventsDealt.GET_CENTER()},cg.getBoundingBox=function(){return li.modelEvents.EventsDealt.GET_BOUDING_BOX()},cg.addModel=function(t){li.modelEvents.EventsDealt.ADD_MODEL(t)},cg.removeModel=function(t){li.modelEvents.EventsDealt.REMOVE_MODEL(t)},cg.setChunksMaterialSide=function(t){li.modelEvents.EventsDealt.SET_CHUNKS_MATERIAL_SIDE(t)},cg.addEventListener=function(t,e){var r=cg.name+" add event listener<"+t+">";lg[t]?lg[t].cb.push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},cg.removeEventListener=function(t,e){var r=cg.name+" remove event listener<"+t+">";if(lg[t]){var i=lg[t].cb.indexOf(e);-1!==i?lg[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},cg.getEventListener=function(){return Object.freeze(lg)},Object.keys(lg).forEach((function(t,e){var n=lg[t];lt.model.hook[n.en]=function(e){lg[t].cb.forEach((function(t){return t(e)}))}}))};var ug=Object.create(null);ug.init=function(){delete ug.init,ug.isSwitchToPano=function(){return Ht.actionStateEngine.state[li.actionEvents.Events.SWITCH_TO_PANO].state},ug.isSwitchToNewMode=function(){return Ht.actionStateEngine.state[li.actionEvents.Events.ACTION_MODE_DOLLHOUSE].state||Ht.actionStateEngine.state[li.actionEvents.Events.ACTION_MODE_PANORAMA].state||Ht.actionStateEngine.state[li.actionEvents.Events.ACTION_MODE_FLOORPLAN].state},ug.isDisableSwitchModel=function(){return Ht.modelStateEngine.state[li.modelEvents.Events.DISABLE_SWITCH_MODEL].state},ug.isDisableSwitchPurepano=function(){return Ht.modelStateEngine.state[li.modelEvents.Events.DISABLE_SWITCH_PUREPANO].state},ug.isEnableMagnifyingMode=function(){return Ht.coreStateEngine.state[li.coreEvents.Events.ENABLE_MAGNIFYING_MODE].state},ug.getMousePointer=function(){return Ht.mouseStateEngine.state[li.mouseEvents.Events.MOUSE_MOVE].data}};var hg=Object.create(null);hg.name="WebXrApi",hg.init=function(){delete hg.init,hg.enterVrMode=function(){li.webxrEvents.enterVrMode()},hg.exitVrMode=function(){li.webxrEvents.exitVrMode()},hg.getGlobalScale=function(){return li.webxrEvents.getGlobalScale()},Object.defineProperties(hg,{onExitVrMode:{set:function(t){li.webxrEvents.onExitVrMode=t},get:function(){return li.webxrEvents.onExitVrMode}}})};var pg=Object.create(null),dg=null;pg.init=function(){delete pg.init,dg=k.getCore()},pg.initSceneCameraConfig=function(t){!function(t){ea.Near=t.near,ea.Far=t.far}(t)},pg.getPanoramaCamera=function(){return dg.player.controls[G.PANORAMA].camera},pg.getDollhouseCamera=function(){return dg.player.controls[G.DOLLHOUSE].camera},pg.getFloorplanCamera=function(){return dg.player.controls[G.FLOORPLAN].camera},pg.getLookAtTarget=function(){return dg.player&&dg.player.control?dg.player.control.camera.getLookAtTarget():null},pg.setPanoramaCameraFov=function(t){dg.player.cameras[G.PANORAMA].setFov(t)},pg.setPanoramaCameraZoom=function(t){dg.player.cameras[G.PANORAMA].setZoom(t)},pg.setPanoramaCameraPosition=function(t){dg.player.cameras[G.PANORAMA].setPosition(t)},pg.setPanoramaCameraQuaternion=function(t){dg.player.cameras[G.PANORAMA].setQuaternion(t)},pg.getPanoramaCameraFov=function(){return dg.player.cameras[G.PANORAMA].fov},pg.getPanoramaCameraZoom=function(){return dg.player.cameras[G.PANORAMA].zoom},pg.getPanoramaCameraPosition=function(){var t=dg.player.cameras[G.PANORAMA].position;return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z})},pg.getPanoramaCameraQuaternion=function(){var t=dg.player.cameras[G.PANORAMA].quaternion;return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z,w:t.w})},pg.setDollhouseCameraFov=function(t){dg.player.cameras[G.DOLLHOUSE].setFov(t)},pg.setDollhouseCameraZoom=function(t){dg.player.cameras[G.DOLLHOUSE].setZoom(t)},pg.setDollhouseCameraPosition=function(t){dg.player.cameras[G.DOLLHOUSE].setPosition(t)},pg.setDollhouseCameraQuaternion=function(t){dg.player.cameras[G.DOLLHOUSE].setQuaternion(t)},pg.setDollhouseCameraDistanceLimit=function(t){fe.minMoveDistance=t.min,fe.maxMoveDistance=t.max},pg.getDollhouseCameraFov=function(){return dg.player.cameras[G.DOLLHOUSE].fov},pg.getDollhouseCameraZoom=function(){return dg.player.cameras[G.DOLLHOUSE].zoom},pg.getDollhouseCameraPosition=function(){var t=dg.player.cameras[G.DOLLHOUSE].position;return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z})},pg.getDollhouseCameraQuaternion=function(){var t=dg.player.cameras[G.DOLLHOUSE].quaternion;return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z,w:t.w})},pg.setSceneCameraNear=function(t){dg.sceneRender.camera.setNear(t)},pg.setSceneCameraFar=function(t){dg.sceneRender.camera.setFar(t)},pg.setSceneCameraFov=function(t){dg.sceneRender.camera.setFov(t)},pg.setSceneCameraZoom=function(t){dg.sceneRender.camera.setZoom(t)},pg.magnifyingCameraLookAtTarget=function(t){dg.sceneRender.magnifyingCamera.lookAtTarget(t)},pg.magnifyingCameraSetZoom=function(t){dg.sceneRender.magnifyingCamera.setZoom(t)},pg.magnifyingCameraSetFov=function(t){dg.sceneRender.magnifyingCamera.setFov(t)},pg.magnifyingCameraSetPosition=function(t){dg.sceneRender.magnifyingCamera.setPosition(t)},pg.getMagnifyingCameraPosition=function(){var t=dg.sceneRender.magnifyingCamera.getPosition();return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z})},pg.getMagnifyingCameraDefaultZoom=function(){return dg.sceneRender.magnifyingCamera.defaultZoom};var fg={"intersect.model":{en:J.INTERSECT_WITHIN_MODEL,cb:[]},"unintersect.model":{en:J.UNINTERSECT_WITHIN_MODEL,cb:[]}},mg=Object.create(null);mg.init=function(){delete mg.init,k.getCore(),mg.addEventListener=function(t,e){var r=mg.name+" add event listener<"+t+">";fg[t]?fg[t].cb.push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},mg.removeEventListener=function(t,e){var r=mg.name+" remove event listener<"+t+">";if(fg[t]){var i=fg[t].cb.indexOf(e);-1!==i?fg[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},mg.getEventListener=function(){return fg},Object.keys(fg).forEach((function(t,e){var n=fg[t];lt.raycaster.hook[n.en]=function(e){fg[t].cb.forEach((function(t){return t(e)}))}}))};var vg=Object.create(null);function gg(){var t=this;this.name="CommonApi",this.coreEvents=og,this.camera=pg,this.actionEvents=sg,this.modelEvents=cg,this.state=ug,this.webxr=hg,this.raycaster=mg,this.waypoint=vg,this.init=function(){delete t.init,og.init(),pg.init(),sg.init(),cg.init(),ug.init(),hg.init(),mg.init(),vg.init(),Object.freeze(t)}}vg.init=function(){delete vg.init,vg.setScale=function(t,e){li.modelEvents.EventsDealt.SET_WAYPOINT_SCALE(t,e)},vg.setColor=function(t,e){li.modelEvents.EventsDealt.SET_WAYPOINT_COLOR(t,e)},vg.setOpacity=function(t,e){li.modelEvents.EventsDealt.SET_WAYPOINT_OPACITY(t,e)}};var yg=Object.create(null),_g=null,Eg=null;function Tg(t,e){Object.keys(Eg[t]).forEach((function(r){!function(t,e,r){var i=Eg[t][e].onApi[t];i?mt(i,e+" onApi: "+t)&&r(i):n.error("Ext:"+e+" registered API<"+t+"> but never used!")()}(t,r,(function(t){t&&t(e)}))}))}yg.init=function(t){Eg=(_g=t).ApiExts,_g[z.NEED_UPDATE]=function(t){Tg(z.NEED_UPDATE,t)},_g[z.NEED_CORE_LOADED]=function(t){Tg(z.NEED_CORE_LOADED,t)},_g[z.NEED_ON_RESIZE]=function(t){Tg(z.NEED_ON_RESIZE,t)},_g[z.NEED_PANORAMA_CAMERA_ROTATE]=function(t){Tg(z.NEED_PANORAMA_CAMERA_ROTATE,t)},_g[z.NEED_DOLLHOUSE_CAMERA_ROTATE]=function(t){Tg(z.NEED_DOLLHOUSE_CAMERA_ROTATE,t)},_g[z.NEED_PANORAMA_CAMERA_ROTATE_STOP]=function(t){Tg(z.NEED_PANORAMA_CAMERA_ROTATE_STOP,t)},_g[z.NEED_DOLLHOUSE_CAMERA_ROTATE_STOP]=function(t){Tg(z.NEED_DOLLHOUSE_CAMERA_ROTATE_STOP,t)},_g[z.NEED_PANORAMA_CAMERA_ZOOM_CHANGED]=function(t){Tg(z.NEED_PANORAMA_CAMERA_ZOOM_CHANGED,t)},_g[z.NEED_DOLLHOUSE_CAMERA_ZOOM_CHANGED]=function(t){Tg(z.NEED_DOLLHOUSE_CAMERA_ZOOM_CHANGED,t)},_g[z.NEED_MODEL_SET_FLOOR]=function(t){Tg(z.NEED_MODEL_SET_FLOOR,t)},_g[z.NEED_MOUSE_MOVE_WITHOUT_BUTTON_DOWN]=function(t){Tg(z.NEED_MOUSE_MOVE_WITHOUT_BUTTON_DOWN,t)},_g[z.NEED_MOUSE_OUT]=function(t){Tg(z.NEED_MOUSE_OUT,t)},_g[z.NEED_MOUSE_MOVE_STOP]=function(t){Tg(z.NEED_MOUSE_MOVE_STOP,t)},_g[z.NEED_MOUSE_LEFT_BUTTON_DOWN]=function(t){Tg(z.NEED_MOUSE_LEFT_BUTTON_DOWN,t)},_g[z.NEED_MOUSE_LEFT_BUTTON_UP]=function(t){Tg(z.NEED_MOUSE_LEFT_BUTTON_UP,t)},_g[[z.NEED_MOUSE_RIGHT_BUTTON_DOWN_UP_WITHOUT_MOVE]]=function(t){Tg(z.NEED_MOUSE_RIGHT_BUTTON_DOWN_UP_WITHOUT_MOVE,t)},_g[z.NEED_MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE]=function(t){Tg(z.NEED_MOUSE_LEFT_BUTTON_DOWN_UP_WITHOUT_MOVE,t)},_g[z.NEED_MOUSE_MOVE_INTERSECT_WITHIN_MODEL]=function(t){Tg(z.NEED_MOUSE_MOVE_INTERSECT_WITHIN_MODEL,t)},_g[z.NEED_MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE]=function(t){Tg(z.NEED_MOUSE_LEFT_BUTTON_DOWN_WITHIN_MOVE,t)},_g[z.NEED_POINTER_MOVE_UNGET_INTERSECT_WITHIN_MODEL]=function(t){Tg(z.NEED_POINTER_MOVE_UNGET_INTERSECT_WITHIN_MODEL,t)},_g[z.NEED_HANDLE_SINGLE_TOUCH_START]=function(t){Tg(z.NEED_HANDLE_SINGLE_TOUCH_START,t)},_g[z.NEED_HANDLE_SINGLE_TOUCH_END]=function(t){Tg(z.NEED_HANDLE_SINGLE_TOUCH_END,t)},_g[z.NEED_HANDLE_CLICK]=function(t){Tg(z.NEED_HANDLE_CLICK,t)},_g[z.NEED_SWITCH_WAYPOINT_START]=function(t){Tg(z.NEED_SWITCH_WAYPOINT_START,t)},_g[z.NEED_SWITCH_WAYPOINT_TRANSITION]=function(t){Tg(z.NEED_SWITCH_WAYPOINT_TRANSITION,t)},_g[z.NEED_SWITCH_WAYPOINT_COMPLETE]=function(t){Tg(z.NEED_SWITCH_WAYPOINT_COMPLETE,t)},_g[z.NEED_MODE_CHANGE]=function(t){Tg(z.NEED_MODE_CHANGE,t)},_g[z.NEED_MODE_TRANSITION]=function(t){Tg(z.NEED_MODE_TRANSITION,t)},_g[z.NEED_SWITCH_MODEL]=function(t){Tg(z.NEED_SWITCH_MODEL,t)},_g[z.NEED_SWITCH_MODEL_COMPLETE]=function(t){Tg(z.NEED_SWITCH_MODEL_COMPLETE,t)},_g[z.NEED_ENTER_VR_MODE]=function(t){Tg(z.NEED_ENTER_VR_MODE,t)},_g[z.NEED_EXIT_VR_MODE]=function(t){Tg(z.NEED_EXIT_VR_MODE,t)},_g[z.NEED_XR_CONTROL_INTERSECT_WITHN_MODEL]=function(t){Tg(z.NEED_XR_CONTROL_INTERSECT_WITHN_MODEL,t)}};var xg=Object.create(null),bg=Object.create(null);Object.keys(z).forEach((function(t){bg[z[t]]=Object.create(null)}));var Mg=Object.create(null);function Ag(){this.name="CommonExtension",this.API=Object.freeze(z),this.ApiExts=Object.freeze(bg)}Mg.canbeUse=!1,Mg.isInited=!1,Ag.prototype.init=function(){n.info(this.name+" init")(),k.getCore(),Mg.isInited?n.warn(this.name+" repeat init")():(Mg.isInited=!0,yg.init(this),Object.freeze(this))},Ag.prototype.canbeUse=function(){return Mg.isInited},Ag.prototype.addExt=function(t,e){!function(t){var e=t.registeredApi;Object.keys(e).forEach((function(r){bg[r]?(!0===e[r]&&(bg[r][t.name]=t),e[r]):n.error("Ext:"+t.name+" registered API <"+r+"> invalid!")()}))}(t),xg[t.name]=t,mt(e,"add ext complete")&&e()},Ag.prototype.removeExt=function(t,e){xg[t]&&(delete xg[t],Object.keys(bg).forEach((function(e){delete bg[e][t]})),mt(e,"remove ext complete")&&e())};var Sg=Object.create(null),Og={development:function(){Sg.env="development",Sg.bundle="2024/12/26 10:52:04",Sg.THREE=L,Sg.TWEEN=Nn,Sg.core=wg,Sg.math=Ve,Sg.browser=he,Sg.ViewMode=G,Sg.SyncData=Re,Sg.bus=k,Sg.bus2=j,Sg.mylog=n,Sg.Layers=ve,Sg.threeTrickTools=Sn,Sg.browserSupportManager=w,Sg.commonEvents=wg.commonEvents,Sg.commonExtension=wg.commonExtension,Sg.ExecTime=hs},production:function(){Sg.env="development",Sg.bundle="2024/12/26 10:52:04",Sg.THREE=L,Sg.TWEEN=Nn,Sg.math=Ve,Sg.common=Dt,Sg.ViewMode=G,Sg.browser=he,Sg.threeTrickTools=Sn,Sg.commonEvents=wg.commonEvents,Sg.commonExtension=wg.commonExtension}},wg=null,Lg=function(){k.carrayCore(this),this.name="Core",this.data=null,this.lifeCycle=new ko,this.sceneRender=null,this.modelManager=null,this.purepanoManager=null,this.player=null,this.tileDownloader=null,this.panoRenderer=null,this.qualityManager=null,this.eventsManager=li,this.statusManager=Ht,this.hookManager=lt,this.interactionManager=new nv,this.waypointManager=new rg,this.webxrManager=new uv,this.uilogManager=new xv,this.guiLogManager=new Av,this.startModeManager=To,this.adapterManager=_e,this.sixCubeLoader=Si,this.commonEvents=new gg,this.commonExtension=new Ag,this.pure3D=!1,this.entryMode="",this.bootOptions=Object.create(null),this.init()};function Dg(t){null===wg.sceneRender&&(wg.sceneRender=new cs,wg.sceneRender.start()),null===wg.modelManager&&(wg.modelManager=new rm),null===wg.purepanoManager&&(wg.purepanoManager=new jm,wg.purepanoManager.init()),null===wg.qualityManager&&(wg.qualityManager=new rl,wg.qualityManager.init()),null===wg.player&&(wg.player=new el,wg.modelManager.init());var e=wg.modelManager.createModel(t);wg.lifeCycle.onCreatedModel(e);var n=_e.getRenderMode();if("lod"===n&&(wg.tileDownloader||(wg.tileDownloader=new Cl,wg.tileDownloader.init()),wg.panoRenderer||(wg.panoRenderer=new Jl),wg.tileDownloader.start(),wg.panoRenderer.start()),e.init(),"6cube"===n){var r=e.panos.list.map((function(t){return{pano_id:t.id,pano_neighbour:t.neighbourUUIDs,_512:Qo(t.id,"512"),_1024:Qo(t.id,"1024"),_2048:Qo(t.id,"2048")}}));Si.init(r)}"lod"===n&&(wg.tileDownloader&&wg.tileDownloader.setPanoData(e.modelid,e.panos),wg.qualityManager&&wg.qualityManager.updateMaximums(void 0,"core dealt model data")),wg.modelManager.addModel(e),wg.player.setModel(e),To.init()}return Lg.prototype.init=function(){var t="--- "+this.name+" init ---";n.info(""+t)(),this.lifeCycle.start(),this.hookManager.init(),this.interactionManager.init(),this.statusManager.init(),this.eventsManager.init(),this.commonEvents.init(),this.eventsManager.bind()},Lg.prototype.initData=function(t){this.data=t,function(t){switch(t.type){case kt:case zt:case Gt:ce((function(){n.error("is support vr session!!!")(),t.basic.render_mode="6cube",t.basic.render_set="1024",_e.setCoreData(t),Dg(t)}),(function(){_e.setCoreData(t),Dg(t)}));break;case Wt:_e.setCoreData(t),function(t){null===wg.sceneRender&&(wg.sceneRender=new cs,wg.sceneRender.start()),null===wg.modelManager&&(wg.modelManager=new rm),null===wg.player&&(wg.player=new el),null===wg.purepanoManager&&(wg.purepanoManager=new jm,wg.purepanoManager.init());var e=t.basic.pano_id,n=t.basic.panorama_camera_fov;wg.purepanoManager.tileRenderer.init();var r=wg.purepanoManager.createPanoSphere({id:e,fov:n});r.entry_anima=t.entry_info.anima||r.entry_anima,r.entry_quaternion.copy(t.entry_info.rotation),wg.purepanoManager.enter("boot",r,(function(){}),(function(){wg.lifeCycle.onPurepanoEnterComplete()}))}(t)}}(t)},Lg.prototype.boot=function(t){void 0===t&&(t=Object.create(null)),this.lifeCycle.onBoot(t),function(t){t?(wg.bootOptions.onProgress=t.onProgress||function(){},wg.bootOptions.onLoaded=t.onLoaded||function(){},!1!==Rn.CoreData(t.data)?wg.initData(t.data):n.error("check boot options failure!, reason: invalid boot data!")()):n.error("check boot options failure!, invalid options")()}(t)},wg=new Lg,Og.development(),Object.freeze(Sg)}()}),"/$$rollup_base$$/src/lib/core"),f=d.browser,m=d.commonEvents,v=Object.create(null);v.parent_count=0,v.offset_left=0,v.offset_top=0;var g={isMobile:f.isMobile,isPc:f.isPc,isPicoNeo3Browser:f.isPicoNeo3Browser,getAnimationFrame:f.getAnimationFrame,isSpecialMobile:function(){return!(-1===window.navigator.userAgent.indexOf("SamsungBrowser")||!f.isMobile())||!!function(){var t=window.navigator.userAgent.split("/").find((function(t){return-1!==t.indexOf("Mobile Safari")}));if(t){if(t.split(".")[0]-0>78)return!0}return!1}()},isWebxr:function(){return f.isVr2()},getUrlParam:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?decodeURI(n[2]):null},getRenderStageSize:function(){var t=m.coreEvents.getRendererStage();return{w:t.clientWidth,h:t.clientHeight}},getRendererStageOffsetInfo:function(){if(0!==v.parent_count)return v;var t=m.coreEvents.getRendererStage(),e=0,n=0,r=0,i=function(t){n+=t.offsetLeft,r+=t.offsetTop,t.offsetParent&&(e++,i(t.offsetParent))};return i(t),v.parent_count=e,v.offset_left=n,v.offset_top=r,v}};u.commonjsRegister("/$$rollup_base$$/src/api/core.js",(function(t,e){var n=p,r=d.commonEvents,i=d.core,o=Object.create(null),a=null;Object.defineProperties(o,{render_type:{get:function(){return r.modelEvents.getActiveModelType()}},rendererCanvas:{get:function(){return r.coreEvents.getRendererCanvas()}},rendererStage:{get:function(){return r.coreEvents.getRendererStage()}},layers:{get:function(){return Object.assign(Object.create(null),r.coreEvents.getLayers())}},magnifying_renderer_enabled:{get:function(){return!1}}});var s={LOADED:"loaded",ENTRY_PANO_LOADED:"entry.pano.loaded",PUREPANO_LOADED:"purepano.loaded",PUREPANO_ANIMATION_START:"purepano.animation.start",PUREPANO_ANIMATION_END:"purepano.animation.end",SWITCH_SCENE_COMPLETE:"switch.scene.complete",RENDER_SIZE_CHANGED:"render.size.changed"},l=Object.create(null);Object.keys(s).forEach((function(t){l[s[t]]=[]})),o.initConfig=function(t){r.coreEvents.initConfig(t)},o.initData=function(t){a=t},o.getRenderer=function(){return i.sceneRender.renderer},o.beginRender=function(t){void 0===t&&(t={});if(a){var e=t.onProgress||function(){},o=t.onLoaded||function(){};if(n.info("%cbegin render, data type:"+a.type,"color:cyan;")(),null===i.data)r.coreEvents.runStart({data:a,onProgress:function(t){e(t)},onLoaded:function(t){o(JSON.parse(JSON.stringify(a)))}});else{if("model"===a.type)return r.coreEvents.continueRender(),void r.modelEvents.switchModel({model_id:a.id,data:a});if("virtual"===a.type)return r.coreEvents.continueRender(),void r.modelEvents.switchModel({model_id:a.id,data:a});if("dsm"===a.type)return r.coreEvents.continueRender(),void r.modelEvents.switchModel({model_id:a.id,data:a});if("purepano"===a.type)return r.coreEvents.continueRender(),void r.modelEvents.switchPurepano({id:a.id,data:a})}a=null}else n.error("begin render failure, reason: unget init data!")()},o.stopRender=function(){r.coreEvents.stopRender()},o.continueRender=function(){r.coreEvents.continueRender()},o.clearRender=function(){r.coreEvents.clearRender()},o.enableMagnifyingGlass=function(){r.coreEvents.enableMagnifyingMode()},o.disableMagnifyingGlass=function(){r.coreEvents.disableMagnifyingMode()},o.enableMagnifyingRender=function(){r.coreEvents.enableMagnifyingMode()},o.disableMagnifyingRender=function(){r.coreEvents.disableMagnifyingMode()},o.enterVr=function(){r.webxr.enterVrMode()},o.exitVr=function(){r.webxr.exitVrMode()},o.enableCss3d=function(){i.sceneRender.enableCss3d()},o.disableCss3d=function(){i.sceneRender.disableCss3d()},o.getPanoramaCamera=function(){return r.camera.getPanoramaCamera()},o.getDollhouseCamera=function(){return r.camera.getDollhouseCamera()},o.getFloorplanCamera=function(){return r.camera.getFloorplanCamera()},o.getSceneCamera=function(){return i.sceneRender.camera},o.getCurrentPanoSkyBoxMatrix=function(){return i.player.currentPano.poseMatrix.clone()},o.getCurrentPanoSkyBoxCubeTexture=function(){return i.player.currentPano.tiledPanoRenderTarget.texture},o.getPurepanoEnvMap=function(){return i.player.model.material.envMap},o.getRendererCanvasBase64OfFullScreen=function(){return r.coreEvents.getRendererCanvasBase64OfFullScreen()},o.getRendererCanvasBase64OfCustomSize=function(t,e,n){r.coreEvents.getRendererCanvasBase64OfCustomSize(t,e,n)},o.enableShadowRenderer=function(){i.sceneRender.renderer.enableShadow()},o.addEventListener=function(t,e){var r=o.name+" add event listener<"+t+">";l[t]?l[t].push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},o.removeEventListener=function(t,e){var r=o.name+" remove event listener<"+t+">";if(l[t]){var i=l[t].indexOf(e);-1!==i?l[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},o.getEventListener=function(){return l},r.coreEvents.addEventListener("loaded",(function(t){l[s.LOADED].forEach((function(t){return t(JSON.parse(JSON.stringify(r.coreEvents.getCoreData())))}))})),r.coreEvents.addEventListener("entry.pano.loaded",(function(t){l[s.ENTRY_PANO_LOADED].forEach((function(e){return e(t)}))})),r.coreEvents.addEventListener("purepano.loaded",(function(t){l[s.PUREPANO_LOADED].forEach((function(e){return e(t)}))})),r.coreEvents.addEventListener("purepano.animation.start",(function(t){l[s.PUREPANO_ANIMATION_START].forEach((function(e){return e(t)}))})),r.coreEvents.addEventListener("purepano.animation.end",(function(t){l[s.PUREPANO_ANIMATION_END].forEach((function(e){return e(t)}))})),r.modelEvents.addEventListener("switch.scene.complete",(function(t){l[s.SWITCH_SCENE_COMPLETE].forEach((function(e){return e(t)}))})),r.coreEvents.addEventListener("renderer.resize",(function(t){l[s.RENDER_SIZE_CHANGED].forEach((function(e){return e(t)}))})),t.exports=Object.freeze(o)})),u.commonjsRegister("/$$rollup_base$$/src/api/scene.js",(function(t,e){var n=d.core,r=d.commonEvents,i=Object.create(null);Object.defineProperties(i,{scene:{get:function(){return n.sceneRender.scene}}}),i.add=function(t){r.coreEvents.sceneAdd(t)},i.remove=function(t){r.coreEvents.sceneRemove(t)},i.setSkyboxBackground=function(t){var e=t.pics,n=t.complete||function(){};r.coreEvents.setSceneSkyboxBackground({pics:e,complete:function(){n()}})},i.removeSkyboxBackground=function(){},i.hideSkyboxBackground=function(){r.coreEvents.hideSceneSkyboxBackground()},i.showSkyboxBackground=function(){r.coreEvents.showSceneSkyboxBackground()},i.enableFog=function(t){r.coreEvents.enableSceneFog({color:t.color,near:t.near,far:t.far})},i.disableFog=function(){r.coreEvents.disableSceneFog()},t.exports=Object.freeze(i)}));var y=e((function(t){!function(){var e=d.TWEEN;t.exports=e}()}),"/$$rollup_base$$/src/lib/tween");u.commonjsRegister("/$$rollup_base$$/src/api/model.js",(function(t,e){var n=p,r=y,i=d.core,o=d.commonEvents,a={SWITCH_WAYPOINT_START:"switch.waypoint.start",SWITCH_WAYPOINT_TRANSITION:"switch.waypoint.transition",SWITCH_WAYPOINT_COMPLETE:"switch.waypoint.complete",SWITCH_FLOOR_COMPLETE:"switch.floor.complete",ADD_MODEL_COMPLETE:"add.model.complete",WAYPOINT_HOVER_IN:"waypoint.hover.in",WAYPOINT_HOVER_OUT:"waypoint.hover.out",INTERSECT:"intersect",UNINTERSECT:"unintersect"},s=Object.create(null);Object.keys(a).forEach((function(t){s[a[t]]=[]}));var l=Object.create(null),c=null,u=null;Object.defineProperties(l,{type:{get:function(){return o.modelEvents.getActiveModelType()}},id:{get:function(){return o.modelEvents.getActiveModelId()}},size:{get:function(){return i.player.model.size}},center:{get:function(){var t=Object.create(null),e=o.modelEvents.getCenter();return t.x=e.x,t.y=e.y,t.z=e.z,t}},face_count:{get:function(){return i.player.model.trickTools.getChunksFaceCount()}},floors:{get:function(){return o.modelEvents.getAllFloorsInfo()}},waypoints:{get:function(){return o.coreEvents.getWaypointsData()}},floor:{get:function(){return o.modelEvents.getCurrentFloorInfo()}},waypoint:{get:function(){return o.coreEvents.getCurrentPanoId()}},isEnabledSwitchWaypoint:{get:function(){return!i.statusManager.actionStateEngine.state["disable.switch.pano"].state}}}),l.add=function(t){o.modelEvents.addModel(t)},l.remove=function(t){o.modelEvents.removeModel(t)},l.switchWaypoint=function(t){var e=t.location_id,n=t.lookat_target,r=t.quaternion,i=t.zoom,a=t.switch_mode,s=t.free_rotate,l=t.duration,c=t.complete||function(){},u=Object.create(null);u.location_id=e,n&&(u.lookat_target=n),r&&(u.quaternion=r),i&&(u.zoom=i),a&&(u.switch_mode=a),s&&(u.free_rotate=s),l&&(u.duration=l),u.complete=c,o.actionEvents.switchToPano(u)},l.disableSwitchWaypoint=function(){o.coreEvents.disableSwitchToPano()},l.enableSwitchWaypoint=function(){o.coreEvents.enableSwitchToPano()},l.disableWaypoint=function(t){o.modelEvents.disablePano(t)},l.enableWaypoint=function(t){o.modelEvents.enablePano(t)},l.getCloserWaypoint=function(t){return o.coreEvents.getCloserLocation(t)},l.hideWaypoint=function(t){o.modelEvents.hideWaypoint(t)},l.showWaypoint=function(t){o.modelEvents.showWaypoint(t)},l.setWaypointTexture=function(t){o.modelEvents.setWaypointPic(t)},l.setAllWaypointTexture=function(t){o.modelEvents.setAllWaypointPic(t)},l.setWaypointColor=function(t,e){o.waypoint.setColor(t,e)},l.setWaypointScale=function(t,e){o.waypoint.setScale(t,e)},l.setWaypointOpacity=function(t,e){o.waypoint.setOpacity(t,e)},l.getWaypointPosition=function(t){return o.modelEvents.getWaypointPosition(t)},l.getVisibleNeighbours=function(t){return o.coreEvents.getNeighboursOfVisible(t)},l.switchFloor=function(t){o.modelEvents.switchFloor(t)},l.showFloor=function(t){o.modelEvents.showFloor(t)},l.hideFloor=function(t){o.modelEvents.hideFloor(t)},l.enableFloor=function(t){o.modelEvents.enableFloor(t)},l.disableFloor=function(t){o.modelEvents.disableFloor(t)},l.setOpacity=function(t){o.modelEvents.setModelOpacity(t)},l.setFloorOpacity=function(t,e){o.modelEvents.setFloorOpacity(t,e)},l.getFloorCenter=function(t){return o.modelEvents.getFloorCenter(t)},l.getFloorScreenCenter=function(t){return o.modelEvents.getFloorScreenCenter(t)},l.getFloorTopVertexScreenPosition=function(t){return o.modelEvents.getFloorTopVerticesScreenPosition(t)},l.getFloorBoundingBox=function(t){var e=o.modelEvents.getFloorBox3(t),n=e.min,r=e.max;return{max:Object.assign({},n),min:Object.assign({},r)}},l.getBoundingBox=function(){var t=o.modelEvents.getBoundingBox(),e=t.max,n=t.min;return{max:Object.assign({},e),min:Object.assign({},n)}},l.getPanoInfo=function(t){return{pose_matrix:o.coreEvents.getPanoPoseMatrix(t)}},l.flyToModelPanoramaMode=function(t){o.actionEvents.flyToModelPanoramaMode(t)},l.flyToModelDollhouseMode=function(t){o.actionEvents.flyToModelDollhouseMode(t)},l.switchToModelPanoramaModeOfFade=function(t){o.actionEvents.switchToModelPanoramaModeOfFade(t)},l.switchToModelPanoramaViewOfFadeFromDollhouseView=function(t){o.actionEvents.switchToModelPanoramaViewOfFadeFromDollhouseView(t)},l.setWaypointSwitchConfig=function(t){var e={id:t.id,switch_mode:t.mode,config:t.config};o.modelEvents.setWaypointSwitchConfig(e)},l.getIntersectWithinFloorBox=function(t,e,n){return i.player.model.floors.get(t).computeIntersectWithinPlaneCollider(e,n)},l.computeFloorBoxContainsPoint=function(t,e){return i.player.model.floors.get(t).box3.containsPoint(e)},l.fadeIn=function(t){if(null===c){var e=t.origin_opacity,o=t.target_opacity,a=t.duration,s=t.progress||function(){},l=t.complete||function(){};c=new r.Tween({value:e}).to({value:o}).easing(r.Easing.Quadratic.Out).duration(a).onUpdate((function(t){var e=t.value;i.player.model.setOpacity(e),s(e)})).onComplete((function(t){c.stop()})).onStop((function(t){c=null,l(t.value)})).start()}else n.error("model fade in failure, reason: animation is playing!")()},l.fadeOut=function(t){if(null===u){var e=t.origin_opacity,o=t.target_opacity,a=t.duration,s=t.progress||function(){},l=t.complete||function(){};u=new r.Tween({value:e}).to({value:o}).easing(r.Easing.Quadratic.Out).duration(a).onUpdate((function(t){var e=t.value;i.player.model.setOpacity(e),s(e)})).onComplete((function(t){u.stop()})).onStop((function(t){u=null,l(t.value)})).start()}else n.error("model fade out failure, reason: animation is playing!")()},l.enableChunksShadow=function(t){i.sceneRender.renderer.enableChunksShadow(t)},l.getPoseMatrix=function(t){var e=i.modelManager.getModel(t).poseMatrix;return[].concat(e.elements)},l.setSide=function(t){o.modelEvents.setChunksMaterialSide(t)},l.addEventListener=function(t,e){var r=l.name+" add event listener<"+t+">";s[t]?s[t].push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},l.removeEventListener=function(t,e){var r=l.name+" remove event listener<"+t+">";if(s[t]){var i=s[t].indexOf(e);-1!==i?s[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},l.getEventListener=function(){return s},o.actionEvents.addEventListener("switch.waypoint.start",(function(t){s[a.SWITCH_WAYPOINT_START].forEach((function(e){return e(t)}))})),o.actionEvents.addEventListener("switch.waypoint.transition",(function(t){s[a.SWITCH_WAYPOINT_TRANSITION].forEach((function(e){return e(t)}))})),o.actionEvents.addEventListener("switch.waypoint.complete",(function(t){s[a.SWITCH_WAYPOINT_COMPLETE].forEach((function(e){return e(t)}))})),o.modelEvents.addEventListener("switch.floor.complete",(function(t){s[a.SWITCH_FLOOR_COMPLETE].forEach((function(e){return e(t)}))})),o.modelEvents.addEventListener("add.model.complete",(function(t){s[a.ADD_MODEL_COMPLETE].forEach((function(e){return e(t)}))})),o.modelEvents.addEventListener("waypoint.hover.in",(function(t){s[a.WAYPOINT_HOVER_IN].forEach((function(e){return e(t)}))})),o.modelEvents.addEventListener("waypoint.hover.out",(function(t){s[a.WAYPOINT_HOVER_OUT].forEach((function(e){return e(t)}))})),o.raycaster.addEventListener("intersect.model",(function(t){s[a.INTERSECT].forEach((function(e){return e(t)}))})),o.raycaster.addEventListener("unintersect.model",(function(t){s[a.UNINTERSECT].forEach((function(e){return e(t)}))})),t.exports=Object.freeze(l)})),u.commonjsRegister("/$$rollup_base$$/src/api/view.js",(function(t,e){var n=p,r=d.commonEvents,i={MODE_CHANGE:"mode.change"},o=Object.create(null);Object.keys(i).forEach((function(t){o[i[t]]=[]}));var a=Object.create(null);Object.defineProperties(a,{mode:{get:function(){return r.coreEvents.getCurrentMode().mode}}}),a.turnToPanorama=function(t){r.actionEvents.switchToPanoramaViewOfFLy(t)},a.turnToDollhouse=function(t){r.actionEvents.flyToDollhouse(t)},a.turnToFloorplan=function(t){r.actionEvents.flyToFloorplan(t)},a.switchToPanoramaViewOfFade=function(t){r.actionEvents.switchToPanoramaViewOfFade(t)},a.addEventListener=function(t,e){var r=a.name+" add event listener<"+t+">";o[t]?o[t].push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},a.removeEventListener=function(t,e){var r=a.name+" remove event listener<"+t+">";if(o[t]){var i=o[t].indexOf(e);-1!==i?o[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},a.getEventListener=function(){return o},r.actionEvents.addEventListener("mode.changed",(function(t){o[i.MODE_CHANGE].forEach((function(e){return e(t)}))})),t.exports=Object.freeze(a)}));var _=e((function(t){var e;e=d.THREE,t.exports=e}),"/$$rollup_base$$/src/lib/three"),E={TRANSITIONING:"transitioning",PANORAMA:"panorama",DOLLHOUSE:"dollhouse",FLOORPLAN:"floorplan"};u.commonjsRegister("/$$rollup_base$$/src/api/camera/panorama-camera.js",(function(t,e){var n=p,r=_,i=E,o=d.core,a=d.commonEvents,s={ROTATION:"rotation",ROTATION_STOP:"rotation.stop",ZOOM_CHANGED:"zoom.changed"},l=Object.create(null);Object.keys(s).forEach((function(t){l[s[t]]=[]}));var c=Object.create(null);Object.defineProperties(c,{fov:{get:function(){return o.player.cameras[i.PANORAMA].getFov()}},near:{get:function(){return o.player.cameras[i.PANORAMA].near}},far:{get:function(){return o.player.cameras[i.PANORAMA].far}},zoom:{get:function(){return o.player.cameras[i.PANORAMA].zoom}},position:{get:function(){var t=o.player.cameras[i.PANORAMA].getPosition();return Object.assign(Object.create(null),t)}},quaternion:{get:function(){var t=o.player.cameras[i.PANORAMA].getQuaternion();return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z,w:t.w})}},direction:{get:function(){var t=o.player.cameras[i.PANORAMA],e=new r.Vector3;return t.getWorldDirection(e),Object.assign(Object.create(null),e)}},target:{get:function(){var t=o.player.controls[i.PANORAMA].target;return Object.assign(Object.create(null),t)}},matrixWorld:{get:function(){var t=o.player.cameras[i.PANORAMA].matrixWorld;return[].concat(t.elements)}},matrixWorldInverse:{get:function(){var t=o.player.cameras[i.PANORAMA].matrixWorldInverse;return[].concat(t.elements)}},projectionMatrix:{get:function(){var t=o.player.cameras[i.PANORAMA].projectionMatrix;return[].concat(t.elements)}},projectionMatrixInverse:{get:function(){var t=o.player.cameras[i.PANORAMA].projectionMatrixInverse;return[].concat(t.elements)}},enabledControl:{get:function(){return o.player.controls[i.PANORAMA].enabled}}}),c.setFov=function(t){o.player.cameras[i.PANORAMA].setFov(t)},c.setZoom=function(t){o.player.cameras[i.PANORAMA].setZoom(t)},c.setZoomLimit=function(t){a.coreEvents.setPanoramaModeZoom(t)},c.setPosition=function(t){o.player.cameras[i.PANORAMA].setPosition(t)},c.setQuaternion=function(t){o.player.cameras[i.PANORAMA].setQuaternion(t)},c.setHorizontalRotateScope=function(t,e){a.coreEvents.setHorizontalScopeOfPanoramaControl(t,e)},c.setVerticalRotateScope=function(t,e){a.coreEvents.setVerticalScopeOfPanoramaControl(t,e)},c.resetHorizontalRotateScope=function(){a.coreEvents.resetHorizontalScopeOfPanoramaControl()},c.resetVerticalRotateScope=function(){a.coreEvents.resetVerticalScopeOfPanoramaControl()},c.rotateOfHorizontal=function(t){var e=t.deg,n=t.duration,r=t.progress||function(){},i=t.complete||function(){};a.actionEvents.cameraClockwiseRotate({deg:e,duration:n,progress:function(t){r(t)},complete:function(){i()}})},c.rotateOfVertical=function(t){a.coreEvents.cameraRotateOfVertical(t)},c.stopRotation=function(){a.actionEvents.stopPanoramaControlRotation()},c.lookAtTarget=function(t){var e=t.target,n=t.duration,r=t.progress||function(){},i=t.complete||function(){};a.actionEvents.cameraLookAt({target:e,duration:n,progress:function(t){r(t)},complete:function(){i()}})},c.lookAtQuaternion=function(t){var e=t.quaternion,n=t.duration,r=t.progress||function(){},i=t.complete||function(){};a.actionEvents.cameraLookAtRotation({rotation:e,duration:n,progress:function(t){r(t)},complete:function(){i()}})},c.disableZoomControl=function(){a.coreEvents.disableZoomControl()},c.enableZoomControl=function(){a.coreEvents.enableZoomControl()},c.disableControl=function(){a.coreEvents.disablePanoramaControl()},c.enableControl=function(){a.coreEvents.enablePanoramaControl()},c.addEventListener=function(t,e){var r=c.name+" add event listener<"+t+">";l[t]?l[t].push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},c.removeEventListener=function(t,e){var r=c.name+" remove event listener<"+t+">";if(l[t]){var i=l[t].indexOf(e);-1!==i?l[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},c.getEventListener=function(){return Object.freeze(l)},a.actionEvents.addEventListener("panorama.camera.rotate",(function(t){l[s.ROTATION].forEach((function(e){return e(t)}))})),a.actionEvents.addEventListener("panorama.camera.rotate.stop",(function(t){l[s.ROTATION_STOP].forEach((function(e){return e(t)}))})),a.actionEvents.addEventListener("panorama.camera.zoom.changed",(function(t){l[s.ZOOM_CHANGED].forEach((function(e){return e(t)}))})),t.exports=Object.freeze(c)})),u.commonjsRegister("/$$rollup_base$$/src/api/camera/dollhouse-camera.js",(function(t,e){var n=p,r=_,i=E,o=d.core,a=d.commonEvents,s={ROTATION:"rotation",ROTATION_STOP:"rotation.stop",ZOOM_CHANGED:"zoom.changed",DISTANCE_ZOOM_CHANGED:"distance.zoom.changed",DRAG_MOVING:"drag.moving"},l=Object.create(null);Object.keys(s).forEach((function(t){l[s[t]]=[]}));var c=Object.create(null);Object.defineProperties(c,{fov:{get:function(){return o.player.cameras[i.DOLLHOUSE].fov}},near:{get:function(){return o.player.cameras[i.DOLLHOUSE].near}},far:{get:function(){return o.player.cameras[i.DOLLHOUSE].far}},zoom:{get:function(){return o.player.cameras[i.DOLLHOUSE].zoom}},position:{get:function(){var t=o.player.cameras[i.DOLLHOUSE].position;return Object.assign(Object.create(null),t)}},quaternion:{get:function(){var t=o.player.cameras[i.DOLLHOUSE].quaternion;return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z,w:t.w})}},direction:{get:function(){var t=o.player.cameras[i.DOLLHOUSE].getDirection();return Object.assign(Object.create(null),t)}},target:{get:function(){var t=a.coreEvents.getDollhouseControlTarget();return Object.assign(Object.create(null),t)}},matrixWorld:{get:function(){var t=o.player.cameras[i.DOLLHOUSE].matrixWorld;return[].concat(t.elements)}},matrixWorldInverse:{get:function(){var t=o.player.cameras[i.DOLLHOUSE].matrixWorldInverse;return[].concat(t.elements)}},projectionMatrix:{get:function(){var t=o.player.cameras[i.DOLLHOUSE].projectionMatrix;return[].concat(t.elements)}},projectionMatrixInverse:{get:function(){var t=o.player.cameras[i.DOLLHOUSE].projectionMatrixInverse;return[].concat(t.elements)}},zoomEnabled:{get:function(){return o.player.controls[i.DOLLHOUSE].cameraZoomEnabled}},distanceZoomEnabled:{get:function(){return o.player.controls[i.DOLLHOUSE].distanceZoomEnabled}}}),c.lookAt=function(t){o.player.controls[i.DOLLHOUSE].lookAt(t)},c.setZoomLimit=function(t){a.coreEvents.setDollhouseModeZoom(t)},c.setZoom=function(t){o.player.cameras[i.DOLLHOUSE].setZoom(t)},c.setPosition=function(t){o.player.cameras[i.DOLLHOUSE].setPosition(t)},c.setQuaternion=function(t){o.player.cameras[i.DOLLHOUSE].setQuaternion(t)},c.setControlTarget=function(t){a.coreEvents.setDollhouseControlTarget(t)},c.switchPosition=function(t){a.actionEvents.dollhouseCameraSwitchToPosition(t)},c.switchQuaternion=function(t){a.actionEvents.dollhouseCameraSwitchToQuaternion(t)},c.switchPose=function(t){a.actionEvents.dollhouseCameraSwitchPose(t)},c.disableControl=function(){a.coreEvents.disableDollhouseControl()},c.enableControl=function(){a.coreEvents.enableDollhouseControl()},c.getDefaultPose=function(t){return a.coreEvents.getDollhouseViewDefaultPose(t)},c.getBackwardPose=function(t){return a.coreEvents.getDollhouseViewBackwardPose(t)},c.enableZoomControl=function(){a.coreEvents.enableDollhouseCameraZoomControl()},c.disableZoomControl=function(){a.coreEvents.disableDollhouseCameraZoomControl()},c.enableDistanceZoomControl=function(){a.coreEvents.enableDollhouseCameraDistanceZoomControl()},c.disableDistanceZoomControl=function(){a.coreEvents.disableDollhouseCameraDistanceZoomControl()},c.setZoomLimit=function(t){a.coreEvents.setDollhouseModeZoom({min:t.min,max:t.max})},c.setDistanceZoomLimit=function(t){a.camera.setDollhouseCameraDistanceLimit({min:t.min,max:t.max})},c.setPolarAngle=function(t){a.coreEvents.setDollhousePolarAngle({min:t.min,max:t.max})},c.computeControlTarget=function(t,e){var n=(new r.Vector3).copy(t),i=(new r.Quaternion).copy(e),o=(new r.Vector3).copy({x:0,y:0,z:-1});return o.applyQuaternion(i).normalize(),(new r.Vector3).addVectors(n,o)},c.addEventListener=function(t,e){var r=c.name+" add event listener<"+t+">";l[t]?l[t].push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},c.removeEventListener=function(t,e){var r=c.name+" remove event listener<"+t+">";if(l[t]){var i=l[t].indexOf(e);-1===i?l[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},c.getEventListener=function(){return Object.freeze(l)},a.actionEvents.addEventListener("dollhouse.camera.rotate",(function(t){l[s.ROTATION].forEach((function(e){return e(t)}))})),a.actionEvents.addEventListener("dollhouse.camera.rotate.stop",(function(t){l[s.ROTATION_STOP].forEach((function(e){return e(t)}))})),a.actionEvents.addEventListener("dollhouse.camera.zoom.changed",(function(t){l[s.ZOOM_CHANGED].forEach((function(e){return e(t)}))})),a.actionEvents.addEventListener("dollhouse.camera.distance.zoom.changed",(function(t){l[s.DISTANCE_ZOOM_CHANGED].forEach((function(e){return e(t)}))})),a.actionEvents.addEventListener("dollhouse.camera.drag.moving",(function(t){l[s.DRAG_MOVING].forEach((function(e){return e(t)}))})),t.exports=Object.freeze(c)})),u.commonjsRegister("/$$rollup_base$$/src/api/camera/floorplan-camera.js",(function(t,e){var n=p,r=E,i=d.core,o=d.commonEvents,a={ZOOM_CHANGE:"zoom.change",DRAG_MOVING:"drag.moving"},s=Object.create(null);Object.keys(a).forEach((function(t){s[a[t]]=[]}));var l=Object.create(null);Object.defineProperties(l,{left:{get:function(){return i.player.cameras[r.FLOORPLAN].left}},right:{get:function(){return i.player.cameras[r.FLOORPLAN].right}},top:{get:function(){return i.player.cameras[r.FLOORPLAN].top}},bottom:{get:function(){return i.player.cameras[r.FLOORPLAN].bottom}},near:{get:function(){return i.player.cameras[r.FLOORPLAN].near}},far:{get:function(){return i.player.cameras[r.FLOORPLAN].far}},zoom:{get:function(){return i.player.cameras[r.FLOORPLAN].zoom}},position:{get:function(){var t=i.player.cameras[r.FLOORPLAN].getPosition();return Object.assign(Object.create(null),t)}},quaternion:{get:function(){var t=i.player.cameras[r.FLOORPLAN].getQuaternion();return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z,w:t.w})}},direction:{get:function(){var t=i.player.cameras[r.FLOORPLAN].getDirection();return Object.assign(Object.create(null),t)}},target:{get:function(){var t=i.player.controls[r.FLOORPLAN].target;return Object.assign(Object.create(null),t)}},matrixWorld:{get:function(){var t=i.player.cameras[r.FLOORPLAN].matrixWorld;return[].concat(t.elements)}},matrixWorldInverse:{get:function(){var t=i.player.cameras[r.FLOORPLAN].matrixWorldInverse;return[].concat(t.elements)}},projectionMatrix:{get:function(){var t=i.player.cameras[r.FLOORPLAN].projectionMatrix;return[].concat(t.elements)}},projectionMatrixInverse:{get:function(){var t=i.player.cameras[r.FLOORPLAN].projectionMatrixInverse;return[].concat(t.elements)}},enabledControl:{get:function(){return i.player.controls[r.FLOORPLAN].enabled}},enabledZoomControl:{get:function(){return i.player.controls[r.FLOORPLAN].zoomEnabled}},enabledPanControl:{get:function(){return i.player.controls[r.FLOORPLAN].panEnabled}}}),l.enableControl=function(){o.coreEvents.enableFloorplanControl()},l.enableZoomControl=function(){o.coreEvents.enableFloorplanZoomControl()},l.enablePanControl=function(){o.coreEvents.enableFloorplanPanControl()},l.disableControl=function(){o.coreEvents.disableFloorplanControl()},l.disableZoomControl=function(){o.coreEvents.disableFloorplanZoomControl()},l.disablePanControl=function(){o.coreEvents.disableFloorplanPanControl()},l.setZoom=function(t){i.player.controls[r.FLOORPLAN].setZoom(t)},l.setZoomLimit=function(t){o.coreEvents.setFloorplanModeZoom({min:t.min,max:t.max})},l.addEventListener=function(t,e){var r=l.name+" add event listener<"+t+">";s[t]?s[t].push(e):n.error(r+" failure, reason: invalid event name<"+t+">!")()},l.removeEventListener=function(t,e){var r=l.name+" remove event listener<"+t+">";if(s[t]){var i=s[t].indexOf(e);-1===i?s[t].splice(i,1):n.error(r+" failure, reason: invalid event callback!")()}else n.error(r+" failure, reason: invalid event name<"+t+">!")()},l.getEventListener=function(){return Object.freeze(s)},o.actionEvents.addEventListener("floorplan.camera.zoom.changed",(function(t){s[a.ZOOM_CHANGE].forEach((function(e){return e(t)}))})),o.actionEvents.addEventListener("floorplan.camera.drag.moving",(function(t){s[a.DRAG_MOVING].forEach((function(e){return e(t)}))})),t.exports=Object.freeze(l)})),u.commonjsRegister("/$$rollup_base$$/src/api/camera/magnifying-camera.js",(function(t,e){var n=_,r=d.core,i=d.commonEvents,o=Object.create(null);Object.defineProperties(o,{fov:{get:function(){return r.sceneRender.magnifyingCamera.fov}},near:{get:function(){return r.sceneRender.magnifyingCamera.near}},far:{get:function(){return r.sceneRender.magnifyingCamera.far}},zoom:{get:function(){return r.sceneRender.magnifyingCamera.zoom}},position:{get:function(){var t=r.sceneRender.magnifyingCamera.position;return Object.assign(Object.create(null),t)}},quaternion:{get:function(){var t=r.sceneRender.magnifyingCamera.quaternion;return Object.assign(Object.create(null),{x:t.x,y:t.y,z:t.z,w:t.w})}},direction:{get:function(){var t=r.sceneRender.magnifyingCamera.getWorldDirection(new n.Vector3);return Object.assign(Object.create(null),t)}},defaultZoom:{get:function(){return i.camera.getMagnifyingCameraDefaultZoom()}}}),o.enable=function(){i.coreEvents.enableMagnifyingMode()},o.disable=function(){i.coreEvents.disableMagnifyingMode()},o.show=function(){i.coreEvents.showMagnifyingGlass()},o.showViewport=function(){i.coreEvents.showMagnifyingGlass()},o.hide=function(){i.coreEvents.hideMagnifyingGlass()},o.hideViewport=function(){i.coreEvents.showMagnifyingGlass()},o.setSize=function(t,e){i.coreEvents.setMagnifyingGlassSize(t,e)},o.setViewportSize=function(t,e){i.coreEvents.setMagnifyingGlassSize(t,e)},o.setFov=function(t){r.sceneRender.magnifyingCamera.setFov(t)},o.setZoom=function(t){r.sceneRender.magnifyingCamera.setZoom(t)},o.setPosition=function(t){i.coreEvents.setMagnifyingPosition(t)},o.setCameraPosition=function(t){i.camera.magnifyingCameraSetPosition(t)},o.lookAt=function(t){i.camera.magnifyingCameraLookAtTarget(t)},t.exports=Object.freeze(o)}));var T=d.math;var x={getVerticesOfItemSize:function(t){for(var e=t.attributes.position,n=e.itemSize,r=[],i={},o=0,a=e.array.length;o<a;o+=n){var s=e.array[o],l=e.array[o+1],c=e.array[o+2],u="k_"+s+"_"+l+"_"+c;void 0===i[u]&&(r.push(new _.Vector3(s,l,c)),i[u]=1)}return r},convertVisionQuaternion2:function(t){return new _.Quaternion(t.x,t.z,-t.y,t.w)},convertWorldPositionToScreen:function(t,e){var n=document.getElementById("renderer-stage"),r=t.clone().project(e),i=n.clientWidth/2,o=n.clientHeight/2;return{x:r.x*i+i,y:-r.y*o+o}},computeWorldPositionOutCamera:function(t,e,n){var r=(t=t.clone()).applyMatrix4(e).applyMatrix4(n),i=Math.abs(r.x)>1,o=Math.abs(r.y)>1,a=Math.abs(r.z)>1;return!!(i||o||a)},computeWorldPositionOutCamera2:function(t,e,n){var r=(t=t.clone()).applyMatrix4(e).applyMatrix4(n);return Math.abs(r.z)>1},convertVisionVector:T.convertVisionVector,convertVisionQuaternion:T.convertVisionQuaternion,convertScreenPositionToNDC:T.convertScreenPositionToNDC};u.commonjsRegister("/$$rollup_base$$/src/api/camera/scene-camera.js",(function(t,e){var n=_,r=d.core,i=d.commonEvents,o=x.convertWorldPositionToScreen,a=x.computeWorldPositionOutCamera,s=Object.create(null);Object.defineProperties(s,{fov:{get:function(){return r.sceneRender.camera.fov}},zoom:{get:function(){return r.sceneRender.camera.zoom}},position:{get:function(){var t=r.sceneRender.camera.getPosition(),e=Object.create(null);return e.x=t.x,e.y=t.y,e.z=t.z,e}},quaternion:{get:function(){var t=r.sceneRender.camera.getQuaternion(),e=Object.create(null);return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}},target:{get:function(){var t=new n.Vector3;return i.coreEvents.getActiveCamera().getWorldDirection(t),{x:t.x,y:t.y,z:t.z}}},matrixWorld:{get:function(){var t=r.sceneRender.camera.matrixWorld;return[].concat(t.elements)}},matrixWorldInverse:{get:function(){var t=r.sceneRender.camera.matrixWorldInverse;return[].concat(t.elements)}},projectionMatrix:{get:function(){var t=r.sceneRender.camera.projectionMatrix;return[].concat(t.elements)}},projectionMatrixInverse:{get:function(){var t=r.sceneRender.camera.projectionMatrixInverse;return[].concat(t.elements)}}}),s.setFov=function(t){i.camera.setSceneCameraFov(t)},s.setNear=function(t){i.camera.setSceneCameraNear(t)},s.setFar=function(t){i.camera.setSceneCameraFar(t)},s.setZoom=function(t){i.camera.setSceneCameraZoom(t)},s.convertWorldPositionToScreen=function(t){var e=new n.Vector3(t.x,t.y,t.z),i=r.sceneRender.camera,s=o(e,i),l=a(e,i.matrixWorldInverse,i.projectionMatrix);return{x:s.x,y:s.y,isOutCamera:l}},s.getLevelAngleTo=function(t,e){var r=new n.Vector2(t.x,t.z),i=new n.Vector2(e.x,e.z),o=180*(r.angle()-i.angle())/Math.PI;return o<=0?-o:360-o},t.exports=Object.freeze(s)})),u.commonjsRegister("/$$rollup_base$$/src/api/lights.js",(function(t,e){var n=d.commonEvents,r=d.core,i=Object.create(null);i.enableAmbientLight=function(t){n.coreEvents.enableAmbientLight(t)},i.enableDirectLight=function(t){n.coreEvents.enableDirectLight(t)},i.disableAmbientLight=function(){n.coreEvents.disableAmbientLight()},i.disableDirectLight=function(){n.coreEvents.disableDirectLight()},i.setAmbientLightColor=function(t){n.coreEvents.setAmbientLightColor(t)},i.setAmbientLightIntensity=function(t){n.coreEvents.setAmbientLightIntensity(t)},i.setDirectLightColor=function(t){n.coreEvents.setDirectLightColor(t)},i.setDirectLightIntensity=function(t){n.coreEvents.setDirectLightIntensity(t)},i.setDirectLightPosition=function(t){n.coreEvents.setDirectLightPosition(t)},i.setDirectLightLookAt=function(t){n.coreEvents.setDirectLightLookAt(t)},i.setDirectLightShadowCameraSize=function(t){r.sceneRender.renderer.setDLightShadowCameraSize(t)},t.exports=Object.freeze(i)})),u.commonjsRegister("/$$rollup_base$$/src/api/raycaster.js",(function(t,e){d.core;var n=d.commonEvents,r=Object.create(null);r.getPointerIntersectWithinModel=function(t,e){return n.coreEvents.getIntersectWithinPointer(t,e)},r.getCurrentPointerIntersectWithinModel=function(){return n.coreEvents.getMouseIntersectWithinModel()},r.computeIntersectCountWithinModelBetweenThePoint=function(t,e){return n.coreEvents.getIntersectCountBetweenThePoint(t,e)},r.computeBarrierWithinModelBetweenThePoint=function(t,e){return n.coreEvents.judgeBarrierBetweenThePoint(t,e)},t.exports=Object.freeze(r)})),u.commonjsRegister("/$$rollup_base$$/src/api/tools.js",(function(t,e){var n=d.commonEvents,r=Object.create(null);Object.defineProperties(r,{}),r.showFps=function(){n.coreEvents.showFps()},r.hideFps=function(){n.coreEvents.hideFps()},r.showArrowLine=function(){},r.hideArrowLine=function(){},r.showLine=function(){},r.hideLine=function(){},t.exports=Object.freeze(r)})),u.commonjsRegister("/$$rollup_base$$/src/api/math.js",(function(t,e){var n=_,r=Object.create(null);r.computeLineCenter=function(t,e){var r=new n.Line3(t,e),i=new n.Vector3,o=Object.create(null);return r.getCenter(i),o.x=i.x,o.y=i.y,o.z=i.z,o},r.computeDistance=function(t,e){var r=(new n.Vector3).copy(t),i=(new n.Vector3).copy(e);return r.distanceTo(i)},r.computeTriangleCenter=function(t,e,r){var i=new n.Triangle(t,e,r),o=new n.Vector3,a=Object.create(null);return i.getMidpoint(o),a.x=o.x,a.y=o.y,a.z=o.z,a},r.divideScalarOfVector3=function(t,e){return(new n.Vector3).copy(t).divideScalar(e)},r.transformPosition=function(t,e){var r=new n.Matrix4;return r.elements=t,(new n.Vector3).copy(e).applyMatrix4(r)},r.transformQuaternion=function(t,e){var r=new n.Matrix4;r.elements=t;var i=new n.Vector3,o=new n.Quaternion,a=new n.Vector3,s=(new n.Quaternion).copy(e);return r.decompose(i,o,a),(new n.Quaternion).multiplyQuaternions(o,s)},r.transformScale=function(t,e){var r=new n.Matrix4;r.elements=t;var i=new n.Vector3,o=new n.Quaternion,a=new n.Vector3;return r.decompose(i,o,a),(new n.Vector3).copy(e).multiply(a)},t.exports=Object.freeze(r)}));var b=Object.create(null),M=new Map;b.carray=function(t,e){M.set(t,e)},b.get=function(t){return M.get(t)};var A=b,S=d.commonEvents,O=Object.create(null);O.init=function(){},O.disableSwitchToPano=Object.create(null),O.enableSwitchToPano=Object.create(null),O.disablePanoramaControl=Object.create(null),O.enablePanoramaControl=Object.create(null),O.disableHitWall=Object.create(null),O.enableHitWall=Object.create(null),Object.defineProperties(O.disableSwitchToPano,{join:{get:function(){return L}}}),Object.defineProperties(O.enableSwitchToPano,{join:{get:function(){return D}}}),Object.defineProperties(O.disablePanoramaControl,{join:{get:function(){return C}}}),Object.defineProperties(O.enablePanoramaControl,{join:{get:function(){return P}}}),Object.defineProperties(O.disableHitWall,{join:{get:function(){return N}}}),Object.defineProperties(O.enableHitWall,{join:{get:function(){return R}}}),A.carray("interaction",O);var w=O;function L(t,e){O.disableSwitchToPano[t]=e,!0===e.state&&S.coreEvents.disableSwitchToPano()}function D(t,e){O.enableSwitchToPano[t]=e;var n=O.disableSwitchToPano;for(var r in n){if(!0===n[r].state)return}"transitioning"!==S.coreEvents.getCurrentMode().mode&&S.coreEvents.enableSwitchToPano()}function C(t,e){O.disablePanoramaControl[t]=e,!0===e.state&&S.coreEvents.disablePanoramaControl()}function P(t,e){O.enablePanoramaControl[t]=e;var n=O.disablePanoramaControl;for(var r in n){if(!0===n[r].state)return}S.coreEvents.enablePanoramaControl()}function N(t,e){O.disableHitWall[t]=e,!0===e.state&&S.actionEvents.disableHitWall()}function R(t,e){O.enableHitWall[t]=e;var n=O.disableHitWall;for(var r in n){if(!0===n[r].state)return}S.actionEvents.enableHitWall()}var I={config:{path:"@/api/config"},core:{path:"@/api/core"},scene:{path:"@/api/scene"},model:{path:"@/api/model"},view:{path:"@/api/view"},panoramaCamera:{path:"@/api/camera/panorama-camera"},dollhouseCamera:{path:"@/api/camera/dollhouse-camera"},floorplanCamera:{path:"@/api/camera/floorplan-camera"},magnifyingCamera:{path:"@/api/camera/magnifying-camera"},sceneCamera:{path:"@/api/camera/scene-camera"},lights:{path:"@/api/lights"},raycaster:{path:"@/api/raycaster"},tools:{path:"@/api/tools"},math:{path:"@/api/math"}},U="pc",B="webxr",F="mobile",H=d.commonExtension,k=Object.create(null),z=Object.create(null),G=["name","registeredApi","onApi","register","init","install","uninstall"];function W(){this.name="Extension",this.installedCallback=Object.create(null),Object.defineProperties(this,{registeredExts:{get:function(){return k}},installedExts:{get:function(){return z}}})}function V(t){return!!k[t]}function j(t){return!!z[t]}W.prototype.init=function(){p.info(this.name+" init")()},W.prototype.mount=function(t,e){this.registerExt(t),this.install(t.name,(function(){e()}))},W.prototype.registerExt=function(t){(function(t){if(!t)return p.error("ext <"+t+"> invalid")(),!1;for(var e=0,n=G.length;e<n;++e){var r=G[e];if(!t[r])return p.error("ext <"+t.constructor.name+"> invalid, missing <"+r+">")(),!1}return!0})(t)&&(V(t.name)?p.warn("ext <"+t.name+"> registered!")():(Object.defineProperty(t,"parent",{writable:!1,value:this.parent}),k[t.name]=t,t.register()))},W.prototype.install=function(t,e){void 0===e&&(e=function(){});var n="install ext: "+t+" failure";if(j(t))p.error("ext <"+t+"> already installed!")();else if(V(t)){var r=function(t){return k[t]}(t);if(r.supportPlatform||p.error("ext <"+t+"> support platform undefined!")(),g.isWebxr()&&!g.isSpecialMobile()){if(!r.supportPlatform)return void p.warn(n+", reason: "+t+" not support "+B+"!")();if(-1===r.supportPlatform.indexOf(B))return void p.warn(n+", reason: "+t+" not support "+B+"!")();i(t,r)}else{if(g.isMobile()){if(r.supportPlatform&&-1===r.supportPlatform.indexOf(F))return void p.warn(n+", reason: "+t+" not support "+F+"!")();i(t,r)}if(g.isPc()){if(r.supportPlatform&&-1===r.supportPlatform.indexOf(U))return void p.warn(n+", reason: "+t+" not support "+U+"!")();i(t,r)}}}else p.error("ext <"+t+"> unregister!")();function i(t,n){!function(t,e,n){void 0===n&&(n=function(){});p.info("add ext "+t)(),H.addExt(e,(function(){z[t]=e,e.install&&e.install((function(){n()}))}))}(t,n,(function(){e()}))}},W.prototype.uninstall=function(t){var e="uninstall ext: "+t+" failure";j(t)?H.canbeUse()?H.removeExt(t,(function(){var e=z[t];delete z[t],e.remove()})):p.warn(e+", reason: commonExtension can't use")():p.warn(e+", reason: not install")()};var Y=W,X=d.commonEvents,Z=d.commonExtension,q=d.TWEEN,Q={development:function(){d.mylog.level=1,p.enabled=!0,p.level=1,Object.defineProperties(K,{ccore:{get:function(){return d}},extension:{get:function(){return $}},interaction:{get:function(){return w}}})},production:function(){d.mylog.level=3,p.enabled=!0,p.level=3,Object.defineProperties(K,{extension:{get:function(){return $}},interaction:{get:function(){return w}}})}},K=Object.create(null);K.name="qspace",K.env="production",K.bundle="Tue Jan 07 2025 19:06:46 GMT+0800 (China Standard Time)",K.version="1.5.0",K.commonEvents=X,K.commonExtension=Z,K.THREE=_,K.TWEEN=q,window[K.name]&&(window[K.name]=K);var J,$=new Y;return Object.defineProperty($,"parent",{writable:!1,value:K}),Q.production(),J=I,Object.keys(J).forEach((function(t){for(var e=J[t].path.split("/"),n="./",r=1;r<e.length-1;++r)n+=e[r]+"/";var i=""+n+e[e.length-1]+".js";K[t]=c(i,"/$$rollup_base$$/src")})),$.init(),w.init(),Object.freeze(K)}));
